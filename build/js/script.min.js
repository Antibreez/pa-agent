"use strict";$(".date-input").datepicker(),function(){var e=document.querySelectorAll(".input-file__label");function t(e){var t=e.querySelector("input");function n(e){e.preventDefault(),e.stopPropagation()}function i(t){e.classList.add("highlight")}function o(t){e.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,n,!1)})),["dragenter","dragover"].forEach((function(t){e.addEventListener(t,i,!1)})),["dragleave","drop"].forEach((function(t){e.addEventListener(t,o,!1)})),e.addEventListener("drop",(function(e){var n=e.dataTransfer.files;t.files&&t.files[0]&&(t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file"));t.files=n,c()}),!1);var c=function(){s(t)},s=function(t){if(t.files&&t.files[0]){var n=new FileReader;n.onload=function(n){e.parentNode.classList.add("loaded"),e.nextElementSibling.querySelector(".file-load__name").textContent=t.files[0].name},n.readAsDataURL(t.files[0])}};t.addEventListener("change",c)}window.makeFileLoad=t,e[0]&&e.forEach((function(e){t(e)}))}(),function(){var e=document.querySelectorAll(".delivery-or-pickup__modal-time");if(e[0]){var t=new Inputmask("99:99");e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelectorAll(".input-text");e[0]&&e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))}))}(),function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));var t=document.querySelector("body");function n(e,t){this.trigger=e,this.modal=t,this.overlay=this.modal.querySelector(".modal__overlay"),this.closeBtn=this.modal.querySelector(".modal__close"),this.onOverlayClick=this.onOverlayClick.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onTriggerClick=this.onTriggerClick.bind(this),this.onResize=this.onResize.bind(this),this.addEventListeners()}n.prototype.open=function(){this.modal.classList.add("js-show"),t.classList.add("js__body-no-scroll")},n.prototype.close=function(){this.modal.classList.remove("js-show"),t.classList.remove("js__body-no-scroll")},n.prototype.onOverlayClick=function(e){e.target===this.overlay&&this.close()},n.prototype.onCloseClick=function(){this.close()},n.prototype.onTriggerClick=function(){this.open()},n.prototype.onResize=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))},n.prototype.addEventListeners=function(){var e,t;this.overlay.addEventListener("click",this.onOverlayClick),this.closeBtn.addEventListener("click",this.onCloseClick),this.trigger.addEventListener("click",this.onTriggerClick),window.addEventListener("resize",(e=this.onResize,function(n){t&&clearTimeout(t),t=setTimeout(e,100,n)}))},window.Modal=n}(),function(){var e=document.querySelectorAll(".search"),t=document.querySelectorAll(".search + .search-close");e[0]&&(e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))})),t.forEach((function(e){e.addEventListener("click",(function(){var t=e.previousElementSibling;t.value="",t.classList.contains("js-inputed")&&t.classList.remove("js-inputed")}))})))}(),$(".select").select2(),$(".select").on("select2:select",(function(e){$(this).addClass("picked")})),$(".contract-info__delivered-toggle").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){if(document.querySelector(".contract-services")){var e=document.querySelectorAll(".contract-services__link");console.log(e);var t=function(e){var t=e.target;console.log(t.classList.contains("chekcbox-btn__label")),(t.classList.contains("checkbox-btn__label")||t.classList.contains("checkbox-btn__checkbox")||t.classList.contains("deliver-or-pickup__confirm-btn")||t.classList.contains("contract-services__delivery-confirm"))&&e.preventDefault()};e.forEach((function(e){e.addEventListener("click",t)}))}}(),document.querySelector(".contracts-all")&&$(".date-input").datepicker(),function(){var e=document.querySelectorAll(".deliver-or-pickup__confirm-btn");if(e[0]){$("#delivery-date").datepicker();var t=document.getElementById("delivery-or-pickup__modal"),n=t.querySelector(".modal__close"),i=t.querySelector(".delivery-or-pickup__modal-input-file"),o=t.querySelector(".input-file__input"),c=t.querySelector(".delivery-or-pickup__modal-time"),s=t.querySelector(".delivery-or-pickup__modal-time"),l=t.querySelector(".checkbox__input");e.forEach((function(e){new Modal(e,t)}));n.addEventListener("click",(function(){i.classList.contains("loaded")&&(i.classList.remove("loaded"),c.value="",s.value="",l.checked=!1,$("#delivery-date").datepicker("setDate",""),o.value="",/safari/i.test(navigator.userAgent)||(o.type="",o.type="file"))}))}}(),$(".filters__btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){var e=document.querySelectorAll(".payment-waiting__confirm-btn");if(e[0]){$("#payment-date").datepicker();var t=document.getElementById("payment-waiting__modal"),n=t.querySelector(".modal__close"),i=t.querySelector(".transactions__check-all input"),o=t.querySelector(".payment-waiting__modal-sender input"),c=t.querySelector(".payment-waiting__modal-recipient input"),s=t.querySelector(".payment-waiting__modal-sum input"),l=t.querySelector(".payment-waiting__modal-purpose input"),a=function(){return t.querySelectorAll(".transactions__check input")};e.forEach((function(e){new Modal(e,t)})),n.addEventListener("click",(function(){i.checked=!1,a().forEach((function(e){e.checked=!1})),$("#payment-date").datepicker("setDate",""),o.value="",c.value="",s.value="",l.value=""})),i.addEventListener("change",(function(){a().forEach((function(e){i.checked?e.checked=!0:e.checked=!1}))}))}}(),$(".support__docs-btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyIsImRhdGUtaW5wdXQuanMiLCJpbnB1dC1maWxlLmpzIiwiaW5wdXQtbWFzay5qcyIsImlucHV0LXRleHQuanMiLCJtb2RhbC5qcyIsInNlYXJjaC5qcyIsInNlbGVjdC5qcyIsImNvbnRyYWN0LXBhZ2UuanMiLCJjb250cmFjdC1zZXJ2aWNlcy5qcyIsImNvbnRyYWN0cy1hbGwuanMiLCJkZWxpdmVyeS1tb2RhbC5qcyIsImZpbHRlcnMuanMiLCJwYXltZW50LWNvbmZpcm0tbW9kYWwuanMiLCJzdXBwb3J0LmpzIl0sIm5hbWVzIjpbIiQiLCJkYXRlcGlja2VyIiwiZmlsZURyb3BBcmVhIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwibWFrZUZpbGVMb2FkIiwiZmlsZUlucHV0IiwicXVlcnlTZWxlY3RvciIsInByZXZlbnREZWZhdWx0cyIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsImhpZ2hsaWdodCIsImNsYXNzTGlzdCIsImFkZCIsInVuaGlnaGxpZ2h0IiwicmVtb3ZlIiwiZm9yRWFjaCIsImV2ZW50TmFtZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJmaWxlcyIsImRhdGFUcmFuc2ZlciIsInZhbHVlIiwidGVzdCIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsInR5cGUiLCJvbkZpbGVDaGFuZ2UiLCJyZWFkVXJsIiwiaW5wdXQiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwicGFyZW50Tm9kZSIsIm5leHRFbGVtZW50U2libGluZyIsInRleHRDb250ZW50IiwibmFtZSIsInJlYWRBc0RhdGFVUkwiLCJ3aW5kb3ciLCJpdGVtIiwiZGVsaXZlcnlUaW1lSW5wdXRzIiwiaW0iLCJJbnB1dG1hc2siLCJtYXNrIiwiaW5wdXRzIiwic3BsaXQiLCJqb2luIiwiY29udGFpbnMiLCJ2aCIsImlubmVySGVpZ2h0IiwiZG9jdW1lbnRFbGVtZW50Iiwic3R5bGUiLCJzZXRQcm9wZXJ0eSIsImNvbmNhdCIsIiRib2R5IiwiTW9kYWwiLCJ0cmlnZ2VyIiwibW9kYWwiLCJ0aGlzIiwib3ZlcmxheSIsImNsb3NlQnRuIiwib25PdmVybGF5Q2xpY2siLCJiaW5kIiwib25DbG9zZUNsaWNrIiwib25UcmlnZ2VyQ2xpY2siLCJvblJlc2l6ZSIsImFkZEV2ZW50TGlzdGVuZXJzIiwicHJvdG90eXBlIiwib3BlbiIsImNsb3NlIiwidGFyZ2V0IiwiZnVuYyIsInRpbWVyIiwiZXZlbnQiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiaXRlbXMiLCJzZWFyY2giLCJwcmV2aW91c0VsZW1lbnRTaWJsaW5nIiwic2VsZWN0MiIsIm9uIiwiYWRkQ2xhc3MiLCJjbGljayIsInBhcmVudCIsIm5leHQiLCJzbGlkZVRvZ2dsZSIsInRvZ2dsZUNsYXNzIiwibGlua3MiLCJjb25zb2xlIiwibG9nIiwib25MaW5rQ2xpY2siLCJsaW5rIiwiZGVsaXZlcnlCdG5zIiwiZ2V0RWxlbWVudEJ5SWQiLCJmaWxlSW5wdXRCbG9jayIsImRhdGVJbnB1dCIsInRpbWVJbnB1dCIsImNvbmZpcm1DaGVja2JveCIsImJ0biIsImNoZWNrZWQiLCJwYXltZW50Q29uZmlybUJ0bnMiLCJtYWluQ2hlY2tib3giLCJzZW5kZXJJbnB1dCIsInJlY2lwaWVudElucHV0Iiwic3VtSW5wdXQiLCJwdXJwb3NlSW5wdXQiLCJnZXRBbGxDaGVja2JveCJdLCJtYXBwaW5ncyI6IkFBQUEsYUNDQUEsRUFBQSxlQUFBQyxhQ0RBLFdBQ0EsSUFBQUMsRUFBQUMsU0FBQUMsaUJBQUEsc0JBRUEsU0FBQUMsRUFBQUgsR0FDQSxJQUFBSSxFQUFBSixFQUFBSyxjQUFBLFNBT0EsU0FBQUMsRUFBQUMsR0FDQUEsRUFBQUMsaUJBQ0FELEVBQUFFLGtCQWFBLFNBQUFDLEVBQUFILEdBQ0FQLEVBQUFXLFVBQUFDLElBQUEsYUFHQSxTQUFBQyxFQUFBTixHQUNBUCxFQUFBVyxVQUFBRyxPQUFBLGFBeEJBLENBQUEsWUFBQSxXQUFBLFlBQUEsUUFBQUMsU0FBQSxTQUFB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dUYsSUFBQXpGLFNBQUEsU0FBQXNCLEdBQ0E4RCxFQUFBRixRQUNBNUQsRUFBQTRELFNBQUEsRUFFQTVELEVBQUE0RCxTQUFBLFNBMUJBLEdDQ0FuRyxFQUFBLHNCQUFBa0YsT0FBQSxXQUNBbEYsRUFBQTBELE1BQUF5QixTQUFBQyxPQUFBQyxjQUNBckYsRUFBQTBELE1BQUE0QixZQUFBIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCgnLmRhdGUtaW5wdXQnKS5kYXRlcGlja2VyKCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgZmlsZURyb3BBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LWZpbGVfX2xhYmVsJyk7XG5cbiAgZnVuY3Rpb24gbWFrZUZpbGVMb2FkKGZpbGVEcm9wQXJlYSkge1xuICAgIHZhciBmaWxlSW5wdXQgPSBmaWxlRHJvcEFyZWEucXVlcnlTZWxlY3RvcignaW5wdXQnKTsgLy8g0KHQsdGA0LDRgdGL0LLQsNC10Lwg0YHRgtCw0L3QtNCw0YDRgtC90YvQtSDRgdC+0LHRi9GC0LjRjyDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlcicsICdkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBwcmV2ZW50RGVmYXVsdHMsIGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0cyhlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cblxuICAgIDsgLy8g0JTQvtCx0LDQstC70Y/QtdC8INGB0YLQuNC70Lgg0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsCDQvdCw0LQg0L3Rg9C20L3QvtC5INC+0LHQu9Cw0YHRgtGM0Y5cblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhpZ2hsaWdodCwgZmFsc2UpO1xuICAgIH0pO1xuICAgIFsnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdW5oaWdobGlnaHQsIGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XG4gICAgfVxuXG4gICAgO1xuXG4gICAgZnVuY3Rpb24gdW5oaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodCcpO1xuICAgIH1cblxuICAgIDsgLy9cblxuICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgaGFuZGxlRHJvcCwgZmFsc2UpO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlRHJvcChlKSB7XG4gICAgICB2YXIgZHQgPSBlLmRhdGFUcmFuc2ZlcjtcbiAgICAgIHZhciBmaWxlcyA9IGR0LmZpbGVzO1xuXG4gICAgICBpZiAoZmlsZUlucHV0LmZpbGVzICYmIGZpbGVJbnB1dC5maWxlc1swXSkge1xuICAgICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgICBpZiAoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmaWxlSW5wdXQuZmlsZXMgPSBmaWxlcztcbiAgICAgIG9uRmlsZUNoYW5nZSgpO1xuICAgIH1cblxuICAgIDtcblxuICAgIHZhciBvbkZpbGVDaGFuZ2UgPSBmdW5jdGlvbiBvbkZpbGVDaGFuZ2UoKSB7XG4gICAgICByZWFkVXJsKGZpbGVJbnB1dCk7XG4gICAgfTtcblxuICAgIHZhciByZWFkVXJsID0gZnVuY3Rpb24gcmVhZFVybChpbnB1dCkge1xuICAgICAgaWYgKGlucHV0LmZpbGVzICYmIGlucHV0LmZpbGVzWzBdKSB7XG4gICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2xvYWRlZCcpO1xuICAgICAgICAgIGZpbGVEcm9wQXJlYS5uZXh0RWxlbWVudFNpYmxpbmcucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fbmFtZScpLnRleHRDb250ZW50ID0gaW5wdXQuZmlsZXNbMF0ubmFtZTtcbiAgICAgICAgfTtcblxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbnB1dC5maWxlc1swXSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpbGVDaGFuZ2UpO1xuICB9XG5cbiAgd2luZG93Lm1ha2VGaWxlTG9hZCA9IG1ha2VGaWxlTG9hZDtcblxuICBpZiAoIWZpbGVEcm9wQXJlYVswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGZpbGVEcm9wQXJlYS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgbWFrZUZpbGVMb2FkKGl0ZW0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBkZWxpdmVyeVRpbWVJbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC10aW1lJyk7XG5cbiAgaWYgKCFkZWxpdmVyeVRpbWVJbnB1dHNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgaW0gPSBuZXcgSW5wdXRtYXNrKFwiOTk6OTlcIik7XG4gIGRlbGl2ZXJ5VGltZUlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaW0ubWFzayhpdGVtKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXRleHQnKTtcblxuICBpZiAoIWlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaW5wdXQudmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJycpIHtcbiAgICAgICAgaW5wdXQudmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKGlucHV0LnZhbHVlICE9PSAnJyAmJiAhaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJykpIHtcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaW5wdXQudmFsdWUgPT09ICcnICYmIGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBcIlwiLmNvbmNhdCh2aCwgXCJweFwiKSk7XG4gIHZhciAkYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcblxuICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jKSB7XG4gICAgdmFyIHRpbWVyO1xuICAgIHJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmICh0aW1lcikgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jLCAxMDAsIGV2ZW50KTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gTW9kYWwodHJpZ2dlciwgbW9kYWwpIHtcbiAgICB0aGlzLnRyaWdnZXIgPSB0cmlnZ2VyO1xuICAgIHRoaXMubW9kYWwgPSBtb2RhbDtcbiAgICB0aGlzLm92ZXJsYXkgPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAgIHRoaXMuY2xvc2VCdG4gPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgICB0aGlzLm9uT3ZlcmxheUNsaWNrID0gdGhpcy5vbk92ZXJsYXlDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DbG9zZUNsaWNrID0gdGhpcy5vbkNsb3NlQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uVHJpZ2dlckNsaWNrID0gdGhpcy5vblRyaWdnZXJDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25SZXNpemUgPSB0aGlzLm9uUmVzaXplLmJpbmQodGhpcyk7XG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QuYWRkKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LmFkZCgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5vbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLm92ZXJsYXkpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uVHJpZ2dlckNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub3BlbigpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIFwiXCIuY29uY2F0KHZoLCBcInB4XCIpKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5vdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbk92ZXJsYXlDbGljayk7XG4gICAgdGhpcy5jbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbG9zZUNsaWNrKTtcbiAgICB0aGlzLnRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uVHJpZ2dlckNsaWNrKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGVib3VuY2UodGhpcy5vblJlc2l6ZSkpO1xuICB9O1xuXG4gIHdpbmRvdy5Nb2RhbCA9IE1vZGFsO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCcpO1xuICB2YXIgY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoICsgLnNlYXJjaC1jbG9zZScpO1xuXG4gIGlmICghaXRlbXNbMF0pIHtcbiAgICByZXR1cm47XG4gIH0gLy8gaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAvLyAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PntcbiAgLy8gICAgIGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2pzLWZvY3VzJyk7XG4gIC8vICAgfSk7XG4gIC8vIH0pO1xuXG5cbiAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChpdGVtLnZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnKSB7XG4gICAgICAgIGl0ZW0udmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKGl0ZW0udmFsdWUgIT09ICcnICYmICFpdGVtLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXRlbS52YWx1ZSA9PT0gJycgJiYgaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG4gIGNsb3NlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHNlYXJjaCA9IGl0ZW0ucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgIHNlYXJjaC52YWx1ZSA9ICcnO1xuXG4gICAgICBpZiAoc2VhcmNoLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIHNlYXJjaC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCgnLnNlbGVjdCcpLnNlbGVjdDIoKTtcbiAgJCgnLnNlbGVjdCcpLm9uKCdzZWxlY3QyOnNlbGVjdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgJCh0aGlzKS5hZGRDbGFzcygncGlja2VkJyk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCgnLmNvbnRyYWN0LWluZm9fX2RlbGl2ZXJlZC10b2dnbGUnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY29udHJhY3RTZXJ2aWNlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1zZXJ2aWNlcycpO1xuXG4gIGlmICghY29udHJhY3RTZXJ2aWNlcykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBsaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1zZXJ2aWNlc19fbGluaycpO1xuICBjb25zb2xlLmxvZyhsaW5rcyk7XG5cbiAgdmFyIG9uTGlua0NsaWNrID0gZnVuY3Rpb24gb25MaW5rQ2xpY2soZSkge1xuICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICBjb25zb2xlLmxvZyh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVrY2JveC1idG5fX2xhYmVsJykpO1xuXG4gICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrYm94LWJ0bl9fbGFiZWwnKSB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2NoZWNrYm94JykgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJykgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY29udHJhY3Qtc2VydmljZXNfX2RlbGl2ZXJ5LWNvbmZpcm0nKSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgfTtcblxuICBsaW5rcy5mb3JFYWNoKGZ1bmN0aW9uIChsaW5rKSB7XG4gICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTGlua0NsaWNrKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY29udHJhY3RzQWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0cy1hbGwnKTtcblxuICBpZiAoIWNvbnRyYWN0c0FsbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gICQoJy5kYXRlLWlucHV0JykuZGF0ZXBpY2tlcigpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRlbGl2ZXJ5QnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyLW9yLXBpY2t1cF9fY29uZmlybS1idG4nKTtcblxuICBpZiAoIWRlbGl2ZXJ5QnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcigpO1xuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbCcpO1xuICB2YXIgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIHZhciBmaWxlSW5wdXRCbG9jayA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLWlucHV0LWZpbGUnKTtcbiAgdmFyIGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICB2YXIgZGF0ZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtdGltZScpO1xuICB2YXIgdGltZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtdGltZScpO1xuICB2YXIgY29uZmlybUNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoZWNrYm94X19pbnB1dCcpO1xuICBkZWxpdmVyeUJ0bnMuZm9yRWFjaChmdW5jdGlvbiAoYnRuKSB7XG4gICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICB9KTtcblxuICB2YXIgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24gb25DbG9zZUNsaWNrKCkge1xuICAgIGlmIChmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QuY29udGFpbnMoJ2xvYWRlZCcpKSB7XG4gICAgICBmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcbiAgICAgIGRhdGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgdGltZUlucHV0LnZhbHVlID0gJyc7XG4gICAgICBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgJCgnI2RlbGl2ZXJ5LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgIGlmICghL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5maWx0ZXJzX19idG4nKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgcGF5bWVudENvbmZpcm1CdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBheW1lbnQtd2FpdGluZ19fY29uZmlybS1idG4nKTtcblxuICBpZiAoIXBheW1lbnRDb25maXJtQnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gICQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCk7XG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXltZW50LXdhaXRpbmdfX21vZGFsJyk7XG4gIHZhciBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgdmFyIG1haW5DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy50cmFuc2FjdGlvbnNfX2NoZWNrLWFsbCBpbnB1dCcpO1xuICB2YXIgc2VuZGVySW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zZW5kZXIgaW5wdXQnKTtcbiAgdmFyIHJlY2lwaWVudElucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcmVjaXBpZW50IGlucHV0Jyk7XG4gIHZhciBzdW1JbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXN1bSBpbnB1dCcpO1xuICB2YXIgcHVycG9zZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcHVycG9zZSBpbnB1dCcpO1xuXG4gIHZhciBnZXRBbGxDaGVja2JveCA9IGZ1bmN0aW9uIGdldEFsbENoZWNrYm94KCkge1xuICAgIHJldHVybiBtb2RhbC5xdWVyeVNlbGVjdG9yQWxsKCcudHJhbnNhY3Rpb25zX19jaGVjayBpbnB1dCcpO1xuICB9O1xuXG4gIHZhciBvbkFsbENoYW5nZSA9IGZ1bmN0aW9uIG9uQWxsQ2hhbmdlKCkge1xuICAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICB2YXIgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24gb25DbG9zZUNsaWNrKCkge1xuICAgIG1haW5DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gICAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgICB9KTtcbiAgICAkKCcjcGF5bWVudC1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgICBzZW5kZXJJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHJlY2lwaWVudElucHV0LnZhbHVlID0gJyc7XG4gICAgc3VtSW5wdXQudmFsdWUgPSAnJztcbiAgICBwdXJwb3NlSW5wdXQudmFsdWUgPSAnJztcbiAgfTtcblxuICBwYXltZW50Q29uZmlybUJ0bnMuZm9yRWFjaChmdW5jdGlvbiAoYnRuKSB7XG4gICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICB9KTtcbiAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICBtYWluQ2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25BbGxDaGFuZ2UpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCgnLnN1cHBvcnRfX2RvY3MtYnRuJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICQoJy5kYXRlLWlucHV0JykuZGF0ZXBpY2tlcigpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgZmlsZURyb3BBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LWZpbGVfX2xhYmVsJyk7XG5cbiAgZnVuY3Rpb24gbWFrZUZpbGVMb2FkKGZpbGVEcm9wQXJlYSkge1xuICAgIGNvbnN0IGZpbGVJbnB1dCA9IGZpbGVEcm9wQXJlYS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIC8vINCh0LHRgNCw0YHRi9Cy0LDQtdC8INGB0YLQsNC90LTQsNGA0YLQvdGL0LUg0YHQvtCx0YvRgtC40Y8g0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsFxuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInLCAnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHByZXZlbnREZWZhdWx0cywgZmFsc2UpXG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdHMgKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfTtcblxuICAgIC8vINCU0L7QsdCw0LLQu9GP0LXQvCDRgdGC0LjQu9C4INC/0YDQuCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNC4INGE0LDQudC70LAg0L3QsNC0INC90YPQttC90L7QuSDQvtCx0LvQsNGB0YLRjNGOXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlciddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGlnaGxpZ2h0LCBmYWxzZSlcbiAgICB9KTtcblxuICAgIFsnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHVuaGlnaGxpZ2h0LCBmYWxzZSlcbiAgICB9KVxuXG4gICAgZnVuY3Rpb24gaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQnKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gdW5oaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodCcpO1xuICAgIH07XG5cbiAgICAvL1xuXG4gICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBoYW5kbGVEcm9wLCBmYWxzZSlcblxuICAgIGZ1bmN0aW9uIGhhbmRsZURyb3AoZSkge1xuICAgICAgbGV0IGR0ID0gZS5kYXRhVHJhbnNmZXJcbiAgICAgIGxldCBmaWxlcyA9IGR0LmZpbGVzXG5cbiAgICAgIGlmIChmaWxlSW5wdXQuZmlsZXMgJiYgZmlsZUlucHV0LmZpbGVzWzBdKSB7XG4gICAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmaWxlSW5wdXQuZmlsZXMgPSBmaWxlcztcbiAgICAgIG9uRmlsZUNoYW5nZSgpO1xuICAgIH07XG5cbiAgICBjb25zdCBvbkZpbGVDaGFuZ2UgPSAoKSA9PiB7XG4gICAgICByZWFkVXJsKGZpbGVJbnB1dCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVhZFVybCA9IChpbnB1dCkgPT4ge1xuICAgICAgaWYgKGlucHV0LmZpbGVzICYmIGlucHV0LmZpbGVzWzBdKSB7XG4gICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2xvYWRlZCcpO1xuICAgICAgICAgIGZpbGVEcm9wQXJlYVxuICAgICAgICAgICAgLm5leHRFbGVtZW50U2libGluZ1xuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX25hbWUnKVxuICAgICAgICAgICAgLnRleHRDb250ZW50ID0gaW5wdXQuZmlsZXNbMF0ubmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGlucHV0LmZpbGVzWzBdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWxlQ2hhbmdlKTtcbiAgfVxuXG4gIHdpbmRvdy5tYWtlRmlsZUxvYWQgPSBtYWtlRmlsZUxvYWQ7XG5cblxuICBpZiAoIWZpbGVEcm9wQXJlYVswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGZpbGVEcm9wQXJlYS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBtYWtlRmlsZUxvYWQoaXRlbSk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgZGVsaXZlcnlUaW1lSW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtdGltZScpO1xuXG4gIGlmICghZGVsaXZlcnlUaW1lSW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGltID0gbmV3IElucHV0bWFzayhcIjk5Ojk5XCIpO1xuXG4gIGRlbGl2ZXJ5VGltZUlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpbS5tYXNrKGl0ZW0pO1xuICB9KTtcblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXRleHQnKTtcblxuICBpZiAoIWlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKFxuICAgICAgICBpbnB1dC52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJ1xuICAgICAgKSB7XG4gICAgICAgIGlucHV0LnZhbHVlID0gJyc7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgaW5wdXQudmFsdWUgIT09ICcnXG4gICAgICAgICYmICFpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKVxuICAgICAgKSB7XG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpbnB1dC52YWx1ZSA9PT0gJydcbiAgICAgICAgJiYgaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSkoKTtcbiIsIigoKSA9PiB7XG4gIGxldCB2aCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMDE7XG4gIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIGAke3ZofXB4YCk7XG5cbiAgY29uc3QgJGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG5cbiAgZnVuY3Rpb24gZGVib3VuY2UoZnVuYyl7XG4gICAgdmFyIHRpbWVyO1xuICAgIHJldHVybiBmdW5jdGlvbihldmVudCl7XG4gICAgICBpZih0aW1lcikgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jLDEwMCxldmVudCk7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIE1vZGFsICh0cmlnZ2VyLCBtb2RhbCkge1xuICAgIHRoaXMudHJpZ2dlciA9IHRyaWdnZXI7XG4gICAgdGhpcy5tb2RhbCA9IG1vZGFsO1xuICAgIHRoaXMub3ZlcmxheSA9IHRoaXMubW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gICAgdGhpcy5jbG9zZUJ0biA9IHRoaXMubW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuXG4gICAgdGhpcy5vbk92ZXJsYXlDbGljayA9IHRoaXMub25PdmVybGF5Q2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uQ2xvc2VDbGljayA9IHRoaXMub25DbG9zZUNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vblRyaWdnZXJDbGljayA9IHRoaXMub25UcmlnZ2VyQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uUmVzaXplID0gdGhpcy5vblJlc2l6ZS5iaW5kKHRoaXMpO1xuXG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGFsLmNsYXNzTGlzdC5hZGQoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QuYWRkKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5vdmVybGF5KSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vblRyaWdnZXJDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMub3BlbigpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICBsZXQgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLXZoJywgYCR7dmh9cHhgKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uT3ZlcmxheUNsaWNrKTtcbiAgICB0aGlzLmNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsb3NlQ2xpY2spO1xuICAgIHRoaXMudHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25UcmlnZ2VyQ2xpY2spO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBkZWJvdW5jZSh0aGlzLm9uUmVzaXplKSk7XG4gIH1cblxuICB3aW5kb3cuTW9kYWwgPSBNb2RhbDtcbn0pKCk7XG4iLCIoKCkgPT4ge1xuICBjb25zdCBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2gnKTtcbiAgY29uc3QgY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoICsgLnNlYXJjaC1jbG9zZScpO1xuXG4gIGlmICghaXRlbXNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gIC8vICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+e1xuICAvLyAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnanMtZm9jdXMnKTtcbiAgLy8gICB9KTtcbiAgLy8gfSk7XG5cbiAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgaXRlbS52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJ1xuICAgICAgKSB7XG4gICAgICAgIGl0ZW0udmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpdGVtLnZhbHVlICE9PSAnJ1xuICAgICAgICAmJiAhaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKVxuICAgICAgKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIGl0ZW0udmFsdWUgPT09ICcnXG4gICAgICAgICYmIGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KVxuICB9KTtcblxuICBjbG9zZS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNlYXJjaCA9IGl0ZW0ucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgIHNlYXJjaC52YWx1ZSA9ICcnO1xuICAgICAgaWYgKFxuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pXG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJCgnLnNlbGVjdCcpLnNlbGVjdDIoKTtcbiAgJCgnLnNlbGVjdCcpLm9uKCdzZWxlY3QyOnNlbGVjdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgJCh0aGlzKS5hZGRDbGFzcygncGlja2VkJyk7XG59KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgJCgnLmNvbnRyYWN0LWluZm9fX2RlbGl2ZXJlZC10b2dnbGUnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNvbnRyYWN0U2VydmljZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3Qtc2VydmljZXMnKTtcblxuICBpZiAoIWNvbnRyYWN0U2VydmljZXMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBsaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1zZXJ2aWNlc19fbGluaycpO1xuICBjb25zb2xlLmxvZyhsaW5rcyk7XG5cbiAgY29uc3Qgb25MaW5rQ2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgY29uc29sZS5sb2codGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2hla2Nib3gtYnRuX19sYWJlbCcpKTtcblxuICAgIGlmIChcbiAgICAgIHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrYm94LWJ0bl9fbGFiZWwnKVxuICAgICAgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tib3gtYnRuX19jaGVja2JveCcpXG4gICAgICB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdkZWxpdmVyLW9yLXBpY2t1cF9fY29uZmlybS1idG4nKVxuICAgICAgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY29udHJhY3Qtc2VydmljZXNfX2RlbGl2ZXJ5LWNvbmZpcm0nKVxuICAgICkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgfVxuXG4gIGxpbmtzLmZvckVhY2goZnVuY3Rpb24obGluaykge1xuICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkxpbmtDbGljayk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgY29udHJhY3RzQWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0cy1hbGwnKTtcblxuICBpZiAoIWNvbnRyYWN0c0FsbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gICQoJy5kYXRlLWlucHV0JykuZGF0ZXBpY2tlcigpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgZGVsaXZlcnlCdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGl2ZXItb3ItcGlja3VwX19jb25maXJtLWJ0bicpO1xuXG4gIGlmICghZGVsaXZlcnlCdG5zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJCgnI2RlbGl2ZXJ5LWRhdGUnKS5kYXRlcGlja2VyKCk7XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbCcpO1xuICBjb25zdCBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICBjb25zdCBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC10aW1lJyk7XG4gIGNvbnN0IHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgY29uc3QgY29uZmlybUNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoZWNrYm94X19pbnB1dCcpO1xuXG4gIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuICAgICAgZGF0ZUlucHV0LnZhbHVlID0gJyc7XG4gICAgICB0aW1lSW5wdXQudmFsdWUgPSAnJztcbiAgICAgIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gICAgICAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG5cbiAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAkKCcuZmlsdGVyc19fYnRuJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBwYXltZW50Q29uZmlybUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGF5bWVudC13YWl0aW5nX19jb25maXJtLWJ0bicpO1xuXG4gIGlmICghcGF5bWVudENvbmZpcm1CdG5zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJCgnI3BheW1lbnQtZGF0ZScpLmRhdGVwaWNrZXIoKTtcblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXltZW50LXdhaXRpbmdfX21vZGFsJyk7XG4gIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICBjb25zdCBtYWluQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudHJhbnNhY3Rpb25zX19jaGVjay1hbGwgaW5wdXQnKTtcbiAgY29uc3Qgc2VuZGVySW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zZW5kZXIgaW5wdXQnKTtcbiAgY29uc3QgcmVjaXBpZW50SW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1yZWNpcGllbnQgaW5wdXQnKTtcbiAgY29uc3Qgc3VtSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zdW0gaW5wdXQnKTtcbiAgY29uc3QgcHVycG9zZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcHVycG9zZSBpbnB1dCcpO1xuXG4gIGNvbnN0IGdldEFsbENoZWNrYm94ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2FjdGlvbnNfX2NoZWNrIGlucHV0Jyk7XG4gIH07XG5cbiAgY29uc3Qgb25BbGxDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KVxuICB9O1xuXG4gIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIG1haW5DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gICAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgIH0pO1xuICAgICQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAgIHNlbmRlcklucHV0LnZhbHVlID0gJyc7XG4gICAgcmVjaXBpZW50SW5wdXQudmFsdWUgPSAnJztcbiAgICBzdW1JbnB1dC52YWx1ZSA9ICcnO1xuICAgIHB1cnBvc2VJbnB1dC52YWx1ZSA9ICcnO1xuICB9O1xuXG4gIHBheW1lbnRDb25maXJtQnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICBtYWluQ2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25BbGxDaGFuZ2UpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJCgnLnN1cHBvcnRfX2RvY3MtYnRuJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSlcbn0pKCk7XG4iXX0=
