"use strict";$(".date-input").datepicker(),function(){var e=document.querySelectorAll(".input-file__label");function t(e){var t=e.querySelector("input");function n(e){e.preventDefault(),e.stopPropagation()}function i(t){e.classList.add("highlight")}function o(t){e.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,n,!1)})),["dragenter","dragover"].forEach((function(t){e.addEventListener(t,i,!1)})),["dragleave","drop"].forEach((function(t){e.addEventListener(t,o,!1)})),e.addEventListener("drop",(function(e){var n=e.dataTransfer.files;t.files&&t.files[0]&&(t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file"));t.files=n,c()}),!1);var c=function(){a(t)},a=function(t){if(t.files&&t.files[0]){var n=new FileReader;n.onload=function(n){e.parentNode.classList.add("loaded"),e.nextElementSibling.querySelector(".file-load__name").textContent=t.files[0].name},n.readAsDataURL(t.files[0])}};t.addEventListener("change",c)}window.makeFileLoad=t,e[0]&&e.forEach((function(e){t(e)}))}(),function(){var e=document.querySelectorAll(".delivery-or-pickup__modal-time");if(e[0]){var t=new Inputmask("99:99");e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelectorAll(".input-text");e[0]&&e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))}))}(),function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));var t=document.querySelector("body");function n(e,t){this.trigger=e,this.modal=t,this.overlay=this.modal.querySelector(".modal__overlay"),this.closeBtn=this.modal.querySelector(".modal__close"),this.onOverlayClick=this.onOverlayClick.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onTriggerClick=this.onTriggerClick.bind(this),this.onResize=this.onResize.bind(this),this.addEventListeners()}n.prototype.open=function(){this.modal.classList.add("js-show"),t.classList.add("js__body-no-scroll")},n.prototype.close=function(){this.modal.classList.remove("js-show"),t.classList.remove("js__body-no-scroll")},n.prototype.onOverlayClick=function(e){e.target===this.overlay&&this.close()},n.prototype.onCloseClick=function(){this.close()},n.prototype.onTriggerClick=function(){this.open()},n.prototype.onResize=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))},n.prototype.addEventListeners=function(){var e,t;this.overlay.addEventListener("click",this.onOverlayClick),this.closeBtn.addEventListener("click",this.onCloseClick),this.trigger.addEventListener("click",this.onTriggerClick),window.addEventListener("resize",(e=this.onResize,function(n){t&&clearTimeout(t),t=setTimeout(e,100,n)}))},window.Modal=n}(),function(){var e=document.querySelectorAll(".search"),t=document.querySelectorAll(".search + .search-close");e[0]&&(e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))})),t.forEach((function(e){e.addEventListener("click",(function(){var t=e.previousElementSibling;t.value="",t.classList.contains("js-inputed")&&t.classList.remove("js-inputed")}))})))}(),function(){function e(e){var t=e.text.split("splitter");return t.length>1?$("<span>"+t[0]+"</span><span>"+t[1]+"</span>"):e.text}$(".select").select2({templateResult:e,templateSelection:e}),$(".select").on("select2:select",(function(e){$(this).addClass("picked")}))}(),function(){var e=document.querySelector(".contract-info__cancellation");if(e){var t=document.getElementById("cancellation__modal");new Modal(e,t)}}(),function(){var e=document.querySelector(".contract-creation");if(e){var t=e.querySelectorAll(".radio__input"),n=e.querySelector(".contract-payment__next"),i=0;$(".contract-subject__agent").on("select2:select",(function(e){i+=1,o()})),$(".contract-subject__service").on("select2:select",(function(){i+=1,o()})),t.forEach((function(e){e.addEventListener("change",(function(){o()}))}))}function o(){var e;i>=3&&(e=!1,t.forEach((function(t){t.checked&&(e=!0)})),e)?n.hasAttribute("disabled")&&n.removeAttribute("disabled"):n.hasAttribute("disabled")||n.setAttribute("disabled","")}}(),$(".contract-info__delivered-toggle").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){if(document.querySelector(".contract-services")){var e=document.querySelectorAll(".contract-services__link"),t=function(e){var t=e.target;console.log(t.classList.contains("chekcbox-btn__label")),(t.classList.contains("checkbox-btn__label")||t.classList.contains("checkbox-btn__checkbox")||t.classList.contains("deliver-or-pickup__confirm-btn")||t.classList.contains("contract-services__delivery-confirm"))&&e.preventDefault()};e.forEach((function(e){e.addEventListener("click",t)}))}}(),document.querySelector(".contracts-all")&&$(".date-input").datepicker(),function(){var e=document.querySelectorAll(".deliver-or-pickup__confirm-btn");if(e[0]){$("#delivery-date").datepicker().on("change",(function(e){u()}));var t=document.getElementById("delivery-or-pickup__modal"),n=t.querySelector(".modal__close"),i=t.querySelector(".modal__overlay"),o=t.querySelector(".modal__submit"),c=t.querySelector(".delivery-or-pickup__modal-input-file"),a=t.querySelector(".input-file__input"),r=t.querySelector(".delivery-or-pickup__modal-date"),l=t.querySelector(".delivery-or-pickup__modal-time"),s=t.querySelector(".checkbox__input");e.forEach((function(e){new Modal(e,t)}));var d=function(){c.classList.contains("loaded")&&(c.classList.remove("loaded"),a.value="",o.setAttribute("disabled",""),/safari/i.test(navigator.userAgent)||(a.type="",a.type="file")),r.value="",l.value="",s.checked=!1,$("#delivery-date").datepicker("setDate","")},u=function(e){v()&&o.hasAttribute("disabled")?o.removeAttribute("disabled"):v()||o.hasAttribute("disabled")||o.setAttribute("disabled","")},v=function(){return $("#delivery-date").datepicker("getDate")&&""!==l.value&&!0===s.checked&&""!==a.value};n.addEventListener("click",d),i.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&d()})),r.addEventListener("input",u),l.addEventListener("input",u),a.addEventListener("change",u),s.addEventListener("change",u)}}(),$(".filters__btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){var e=document.querySelectorAll(".payment-waiting__confirm-btn");if(e[0]){$("#payment-date").datepicker();var t=document.getElementById("payment-waiting__modal"),n=t.querySelector(".modal__close"),i=t.querySelector(".modal__overlay"),o=t.querySelector(".transactions__check-all input"),c=t.querySelector(".payment-waiting__modal-sender input"),a=t.querySelector(".payment-waiting__modal-recipient input"),r=t.querySelector(".payment-waiting__modal-sum input"),l=t.querySelector(".payment-waiting__modal-purpose input"),s=function(){return t.querySelectorAll(".transactions__check input")},d=function(){o.checked=!1,s().forEach((function(e){e.checked=!1})),$("#payment-date").datepicker("setDate",""),c.value="",a.value="",r.value="",l.value=""};e.forEach((function(e){new Modal(e,t)})),n.addEventListener("click",d),i.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&d()})),o.addEventListener("change",(function(){s().forEach((function(e){o.checked?e.checked=!0:e.checked=!1}))}))}}(),$(".support__docs-btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){var e=document.querySelector(".contract-info__verification");if(e){var t=document.getElementById("verification__modal"),n=t.querySelector(".verification__modal-input-file"),i=t.querySelector(".input-file__input"),o=t.querySelector(".modal__close"),c=t.querySelector(".modal__overlay"),a=document.querySelector(".modal__save"),r=function(){n.classList.contains("loaded")&&(n.classList.remove("loaded"),i.value="",a.setAttribute("disabled",""),/safari/i.test(navigator.userAgent)||(i.type="",i.type="file"))};new Modal(e,t),o.addEventListener("click",r),c.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&r()})),i.addEventListener("change",(function(){""!==i.value&&a.removeAttribute("disabled")}))}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyIsImRhdGUtaW5wdXQuanMiLCJpbnB1dC1maWxlLmpzIiwiaW5wdXQtbWFzay5qcyIsImlucHV0LXRleHQuanMiLCJtb2RhbC5qcyIsInNlYXJjaC5qcyIsInNlbGVjdC5qcyIsImNhbmNlbGxhdGlvbi1tb2RhbC5qcyIsImNvbnRyYWN0LWNyZWF0aW9uLmpzIiwiY29udHJhY3QtcGFnZS5qcyIsImNvbnRyYWN0LXNlcnZpY2VzLmpzIiwiY29udHJhY3RzLWFsbC5qcyIsImRlbGl2ZXJ5LW1vZGFsLmpzIiwiZmlsdGVycy5qcyIsInBheW1lbnQtY29uZmlybS1tb2RhbC5qcyIsInN1cHBvcnQuanMiLCJ2ZXJpZmljYXRpb24tbW9kYWwuanMiXSwibmFtZXMiOlsiJCIsImRhdGVwaWNrZXIiLCJmaWxlRHJvcEFyZWEiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJtYWtlRmlsZUxvYWQiLCJmaWxlSW5wdXQiLCJxdWVyeVNlbGVjdG9yIiwicHJldmVudERlZmF1bHRzIiwiZSIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwiaGlnaGxpZ2h0IiwiY2xhc3NMaXN0IiwiYWRkIiwidW5oaWdobGlnaHQiLCJyZW1vdmUiLCJmb3JFYWNoIiwiZXZlbnROYW1lIiwiYWRkRXZlbnRMaXN0ZW5lciIsImZpbGVzIiwiZGF0YVRyYW5zZmVyIiwidmFsdWUiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwidHlwZSIsIm9uRmlsZUNoYW5nZSIsInJlYWRVcmwiLCJpbnB1dCIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWQiLCJwYXJlbnROb2RlIiwibmV4dEVsZW1lbnRTaWJsaW5nIiwidGV4dENvbnRlbnQiLCJuYW1lIiwicmVhZEFzRGF0YVVSTCIsIndpbmRvdyIsIml0ZW0iLCJkZWxpdmVyeVRpbWVJbnB1dHMiLCJpbSIsIklucHV0bWFzayIsIm1hc2siLCJpbnB1dHMiLCJzcGxpdCIsImpvaW4iLCJjb250YWlucyIsInZoIiwiaW5uZXJIZWlnaHQiLCJkb2N1bWVudEVsZW1lbnQiLCJzdHlsZSIsInNldFByb3BlcnR5IiwiY29uY2F0IiwiJGJvZHkiLCJNb2RhbCIsInRyaWdnZXIiLCJtb2RhbCIsInRoaXMiLCJvdmVybGF5IiwiY2xvc2VCdG4iLCJvbk92ZXJsYXlDbGljayIsImJpbmQiLCJvbkNsb3NlQ2xpY2siLCJvblRyaWdnZXJDbGljayIsIm9uUmVzaXplIiwiYWRkRXZlbnRMaXN0ZW5lcnMiLCJwcm90b3R5cGUiLCJvcGVuIiwiY2xvc2UiLCJ0YXJnZXQiLCJmdW5jIiwidGltZXIiLCJldmVudCIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJpdGVtcyIsInNlYXJjaCIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJmb3JtYXRPcHRpb24iLCJ0ZXh0IiwibGVuZ3RoIiwic2VsZWN0MiIsInRlbXBsYXRlUmVzdWx0IiwidGVtcGxhdGVTZWxlY3Rpb24iLCJvbiIsImFkZENsYXNzIiwiY2FuY2VsbGF0aW9uQnRuIiwiZ2V0RWxlbWVudEJ5SWQiLCJkYXRhQmxvY2siLCJyYWRpb3MiLCJuZXh0QnRuIiwic2VsZWN0ZWQiLCJjaGVja0RhdGEiLCJpc0NoZWNrZWQiLCJjaGVja2VkIiwiaGFzQXR0cmlidXRlIiwicmVtb3ZlQXR0cmlidXRlIiwic2V0QXR0cmlidXRlIiwiY2xpY2siLCJwYXJlbnQiLCJuZXh0Iiwic2xpZGVUb2dnbGUiLCJ0b2dnbGVDbGFzcyIsImxpbmtzIiwib25MaW5rQ2xpY2siLCJjb25zb2xlIiwibG9nIiwibGluayIsImRlbGl2ZXJ5QnRucyIsImRhdGVUZXh0Iiwib25GaWVsZENoYW5nZSIsInN1Ym1pdCIsImZpbGVJbnB1dEJsb2NrIiwiZGF0ZUlucHV0IiwidGltZUlucHV0IiwiY29uZmlybUNoZWNrYm94IiwiYnRuIiwiaXNGb3JtRmlsbGVkIiwicGF5bWVudENvbmZpcm1CdG5zIiwibWFpbkNoZWNrYm94Iiwic2VuZGVySW5wdXQiLCJyZWNpcGllbnRJbnB1dCIsInN1bUlucHV0IiwicHVycG9zZUlucHV0IiwiZ2V0QWxsQ2hlY2tib3giLCJ2ZXJpZmljYXRpb25CdG4iLCJzYXZlQnRuIl0sIm1hcHBpbmdzIjoiQUFBQSxhQ0NBQSxFQUFBLGVBQUFDLGFDREEsV0FDQSxJQUFBQyxFQUFBQyxTQUFBQyxpQkFBQSxzQkFFQSxTQUFBQyxFQUFBSCxHQUNBLElBQUFJLEVBQUFKLEVBQUFLLGNBQUEsU0FPQSxTQUFBQyxFQUFBQyxHQUNBQSxFQUFBQyxpQkFDQUQsRUFBQUUsa0JBYUEsU0FBQUMsRUFBQUgsR0FDQVAsRUFBQVcsVUFBQUMsSUFBQSxhQUdBLFNBQUFDLEVBQUFOLEdBQ0FQLEVBQUFXLFVBQUFHLE9BQUEsYUF4QkEsQ0FBQSxZQUFBLFdBQUEsWUFBQSxRQUFBQyxTQUFBLFNBQUFDLEdBQ0FoQixFQUFBaUIsaUJBQUFELEVBQUFWLEdBQUEsTUFVQSxDQUFBLFlBQUEsWUFBQVMsU0FBQSxTQUFBQyxHQUNBaEIsRUFBQWlCLGlCQUFBRCxFQUFBTixHQUFBLE1BR0EsQ0FBQSxZQUFBLFFBQUFLLFNBQUEsU0FBQUMsR0FDQWhCLEVBQUFpQixpQkFBQUQsRUFBQUgsR0FBQSxNQWFBYixFQUFBaUIsaUJBQUEsUUFFQSxTQUFBVixHQUNBLElBQ0FXLEVBREFYLEVBQUFZLGFBQ0FELE1BRUFkLEVBQUFjLE9BQUFkLEVBQUFjLE1BQUEsS0FDQWQsRUFBQWdCLE1BQUEsR0FFQSxVQUFBQyxLQUFBQyxVQUFBQyxhQUNBbkIsRUFBQW9CLEtBQUEsR0FDQXBCLEVBQUFvQixLQUFBLFNBSUFwQixFQUFBYyxNQUFBQSxFQUNBTyxPQWhCQSxHQW1CQSxJQUFBQSxFQUFBLFdBQ0FDLEVBQUF0QixJQUdBc0IsRUFBQSxTQUFBQyxHQUNBLEdBQUFBLEVBQUFULE9BQUFTLEVBQUFULE1BQUEsR0FBQSxDQUNBLElBQUFVLEVBQUEsSUFBQUMsV0FFQUQsRUFBQUUsT0FBQSxTQUFBdkIsR0FDQVAsRUFBQStCLFdBQUFwQixVQUFBQyxJQUFBLFVBQ0FaLEVBQ0FnQyxtQkFDQTNCLGNBQUEsb0JBQ0E0QixZQUFBTixFQUFBVCxNQUFBLEdBQUFnQixNQUdBTixFQUFBTyxjQUFBUixFQUFBVCxNQUFBLE1BSUFkLEVBQUFhLGlCQUFBLFNBQUFRLEdBR0FXLE9BQUFqQyxhQUFBQSxFQUdBSCxFQUFBLElBSUFBLEVBQUFlLFNBQUEsU0FBQXNCLEdBQ0FsQyxFQUFBa0MsTUF0RkEsR0NBQSxXQUNBLElBQUFDLEVBQUFyQyxTQUFBQyxpQkFBQSxtQ0FFQSxHQUFBb0MsRUFBQSxHQUFBLENBSUEsSUFBQUMsRUFBQSxJQUFBQyxVQUFBLFNBRUFGLEVBQUF2QixTQUFBLFNBQUFzQixHQUNBRSxFQUFBRSxLQUFBSixPQVZBLEdDQUEsV0FDQSxJQUFBSyxFQUFBekMsU0FBQUMsaUJBQUEsZUFFQXdDLEVBQUEsSUFJQUEsRUFBQTNCLFNBQUEsU0FBQVksR0FDQUEsRUFBQVYsaUJBQUEsUUFBQSxXQUVBLEtBQUFVLEVBQUFQLE1BQUF1QixNQUFBLEtBQUFDLEtBQUEsTUFFQWpCLEVBQUFQLE1BQUEsSUFJQSxLQUFBTyxFQUFBUCxPQUNBTyxFQUFBaEIsVUFBQWtDLFNBQUEsZUFFQWxCLEVBQUFoQixVQUFBQyxJQUFBLGNBSUEsS0FBQWUsRUFBQVAsT0FDQU8sRUFBQWhCLFVBQUFrQyxTQUFBLGVBRUFsQixFQUFBaEIsVUFBQUcsT0FBQSxvQkExQkEsR0NBQSxXQUNBLElBQUFnQyxFQUFBLElBQUFWLE9BQUFXLFlBQ0E5QyxTQUFBK0MsZ0JBQUFDLE1BQUFDLFlBQUEsT0FBQSxHQUFBQyxPQUFBTCxFQUFBLE9BRUEsSUFBQU0sRUFBQW5ELFNBQUFJLGNBQUEsUUFVQSxTQUFBZ0QsRUFBQUMsRUFBQUMsR0FDQUMsS0FBQUYsUUFBQUEsRUFDQUUsS0FBQUQsTUFBQUEsRUFDQUMsS0FBQUMsUUFBQUQsS0FBQUQsTUFBQWxELGNBQUEsbUJBQ0FtRCxLQUFBRSxTQUFBRixLQUFBRCxNQUFBbEQsY0FBQSxpQkFFQW1ELEtBQUFHLGVBQUFILEtBQUFHLGVBQUFDLEtBQUFKLE1BQ0FBLEtBQUFLLGFBQUFMLEtBQUFLLGFBQUFELEtBQUFKLE1BQ0FBLEtBQUFNLGVBQUFOLEtBQUFNLGVBQUFGLEtBQUFKLE1BQ0FBLEtBQUFPLFNBQUFQLEtBQUFPLFNBQUFILEtBQUFKLE1BRUFBLEtBQUFRLG9CQUdBWCxFQUFBWSxVQUFBQyxLQUFBLFdBQ0FWLEtBQUFELE1BQUE1QyxVQUFBQyxJQUFBLFdBQ0F3QyxFQUFBekMsVUFBQUMsSUFBQSx1QkFHQXlDLEVBQUFZLFVBQUFFLE1BQUEsV0FDQVgsS0FBQUQsTUFBQTVDLFVBQUFHLE9BQUEsV0FDQXNDLEVBQUF6QyxVQUFBRyxPQUFBLHVCQUdBdUMsRUFBQVksVUFBQU4sZUFBQSxTQUFBcEQsR0FDQUEsRUFBQTZELFNBQUFaLEtBQUFDLFNBQ0FELEtBQUFXLFNBSUFkLEVBQUFZLFVBQUFKLGFBQUEsV0FDQUwsS0FBQVcsU0FHQWQsRUFBQVksVUFBQUgsZUFBQSxXQUNBTixLQUFBVSxRQUdBYixFQUFBWSxVQUFBRixTQUFBLFdBQ0EsSUFBQWpCLEVBQUEsSUFBQVYsT0FBQVcsWUFDQTlDLFNBQUErQyxnQkFBQUMsTUFBQUMsWUFBQSxPQUFBLEdBQUFDLE9BQUFMLEVBQUEsUUFHQU8sRUFBQVksVUFBQUQsa0JBQUEsV0FuREEsSUFBQUssRUFDQUMsRUFtREFkLEtBQUFDLFFBQUF4QyxpQkFBQSxRQUFBdUMsS0FBQUcsZ0JBQ0FILEtBQUFFLFNBQUF6QyxpQkFBQSxRQUFBdUMsS0FBQUssY0FDQUwsS0FBQUYsUUFBQXJDLGlCQUFBLFFBQUF1QyxLQUFBTSxnQkFDQTFCLE9BQUFuQixpQkFBQSxVQXZEQW9ELEVBdURBYixLQUFBTyxTQXJEQSxTQUFBUSxHQUNBRCxHQUFBRSxhQUFBRixHQUNBQSxFQUFBRyxXQUFBSixFQUFBLElBQUFFLE9Bc0RBbkMsT0FBQWlCLE1BQUFBLEVBaEVBLEdDQUEsV0FDQSxJQUFBcUIsRUFBQXpFLFNBQUFDLGlCQUFBLFdBQ0FpRSxFQUFBbEUsU0FBQUMsaUJBQUEsMkJBRUF3RSxFQUFBLEtBVUFBLEVBQUEzRCxTQUFBLFNBQUFzQixHQUNBQSxFQUFBcEIsaUJBQUEsUUFBQSxXQUVBLEtBQUFvQixFQUFBakIsTUFBQXVCLE1BQUEsS0FBQUMsS0FBQSxNQUVBUCxFQUFBakIsTUFBQSxJQUlBLEtBQUFpQixFQUFBakIsT0FDQWlCLEVBQUExQixVQUFBa0MsU0FBQSxlQUVBUixFQUFBMUIsVUFBQUMsSUFBQSxjQUlBLEtBQUF5QixFQUFBakIsT0FDQWlCLEVBQUExQixVQUFBa0MsU0FBQSxlQUVBUixFQUFBMUIsVUFBQUcsT0FBQSxvQkFLQXFELEVBQUFwRCxTQUFBLFNBQUFzQixHQUNBQSxFQUFBcEIsaUJBQUEsU0FBQSxXQUNBLElBQUEwRCxFQUFBdEMsRUFBQXVDLHVCQUNBRCxFQUFBdkQsTUFBQSxHQUVBdUQsRUFBQWhFLFVBQUFrQyxTQUFBLGVBRUE4QixFQUFBaEUsVUFBQUcsT0FBQSxxQkE3Q0EsR0NBQSxXQUVBLFNBQUErRCxFQUFBeEMsR0FDQSxJQUFBakIsRUFBQWlCLEVBQUF5QyxLQUFBbkMsTUFBQSxZQUVBLE9BQUF2QixFQUFBMkQsT0FBQSxFQUNBakYsRUFBQSxTQUNBc0IsRUFBQSxHQUNBLGdCQUNBQSxFQUFBLEdBQ0EsV0FHQWlCLEVBQUF5QyxLQUlBaEYsRUFBQSxXQUFBa0YsUUFBQSxDQUNBQyxlQUFBSixFQUNBSyxrQkFBQUwsSUFHQS9FLEVBQUEsV0FBQXFGLEdBQUEsa0JBQUEsU0FBQTVFLEdBQ0FULEVBQUEwRCxNQUFBNEIsU0FBQSxhQXZCQSxHQ0FBLFdBQ0EsSUFBQUMsRUFBQXBGLFNBQUFJLGNBQUEsZ0NBRUEsR0FBQWdGLEVBQUEsQ0FJQSxJQUFBOUIsRUFBQXRELFNBQUFxRixlQUFBLHVCQUVBLElBQUFqQyxNQUFBZ0MsRUFBQTlCLElBVEEsR0NBQSxXQUNBLElBQUFnQyxFQUFBdEYsU0FBQUksY0FBQSxzQkFFQSxHQUFBa0YsRUFBQSxDQUlBLElBQUFDLEVBQUFELEVBQUFyRixpQkFBQSxpQkFDQXVGLEVBQUFGLEVBQUFsRixjQUFBLDJCQUVBcUYsRUFBQSxFQTRCQTVGLEVBQUEsNEJBQUFxRixHQUFBLGtCQUFBLFNBQUE1RSxHQUNBbUYsR0FBQSxFQUNBQyxPQUdBN0YsRUFBQSw4QkFBQXFGLEdBQUEsa0JBQUEsV0FDQU8sR0FBQSxFQUNBQyxPQUdBSCxFQUFBekUsU0FBQSxTQUFBc0IsR0FDQUEsRUFBQXBCLGlCQUFBLFVBQUEsV0FDQTBFLFVBM0JBLFNBQUFBLElBWEEsSUFDQUMsRUFZQUYsR0FBQSxJQVpBRSxHQUFBLEVBQ0FKLEVBQUF6RSxTQUFBLFNBQUFzQixHQUNBQSxFQUFBd0QsVUFDQUQsR0FBQSxNQUlBQSxHQVFBSCxFQUFBSyxhQUFBLGFBQ0FMLEVBQUFNLGdCQUFBLFlBR0FOLEVBQUFLLGFBQUEsYUFDQUwsRUFBQU8sYUFBQSxXQUFBLEtBakNBLEdDRUFsRyxFQUFBLG9DQUFBbUcsT0FBQSxXQUNBbkcsRUFBQTBELE1BQUEwQyxTQUFBQyxPQUFBQyxjQUNBdEcsRUFBQTBELE1BQUE2QyxZQUFBLGFDSkEsV0FHQSxHQUZBcEcsU0FBQUksY0FBQSxzQkFFQSxDQUlBLElBQUFpRyxFQUFBckcsU0FBQUMsaUJBQUEsNEJBRUFxRyxFQUFBLFNBQUFoRyxHQUNBLElBQUE2RCxFQUFBN0QsRUFBQTZELE9BQ0FvQyxRQUFBQyxJQUFBckMsRUFBQXpELFVBQUFrQyxTQUFBLHlCQUdBdUIsRUFBQXpELFVBQUFrQyxTQUFBLHdCQUNBdUIsRUFBQXpELFVBQUFrQyxTQUFBLDJCQUNBdUIsRUFBQXpELFVBQUFrQyxTQUFBLG1DQUNBdUIsRUFBQXpELFVBQUFrQyxTQUFBLHlDQUVBdEMsRUFBQUMsa0JBSUE4RixFQUFBdkYsU0FBQSxTQUFBMkYsR0FDQUEsRUFBQXpGLGlCQUFBLFFBQUFzRixPQXhCQSxHQ0NBdEcsU0FBQUksY0FBQSxtQkFNQVAsRUFBQSxlQUFBQyxhQ1BBLFdBQ0EsSUFBQTRHLEVBQUExRyxTQUFBQyxpQkFBQSxtQ0FFQSxHQUFBeUcsRUFBQSxHQUFBLENBSUE3RyxFQUFBLGtCQUFBQyxhQUFBb0YsR0FBQSxVQUFBLFNBQUF5QixHQUNBQyxPQUdBLElBQUF0RCxFQUFBdEQsU0FBQXFGLGVBQUEsNkJBQ0FuQixFQUFBWixFQUFBbEQsY0FBQSxpQkFDQW9ELEVBQUFGLEVBQUFsRCxjQUFBLG1CQUNBeUcsRUFBQXZELEVBQUFsRCxjQUFBLGtCQUNBMEcsRUFBQXhELEVBQUFsRCxjQUFBLHlDQUNBRCxFQUFBbUQsRUFBQWxELGNBQUEsc0JBQ0EyRyxFQUFBekQsRUFBQWxELGNBQUEsbUNBQ0E0RyxFQUFBMUQsRUFBQWxELGNBQUEsbUNBQ0E2RyxFQUFBM0QsRUFBQWxELGNBQUEsb0JBRUFzRyxFQUFBNUYsU0FBQSxTQUFBb0csR0FDQSxJQUFBOUQsTUFBQThELEVBQUE1RCxNQUdBLElBQUFNLEVBQUEsV0FDQWtELEVBQUFwRyxVQUFBa0MsU0FBQSxZQUNBa0UsRUFBQXBHLFVBQUFHLE9BQUEsVUFFQVYsRUFBQWdCLE1BQUEsR0FDQTBGLEVBQUFkLGFBQUEsV0FBQSxJQUVBLFVBQUEzRSxLQUFBQyxVQUFBQyxhQUNBbkIsRUFBQW9CLEtBQUEsR0FDQXBCLEVBQUFvQixLQUFBLFNBSUF3RixFQUFBNUYsTUFBQSxHQUNBNkYsRUFBQTdGLE1BQUEsR0FDQThGLEVBQUFyQixTQUFBLEVBQ0EvRixFQUFBLGtCQUFBQyxXQUFBLFVBQUEsS0FTQThHLEVBQUEsU0FBQXRHLEdBQ0E2RyxLQUFBTixFQUFBaEIsYUFBQSxZQUNBZ0IsRUFBQWYsZ0JBQUEsWUFDQXFCLEtBQUFOLEVBQUFoQixhQUFBLGFBQ0FnQixFQUFBZCxhQUFBLFdBQUEsS0FJQW9CLEVBQUEsV0FDQSxPQUFBdEgsRUFBQSxrQkFBQUMsV0FBQSxZQUNBLEtBQUFrSCxFQUFBN0YsUUFDQSxJQUFBOEYsRUFBQXJCLFNBQ0EsS0FBQXpGLEVBQUFnQixPQUdBK0MsRUFBQWxELGlCQUFBLFFBQUE0QyxHQUNBSixFQUFBeEMsaUJBQUEsU0F0QkEsU0FBQVYsR0FDQUEsRUFBQTZELE9BQUF6RCxVQUFBa0MsU0FBQSxtQkFDQWdCLE9BcUJBbUQsRUFBQS9GLGlCQUFBLFFBQUE0RixHQUNBSSxFQUFBaEcsaUJBQUEsUUFBQTRGLEdBQ0F6RyxFQUFBYSxpQkFBQSxTQUFBNEYsR0FDQUssRUFBQWpHLGlCQUFBLFNBQUE0RixJQXRFQSxHQ0NBL0csRUFBQSxpQkFBQW1HLE9BQUEsV0FDQW5HLEVBQUEwRCxNQUFBMEMsU0FBQUMsT0FBQUMsY0FDQXRHLEVBQUEwRCxNQUFBNkMsWUFBQSxhQ0hBLFdBQ0EsSUFBQWdCLEVBQUFwSCxTQUFBQyxpQkFBQSxpQ0FFQSxHQUFBbUgsRUFBQSxHQUFBLENBSUF2SCxFQUFBLGlCQUFBQyxhQUVBLElBQUF3RCxFQUFBdEQsU0FBQXFGLGVBQUEsMEJBQ0FuQixFQUFBWixFQUFBbEQsY0FBQSxpQkFDQW9ELEVBQUFGLEVBQUFsRCxjQUFBLG1CQUNBaUgsRUFBQS9ELEVBQUFsRCxjQUFBLGtDQUNBa0gsRUFBQWhFLEVBQUFsRCxjQUFBLHdDQUNBbUgsRUFBQWpFLEVBQUFsRCxjQUFBLDJDQUNBb0gsRUFBQWxFLEVBQUFsRCxjQUFBLHFDQUNBcUgsRUFBQW5FLEVBQUFsRCxjQUFBLHlDQUVBc0gsRUFBQSxXQUNBLE9BQUFwRSxFQUFBckQsaUJBQUEsK0JBYUEyRCxFQUFBLFdBQ0F5RCxFQUFBekIsU0FBQSxFQUNBOEIsSUFBQTVHLFNBQUEsU0FBQXNCLEdBQ0FBLEVBQUF3RCxTQUFBLEtBRUEvRixFQUFBLGlCQUFBQyxXQUFBLFVBQUEsSUFDQXdILEVBQUFuRyxNQUFBLEdBQ0FvRyxFQUFBcEcsTUFBQSxHQUNBcUcsRUFBQXJHLE1BQUEsR0FDQXNHLEVBQUF0RyxNQUFBLElBU0FpRyxFQUFBdEcsU0FBQSxTQUFBb0csR0FDQSxJQUFBOUQsTUFBQThELEVBQUE1RCxNQUdBWSxFQUFBbEQsaUJBQUEsUUFBQTRDLEdBQ0FKLEVBQUF4QyxpQkFBQSxTQVhBLFNBQUFWLEdBQ0FBLEVBQUE2RCxPQUFBekQsVUFBQWtDLFNBQUEsbUJBQ0FnQixPQVVBeUQsRUFBQXJHLGlCQUFBLFVBbENBLFdBQ0EwRyxJQUFBNUcsU0FBQSxTQUFBc0IsR0FDQWlGLEVBQUF6QixRQUNBeEQsRUFBQXdELFNBQUEsRUFFQXhELEVBQUF3RCxTQUFBLFNBM0JBLEdDQ0EvRixFQUFBLHNCQUFBbUcsT0FBQSxXQUNBbkcsRUFBQTBELE1BQUEwQyxTQUFBQyxPQUFBQyxjQUNBdEcsRUFBQTBELE1BQUE2QyxZQUFBLGFDSEEsV0FDQSxJQUFBdUIsRUFBQTNILFNBQUFJLGNBQUEsZ0NBRUEsR0FBQXVILEVBQUEsQ0FJQSxJQUFBckUsRUFBQXRELFNBQUFxRixlQUFBLHVCQUNBeUIsRUFBQXhELEVBQUFsRCxjQUFBLG1DQUNBRCxFQUFBbUQsRUFBQWxELGNBQUEsc0JBQ0E4RCxFQUFBWixFQUFBbEQsY0FBQSxpQkFDQW9ELEVBQUFGLEVBQUFsRCxjQUFBLG1CQUNBd0gsRUFBQTVILFNBQUFJLGNBQUEsZ0JBRUF3RCxFQUFBLFdBQ0FrRCxFQUFBcEcsVUFBQWtDLFNBQUEsWUFDQWtFLEVBQUFwRyxVQUFBRyxPQUFBLFVBRUFWLEVBQUFnQixNQUFBLEdBQ0F5RyxFQUFBN0IsYUFBQSxXQUFBLElBRUEsVUFBQTNFLEtBQUFDLFVBQUFDLGFBQ0FuQixFQUFBb0IsS0FBQSxHQUNBcEIsRUFBQW9CLEtBQUEsVUFpQkEsSUFBQTZCLE1BQUF1RSxFQUFBckUsR0FDQVksRUFBQWxELGlCQUFBLFFBQUE0QyxHQUNBSixFQUFBeEMsaUJBQUEsU0FkQSxTQUFBVixHQUNBQSxFQUFBNkQsT0FBQXpELFVBQUFrQyxTQUFBLG1CQUNBZ0IsT0FhQXpELEVBQUFhLGlCQUFBLFVBVEEsV0FDQSxLQUFBYixFQUFBZ0IsT0FDQXlHLEVBQUE5QixnQkFBQSxnQkFwQ0EiLCJmaWxlIjoic2NyaXB0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKCkge1xuICAkKCcuZGF0ZS1pbnB1dCcpLmRhdGVwaWNrZXIoKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBmaWxlRHJvcEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtZmlsZV9fbGFiZWwnKTtcblxuICBmdW5jdGlvbiBtYWtlRmlsZUxvYWQoZmlsZURyb3BBcmVhKSB7XG4gICAgdmFyIGZpbGVJbnB1dCA9IGZpbGVEcm9wQXJlYS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpOyAvLyDQodCx0YDQsNGB0YvQstCw0LXQvCDRgdGC0LDQvdC00LDRgNGC0L3Ri9C1INGB0L7QsdGL0YLQuNGPINC/0YDQuCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNC4INGE0LDQudC70LBcblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJywgJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHByZXZlbnREZWZhdWx0cywgZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gcHJldmVudERlZmF1bHRzKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuXG4gICAgOyAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0YHRgtC40LvQuCDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwINC90LDQtCDQvdGD0LbQvdC+0Lkg0L7QsdC70LDRgdGC0YzRjlxuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGlnaGxpZ2h0LCBmYWxzZSk7XG4gICAgfSk7XG4gICAgWydkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB1bmhpZ2hsaWdodCwgZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQnKTtcbiAgICB9XG5cbiAgICA7XG5cbiAgICBmdW5jdGlvbiB1bmhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0Jyk7XG4gICAgfVxuXG4gICAgOyAvL1xuXG4gICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBoYW5kbGVEcm9wLCBmYWxzZSk7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVEcm9wKGUpIHtcbiAgICAgIHZhciBkdCA9IGUuZGF0YVRyYW5zZmVyO1xuICAgICAgdmFyIGZpbGVzID0gZHQuZmlsZXM7XG5cbiAgICAgIGlmIChmaWxlSW5wdXQuZmlsZXMgJiYgZmlsZUlucHV0LmZpbGVzWzBdKSB7XG4gICAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgICAgIGlmICghL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZpbGVJbnB1dC5maWxlcyA9IGZpbGVzO1xuICAgICAgb25GaWxlQ2hhbmdlKCk7XG4gICAgfVxuXG4gICAgO1xuXG4gICAgdmFyIG9uRmlsZUNoYW5nZSA9IGZ1bmN0aW9uIG9uRmlsZUNoYW5nZSgpIHtcbiAgICAgIHJlYWRVcmwoZmlsZUlucHV0KTtcbiAgICB9O1xuXG4gICAgdmFyIHJlYWRVcmwgPSBmdW5jdGlvbiByZWFkVXJsKGlucHV0KSB7XG4gICAgICBpZiAoaW5wdXQuZmlsZXMgJiYgaW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgZmlsZURyb3BBcmVhLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnbG9hZGVkJyk7XG4gICAgICAgICAgZmlsZURyb3BBcmVhLm5leHRFbGVtZW50U2libGluZy5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19uYW1lJykudGV4dENvbnRlbnQgPSBpbnB1dC5maWxlc1swXS5uYW1lO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGlucHV0LmZpbGVzWzBdKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmlsZUNoYW5nZSk7XG4gIH1cblxuICB3aW5kb3cubWFrZUZpbGVMb2FkID0gbWFrZUZpbGVMb2FkO1xuXG4gIGlmICghZmlsZURyb3BBcmVhWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgZmlsZURyb3BBcmVhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBtYWtlRmlsZUxvYWQoaXRlbSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRlbGl2ZXJ5VGltZUlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcblxuICBpZiAoIWRlbGl2ZXJ5VGltZUlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbSA9IG5ldyBJbnB1dG1hc2soXCI5OTo5OVwiKTtcbiAgZGVsaXZlcnlUaW1lSW5wdXRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpbS5tYXNrKGl0ZW0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtdGV4dCcpO1xuXG4gIGlmICghaW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaW5wdXRzLmZvckVhY2goZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChpbnB1dC52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJykge1xuICAgICAgICBpbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgfVxuXG4gICAgICBpZiAoaW5wdXQudmFsdWUgIT09ICcnICYmICFpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpbnB1dC52YWx1ZSA9PT0gJycgJiYgaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJykpIHtcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciB2aCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMDE7XG4gIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIFwiXCIuY29uY2F0KHZoLCBcInB4XCIpKTtcbiAgdmFyICRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuXG4gIGZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMpIHtcbiAgICB2YXIgdGltZXI7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKHRpbWVyKSBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmMsIDEwMCwgZXZlbnQpO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBNb2RhbCh0cmlnZ2VyLCBtb2RhbCkge1xuICAgIHRoaXMudHJpZ2dlciA9IHRyaWdnZXI7XG4gICAgdGhpcy5tb2RhbCA9IG1vZGFsO1xuICAgIHRoaXMub3ZlcmxheSA9IHRoaXMubW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gICAgdGhpcy5jbG9zZUJ0biA9IHRoaXMubW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICAgIHRoaXMub25PdmVybGF5Q2xpY2sgPSB0aGlzLm9uT3ZlcmxheUNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNsb3NlQ2xpY2sgPSB0aGlzLm9uQ2xvc2VDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25UcmlnZ2VyQ2xpY2sgPSB0aGlzLm9uVHJpZ2dlckNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vblJlc2l6ZSA9IHRoaXMub25SZXNpemUuYmluZCh0aGlzKTtcbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm1vZGFsLmNsYXNzTGlzdC5hZGQoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QuYWRkKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMub3ZlcmxheSkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUub25DbG9zZUNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUub25UcmlnZ2VyQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5vcGVuKCk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciB2aCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMDE7XG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLXZoJywgXCJcIi5jb25jYXQodmgsIFwicHhcIikpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uT3ZlcmxheUNsaWNrKTtcbiAgICB0aGlzLmNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsb3NlQ2xpY2spO1xuICAgIHRoaXMudHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25UcmlnZ2VyQ2xpY2spO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBkZWJvdW5jZSh0aGlzLm9uUmVzaXplKSk7XG4gIH07XG5cbiAgd2luZG93Lk1vZGFsID0gTW9kYWw7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoJyk7XG4gIHZhciBjbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2ggKyAuc2VhcmNoLWNsb3NlJyk7XG5cbiAgaWYgKCFpdGVtc1swXSkge1xuICAgIHJldHVybjtcbiAgfSAvLyBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gIC8vICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+e1xuICAvLyAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnanMtZm9jdXMnKTtcbiAgLy8gICB9KTtcbiAgLy8gfSk7XG5cblxuICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGl0ZW0udmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJycpIHtcbiAgICAgICAgaXRlbS52YWx1ZSA9ICcnO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXRlbS52YWx1ZSAhPT0gJycgJiYgIWl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJykpIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpdGVtLnZhbHVlID09PSAnJyAmJiBpdGVtLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgY2xvc2UuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgc2VhcmNoID0gaXRlbS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICAgICAgc2VhcmNoLnZhbHVlID0gJyc7XG5cbiAgICAgIGlmIChzZWFyY2guY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJykpIHtcbiAgICAgICAgc2VhcmNoLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBmb3JtYXRPcHRpb24oaXRlbSkge1xuICAgIHZhciB2YWx1ZSA9IGl0ZW0udGV4dC5zcGxpdCgnc3BsaXR0ZXInKTtcblxuICAgIGlmICh2YWx1ZS5sZW5ndGggPiAxKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gJCgnPHNwYW4+JyArIHZhbHVlWzBdICsgJzwvc3Bhbj48c3Bhbj4nICsgdmFsdWVbMV0gKyAnPC9zcGFuPicpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGl0ZW0udGV4dDtcbiAgICB9XG4gIH1cblxuICAkKCcuc2VsZWN0Jykuc2VsZWN0Mih7XG4gICAgdGVtcGxhdGVSZXN1bHQ6IGZvcm1hdE9wdGlvbixcbiAgICB0ZW1wbGF0ZVNlbGVjdGlvbjogZm9ybWF0T3B0aW9uXG4gIH0pO1xuICAkKCcuc2VsZWN0Jykub24oJ3NlbGVjdDI6c2VsZWN0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAkKHRoaXMpLmFkZENsYXNzKCdwaWNrZWQnKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY2FuY2VsbGF0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LWluZm9fX2NhbmNlbGxhdGlvbicpO1xuXG4gIGlmICghY2FuY2VsbGF0aW9uQnRuKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbGxhdGlvbl9fbW9kYWwnKTtcbiAgbmV3IE1vZGFsKGNhbmNlbGxhdGlvbkJ0biwgbW9kYWwpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRhdGFCbG9jayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1jcmVhdGlvbicpO1xuXG4gIGlmICghZGF0YUJsb2NrKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHJhZGlvcyA9IGRhdGFCbG9jay5xdWVyeVNlbGVjdG9yQWxsKCcucmFkaW9fX2lucHV0Jyk7XG4gIHZhciBuZXh0QnRuID0gZGF0YUJsb2NrLnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1wYXltZW50X19uZXh0Jyk7XG4gIHZhciBzZWxlY3RlZCA9IDA7XG5cbiAgZnVuY3Rpb24gaXNSYWRpb0NoZWNrZWQoKSB7XG4gICAgdmFyIGlzQ2hlY2tlZCA9IGZhbHNlO1xuICAgIHJhZGlvcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpZiAoaXRlbS5jaGVja2VkKSB7XG4gICAgICAgIGlzQ2hlY2tlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGlzQ2hlY2tlZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoZWNrRGF0YSgpIHtcbiAgICBpZiAoc2VsZWN0ZWQgPj0gMyAmJiBpc1JhZGlvQ2hlY2tlZCgpKSB7XG4gICAgICBpZiAobmV4dEJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgICAgbmV4dEJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghbmV4dEJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgICAgbmV4dEJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gICQoJy5jb250cmFjdC1zdWJqZWN0X19hZ2VudCcpLm9uKCdzZWxlY3QyOnNlbGVjdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgc2VsZWN0ZWQgKz0gMTtcbiAgICBjaGVja0RhdGEoKTtcbiAgfSk7XG4gICQoJy5jb250cmFjdC1zdWJqZWN0X19zZXJ2aWNlJykub24oJ3NlbGVjdDI6c2VsZWN0JywgZnVuY3Rpb24gKCkge1xuICAgIHNlbGVjdGVkICs9IDE7XG4gICAgY2hlY2tEYXRhKCk7XG4gIH0pO1xuICByYWRpb3MuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgY2hlY2tEYXRhKCk7XG4gICAgfSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCgnLmNvbnRyYWN0LWluZm9fX2RlbGl2ZXJlZC10b2dnbGUnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY29udHJhY3RTZXJ2aWNlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1zZXJ2aWNlcycpO1xuXG4gIGlmICghY29udHJhY3RTZXJ2aWNlcykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBsaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1zZXJ2aWNlc19fbGluaycpO1xuXG4gIHZhciBvbkxpbmtDbGljayA9IGZ1bmN0aW9uIG9uTGlua0NsaWNrKGUpIHtcbiAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgY29uc29sZS5sb2codGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2hla2Nib3gtYnRuX19sYWJlbCcpKTtcblxuICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2xhYmVsJykgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tib3gtYnRuX19jaGVja2JveCcpIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2RlbGl2ZXItb3ItcGlja3VwX19jb25maXJtLWJ0bicpIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbnRyYWN0LXNlcnZpY2VzX19kZWxpdmVyeS1jb25maXJtJykpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH07XG5cbiAgbGlua3MuZm9yRWFjaChmdW5jdGlvbiAobGluaykge1xuICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkxpbmtDbGljayk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbnRyYWN0c0FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdHMtYWxsJyk7XG5cbiAgaWYgKCFjb250cmFjdHNBbGwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcuZGF0ZS1pbnB1dCcpLmRhdGVwaWNrZXIoKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBkZWxpdmVyeUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFkZWxpdmVyeUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKGRhdGVUZXh0KSB7XG4gICAgb25GaWVsZENoYW5nZSgpO1xuICB9KTtcbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwnKTtcbiAgdmFyIGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICB2YXIgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICB2YXIgc3VibWl0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQnKTtcbiAgdmFyIGZpbGVJbnB1dEJsb2NrID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtaW5wdXQtZmlsZScpO1xuICB2YXIgZmlsZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG4gIHZhciBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1kYXRlJyk7XG4gIHZhciB0aW1lSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC10aW1lJyk7XG4gIHZhciBjb25maXJtQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuY2hlY2tib3hfX2lucHV0Jyk7XG4gIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uIChidG4pIHtcbiAgICBuZXcgTW9kYWwoYnRuLCBtb2RhbCk7XG4gIH0pO1xuXG4gIHZhciBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiBvbkNsb3NlQ2xpY2soKSB7XG4gICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG4gICAgICBzdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcblxuICAgICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkYXRlSW5wdXQudmFsdWUgPSAnJztcbiAgICB0aW1lSW5wdXQudmFsdWUgPSAnJztcbiAgICBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgfTtcblxuICB2YXIgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbiBvbk92ZXJsYXlDbGljayhlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAgICAgb25DbG9zZUNsaWNrKCk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbkZpZWxkQ2hhbmdlID0gZnVuY3Rpb24gb25GaWVsZENoYW5nZShlKSB7XG4gICAgaWYgKGlzRm9ybUZpbGxlZCgpICYmIHN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIGlmICghaXNGb3JtRmlsbGVkKCkgJiYgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgaXNGb3JtRmlsbGVkID0gZnVuY3Rpb24gaXNGb3JtRmlsbGVkKCkge1xuICAgIHJldHVybiAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoJ2dldERhdGUnKSAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnICYmIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID09PSB0cnVlICYmIGZpbGVJbnB1dC52YWx1ZSAhPT0gJyc7XG4gIH07XG5cbiAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuICBkYXRlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgdGltZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgY29uZmlybUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmllbGRDaGFuZ2UpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCgnLmZpbHRlcnNfX2J0bicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBwYXltZW50Q29uZmlybUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGF5bWVudC13YWl0aW5nX19jb25maXJtLWJ0bicpO1xuXG4gIGlmICghcGF5bWVudENvbmZpcm1CdG5zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJCgnI3BheW1lbnQtZGF0ZScpLmRhdGVwaWNrZXIoKTtcbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheW1lbnQtd2FpdGluZ19fbW9kYWwnKTtcbiAgdmFyIGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICB2YXIgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICB2YXIgbWFpbkNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnRyYW5zYWN0aW9uc19fY2hlY2stYWxsIGlucHV0Jyk7XG4gIHZhciBzZW5kZXJJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXNlbmRlciBpbnB1dCcpO1xuICB2YXIgcmVjaXBpZW50SW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1yZWNpcGllbnQgaW5wdXQnKTtcbiAgdmFyIHN1bUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc3VtIGlucHV0Jyk7XG4gIHZhciBwdXJwb3NlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1wdXJwb3NlIGlucHV0Jyk7XG5cbiAgdmFyIGdldEFsbENoZWNrYm94ID0gZnVuY3Rpb24gZ2V0QWxsQ2hlY2tib3goKSB7XG4gICAgcmV0dXJuIG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2FjdGlvbnNfX2NoZWNrIGlucHV0Jyk7XG4gIH07XG5cbiAgdmFyIG9uQWxsQ2hhbmdlID0gZnVuY3Rpb24gb25BbGxDaGFuZ2UoKSB7XG4gICAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpZiAobWFpbkNoZWNrYm94LmNoZWNrZWQpIHtcbiAgICAgICAgaXRlbS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHZhciBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiBvbkNsb3NlQ2xpY2soKSB7XG4gICAgbWFpbkNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgIH0pO1xuICAgICQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAgIHNlbmRlcklucHV0LnZhbHVlID0gJyc7XG4gICAgcmVjaXBpZW50SW5wdXQudmFsdWUgPSAnJztcbiAgICBzdW1JbnB1dC52YWx1ZSA9ICcnO1xuICAgIHB1cnBvc2VJbnB1dC52YWx1ZSA9ICcnO1xuICB9O1xuXG4gIHZhciBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uIG9uT3ZlcmxheUNsaWNrKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgICB9XG4gIH07XG5cbiAgcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24gKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgbWFpbkNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQWxsQ2hhbmdlKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5zdXBwb3J0X19kb2NzLWJ0bicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG5cbiAgaWYgKCF2ZXJpZmljYXRpb25CdG4pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyaWZpY2F0aW9uX19tb2RhbCcpO1xuICB2YXIgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudmVyaWZpY2F0aW9uX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIHZhciBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgdmFyIGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICB2YXIgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICB2YXIgc2F2ZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIHZhciBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiBvbkNsb3NlQ2xpY2soKSB7XG4gICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG4gICAgICBzYXZlQnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG5cbiAgICAgIGlmICghL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uIG9uT3ZlcmxheUNsaWNrKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIG9uSW5wdXRDaGFuZ2UgPSBmdW5jdGlvbiBvbklucHV0Q2hhbmdlKCkge1xuICAgIGlmIChmaWxlSW5wdXQudmFsdWUgIT09ICcnKSB7XG4gICAgICBzYXZlQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG4gIH07XG5cbiAgbmV3IE1vZGFsKHZlcmlmaWNhdGlvbkJ0biwgbW9kYWwpO1xuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbklucHV0Q2hhbmdlKTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAkKCcuZGF0ZS1pbnB1dCcpLmRhdGVwaWNrZXIoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGZpbGVEcm9wQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1maWxlX19sYWJlbCcpO1xuXG4gIGZ1bmN0aW9uIG1ha2VGaWxlTG9hZChmaWxlRHJvcEFyZWEpIHtcbiAgICBjb25zdCBmaWxlSW5wdXQgPSBmaWxlRHJvcEFyZWEucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcbiAgICAvLyDQodCx0YDQsNGB0YvQstCw0LXQvCDRgdGC0LDQvdC00LDRgNGC0L3Ri9C1INGB0L7QsdGL0YLQuNGPINC/0YDQuCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNC4INGE0LDQudC70LBcblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJywgJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBwcmV2ZW50RGVmYXVsdHMsIGZhbHNlKVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gcHJldmVudERlZmF1bHRzIChlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH07XG5cbiAgICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0YHRgtC40LvQuCDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwINC90LDQtCDQvdGD0LbQvdC+0Lkg0L7QsdC70LDRgdGC0YzRjlxuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInXS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhpZ2hsaWdodCwgZmFsc2UpXG4gICAgfSk7XG5cbiAgICBbJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB1bmhpZ2hsaWdodCwgZmFsc2UpXG4gICAgfSlcblxuICAgIGZ1bmN0aW9uIGhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHVuaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQnKTtcbiAgICB9O1xuXG4gICAgLy9cblxuICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgaGFuZGxlRHJvcCwgZmFsc2UpXG5cbiAgICBmdW5jdGlvbiBoYW5kbGVEcm9wKGUpIHtcbiAgICAgIGxldCBkdCA9IGUuZGF0YVRyYW5zZmVyXG4gICAgICBsZXQgZmlsZXMgPSBkdC5maWxlc1xuXG4gICAgICBpZiAoZmlsZUlucHV0LmZpbGVzICYmIGZpbGVJbnB1dC5maWxlc1swXSkge1xuICAgICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZmlsZUlucHV0LmZpbGVzID0gZmlsZXM7XG4gICAgICBvbkZpbGVDaGFuZ2UoKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25GaWxlQ2hhbmdlID0gKCkgPT4ge1xuICAgICAgcmVhZFVybChmaWxlSW5wdXQpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlYWRVcmwgPSAoaW5wdXQpID0+IHtcbiAgICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlc1swXSkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdsb2FkZWQnKTtcbiAgICAgICAgICBmaWxlRHJvcEFyZWFcbiAgICAgICAgICAgIC5uZXh0RWxlbWVudFNpYmxpbmdcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19uYW1lJylcbiAgICAgICAgICAgIC50ZXh0Q29udGVudCA9IGlucHV0LmZpbGVzWzBdLm5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbnB1dC5maWxlc1swXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmlsZUNoYW5nZSk7XG4gIH1cblxuICB3aW5kb3cubWFrZUZpbGVMb2FkID0gbWFrZUZpbGVMb2FkO1xuXG5cbiAgaWYgKCFmaWxlRHJvcEFyZWFbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBmaWxlRHJvcEFyZWEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgbWFrZUZpbGVMb2FkKGl0ZW0pO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGRlbGl2ZXJ5VGltZUlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcblxuICBpZiAoIWRlbGl2ZXJ5VGltZUlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbSA9IG5ldyBJbnB1dG1hc2soXCI5OTo5OVwiKTtcblxuICBkZWxpdmVyeVRpbWVJbnB1dHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgaW0ubWFzayhpdGVtKTtcbiAgfSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC10ZXh0Jyk7XG5cbiAgaWYgKCFpbnB1dHNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpbnB1dHMuZm9yRWFjaChmdW5jdGlvbihpbnB1dCkge1xuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChcbiAgICAgICAgaW5wdXQudmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJydcbiAgICAgICkge1xuICAgICAgICBpbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIGlucHV0LnZhbHVlICE9PSAnJ1xuICAgICAgICAmJiAhaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgaW5wdXQudmFsdWUgPT09ICcnXG4gICAgICAgICYmIGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG4iLCIoKCkgPT4ge1xuICBsZXQgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBgJHt2aH1weGApO1xuXG4gIGNvbnN0ICRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuXG4gIGZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMpe1xuICAgIHZhciB0aW1lcjtcbiAgICByZXR1cm4gZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgaWYodGltZXIpIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICB0aW1lciA9IHNldFRpbWVvdXQoZnVuYywxMDAsZXZlbnQpO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBNb2RhbCAodHJpZ2dlciwgbW9kYWwpIHtcbiAgICB0aGlzLnRyaWdnZXIgPSB0cmlnZ2VyO1xuICAgIHRoaXMubW9kYWwgPSBtb2RhbDtcbiAgICB0aGlzLm92ZXJsYXkgPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAgIHRoaXMuY2xvc2VCdG4gPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcblxuICAgIHRoaXMub25PdmVybGF5Q2xpY2sgPSB0aGlzLm9uT3ZlcmxheUNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNsb3NlQ2xpY2sgPSB0aGlzLm9uQ2xvc2VDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25UcmlnZ2VyQ2xpY2sgPSB0aGlzLm9uVHJpZ2dlckNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vblJlc2l6ZSA9IHRoaXMub25SZXNpemUuYmluZCh0aGlzKTtcblxuICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QuYWRkKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LmFkZCgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMub3ZlcmxheSkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub25UcmlnZ2VyQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9wZW4oKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgbGV0IHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIGAke3ZofXB4YCk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbk92ZXJsYXlDbGljayk7XG4gICAgdGhpcy5jbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbG9zZUNsaWNrKTtcbiAgICB0aGlzLnRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uVHJpZ2dlckNsaWNrKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGVib3VuY2UodGhpcy5vblJlc2l6ZSkpO1xuICB9XG5cbiAgd2luZG93Lk1vZGFsID0gTW9kYWw7XG59KSgpO1xuIiwiKCgpID0+IHtcbiAgY29uc3QgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoJyk7XG4gIGNvbnN0IGNsb3NlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCArIC5zZWFyY2gtY2xvc2UnKTtcblxuICBpZiAoIWl0ZW1zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAvLyAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PntcbiAgLy8gICAgIGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2pzLWZvY3VzJyk7XG4gIC8vICAgfSk7XG4gIC8vIH0pO1xuXG4gIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoKSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGl0ZW0udmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJydcbiAgICAgICkge1xuICAgICAgICBpdGVtLnZhbHVlID0gJyc7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgaXRlbS52YWx1ZSAhPT0gJydcbiAgICAgICAgJiYgIWl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpdGVtLnZhbHVlID09PSAnJ1xuICAgICAgICAmJiBpdGVtLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSlcbiAgfSk7XG5cbiAgY2xvc2UuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBjb25zdCBzZWFyY2ggPSBpdGVtLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG4gICAgICBzZWFyY2gudmFsdWUgPSAnJztcbiAgICAgIGlmIChcbiAgICAgICAgc2VhcmNoLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgc2VhcmNoLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KVxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgZnVuY3Rpb24gZm9ybWF0T3B0aW9uIChpdGVtKSB7XG4gICAgY29uc3QgdmFsdWUgPSBpdGVtLnRleHQuc3BsaXQoJ3NwbGl0dGVyJyk7XG5cbiAgICBpZiAodmFsdWUubGVuZ3RoID4gMSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gJCgnPHNwYW4+J1xuICAgICAgICArIHZhbHVlWzBdXG4gICAgICAgICsgJzwvc3Bhbj48c3Bhbj4nXG4gICAgICAgICsgdmFsdWVbMV1cbiAgICAgICAgKyAnPC9zcGFuPicpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGl0ZW0udGV4dDtcbiAgICB9XG4gIH1cblxuICAkKCcuc2VsZWN0Jykuc2VsZWN0Mih7XG4gICAgdGVtcGxhdGVSZXN1bHQ6IGZvcm1hdE9wdGlvbixcbiAgICB0ZW1wbGF0ZVNlbGVjdGlvbjogZm9ybWF0T3B0aW9uXG4gIH0pO1xuXG4gICQoJy5zZWxlY3QnKS5vbignc2VsZWN0MjpzZWxlY3QnLCBmdW5jdGlvbiAoZSkge1xuICAgICQodGhpcykuYWRkQ2xhc3MoJ3BpY2tlZCcpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1pbmZvX19jYW5jZWxsYXRpb24nKTtcblxuICBpZiAoIWNhbmNlbGxhdGlvbkJ0bikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbGxhdGlvbl9fbW9kYWwnKTtcblxuICBuZXcgTW9kYWwoY2FuY2VsbGF0aW9uQnRuLCBtb2RhbCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBkYXRhQmxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3QtY3JlYXRpb24nKTtcblxuICBpZiAoIWRhdGFCbG9jaykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHJhZGlvcyA9IGRhdGFCbG9jay5xdWVyeVNlbGVjdG9yQWxsKCcucmFkaW9fX2lucHV0Jyk7XG4gIGNvbnN0IG5leHRCdG4gPSBkYXRhQmxvY2sucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LXBheW1lbnRfX25leHQnKTtcblxuICBsZXQgc2VsZWN0ZWQgPSAwO1xuXG4gIGZ1bmN0aW9uIGlzUmFkaW9DaGVja2VkICgpIHtcbiAgICBsZXQgaXNDaGVja2VkID0gZmFsc2U7XG4gICAgcmFkaW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgaWYgKGl0ZW0uY2hlY2tlZCkge1xuICAgICAgICBpc0NoZWNrZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGlzQ2hlY2tlZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoZWNrRGF0YSAoKSB7XG4gICAgaWYgKFxuICAgICAgc2VsZWN0ZWQgPj0gM1xuICAgICAgJiYgaXNSYWRpb0NoZWNrZWQoKVxuICAgICkge1xuICAgICAgaWYgKG5leHRCdG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICAgIG5leHRCdG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghbmV4dEJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgICAgbmV4dEJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gICQoJy5jb250cmFjdC1zdWJqZWN0X19hZ2VudCcpLm9uKCdzZWxlY3QyOnNlbGVjdCcsIGZ1bmN0aW9uKGUpIHtcbiAgICBzZWxlY3RlZCArPSAxO1xuICAgIGNoZWNrRGF0YSgpO1xuICB9KVxuXG4gICQoJy5jb250cmFjdC1zdWJqZWN0X19zZXJ2aWNlJykub24oJ3NlbGVjdDI6c2VsZWN0JywgZnVuY3Rpb24oKSB7XG4gICAgc2VsZWN0ZWQgKz0xO1xuICAgIGNoZWNrRGF0YSgpO1xuICB9KVxuXG4gIHJhZGlvcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAgICAgY2hlY2tEYXRhKCk7XG4gICAgfSlcbiAgfSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgJCgnLmNvbnRyYWN0LWluZm9fX2RlbGl2ZXJlZC10b2dnbGUnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNvbnRyYWN0U2VydmljZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3Qtc2VydmljZXMnKTtcblxuICBpZiAoIWNvbnRyYWN0U2VydmljZXMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBsaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1zZXJ2aWNlc19fbGluaycpO1xuXG4gIGNvbnN0IG9uTGlua0NsaWNrID0gZnVuY3Rpb24oZSkge1xuICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgIGNvbnNvbGUubG9nKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWtjYm94LWJ0bl9fbGFiZWwnKSk7XG5cbiAgICBpZiAoXG4gICAgICB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2xhYmVsJylcbiAgICAgIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrYm94LWJ0bl9fY2hlY2tib3gnKVxuICAgICAgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJylcbiAgICAgIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbnRyYWN0LXNlcnZpY2VzX19kZWxpdmVyeS1jb25maXJtJylcbiAgICApIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH1cblxuICBsaW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHtcbiAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25MaW5rQ2xpY2spO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNvbnRyYWN0c0FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdHMtYWxsJyk7XG5cbiAgaWYgKCFjb250cmFjdHNBbGwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcuZGF0ZS1pbnB1dCcpLmRhdGVwaWNrZXIoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGRlbGl2ZXJ5QnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyLW9yLXBpY2t1cF9fY29uZmlybS1idG4nKTtcblxuICBpZiAoIWRlbGl2ZXJ5QnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcigpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihkYXRlVGV4dCkge1xuICAgIG9uRmllbGRDaGFuZ2UoKTtcbiAgfSk7XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbCcpO1xuICBjb25zdCBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgY29uc3Qgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICBjb25zdCBzdWJtaXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3N1Ym1pdCcpO1xuICBjb25zdCBmaWxlSW5wdXRCbG9jayA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLWlucHV0LWZpbGUnKTtcbiAgY29uc3QgZmlsZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG4gIGNvbnN0IGRhdGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLWRhdGUnKTtcbiAgY29uc3QgdGltZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtdGltZScpO1xuICBjb25zdCBjb25maXJtQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuY2hlY2tib3hfX2lucHV0Jyk7XG5cbiAgZGVsaXZlcnlCdG5zLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7XG4gICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICB9KTtcblxuICBjb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAgICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG5cbiAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG5cbiAgICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRhdGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHRpbWVJbnB1dC52YWx1ZSA9ICcnO1xuICAgIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gICAgJCgnI2RlbGl2ZXJ5LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICB9XG5cbiAgY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAgICAgb25DbG9zZUNsaWNrKCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgb25GaWVsZENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoaXNGb3JtRmlsbGVkKCkgJiYgc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc3VibWl0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9IGVsc2UgaWYgKCFpc0Zvcm1GaWxsZWQoKSAmJiAhc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgaXNGb3JtRmlsbGVkID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignZ2V0RGF0ZScpXG4gICAgICAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnXG4gICAgICAmJiBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9PT0gdHJ1ZVxuICAgICAgJiYgZmlsZUlucHV0LnZhbHVlICE9PSAnJ1xuICB9XG5cbiAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuICBkYXRlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgdGltZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgY29uZmlybUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmllbGRDaGFuZ2UpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJCgnLmZpbHRlcnNfX2J0bicpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICQodGhpcykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgcGF5bWVudENvbmZpcm1CdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBheW1lbnQtd2FpdGluZ19fY29uZmlybS1idG4nKTtcblxuICBpZiAoIXBheW1lbnRDb25maXJtQnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gICQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCk7XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5bWVudC13YWl0aW5nX19tb2RhbCcpO1xuICBjb25zdCBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgY29uc3Qgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICBjb25zdCBtYWluQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudHJhbnNhY3Rpb25zX19jaGVjay1hbGwgaW5wdXQnKTtcbiAgY29uc3Qgc2VuZGVySW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zZW5kZXIgaW5wdXQnKTtcbiAgY29uc3QgcmVjaXBpZW50SW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1yZWNpcGllbnQgaW5wdXQnKTtcbiAgY29uc3Qgc3VtSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zdW0gaW5wdXQnKTtcbiAgY29uc3QgcHVycG9zZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcHVycG9zZSBpbnB1dCcpO1xuXG4gIGNvbnN0IGdldEFsbENoZWNrYm94ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2FjdGlvbnNfX2NoZWNrIGlucHV0Jyk7XG4gIH07XG5cbiAgY29uc3Qgb25BbGxDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KVxuICB9O1xuXG4gIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIG1haW5DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gICAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgIH0pO1xuICAgICQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAgIHNlbmRlcklucHV0LnZhbHVlID0gJyc7XG4gICAgcmVjaXBpZW50SW5wdXQudmFsdWUgPSAnJztcbiAgICBzdW1JbnB1dC52YWx1ZSA9ICcnO1xuICAgIHB1cnBvc2VJbnB1dC52YWx1ZSA9ICcnO1xuICB9O1xuXG4gIGNvbnN0IG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgICAgIG9uQ2xvc2VDbGljaygpO1xuICAgIH1cbiAgfVxuXG4gIHBheW1lbnRDb25maXJtQnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuICBtYWluQ2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25BbGxDaGFuZ2UpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJCgnLnN1cHBvcnRfX2RvY3MtYnRuJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcblxuICBpZiAoIXZlcmlmaWNhdGlvbkJ0bikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZlcmlmaWNhdGlvbl9fbW9kYWwnKTtcbiAgY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudmVyaWZpY2F0aW9uX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICBjb25zdCBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgY29uc3Qgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICBjb25zdCBzYXZlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19zYXZlJyk7XG5cbiAgY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuXG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgICAgIHNhdmVCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcblxuICAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAgICAgb25DbG9zZUNsaWNrKCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgb25JbnB1dENoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChmaWxlSW5wdXQudmFsdWUgIT09ICcnKSB7XG4gICAgICBzYXZlQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG4gIH1cblxuICBuZXcgTW9kYWwodmVyaWZpY2F0aW9uQnRuLCBtb2RhbCk7XG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uSW5wdXRDaGFuZ2UpO1xufSkoKTtcbiJdfQ==
