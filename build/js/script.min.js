"use strict";!function(){var e=document.querySelectorAll(".checkbox-2__input");e[0]&&e.forEach((function(e){e.addEventListener("change",(function(e){var t=e.target;!0===t.checked?t.parentNode.classList.add("checked"):t.parentNode.classList.remove("checked")}))}))}(),$(".date-input:not(.date-input-range)").datepicker({dateFormat:"dd.mm.yy"}),$(".date-input-range").datepicker({range:"period",inline:!0,showButtonPanel:!0,showOtherMonths:!0,selectOtherMonths:!0,closeText:"Готово",dateFormat:"dd.mm.yy",beforeShow:function(e,t){t.dpDiv.css("transform","translateX(-24px)"),t.dpDiv.addClass("calendar-range")},onSelect:function(e,t,n){t.input.val(n.startDateText+" - "+n.endDateText)}}),function(){var e=document.querySelector(".modal.requests-upload");if(e){var t=document.querySelector(".modal.requests-upload .input-file__wrapper"),n=t.querySelector(".input-file"),a=n.cloneNode(!0),o=e.querySelector(".modal__save"),i=e.querySelector(".modal__close"),r=function(e){s(e.target)};f(n),i.addEventListener("click",(function(){t.querySelectorAll(".input-file-requests").forEach((function(e,t){0!==t&&(p(e),e.remove())})),!o.hasAttribute("disabled")&&o.setAttribute("disabled","")}))}function c(e){e.preventDefault(),e.stopPropagation()}function l(){var e=t.querySelectorAll(".file-load.loaded");e.length>0&&o.hasAttribute("disabled")&&o.removeAttribute("disabled"),0===e.length&&!o.hasAttribute("disabled")&&o.setAttribute("disabled","")}function s(e){e.parentNode.parentNode;var n=e.parentNode,o=n.parentNode.querySelector(".file-load__progress-current"),i=n.parentNode.querySelector(".file-load__status span"),r=n.parentNode.querySelector(".file-load"),c=n.parentNode.querySelector(".file-load__size");if(e.files&&e.files[0]){var s=new FileReader;s.onloadstart=function(){n.parentNode.classList.add("loaded")},s.onprogress=function(e){o.style.width=Math.round(e.loaded/e.total*100)+"%",i.textContent=Math.round(e.loaded/e.total*100)},s.onload=function(i){o.style.width="100%",n.nextElementSibling.querySelector(".file-load__name").textContent=e.files[0].name;var s=e.files[0].size,d=" байт",u="XLSX, ";s>=1024&&s<1048576?(s=Math.round(s/1024),d=" Кбайт"):(s=Math.round(s/1024/1024),d=" Мбайт"),"application/vnd.ms-excel"===e.files[0].type&&(u="XLS, "),r.classList.add("loaded"),c.textContent=u+s+d;var p=a.cloneNode(!0);t.prepend(p),f(p),t.querySelectorAll("input").forEach((function(e,t){e.name="file-"+t})),l()},s.readAsDataURL(e.files[0])}}function d(e){var t=e.currentTarget.querySelector("input"),n=e.dataTransfer.files;console.log(n),t.files&&t.files[0]&&(t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file")),"application/vnd.ms-excel"!==n[0].type&&"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"!==n[0].type||(t.files=n,s(t))}function u(e){var t=e.currentTarget.parentNode.parentNode,n=t.querySelector("input");n.value="",/safari/i.test(navigator.userAgent)||(n.type="",n.type="file"),p(t),t.remove(),l()}function f(e){var t=e.querySelector(".input-file__label"),n=e.querySelector("input"),a=e.querySelector(".file-load__clear");function o(e){t.classList.add("highlight")}function i(e){t.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(e){t.addEventListener(e,c,!1)})),["dragenter","dragover"].forEach((function(e){t.addEventListener(e,o,!1)})),["dragleave","drop"].forEach((function(e){t.addEventListener(e,i,!1)})),t.addEventListener("drop",d),n.addEventListener("change",r),a.addEventListener("click",u)}function p(e){var t=e.querySelector(".input-file__label"),n=e.querySelector("input"),a=e.querySelector(".file-load__clear");function o(e){t.classList.add("highlight")}function i(e){t.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(e){t.removeEventListener(e,c,!1)})),["dragenter","dragover"].forEach((function(e){t.removeEventListener(e,o,!1)})),["dragleave","drop"].forEach((function(e){t.removeEventListener(e,i,!1)})),t.removeEventListener("drop",d),n.removeEventListener("change",r),a.removeEventListener("click",u)}}(),function(){var e=document.querySelector(".send-scan__upload-file");if(e){var t=e.querySelectorAll(".input-file"),n=e.querySelector(".send-scan__submit"),a=function(e){i(e.target)};t.forEach((function(e){!function(e){var t=e.querySelector(".input-file__label"),n=e.querySelector("input"),i=e.querySelector(".file-load__clear");function l(e){t.classList.add("highlight")}function s(e){t.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(e){t.addEventListener(e,o,!1)})),["dragenter","dragover"].forEach((function(e){t.addEventListener(e,l,!1)})),["dragleave","drop"].forEach((function(e){t.addEventListener(e,s,!1)})),t.addEventListener("drop",r),n.addEventListener("change",a),i.addEventListener("click",c)}(e)}))}function o(e){e.preventDefault(),e.stopPropagation()}function i(e){var a=e.parentNode,o=a.parentNode.querySelector(".file-load__progress-current"),i=a.parentNode.querySelector(".file-load__status span"),r=a.parentNode.querySelector(".file-load"),c=a.parentNode.querySelector(".file-load__size");if(e.files&&e.files[0]){var l=new FileReader;l.onloadstart=function(){a.parentNode.classList.add("loaded")},l.onprogress=function(e){o.style.width=Math.round(e.loaded/e.total*100)+"%",i.textContent=Math.round(e.loaded/e.total*100)},l.onload=function(i){o.style.width="100%",a.nextElementSibling.querySelector(".file-load__name").textContent=e.files[0].name;var l,s=e.files[0].size,d=" байт";s>=1024&&s<1048576?(s=Math.round(s/1024),d=" Кбайт"):(s=Math.round(s/1024/1024),d=" Мбайт"),r.classList.add("loaded"),c.textContent=s+d,l=!0,t.forEach((function(e){e.querySelector(".file-load").classList.contains("loaded")||(l=!1)})),l&&n.removeAttribute("disabled")},l.readAsDataURL(e.files[0])}}function r(e){var t=e.currentTarget.querySelector("input"),n=e.dataTransfer.files;console.log(n),t.files&&t.files[0]&&(t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file")),t.files=n,i(t)}function c(e){var t=e.currentTarget.parentNode.parentNode,a=t.querySelector("input"),o=t.querySelector(".file-load");a.value="",/safari/i.test(navigator.userAgent)||(a.type="",a.type="file"),t.classList.remove("loaded"),n.setAttribute("disabled",""),o.classList.remove("loaded")}}(),function(){var e=document.querySelectorAll(".input-file__label");function t(e){var t=e.querySelector("input"),n=e.parentNode.querySelector(".file-load__clear");function a(e){e.preventDefault(),e.stopPropagation()}function o(t){e.classList.add("highlight")}function i(t){e.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,a,!1)})),["dragenter","dragover"].forEach((function(t){e.addEventListener(t,o,!1)})),["dragleave","drop"].forEach((function(t){e.addEventListener(t,i,!1)})),e.addEventListener("drop",(function(e){var n=e.dataTransfer.files;t.files&&t.files[0]&&(t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file"));t.files=n,r(),window.onVerificationFileDrop&&window.onVerificationFileDrop(),window.onDeliveryFileDrop&&window.onDeliveryFileDrop(),window.onInstallationFileDrop&&window.onInstallationFileDrop()}),!1);var r=function(){c(t)},c=function(t){if(t.files&&t.files[0]){var n=new FileReader;n.onload=function(n){e.parentNode.classList.add("loaded"),e.nextElementSibling.querySelector(".file-load__name").textContent=t.files[0].name},n.readAsDataURL(t.files[0])}};t.addEventListener("change",r),n.addEventListener("click",(function(){e.parentNode.classList.remove("loaded"),t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file")}))}document.querySelectorAll(".modal.requests-upload")||(console.log("input file"),window.makeFileLoad=t,e[0]&&e.forEach((function(e){t(e)})))}(),function(){var e=document.querySelectorAll(".input-text");e[0]&&e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))}))}(),function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));var t,n,a=document.querySelector("body");function o(e,t){this.trigger=e,this.modal=t,this.overlay=this.modal.querySelector(".modal__overlay"),this.closeBtn=this.modal.querySelector(".modal__close"),this.onOverlayClick=this.onOverlayClick.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onTriggerClick=this.onTriggerClick.bind(this),this.addEventListeners()}window.addEventListener("resize",(t=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))},function(e){n&&clearTimeout(n),n=setTimeout(t,100,e)})),o.prototype.open=function(){this.modal.classList.add("js-show"),a.classList.add("js__body-no-scroll")},o.prototype.close=function(){this.modal.classList.remove("js-show"),a.classList.remove("js__body-no-scroll")},o.prototype.onOverlayClick=function(e){e.target===this.overlay&&this.close()},o.prototype.onCloseClick=function(){this.close()},o.prototype.onTriggerClick=function(){this.open()},o.prototype.addEventListeners=function(){this.overlay.addEventListener("click",this.onOverlayClick),this.closeBtn&&this.closeBtn.addEventListener("click",this.onCloseClick),this.trigger&&this.trigger.addEventListener("click",this.onTriggerClick)},window.Modal=o}(),$(".input-money").mask("# ##0 ₽",{reverse:!0}),function(){var e=document.querySelectorAll(".input-phone");if(e[0]){var t=new Inputmask("+7(999) 999-99-99");e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelectorAll(".search"),t=document.querySelectorAll(".search + .search-close");e[0]&&(e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))})),t.forEach((function(e){e.addEventListener("click",(function(){var t=e.previousElementSibling;t.value="",t.classList.contains("js-inputed")&&t.classList.remove("js-inputed")}))})))}(),function(){function e(e){var t=e.text.split("splitter"),n=window.matchMedia("(max-width: 999px)").matches?"<br>":"";return t.length>1?$("<span>"+t[0]+"</span>"+n+"<span>"+t[1]+"</span>"):e.text}$(".select").select2({templateResult:e,templateSelection:e}),$(".select").on("select2:select",(function(e){$(this).addClass("picked")}))}(),$(window).on("load",(function(){new Swiper(".subscription-tabs",{freeMode:!0,slidesPerView:"auto",watchOverflow:!0})})),function(){var e=document.querySelectorAll(".delivery-or-pickup__modal-time");if(e[0]){var t=new Inputmask("99:99");e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelectorAll(".account-creation__new");if(e[0]){var t=document.getElementById("account-creation");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){if(document.getElementById("account-creation")){var e=$(".account-creation__input .input-text"),t=$("#account-creation .modal__save");e.on("input",(function(n){0===e.filter((function(){return""===this.value.split(" ").join("")||0===this.value.length})).length?t.removeAttr("disabled"):t.attr("disabled","")}))}}(),function(){var e=$(".agent-report__equipment  table  tbody"),t=e.children().eq(1);$(".agent-report__add-line").on("click",(function(){e.append(t.clone())}))}(),function(){if(document.querySelector(".agents__users-block-mobile")){new Swiper(".agents__users-block-mobile__slider",{slidesPerView:1,pagination:{el:".agents__users-block-mobile__pagination",dynamicBullets:!0}});$(".agents__users-btn").parent().next().slideToggle()}}(),$(".agents__users-btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){var e=document.querySelectorAll(".contract-info__cancellation");if(e[0]){var t=document.getElementById("cancellation__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.querySelectorAll(".user-settings__change-email");if(e[0]){var t=document.getElementById("change-email");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.getElementById("change-email");if(e){var t=e.querySelector(".change-email__input .input-text"),n=e.querySelector(".modal__save");t.addEventListener("input",(function(e){e.target.validity.valid&&n.removeAttribute("disabled"),e.target.validity.valid||n.hasAttribute("disabled")||n.setAttribute("disabled","")}))}}(),function(){var e=document.querySelectorAll(".user-settings__change-phone");if(e[0]){var t=document.getElementById("change-phone");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.getElementById("change-phone");if(e){var t=e.querySelector(".change-phone__input .input-text"),n=e.querySelector(".modal__save");t.addEventListener("input",(function(e){-1===e.target.value.indexOf("_")&&n.removeAttribute("disabled"),-1!==e.target.value.indexOf("_")&&(n.hasAttribute("disabled")||n.setAttribute("disabled",""))}))}}(),function(){var e=document.querySelectorAll(".contract-creation__client-type  input");if(e[0]){var t=document.querySelector(".contract-creation__details");e.forEach((function(e){e.addEventListener("change",n)}))}function n(){e[0].checked&&t.classList.remove("show-for-entity"),e[1].checked&&t.classList.add("show-for-entity")}}(),function(){if(document.querySelector(".clients-mobile-block"))new Swiper(".clients-mobile-block__slider",{slidesPerView:1,pagination:{el:".clients-mobile-block__pagination",dynamicBullets:!0}})}(),document.querySelectorAll("[data-trigger]").forEach((function(e){var t=e.getAttribute("data-trigger"),n=document.querySelector("[data-modal="+t+"]");n&&new Modal(e,n)})),function(){var e=document.getElementById("confirmation-code");if(e){var t=e.querySelector(".confirmation-code__input .input-text"),n=e.querySelector(".modal__save");t.addEventListener("input",(function(e){6===e.target.value.length&&n.removeAttribute("disabled"),e.target.value.length<6&&(n.hasAttribute("disabled")||n.setAttribute("disabled",""))}))}}(),$(".delivery-or-pickup.done").click((function(){$(this).find(".contract-info__delivered-adress").slideToggle(),$(this).find(".contract-info__delivered-toggle").toggleClass("opened")})),function(){if(document.querySelector(".contract-services")){var e=document.querySelectorAll(".contract-services__link"),t=function(e){var t=e.target;(t.classList.contains("checkbox-btn__label")||t.classList.contains("checkbox-btn__checkbox")||t.classList.contains("deliver-or-pickup__confirm-btn")||t.classList.contains("contract-services__delivery-confirm"))&&e.preventDefault()};e.forEach((function(e){e.addEventListener("click",t)}))}}(),function(){var e=document.querySelectorAll(".contracts__link");if(e[0]){var t=function(e){var t=e.target;(t.classList.contains("checkbox-btn__label")||t.classList.contains("checkbox-btn__checkbox")||t.classList.contains("contract-info__verification")||t.classList.contains("payment-waiting__confirm-btn")||t.classList.contains("contract-services__delivery-confirm")||t.classList.contains("reports__download-btn")||$(t).parents(".reports__download-btn").length>0)&&e.preventDefault()};e.forEach((function(e){e.addEventListener("click",t)}))}}(),function(){if(document.querySelector(".contract-services-mobile"))new Swiper(".contract-services-mobile__slider",{slidesPerView:1,pagination:{el:".contract-services-mobile__pagination",dynamicBullets:!0}})}(),function(){if(document.querySelector(".contracts-mobile"))new Swiper(".contracts-mobile__slider",{slidesPerView:1,pagination:{el:".contracts-mobile__pagination",dynamicBullets:!0}})}(),function(){var e=document.querySelectorAll(".subscription-page__action-item--delete");if(e[0]){var t=document.getElementById("delete-service__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.querySelectorAll(".deliver-or-pickup__confirm-btn");if(e[0]){var t=document.getElementById("delivery-or-pickup__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.querySelectorAll(".contract-creation__delivery-device");e[0]&&e.forEach((function(e){var t=e.querySelectorAll(".contract-creation__delivery-type-wrapper  input");function n(e){var n=e.target.parentNode.parentNode.parentNode;t[0].checked&&n.classList.remove("show-for-pickup"),t[1].checked&&n.classList.add("show-for-pickup")}t.forEach((function(e){e.addEventListener("change",n)}))}))}(),function(){function e(e){var t=""+e,n=+t[t.length-1];return 1===+t[t.length-2]?"".concat(e," лет"):1===n?"".concat(e," год"):n>1&&n<5?"".concat(e," года"):n>4||0===n?"".concat(e," лет"):void 0}var t=$(".device-period__range-value-year"),n=$(".device-period__range-value-price"),a=n.text(),o=+n.attr("data-price");function i(e){return"".concat(o*e," ").concat(a)}$(".js-range-single-slider").ionRangeSlider({type:"single",grid:!1,hide_min_max:!0,extra_classes:"single-slider",onStart:function(a){t.text(e(a.from)),n.text(i(a.from))},onChange:function(a){t.text(e(a.from)),n.text(i(a.from))}}),$(".irs--flat").on("click",(function(e){console.log(e.target)}))}(),function(){var e=$(".mutual-calcs__earned-date-menu");$(".mutual-calcs__earned-date-btn");$.extend($.datepicker,{_inlineDatepicker2:$.datepicker._inlineDatepicker,_inlineDatepicker:function(e,t){this._inlineDatepicker2(e,t);var n=$.datepicker._get(t,"beforeShow");n&&n.apply(e,[e,t])}}),$(".mutual-calcs__earned-date-btn").on("click",(function(){$(".mutual-calcs__earned-date-menu").toggle()})),$("#earned-date").datepicker({range:"period",inline:!0,showButtonPanel:!0,showOtherMonths:!0,selectOtherMonths:!0,closeText:"Готово",dateFormat:"dd.mm.yy",beforeShow:function(e,t){t.dpDiv.css("transform","translateX(-24px)"),t.dpDiv.addClass("calendar-range")},onSelect:function(e,t,n){$(".mutual-calcs__earned-date-btn").text(n.startDateText+" - "+n.endDateText)}}),$(document).mouseup((function(e){var t=$(".mutual-calcs__earned-date-menu"),n=$(".mutual-calcs__earned-date-btn");t.is(e.target)||0!==t.has(e.target).length||n.is(e.target)||0!==n.has(e.target).length||t.hide()})),$(".mutual-calcs__earned-date-menu-btn").on("click",(function(){$(this).hasClass("all-time")?""===$(".earned-date__start-period").text()?$(".mutual-calcs__earned-date-btn").text($(this).text()):$(".mutual-calcs__earned-date-btn").text($(this).text()+" (с "+$(".earned-date__start-period").text()+")"):$(".mutual-calcs__earned-date-btn").text($(this).text()),e.hide()})),""===$(".earned-date__start-period").text()?$(".mutual-calcs__earned-date-btn").text($(".mutual-calcs__earned-date-menu-btn.all-time").text()):$(".mutual-calcs__earned-date-btn").text($(".mutual-calcs__earned-date-menu-btn.all-time").text()+" (с "+$(".earned-date__start-period").text()+")")}(),$(".filters__btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),$(".filters__btn-clear").click((function(){$(".filters .select").val("Все"),$(".filters .select").trigger("change"),$(".filters .select").removeClass("picked")})),function(){var e=$(".subscription-all__hierarchy-trigger"),t=$(".hierarchy"),n=t.find(".hierarchy__blackout"),a=t.find(".hierarchy__close");e.on("click",(function(){t.addClass("opened")})),n.on("click",(function(){t.removeClass("opened")})),a.on("click",(function(){t.removeClass("opened")}))}(),function(){var e=$(".hierarchy__line");e.on("click",(function(){$(this).find(".hierarchy__open-btn").toggleClass("opened"),$(this).next().toggleClass("opened"),$(this).hasClass("marked")||(e.removeClass("marked"),$(this).addClass("marked"))}))}(),function(){if(document.querySelector(".installation-accounts-mobile"))new Swiper(".installation-accounts-mobile__slider",{slidesPerView:1,pagination:{el:".installation-accounts-mobile__pagination",dynamicBullets:!0}})}(),function(){var e=document.querySelectorAll(".installation__confirm-btn");if(e[0]){var t=document.getElementById("installation__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.querySelectorAll(".delivery-or-pickup__installation-choose-block  input");if(e[0]){var t=e[0].parentNode.parentNode.parentNode.parentNode;e.forEach((function(e){e.addEventListener("change",n)}))}function n(){console.log(t),e[0].checked&&(t.classList.contains("show-for-manual")&&t.classList.remove("show-for-manual"),t.classList.contains("show-for-registration")&&t.classList.remove("show-for-registration"),t.classList.contains("show-for-delivery")||t.classList.add("show-for-delivery")),e[1].checked&&(t.classList.contains("show-for-manual")&&t.classList.remove("show-for-manual"),t.classList.contains("show-for-delivery")&&t.classList.remove("show-for-delivery"),t.classList.contains("show-for-registration")||t.classList.add("show-for-registration")),e[2].checked&&(t.classList.contains("show-for-delivery")&&t.classList.remove("show-for-delivery"),t.classList.contains("show-for-registration")&&t.classList.remove("show-for-registration"),t.classList.contains("show-for-manual")||t.classList.add("show-for-manual"))}}(),function(){var e=document.querySelectorAll(".mutual-calcs__make-payment");if(e[0]){var t=document.getElementById("payment-waiting__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.querySelector(".header__nav-btn");if(e){var t=document.querySelector(".header__close-btn"),n=document.querySelector(".header__nav"),a=function(){return window.matchMedia("(max-width: 1439px)").matches};a();e.addEventListener("click",(function(){a()&&(e.classList.toggle("js-opened"),n.classList.toggle("js-show"))})),t.addEventListener("click",(function(){n.classList.remove("js-show"),e.classList.toggle("js-opened")}))}}(),function(){if(document.querySelector(".mutual-calcs-payment-mobile"))new Swiper(".mutual-calcs-payment-mobile__slider",{slidesPerView:1,pagination:{el:".mutual-calcs-payment-mobile__pagination",dynamicBullets:!0}})}(),function(){if(document.querySelector(".mutual-calcs-block-mobile"))new Swiper(".mutual-calcs-block-mobile__slider",{slidesPerView:1,pagination:{el:".mutual-calcs-block-mobile__pagination",dynamicBullets:!0}})}(),document.querySelectorAll(".input-password")[0]&&$(document).on("click",".input-icon--show-password",(function(){$(this).toggleClass("active"),$(this).hasClass("active")?$(this).next().attr("type","text"):$(this).next().attr("type","password")})),function(){var e=document.querySelectorAll(".payment-waiting__confirm-btn");if(e[0]){var t=document.getElementById("payment-waiting__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.getElementById("payment-waiting__modal");if(e){var t=e.querySelector(".modal__close"),n=e.querySelector(".modal__overlay"),a=e.querySelector(".transactions__check-all input"),o=e.querySelector(".payment-waiting__modal-sender input"),i=e.querySelector(".payment-waiting__modal-recipient input"),r=e.querySelector(".payment-waiting__modal-sum input"),c=e.querySelector(".payment-waiting__modal-purpose input"),l=function(){return e.querySelectorAll(".transactions__check input")},s=function(){return e.querySelectorAll(".transactions__mobile-check input")},d=function(){a.checked=!1,l().forEach((function(e){e.checked=!1,e.parentNode.parentNode.parentNode.parentNode.classList.remove("checked")})),s().forEach((function(e){e.checked=!1,e.parentNode.parentNode.parentNode.classList.remove("checked")})),$("#payment-date").datepicker("setDate",""),o.value="",i.value="",r.value="",c.value=""},u=function(e){e.target.checked?e.target.parentNode.parentNode.parentNode.parentNode.classList.add("checked"):e.target.parentNode.parentNode.parentNode.parentNode.classList.remove("checked")},f=function(e){e.target.checked?e.target.parentNode.parentNode.parentNode.classList.add("checked"):e.target.parentNode.parentNode.parentNode.classList.remove("checked")};t.addEventListener("click",d),n.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&d()})),a.addEventListener("change",(function(){l().forEach((function(e){var t=e.parentNode.parentNode.parentNode.parentNode;a.checked?(e.checked=!0,t.classList.contains("checked")||t.classList.add("checked")):(e.checked=!1,t.classList.contains("checked")&&t.classList.remove("checked"))}))})),l().forEach((function(e){e.addEventListener("change",u)})),s().forEach((function(e){e.addEventListener("change",f)}))}}(),function(){var e=document.querySelectorAll(".mutual-calcs-payment-block__link");if(e[0]){var t=document.getElementById("payment-info__modal");e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e,t=document.getElementById("js-video-box");$(".subscribe-register__input .input-text").each((function(n,a){var o=$(this);o.siblings(".subscribe-register__btn").on("click",(function(n){var a;(e=new JsQRScanner((a=o,function(n){a.val(n),$(".qr-scanner-modal").removeClass("js-show"),e.stopScanning(),e.removeFrom(t)}))).setSnapImageMaxSize(300),t&&(t.innerHTML="",e.appendTo(t))}))})),$(document).on("click",".qr-scanner-modal .qr-scanner-modal__close",(function(n){e.stopScanning(),e.removeFrom(t)}))}(),function(){var e=$(".reports__download-btn"),t=$(".reports__download-dropdown");0!==e.length&&(e.on("click",(function(){var e=$(this).next().hasClass("shown");t.removeClass("shown"),!e&&$(this).next().addClass("shown")})),$(document).on("click",(function(e){var n=$(e.target);n.hasClass("reports__download-btn")||n.parents(".reports__download-btn").length>0||n.hasClass("reports__download-dropdown")||n.parents(".reports__download-dropdown").length>0||t.removeClass("shown")})))}(),function(){if(document.querySelector(".subscription-page__reward-mobile"))new Swiper(".subscription-page__reward-mobile",{slidesPerView:1,pagination:{el:".subscription-page__pagination",dynamicBullets:!0}})}(),function(){var e=document.querySelectorAll(".contract-device__schedule");if(e[0]){var t=document.getElementById("schedule__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){if(document.getElementById("schedule__modal")){var e=document.querySelectorAll(".schedule__modal-toggle input"),t=document.querySelector(".schedule__modal-toggle");e.forEach((function(e,n){e.addEventListener("change",(function(){0===n&&(t.classList.remove("second-tab"),t.classList.add("first-tab")),1===n&&(t.classList.remove("first-tab"),t.classList.add("second-tab"))}))}))}}(),function(){if(document.querySelector(".main-page")){var e=document.querySelector(".support"),t=document.querySelector(".support__container"),n=e.querySelectorAll(".support__item");!function(){var e=document.createDocumentFragment(),a=document.createElement("div");a.classList.add("swiper-container"),a.classList.add("support__slider");var o=document.createElement("div");o.classList.add("swiper-wrapper"),n.forEach((function(e,t){var n=document.createElement("div");n.classList.add("swiper-slide");var a=e.cloneNode(!0);n.appendChild(a),o.appendChild(n)}));var i=document.createElement("div");i.classList.add("support__slider-pagination","swiper-pagination"),a.appendChild(o),a.appendChild(i),e.appendChild(a),t.appendChild(e),new Swiper(".support__slider",{slidesPerView:1,pagination:{el:".support__slider-pagination"}})}()}}(),$(".support__docs-btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){if(document.querySelector(".transactions-mobile-block"))new Swiper(".transactions-mobile-block__slider",{slidesPerView:1,pagination:{el:".transactions-mobile-block__pagination",dynamicBullets:!0}})}(),$(".header__user-btn").on("click",(function(e){$(this).is(e.target)&&$(this).toggleClass("active")})),$(document).on("mouseup",(function(e){var t=$(".header__user-btn");t.is(e.target)||0!==t.has(e.target).length||t.removeClass("active")})),function(){var e=document.querySelectorAll(".contract-info__verification");if(e[0]){var t=document.getElementById("verification__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.getElementById("verification__modal");if(e){var t=e.querySelectorAll(".verification__modal-input-file"),n=e.querySelector(".modal__close"),a=e.querySelector(".modal__overlay"),o=e.querySelector(".modal__save"),i=function(){t.forEach((function(e){var t=e.querySelector(".input-file__input");e.classList.contains("loaded")&&(e.classList.remove("loaded"),t.value="",o.setAttribute("disabled",""),/safari/i.test(navigator.userAgent)||(t.type="",t.type="file"))}))},r=function(){o.hasAttribute("disabled")||o.setAttribute("disabled","")};window.onVerificationFileDrop=function(){var e;e=!0,t.forEach((function(t){""===t.querySelector(".input-file__input").value&&(e=!1)})),e&&o.hasAttribute("disabled")&&o.removeAttribute("disabled"),e||o.hasAttribute("disabled")||o.setAttribute("disabled","")},t.forEach((function(e){var t=e.querySelector(".input-file__input"),n=e.querySelector(".file-load__clear");t.addEventListener("change",window.onVerificationFileDrop),n.addEventListener("click",r)})),n.addEventListener("click",i),a.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&i()}))}}(),function(){var e=document.querySelectorAll(".contract-info__serial-btn");if(e[0]){var t=document.getElementById("write-serial");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.getElementById("write-serial");if(e){var t=e.querySelector(".write-serial__input .input-text"),n=e.querySelector(".modal__save");t.addEventListener("input",(function(e){var t=e.target.value;""!==t.split(" ").join("")&&t.length>0&&n.hasAttribute("disabled")&&n.removeAttribute("disabled"),""!==t.split(" ").join("")&&0!==t.length||n.hasAttribute("disabled")||n.setAttribute("disabled","")}))}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyIsImNoZWNrYm94LTIuanMiLCJkYXRlLWlucHV0LmpzIiwiaW5wdXQtZmlsZS1yZXF1ZXN0cy5qcyIsImlucHV0LWZpbGUtc2Nhbi5qcyIsImlucHV0LWZpbGUuanMiLCJpbnB1dC10ZXh0LmpzIiwibW9kYWwuanMiLCJtb25leS1tYXNrLmpzIiwicGhvbmUtbWFzay5qcyIsInNlYXJjaC5qcyIsInNlbGVjdC5qcyIsInN1YnNjcmlwdGlvbi10YWJzLmpzIiwidGltZS1tYXNrLmpzIiwiYWNjb3VudC1jcmVhdGlvbi1tb2RhbC5qcyIsImFjY291bnQtY3JlYXRpb24uanMiLCJhZ2VudC1yZXBvcnQuanMiLCJhZ2VudC11c2Vycy1zbGlkZXIuanMiLCJhZ2VudHMuanMiLCJjYW5jZWxsYXRpb24tbW9kYWwuanMiLCJjaGFuZ2UtZW1haWwtbW9kYWwuanMiLCJjaGFuZ2UtZW1haWwuanMiLCJjaGFuZ2UtcGhvbmUtbW9kYWwuanMiLCJjaGFuZ2UtcGhvbmUuanMiLCJjbGllbnQtdHlwZS5qcyIsImNsaWVudHMtc2xpZGVyLmpzIiwiY29tbW9uLW1vZGFsLmpzIiwiY29uZmlybWF0aW9uLWNvZGUuanMiLCJjb250cmFjdC1wYWdlLmpzIiwiY29udHJhY3Qtc2VydmljZXMuanMiLCJjb250cmFjdHMtYWxsLmpzIiwiY29udHJhY3RzLXNlcnZpY2VzLXNsaWRlci5qcyIsImNvbnRyYWN0cy1zbGlkZXIuanMiLCJkZWxldGUtc2VydmljZS1tb2RhbC5qcyIsImRlbGl2ZXJ5LW1vZGFsLmpzIiwiZGVsaXZlcnktdHlwZS5qcyIsImRldmljZS1wZXJpb2QuanMiLCJlYXJuZWQtZGF0ZS5qcyIsImZpbHRlcnMuanMiLCJoaWVyYXJjaHktbW9kYWwuanMiLCJoaWVyYXJjaHkuanMiLCJpbnN0YWxsYXRpb24tYWNjb3VudHMtc2xpZGVyLmpzIiwiaW5zdGFsbGF0aW9uLW1vZGFsLmpzIiwiaW5zdGFsbGF0aW9uLXdhaXRpbmcuanMiLCJtYWtlLXBheW1lbnQtbW9kYWwuanMiLCJtZW51LmpzIiwibXV0dWFsLWNhbGNzLXBheW1lbnQtc2xpZGVyLmpzIiwibXV0dWFsLWNhbGNzLXNsaWRlci5qcyIsInBhc3N3b3JkLWlucHV0LmpzIiwicGF5bWVudC1jb25maXJtLW1vZGFsLmpzIiwicGF5bWVudC1jb25maXJtLmpzIiwicGF5bWVudC1pbmZvLW1vZGFsLmpzIiwicXJzY2FubmVyLmpzIiwicmVwb3J0LWRyb3Bkb3duLmpzIiwicmV3YXJkLXNsaWRlci5qcyIsInNjaGVkdWxlLW1vZGFsLmpzIiwic2NoZWR1bGUuanMiLCJzdXBwb3J0LXNsaWRlci5qcyIsInN1cHBvcnQuanMiLCJ0cmFuc2FjdGlvbnMtc2xpZGVyLmpzIiwidXNlci1idG4uanMiLCJ2ZXJpZmljYXRpb24tbW9kYWwuanMiLCJ2ZXJpZmljYXRpb24uanMiLCJ3cml0ZS1zZXJpYWwtbW9kYWwuanMiLCJ3cml0ZS1zZXJpYWwuanMiXSwibmFtZXMiOlsiY2hlY2tib3gyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsIml0ZW0iLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsInRhcmdldCIsImNoZWNrZWQiLCJwYXJlbnROb2RlIiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwiJCIsImRhdGVwaWNrZXIiLCJkYXRlRm9ybWF0IiwicmFuZ2UiLCJpbmxpbmUiLCJzaG93QnV0dG9uUGFuZWwiLCJzaG93T3RoZXJNb250aHMiLCJzZWxlY3RPdGhlck1vbnRocyIsImNsb3NlVGV4dCIsImJlZm9yZVNob3ciLCJpbnB1dCIsImluc3QiLCJkcERpdiIsImNzcyIsImFkZENsYXNzIiwib25TZWxlY3QiLCJkYXRlVGV4dCIsImV4dGVuc2lvblJhbmdlIiwidmFsIiwic3RhcnREYXRlVGV4dCIsImVuZERhdGVUZXh0IiwicmVxdWVzdE1vZGFsIiwicXVlcnlTZWxlY3RvciIsImZpbGVzV3JhcHBlciIsImZpbGVJbnB1dEl0ZW0iLCJuZXdGaWxlSW5wdXRJdGVtIiwiY2xvbmVOb2RlIiwic3VibWl0IiwiY2FuY2VsIiwib25GaWxlQ2hhbmdlIiwicmVhZFVybCIsImFkZEV2ZW50TGlzdGVuZXJzIiwiaWR4IiwicmVtb3ZlRXZlbnRMaXN0ZW5lcnMiLCJoYXNBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJwcmV2ZW50RGVmYXVsdHMiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsImNoZWNrRm9ybSIsImZpbGVzIiwibGVuZ3RoIiwicmVtb3ZlQXR0cmlidXRlIiwiZmlsZURyb3BBcmVhIiwiYmFyIiwic3RhdHVzIiwiZmlsZUxvYWQiLCJmaWxlSW5mbyIsInJlYWRlciIsIkZpbGVSZWFkZXIiLCJvbmxvYWRzdGFydCIsIm9ucHJvZ3Jlc3MiLCJzdHlsZSIsIndpZHRoIiwiTWF0aCIsInJvdW5kIiwibG9hZGVkIiwidG90YWwiLCJ0ZXh0Q29udGVudCIsIm9ubG9hZCIsIm5leHRFbGVtZW50U2libGluZyIsIm5hbWUiLCJzaXplIiwic2l6ZURpbSIsInR5cGUiLCJuZXdJdGVtIiwicHJlcGVuZCIsInJlYWRBc0RhdGFVUkwiLCJoYW5kbGVEcm9wIiwiZmlsZUlucHV0IiwiY3VycmVudFRhcmdldCIsImRhdGFUcmFuc2ZlciIsImNvbnNvbGUiLCJsb2ciLCJ2YWx1ZSIsInRlc3QiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJvbkNsZWFyIiwiZHJvcEFyZWEiLCJmaWxlQ2xlYXIiLCJoaWdobGlnaHQiLCJ1bmhpZ2hsaWdodCIsImV2ZW50TmFtZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzY2FuVXBsb2FkIiwiZmlsbGVkIiwiY29udGFpbnMiLCJtYWtlRmlsZUxvYWQiLCJ3aW5kb3ciLCJvblZlcmlmaWNhdGlvbkZpbGVEcm9wIiwib25EZWxpdmVyeUZpbGVEcm9wIiwib25JbnN0YWxsYXRpb25GaWxlRHJvcCIsImlucHV0cyIsInNwbGl0Iiwiam9pbiIsInZoIiwiaW5uZXJIZWlnaHQiLCJkb2N1bWVudEVsZW1lbnQiLCJzZXRQcm9wZXJ0eSIsImNvbmNhdCIsImZ1bmMiLCJ0aW1lciIsIiRib2R5IiwiTW9kYWwiLCJ0cmlnZ2VyIiwibW9kYWwiLCJ0aGlzIiwib3ZlcmxheSIsImNsb3NlQnRuIiwib25PdmVybGF5Q2xpY2siLCJiaW5kIiwib25DbG9zZUNsaWNrIiwib25UcmlnZ2VyQ2xpY2siLCJldmVudCIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJwcm90b3R5cGUiLCJvcGVuIiwiY2xvc2UiLCJtYXNrIiwicmV2ZXJzZSIsImltIiwiSW5wdXRtYXNrIiwiaXRlbXMiLCJzZWFyY2giLCJwcmV2aW91c0VsZW1lbnRTaWJsaW5nIiwiZm9ybWF0T3B0aW9uIiwidGV4dCIsImJyIiwibWF0Y2hNZWRpYSIsIm1hdGNoZXMiLCJzZWxlY3QyIiwidGVtcGxhdGVSZXN1bHQiLCJ0ZW1wbGF0ZVNlbGVjdGlvbiIsIm9uIiwiU3dpcGVyIiwiZnJlZU1vZGUiLCJzbGlkZXNQZXJWaWV3Iiwid2F0Y2hPdmVyZmxvdyIsImRlbGl2ZXJ5VGltZUlucHV0cyIsImNhbmNlbGxhdGlvbkJ0biIsImdldEVsZW1lbnRCeUlkIiwiJGlucHV0IiwiJGJ0biIsImZpbHRlciIsInJlbW92ZUF0dHIiLCJhdHRyIiwiJHRib2R5IiwiJGxpbmUiLCJjaGlsZHJlbiIsImVxIiwiYXBwZW5kIiwiY2xvbmUiLCJwYWdpbmF0aW9uIiwiZWwiLCJkeW5hbWljQnVsbGV0cyIsInBhcmVudCIsIm5leHQiLCJzbGlkZVRvZ2dsZSIsImNsaWNrIiwidG9nZ2xlQ2xhc3MiLCJjaGFuZ2VCdXR0b24iLCJidG4iLCJ2YWxpZGl0eSIsInZhbGlkIiwiaW5kZXhPZiIsInJhZGlvcyIsIndyYXBwZXIiLCJvblJhZGlvQ2hhbmdlIiwiZ2V0QXR0cmlidXRlIiwiZmluZCIsImxpbmtzIiwib25MaW5rQ2xpY2siLCJsaW5rIiwiY29udHJhY3RzTGlua0FsbCIsInBhcmVudHMiLCJkZWxpdmVyeUJ0bnMiLCJkZXZpY2VzIiwiZ2V0WWVhckxhYmVsIiwibnVtIiwibGFzdE51bWJlciIsIiR5ZWFycyIsIiRwcmljZSIsInByaWNlQ3VycmVuY3kiLCJwcmljZUJhc2ljIiwiZ2V0UHJpY2UiLCJpb25SYW5nZVNsaWRlciIsImdyaWQiLCJoaWRlX21pbl9tYXgiLCJleHRyYV9jbGFzc2VzIiwib25TdGFydCIsImRhdGEiLCJmcm9tIiwib25DaGFuZ2UiLCJtZW51IiwiZXh0ZW5kIiwiX2lubGluZURhdGVwaWNrZXIyIiwiX2lubGluZURhdGVwaWNrZXIiLCJfZ2V0IiwiYXBwbHkiLCJ0b2dnbGUiLCJtb3VzZXVwIiwiaXMiLCJoYXMiLCJoaWRlIiwiaGFzQ2xhc3MiLCJyZW1vdmVDbGFzcyIsIiR0cmlnZ2VyIiwiJG1vZGFsIiwiJGJsYWNrb3V0IiwiJGNsb3NlIiwicGF5bWVudENvbmZpcm1CdG5zIiwibWVudUJ0biIsIm5hdiIsImNoZWNrSWZUYWJsZXQiLCJtYWluQ2hlY2tib3giLCJzZW5kZXJJbnB1dCIsInJlY2lwaWVudElucHV0Iiwic3VtSW5wdXQiLCJwdXJwb3NlSW5wdXQiLCJnZXRBbGxDaGVja2JveCIsImdldEFsbE1vYmlsZUNoZWNrYm94Iiwib25DaGVja2JveENoYW5nZSIsIm9uTW9iaWxlQ2hlY2tib3hDaGFuZ2UiLCJyb3ciLCJwYXltZW50cyIsImpiU2Nhbm5lciIsInNjYW5uZXJQYXJlbnRFbGVtZW50IiwiZWFjaCIsImluZGV4Iiwic2libGluZ3MiLCJKc1FSU2Nhbm5lciIsInNjYW5uZWRUZXh0Iiwic3RvcFNjYW5uaW5nIiwicmVtb3ZlRnJvbSIsInNldFNuYXBJbWFnZU1heFNpemUiLCJpbm5lckhUTUwiLCJhcHBlbmRUbyIsIiRkcm9wZG93biIsImlzT3BlbmVkIiwiJHRhcmdldCIsInNjaGVkdWxlQnRucyIsImlkIiwic3VwcG9ydCIsInN1cHBvcnRDb250YWluZXIiLCJmcmFnbWVudCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJjb250YWluZXIiLCJjcmVhdGVFbGVtZW50Iiwic2xpZGUiLCJub2RlIiwiYXBwZW5kQ2hpbGQiLCJtYWtlU2xpZGVyIiwiYmxvY2siLCJ2ZXJpZmljYXRpb25CdG4iLCJmaWxlSW5wdXRCbG9jayIsInNhdmVCdG4iLCJpbnB1dEJsb2NrIiwib25GaWxlQ2xlYXIiXSwibWFwcGluZ3MiOiJBQUFBLGNDQUEsV0FDQSxJQUFBQSxFQUFBQyxTQUFBQyxpQkFBQSxzQkFFQUYsRUFBQSxJQUlBQSxFQUFBRyxTQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLGlCQUFBLFVBQUEsU0FBQUMsR0FDQSxJQUFBQyxFQUFBRCxFQUFBQyxRQUNBLElBQUFBLEVBQUFDLFFBQ0FELEVBQUFFLFdBQUFDLFVBQUFDLElBQUEsV0FFQUosRUFBQUUsV0FBQUMsVUFBQUUsT0FBQSxpQkFiQSxHQ0NBQyxFQUFBLHNDQUFBQyxXQUFBLENBQUFDLFdBQUEsYUFFQUYsRUFBQSxxQkFBQUMsV0FBQSxDQUNBRSxNQUFBLFNBQ0FDLFFBQUEsRUFDQUMsaUJBQUEsRUFDQUMsaUJBQUEsRUFDQUMsbUJBQUEsRUFDQUMsVUFBQSxTQUNBTixXQUFBLFdBRUFPLFdBQUEsU0FBQUMsRUFBQUMsR0FDQUEsRUFBQUMsTUFBQUMsSUFBQSxZQUFBLHFCQUNBRixFQUFBQyxNQUFBRSxTQUFBLG1CQUdBQyxTQUFBLFNBQUFDLEVBQUFMLEVBQUFNLEdBQ0FOLEVBQUFELE1BQUFRLElBQUFELEVBQUFFLGNBQUEsTUFBQUYsRUFBQUcsZ0JDbEJBLFdBQ0EsSUFBQUMsRUFBQWpDLFNBQUFrQyxjQUFBLDBCQUVBLEdBQUFELEVBQUEsQ0FJQSxJQUFBRSxFQUFBbkMsU0FBQWtDLGNBQUEsK0NBQ0FFLEVBQUFELEVBQUFELGNBQUEsZUFDQUcsRUFBQUQsRUFBQUUsV0FBQSxHQUNBQyxFQUFBTixFQUFBQyxjQUFBLGdCQUNBTSxFQUFBUCxFQUFBQyxjQUFBLGlCQXNIQU8sRUFBQSxTQUFBcEMsR0FDQXFDLEVBQUFyQyxFQUFBQyxTQW1GQXFDLEVBQUFQLEdBQ0FJLEVBQUFwQyxpQkFBQSxTQUFBLFdBN0xBK0IsRUFBQWxDLGlCQUFBLHdCQUFBQyxTQUFBLFNBQUFDLEVBQUF5QyxHQUNBLElBQUFBLElBQ0FDLEVB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RixjQUFBLG9DQUNBNkksRUFBQXpELEVBQUFwRixjQUFBLGdCQTJCQVosRUFBQWxCLGlCQUFBLFNBekJBLFNBQUFDLEdBQ0EsSUFBQWlGLEVBQUFqRixFQUFBQyxPQUFBZ0YsTUFHQSxLQUFBQSxFQUFBb0IsTUFBQSxLQUFBQyxLQUFBLEtBQ0FyQixFQUFBakMsT0FBQSxHQUNBMEgsRUFBQWpJLGFBQUEsYUFFQWlJLEVBQUF6SCxnQkFBQSxZQUlBLEtBQUFnQyxFQUFBb0IsTUFBQSxLQUFBQyxLQUFBLEtBQ0EsSUFBQXJCLEVBQUFqQyxRQUVBMEgsRUFBQWpJLGFBQUEsYUFDQWlJLEVBQUFoSSxhQUFBLFdBQUEsUUFoQ0EiLCJmaWxlIjoic2NyaXB0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY2hlY2tib3gyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNoZWNrYm94LTJfX2lucHV0Jyk7XG5cbiAgaWYgKCFjaGVja2JveDJbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjaGVja2JveDIuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDtcblxuICAgICAgaWYgKHRhcmdldC5jaGVja2VkID09PSB0cnVlKSB7XG4gICAgICAgIHRhcmdldC5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhcmdldC5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAkKCcuZGF0ZS1pbnB1dDpub3QoLmRhdGUtaW5wdXQtcmFuZ2UpJykuZGF0ZXBpY2tlcih7XG4gICAgZGF0ZUZvcm1hdDogJ2RkLm1tLnl5J1xuICB9KTtcbiAgJCgnLmRhdGUtaW5wdXQtcmFuZ2UnKS5kYXRlcGlja2VyKHtcbiAgICByYW5nZTogJ3BlcmlvZCcsXG4gICAgaW5saW5lOiB0cnVlLFxuICAgIHNob3dCdXR0b25QYW5lbDogdHJ1ZSxcbiAgICBzaG93T3RoZXJNb250aHM6IHRydWUsXG4gICAgc2VsZWN0T3RoZXJNb250aHM6IHRydWUsXG4gICAgY2xvc2VUZXh0OiBcItCT0L7RgtC+0LLQvlwiLFxuICAgIGRhdGVGb3JtYXQ6ICdkZC5tbS55eScsXG4gICAgYmVmb3JlU2hvdzogZnVuY3Rpb24gYmVmb3JlU2hvdyhpbnB1dCwgaW5zdCkge1xuICAgICAgaW5zdC5kcERpdi5jc3MoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGVYKC0yNHB4KScpO1xuICAgICAgaW5zdC5kcERpdi5hZGRDbGFzcygnY2FsZW5kYXItcmFuZ2UnKTtcbiAgICB9LFxuICAgIG9uU2VsZWN0OiBmdW5jdGlvbiBvblNlbGVjdChkYXRlVGV4dCwgaW5zdCwgZXh0ZW5zaW9uUmFuZ2UpIHtcbiAgICAgIGluc3QuaW5wdXQudmFsKGV4dGVuc2lvblJhbmdlLnN0YXJ0RGF0ZVRleHQgKyAnIC0gJyArIGV4dGVuc2lvblJhbmdlLmVuZERhdGVUZXh0KTtcbiAgICB9XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHJlcXVlc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC5yZXF1ZXN0cy11cGxvYWQnKTtcblxuICBpZiAoIXJlcXVlc3RNb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBmaWxlc1dyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWwucmVxdWVzdHMtdXBsb2FkIC5pbnB1dC1maWxlX193cmFwcGVyJyk7XG4gIHZhciBmaWxlSW5wdXRJdGVtID0gZmlsZXNXcmFwcGVyLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlJyk7XG4gIHZhciBuZXdGaWxlSW5wdXRJdGVtID0gZmlsZUlucHV0SXRlbS5jbG9uZU5vZGUodHJ1ZSk7XG4gIHZhciBzdWJtaXQgPSByZXF1ZXN0TW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zYXZlJyk7XG4gIHZhciBjYW5jZWwgPSByZXF1ZXN0TW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuXG4gIGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0cyhlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH1cblxuICA7XG5cbiAgZnVuY3Rpb24gbWFrZUlucHV0c05hbWVzKCkge1xuICAgIGZpbGVzV3JhcHBlci5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCcpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGlkeCkge1xuICAgICAgaXRlbS5uYW1lID0gJ2ZpbGUtJyArIGlkeDtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsZWFySW5wdXRzKCkge1xuICAgIGZpbGVzV3JhcHBlci5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtZmlsZS1yZXF1ZXN0cycpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGlkeCkge1xuICAgICAgaWYgKGlkeCAhPT0gMCkge1xuICAgICAgICByZW1vdmVFdmVudExpc3RlbmVycyhpdGVtKTtcbiAgICAgICAgaXRlbS5yZW1vdmUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAhc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSAmJiBzdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoZWNrRm9ybSgpIHtcbiAgICB2YXIgZmlsZXMgPSBmaWxlc1dyYXBwZXIucXVlcnlTZWxlY3RvckFsbCgnLmZpbGUtbG9hZC5sb2FkZWQnKTtcbiAgICBmaWxlcy5sZW5ndGggPiAwICYmIHN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgJiYgc3VibWl0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICBmaWxlcy5sZW5ndGggPT09IDAgJiYgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgJiYgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gIH1cblxuICBmdW5jdGlvbiByZWFkVXJsKGlucHV0KSB7XG4gICAgdmFyIGZpZWxJbnB1dEl0ZW0gPSBpbnB1dC5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG4gICAgdmFyIGZpbGVEcm9wQXJlYSA9IGlucHV0LnBhcmVudE5vZGU7XG4gICAgdmFyIGJhciA9IGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX3Byb2dyZXNzLWN1cnJlbnQnKTtcbiAgICB2YXIgc3RhdHVzID0gZmlsZURyb3BBcmVhLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fc3RhdHVzIHNwYW4nKTtcbiAgICB2YXIgZmlsZUxvYWQgPSBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkJyk7XG4gICAgdmFyIGZpbGVJbmZvID0gZmlsZURyb3BBcmVhLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fc2l6ZScpO1xuXG4gICAgaWYgKGlucHV0LmZpbGVzICYmIGlucHV0LmZpbGVzWzBdKSB7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgcmVhZGVyLm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdsb2FkZWQnKTtcbiAgICAgIH07XG5cbiAgICAgIHJlYWRlci5vbnByb2dyZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgYmFyLnN0eWxlLndpZHRoID0gTWF0aC5yb3VuZChlLmxvYWRlZCAvIGUudG90YWwgKiAxMDApICsgJyUnO1xuICAgICAgICBzdGF0dXMudGV4dENvbnRlbnQgPSBNYXRoLnJvdW5kKGUubG9hZGVkIC8gZS50b3RhbCAqIDEwMCk7XG4gICAgICB9O1xuXG4gICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgYmFyLnN0eWxlLndpZHRoID0gJzEwMCUnO1xuICAgICAgICBmaWxlRHJvcEFyZWEubmV4dEVsZW1lbnRTaWJsaW5nLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX25hbWUnKS50ZXh0Q29udGVudCA9IGlucHV0LmZpbGVzWzBdLm5hbWU7XG4gICAgICAgIHZhciBzaXplID0gaW5wdXQuZmlsZXNbMF0uc2l6ZTtcbiAgICAgICAgdmFyIHNpemVEaW0gPSAnINCx0LDQudGCJztcbiAgICAgICAgdmFyIHR5cGUgPSAnWExTWCwgJztcblxuICAgICAgICBpZiAoc2l6ZSA+PSAxMDI0ICYmIHNpemUgPCAxMDQ4NTc2KSB7XG4gICAgICAgICAgc2l6ZSA9IE1hdGgucm91bmQoc2l6ZSAvIDEwMjQpO1xuICAgICAgICAgIHNpemVEaW0gPSAnINCa0LHQsNC50YInO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNpemUgPSBNYXRoLnJvdW5kKHNpemUgLyAxMDI0IC8gMTAyNCk7XG4gICAgICAgICAgc2l6ZURpbSA9ICcg0JzQsdCw0LnRgic7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5wdXQuZmlsZXNbMF0udHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcpIHtcbiAgICAgICAgICB0eXBlID0gJ1hMUywgJztcbiAgICAgICAgfVxuXG4gICAgICAgIGZpbGVMb2FkLmNsYXNzTGlzdC5hZGQoJ2xvYWRlZCcpO1xuICAgICAgICBmaWxlSW5mby50ZXh0Q29udGVudCA9IHR5cGUgKyBzaXplICsgc2l6ZURpbTtcbiAgICAgICAgdmFyIG5ld0l0ZW0gPSBuZXdGaWxlSW5wdXRJdGVtLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgZmlsZXNXcmFwcGVyLnByZXBlbmQobmV3SXRlbSk7XG4gICAgICAgIGFkZEV2ZW50TGlzdGVuZXJzKG5ld0l0ZW0pO1xuICAgICAgICBtYWtlSW5wdXRzTmFtZXMoKTtcbiAgICAgICAgY2hlY2tGb3JtKCk7XG4gICAgICB9O1xuXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbnB1dC5maWxlc1swXSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaGFuZGxlRHJvcChlKSB7XG4gICAgdmFyIGZpbGVJbnB1dCA9IGUuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIHZhciBkdCA9IGUuZGF0YVRyYW5zZmVyO1xuICAgIHZhciBmaWxlcyA9IGR0LmZpbGVzO1xuICAgIGNvbnNvbGUubG9nKGZpbGVzKTtcblxuICAgIGlmIChmaWxlSW5wdXQuZmlsZXMgJiYgZmlsZUlucHV0LmZpbGVzWzBdKSB7XG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZmlsZXNbMF0udHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcgfHwgZmlsZXNbMF0udHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC5zcHJlYWRzaGVldG1sLnNoZWV0Jykge1xuICAgICAgZmlsZUlucHV0LmZpbGVzID0gZmlsZXM7XG4gICAgICByZWFkVXJsKGZpbGVJbnB1dCk7XG4gICAgfVxuICB9XG5cbiAgO1xuXG4gIHZhciBvbkZpbGVDaGFuZ2UgPSBmdW5jdGlvbiBvbkZpbGVDaGFuZ2UoZSkge1xuICAgIHJlYWRVcmwoZS50YXJnZXQpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG9uQ2xlYXIoZSkge1xuICAgIHZhciBmaWxlSW5wdXRJdGVtID0gZS5jdXJyZW50VGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICB2YXIgZmlsZUlucHV0ID0gZmlsZUlucHV0SXRlbS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgIH1cblxuICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKGZpbGVJbnB1dEl0ZW0pO1xuICAgIGZpbGVJbnB1dEl0ZW0ucmVtb3ZlKCk7XG4gICAgY2hlY2tGb3JtKCk7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVycyhpdGVtKSB7XG4gICAgdmFyIGRyb3BBcmVhID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9fbGFiZWwnKTtcbiAgICB2YXIgZmlsZUlucHV0ID0gaXRlbS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIHZhciBmaWxlQ2xlYXIgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG5cbiAgICBmdW5jdGlvbiBoaWdobGlnaHQoZSkge1xuICAgICAgZHJvcEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XG4gICAgfVxuXG4gICAgO1xuXG4gICAgZnVuY3Rpb24gdW5oaWdobGlnaHQoZSkge1xuICAgICAgZHJvcEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0Jyk7XG4gICAgfVxuXG4gICAgO1xuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJywgJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBkcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcHJldmVudERlZmF1bHRzLCBmYWxzZSk7XG4gICAgfSk7XG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGRyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoaWdobGlnaHQsIGZhbHNlKTtcbiAgICB9KTtcbiAgICBbJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBkcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdW5oaWdobGlnaHQsIGZhbHNlKTtcbiAgICB9KTtcbiAgICBkcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgaGFuZGxlRHJvcCk7XG4gICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmlsZUNoYW5nZSk7XG4gICAgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbGVhcik7XG4gIH1cblxuICBmdW5jdGlvbiByZW1vdmVFdmVudExpc3RlbmVycyhpdGVtKSB7XG4gICAgdmFyIGRyb3BBcmVhID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9fbGFiZWwnKTtcbiAgICB2YXIgZmlsZUlucHV0ID0gaXRlbS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIHZhciBmaWxlQ2xlYXIgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG5cbiAgICBmdW5jdGlvbiBoaWdobGlnaHQoZSkge1xuICAgICAgZHJvcEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XG4gICAgfVxuXG4gICAgO1xuXG4gICAgZnVuY3Rpb24gdW5oaWdobGlnaHQoZSkge1xuICAgICAgZHJvcEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0Jyk7XG4gICAgfVxuXG4gICAgO1xuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJywgJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBkcm9wQXJlYS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcHJldmVudERlZmF1bHRzLCBmYWxzZSk7XG4gICAgfSk7XG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGRyb3BBcmVhLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoaWdobGlnaHQsIGZhbHNlKTtcbiAgICB9KTtcbiAgICBbJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBkcm9wQXJlYS5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdW5oaWdobGlnaHQsIGZhbHNlKTtcbiAgICB9KTtcbiAgICBkcm9wQXJlYS5yZW1vdmVFdmVudExpc3RlbmVyKCdkcm9wJywgaGFuZGxlRHJvcCk7XG4gICAgZmlsZUlucHV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmlsZUNoYW5nZSk7XG4gICAgZmlsZUNsZWFyLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbGVhcik7XG4gIH1cblxuICBhZGRFdmVudExpc3RlbmVycyhmaWxlSW5wdXRJdGVtKTtcbiAgY2FuY2VsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIGNsZWFySW5wdXRzKCk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNjYW5VcGxvYWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNlbmQtc2Nhbl9fdXBsb2FkLWZpbGVcIik7XG5cbiAgaWYgKCFzY2FuVXBsb2FkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGZpbGVJbnB1dEl0ZW0gPSBzY2FuVXBsb2FkLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuaW5wdXQtZmlsZVwiKTtcbiAgdmFyIHN1Ym1pdCA9IHNjYW5VcGxvYWQucXVlcnlTZWxlY3RvcihcIi5zZW5kLXNjYW5fX3N1Ym1pdFwiKTtcblxuICBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdHMoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNGaWxsZWQoKSB7XG4gICAgdmFyIGZpbGxlZCA9IHRydWU7XG4gICAgZmlsZUlucHV0SXRlbS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICB2YXIgZmlsZSA9IGl0ZW0ucXVlcnlTZWxlY3RvcihcIi5maWxlLWxvYWRcIik7XG5cbiAgICAgIGlmICghZmlsZS5jbGFzc0xpc3QuY29udGFpbnMoXCJsb2FkZWRcIikpIHtcbiAgICAgICAgZmlsbGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGZpbGxlZDtcbiAgfSAvLyBmdW5jdGlvbiBtYWtlSW5wdXRzTmFtZXMoKSB7XG4gIC8vICAgZmlsZXNXcmFwcGVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0JykuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpZHgpIHtcbiAgLy8gICAgIGl0ZW0ubmFtZSA9ICdmaWxlLScgKyBpZHg7XG4gIC8vICAgfSk7XG4gIC8vIH1cbiAgLy8gZnVuY3Rpb24gY2xlYXJJbnB1dHMoKSB7XG4gIC8vICAgZmlsZXNXcmFwcGVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1maWxlLXJlcXVlc3RzJykuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpZHgpIHtcbiAgLy8gICAgIGlmIChpZHggIT09IDApIHtcbiAgLy8gICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoaXRlbSk7XG4gIC8vICAgICAgIGl0ZW0ucmVtb3ZlKCk7XG4gIC8vICAgICB9XG4gIC8vICAgfSlcbiAgLy8gICAhc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSAmJiBzdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgLy8gfVxuICAvLyBmdW5jdGlvbiBjaGVja0Zvcm0oKSB7XG4gIC8vICAgY29uc3QgZmlsZXMgPSBmaWxlc1dyYXBwZXIucXVlcnlTZWxlY3RvckFsbCgnLmZpbGUtbG9hZC5sb2FkZWQnKTtcbiAgLy8gICBmaWxlcy5sZW5ndGggPiAwXG4gIC8vICAgICAmJiBzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gIC8vICAgICAmJiBzdWJtaXQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gIC8vICAgZmlsZXMubGVuZ3RoID09PSAwXG4gIC8vICAgICAmJiAhc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAvLyAgICAgJiYgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJylcbiAgLy8gfVxuXG5cbiAgZnVuY3Rpb24gcmVhZFVybChpbnB1dCkge1xuICAgIC8vY29uc3QgZmllbElucHV0SXRlbSA9IGlucHV0LnBhcmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICB2YXIgZmlsZURyb3BBcmVhID0gaW5wdXQucGFyZW50Tm9kZTtcbiAgICB2YXIgYmFyID0gZmlsZURyb3BBcmVhLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcihcIi5maWxlLWxvYWRfX3Byb2dyZXNzLWN1cnJlbnRcIik7XG4gICAgdmFyIHN0YXR1cyA9IGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoXCIuZmlsZS1sb2FkX19zdGF0dXMgc3BhblwiKTtcbiAgICB2YXIgZmlsZUxvYWQgPSBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKFwiLmZpbGUtbG9hZFwiKTtcbiAgICB2YXIgZmlsZUluZm8gPSBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKFwiLmZpbGUtbG9hZF9fc2l6ZVwiKTtcblxuICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlc1swXSkge1xuICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgIHJlYWRlci5vbmxvYWRzdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZmlsZURyb3BBcmVhLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZChcImxvYWRlZFwiKTtcbiAgICAgIH07XG5cbiAgICAgIHJlYWRlci5vbnByb2dyZXNzID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgYmFyLnN0eWxlLndpZHRoID0gTWF0aC5yb3VuZChlLmxvYWRlZCAvIGUudG90YWwgKiAxMDApICsgXCIlXCI7XG4gICAgICAgIHN0YXR1cy50ZXh0Q29udGVudCA9IE1hdGgucm91bmQoZS5sb2FkZWQgLyBlLnRvdGFsICogMTAwKTtcbiAgICAgIH07XG5cbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBiYXIuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcbiAgICAgICAgZmlsZURyb3BBcmVhLm5leHRFbGVtZW50U2libGluZy5xdWVyeVNlbGVjdG9yKFwiLmZpbGUtbG9hZF9fbmFtZVwiKS50ZXh0Q29udGVudCA9IGlucHV0LmZpbGVzWzBdLm5hbWU7XG4gICAgICAgIHZhciBzaXplID0gaW5wdXQuZmlsZXNbMF0uc2l6ZTtcbiAgICAgICAgdmFyIHNpemVEaW0gPSBcIiDQsdCw0LnRglwiO1xuXG4gICAgICAgIGlmIChzaXplID49IDEwMjQgJiYgc2l6ZSA8IDEwNDg1NzYpIHtcbiAgICAgICAgICBzaXplID0gTWF0aC5yb3VuZChzaXplIC8gMTAyNCk7XG4gICAgICAgICAgc2l6ZURpbSA9IFwiINCa0LHQsNC50YJcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzaXplID0gTWF0aC5yb3VuZChzaXplIC8gMTAyNCAvIDEwMjQpO1xuICAgICAgICAgIHNpemVEaW0gPSBcIiDQnNCx0LDQudGCXCI7XG4gICAgICAgIH1cblxuICAgICAgICBmaWxlTG9hZC5jbGFzc0xpc3QuYWRkKFwibG9hZGVkXCIpO1xuICAgICAgICBmaWxlSW5mby50ZXh0Q29udGVudCA9IHNpemUgKyBzaXplRGltO1xuICAgICAgICBpc0ZpbGxlZCgpICYmIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTsgLy8gY29uc3QgbmV3SXRlbSA9IG5ld0ZpbGVJbnB1dEl0ZW0uY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICAvLyBmaWxlc1dyYXBwZXIucHJlcGVuZChuZXdJdGVtKTtcbiAgICAgICAgLy8gYWRkRXZlbnRMaXN0ZW5lcnMobmV3SXRlbSk7XG4gICAgICAgIC8vIG1ha2VJbnB1dHNOYW1lcygpO1xuICAgICAgICAvLyBjaGVja0Zvcm0oKTtcbiAgICAgIH07XG5cbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGlucHV0LmZpbGVzWzBdKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVEcm9wKGUpIHtcbiAgICB2YXIgZmlsZUlucHV0ID0gZS5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFwiKTtcbiAgICB2YXIgZHQgPSBlLmRhdGFUcmFuc2ZlcjtcbiAgICB2YXIgZmlsZXMgPSBkdC5maWxlcztcbiAgICBjb25zb2xlLmxvZyhmaWxlcyk7XG5cbiAgICBpZiAoZmlsZUlucHV0LmZpbGVzICYmIGZpbGVJbnB1dC5maWxlc1swXSkge1xuICAgICAgZmlsZUlucHV0LnZhbHVlID0gXCJcIjtcblxuICAgICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9IFwiXCI7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gXCJmaWxlXCI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZmlsZUlucHV0LmZpbGVzID0gZmlsZXM7XG4gICAgcmVhZFVybChmaWxlSW5wdXQpO1xuICB9XG5cbiAgdmFyIG9uRmlsZUNoYW5nZSA9IGZ1bmN0aW9uIG9uRmlsZUNoYW5nZShlKSB7XG4gICAgcmVhZFVybChlLnRhcmdldCk7XG4gIH07XG5cbiAgZnVuY3Rpb24gb25DbGVhcihlKSB7XG4gICAgdmFyIGZpbGVJbnB1dEl0ZW0gPSBlLmN1cnJlbnRUYXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAgIHZhciBmaWxlSW5wdXQgPSBmaWxlSW5wdXRJdGVtLnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFwiKTtcbiAgICB2YXIgZmlsZUxvYWQgPSBmaWxlSW5wdXRJdGVtLnF1ZXJ5U2VsZWN0b3IoXCIuZmlsZS1sb2FkXCIpO1xuICAgIGZpbGVJbnB1dC52YWx1ZSA9IFwiXCI7XG5cbiAgICBpZiAoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICBmaWxlSW5wdXQudHlwZSA9IFwiXCI7XG4gICAgICBmaWxlSW5wdXQudHlwZSA9IFwiZmlsZVwiO1xuICAgIH0gLy9yZW1vdmVFdmVudExpc3RlbmVycyhmaWxlSW5wdXRJdGVtKTtcblxuXG4gICAgZmlsZUlucHV0SXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwibG9hZGVkXCIpO1xuICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcIlwiKTtcbiAgICBmaWxlTG9hZC5jbGFzc0xpc3QucmVtb3ZlKFwibG9hZGVkXCIpOyAvL2NoZWNrRm9ybSgpO1xuICB9XG5cbiAgZnVuY3Rpb24gYWRkRXZlbnRMaXN0ZW5lcnMoaXRlbSkge1xuICAgIHZhciBkcm9wQXJlYSA9IGl0ZW0ucXVlcnlTZWxlY3RvcihcIi5pbnB1dC1maWxlX19sYWJlbFwiKTtcbiAgICB2YXIgZmlsZUlucHV0ID0gaXRlbS5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIik7XG4gICAgdmFyIGZpbGVDbGVhciA9IGl0ZW0ucXVlcnlTZWxlY3RvcihcIi5maWxlLWxvYWRfX2NsZWFyXCIpO1xuXG4gICAgZnVuY3Rpb24gaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGRyb3BBcmVhLmNsYXNzTGlzdC5hZGQoXCJoaWdobGlnaHRcIik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdW5oaWdobGlnaHQoZSkge1xuICAgICAgZHJvcEFyZWEuY2xhc3NMaXN0LnJlbW92ZShcImhpZ2hsaWdodFwiKTtcbiAgICB9XG5cbiAgICBbXCJkcmFnZW50ZXJcIiwgXCJkcmFnb3ZlclwiLCBcImRyYWdsZWF2ZVwiLCBcImRyb3BcIl0uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBkcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcHJldmVudERlZmF1bHRzLCBmYWxzZSk7XG4gICAgfSk7XG4gICAgW1wiZHJhZ2VudGVyXCIsIFwiZHJhZ292ZXJcIl0uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBkcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGlnaGxpZ2h0LCBmYWxzZSk7XG4gICAgfSk7XG4gICAgW1wiZHJhZ2xlYXZlXCIsIFwiZHJvcFwiXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGRyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB1bmhpZ2hsaWdodCwgZmFsc2UpO1xuICAgIH0pO1xuICAgIGRyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIGhhbmRsZURyb3ApO1xuICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIG9uRmlsZUNoYW5nZSk7XG4gICAgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBvbkNsZWFyKTtcbiAgfVxuXG4gIGZpbGVJbnB1dEl0ZW0uZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGFkZEV2ZW50TGlzdGVuZXJzKGl0ZW0pO1xuICB9KTsgLy9hZGRFdmVudExpc3RlbmVycyhmaWxlSW5wdXRJdGVtKTtcbiAgLy8gY2FuY2VsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gIC8vICAgY2xlYXJJbnB1dHMoKTtcbiAgLy8gfSlcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBmaWxlRHJvcEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtZmlsZV9fbGFiZWwnKTtcbiAgdmFyIHJlcXVlc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tb2RhbC5yZXF1ZXN0cy11cGxvYWQnKTtcblxuICBpZiAocmVxdWVzdE1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc29sZS5sb2coJ2lucHV0IGZpbGUnKTtcblxuICBmdW5jdGlvbiBtYWtlRmlsZUxvYWQoZmlsZURyb3BBcmVhKSB7XG4gICAgdmFyIGZpbGVJbnB1dCA9IGZpbGVEcm9wQXJlYS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIHZhciBmaWxlQ2xlYXIgPSBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19jbGVhcicpOyAvLyDQodCx0YDQsNGB0YvQstCw0LXQvCDRgdGC0LDQvdC00LDRgNGC0L3Ri9C1INGB0L7QsdGL0YLQuNGPINC/0YDQuCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNC4INGE0LDQudC70LBcblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJywgJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHByZXZlbnREZWZhdWx0cywgZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gcHJldmVudERlZmF1bHRzKGUpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuXG4gICAgOyAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0YHRgtC40LvQuCDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwINC90LDQtCDQvdGD0LbQvdC+0Lkg0L7QsdC70LDRgdGC0YzRjlxuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGlnaGxpZ2h0LCBmYWxzZSk7XG4gICAgfSk7XG4gICAgWydkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB1bmhpZ2hsaWdodCwgZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQnKTtcbiAgICB9XG5cbiAgICA7XG5cbiAgICBmdW5jdGlvbiB1bmhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0Jyk7XG4gICAgfVxuXG4gICAgOyAvL1xuXG4gICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBoYW5kbGVEcm9wLCBmYWxzZSk7XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVEcm9wKGUpIHtcbiAgICAgIHZhciBkdCA9IGUuZGF0YVRyYW5zZmVyO1xuICAgICAgdmFyIGZpbGVzID0gZHQuZmlsZXM7XG5cbiAgICAgIGlmIChmaWxlSW5wdXQuZmlsZXMgJiYgZmlsZUlucHV0LmZpbGVzWzBdKSB7XG4gICAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgICAgIGlmICghL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZpbGVJbnB1dC5maWxlcyA9IGZpbGVzO1xuICAgICAgb25GaWxlQ2hhbmdlKCk7XG4gICAgICB3aW5kb3cub25WZXJpZmljYXRpb25GaWxlRHJvcCAmJiB3aW5kb3cub25WZXJpZmljYXRpb25GaWxlRHJvcCgpO1xuICAgICAgd2luZG93Lm9uRGVsaXZlcnlGaWxlRHJvcCAmJiB3aW5kb3cub25EZWxpdmVyeUZpbGVEcm9wKCk7XG4gICAgICB3aW5kb3cub25JbnN0YWxsYXRpb25GaWxlRHJvcCAmJiB3aW5kb3cub25JbnN0YWxsYXRpb25GaWxlRHJvcCgpO1xuICAgIH1cblxuICAgIDtcblxuICAgIHZhciBvbkZpbGVDaGFuZ2UgPSBmdW5jdGlvbiBvbkZpbGVDaGFuZ2UoKSB7XG4gICAgICByZWFkVXJsKGZpbGVJbnB1dCk7XG4gICAgfTtcblxuICAgIHZhciByZWFkVXJsID0gZnVuY3Rpb24gcmVhZFVybChpbnB1dCkge1xuICAgICAgaWYgKGlucHV0LmZpbGVzICYmIGlucHV0LmZpbGVzWzBdKSB7XG4gICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2xvYWRlZCcpO1xuICAgICAgICAgIGZpbGVEcm9wQXJlYS5uZXh0RWxlbWVudFNpYmxpbmcucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fbmFtZScpLnRleHRDb250ZW50ID0gaW5wdXQuZmlsZXNbMF0ubmFtZTtcbiAgICAgICAgfTtcblxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbnB1dC5maWxlc1swXSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIG9uQ2xlYXIoKSB7XG4gICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcbiAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgICBpZiAoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpbGVDaGFuZ2UpO1xuICAgIGZpbGVDbGVhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xlYXIpO1xuICB9XG5cbiAgd2luZG93Lm1ha2VGaWxlTG9hZCA9IG1ha2VGaWxlTG9hZDtcblxuICBpZiAoIWZpbGVEcm9wQXJlYVswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGZpbGVEcm9wQXJlYS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgbWFrZUZpbGVMb2FkKGl0ZW0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtdGV4dCcpO1xuXG4gIGlmICghaW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaW5wdXRzLmZvckVhY2goZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChpbnB1dC52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJykge1xuICAgICAgICBpbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgfVxuXG4gICAgICBpZiAoaW5wdXQudmFsdWUgIT09ICcnICYmICFpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpbnB1dC52YWx1ZSA9PT0gJycgJiYgaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJykpIHtcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciB2aCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMDE7XG4gIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIFwiXCIuY29uY2F0KHZoLCBcInB4XCIpKTtcbiAgdmFyICRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuXG4gIGZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMpIHtcbiAgICB2YXIgdGltZXI7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKHRpbWVyKSBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmMsIDEwMCwgZXZlbnQpO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBvblJlc2l6ZSgpIHtcbiAgICB2YXIgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIFwiXCIuY29uY2F0KHZoLCBcInB4XCIpKTtcbiAgfVxuXG4gIDtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGRlYm91bmNlKG9uUmVzaXplKSk7XG5cbiAgZnVuY3Rpb24gTW9kYWwodHJpZ2dlciwgbW9kYWwpIHtcbiAgICB0aGlzLnRyaWdnZXIgPSB0cmlnZ2VyO1xuICAgIHRoaXMubW9kYWwgPSBtb2RhbDtcbiAgICB0aGlzLm92ZXJsYXkgPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAgIHRoaXMuY2xvc2VCdG4gPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgICB0aGlzLm9uT3ZlcmxheUNsaWNrID0gdGhpcy5vbk92ZXJsYXlDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DbG9zZUNsaWNrID0gdGhpcy5vbkNsb3NlQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uVHJpZ2dlckNsaWNrID0gdGhpcy5vblRyaWdnZXJDbGljay5iaW5kKHRoaXMpOyAvL3RoaXMub25SZXNpemUgPSB0aGlzLm9uUmVzaXplLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm1vZGFsLmNsYXNzTGlzdC5hZGQoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QuYWRkKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMub3ZlcmxheSkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUub25DbG9zZUNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUub25UcmlnZ2VyQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5vcGVuKCk7XG4gIH07IC8vIE1vZGFsLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uKCkge1xuICAvLyAgICAgbGV0IHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgLy8gICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIGAke3ZofXB4YCk7XG4gIC8vIH07XG5cblxuICBNb2RhbC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5vdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbk92ZXJsYXlDbGljayk7XG4gICAgdGhpcy5jbG9zZUJ0biAmJiB0aGlzLmNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsb3NlQ2xpY2spO1xuICAgIHRoaXMudHJpZ2dlciAmJiB0aGlzLnRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uVHJpZ2dlckNsaWNrKTtcbiAgfTtcblxuICB3aW5kb3cuTW9kYWwgPSBNb2RhbDtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5pbnB1dC1tb25leScpLm1hc2soJyMgIyMwIOKCvScsIHtcbiAgICByZXZlcnNlOiB0cnVlXG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1waG9uZScpO1xuXG4gIGlmICghaW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGltID0gbmV3IElucHV0bWFzayhcIis3KDk5OSkgOTk5LTk5LTk5XCIpO1xuICBpbnB1dHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGltLm1hc2soaXRlbSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCcpO1xuICB2YXIgY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoICsgLnNlYXJjaC1jbG9zZScpO1xuXG4gIGlmICghaXRlbXNbMF0pIHtcbiAgICByZXR1cm47XG4gIH0gLy8gaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAvLyAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PntcbiAgLy8gICAgIGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2pzLWZvY3VzJyk7XG4gIC8vICAgfSk7XG4gIC8vIH0pO1xuXG5cbiAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChpdGVtLnZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnKSB7XG4gICAgICAgIGl0ZW0udmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKGl0ZW0udmFsdWUgIT09ICcnICYmICFpdGVtLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXRlbS52YWx1ZSA9PT0gJycgJiYgaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG4gIGNsb3NlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHNlYXJjaCA9IGl0ZW0ucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgIHNlYXJjaC52YWx1ZSA9ICcnO1xuXG4gICAgICBpZiAoc2VhcmNoLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIHNlYXJjaC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gZm9ybWF0T3B0aW9uKGl0ZW0pIHtcbiAgICB2YXIgdmFsdWUgPSBpdGVtLnRleHQuc3BsaXQoJ3NwbGl0dGVyJyk7XG4gICAgdmFyIGJyID0gd2luZG93Lm1hdGNoTWVkaWEoJyhtYXgtd2lkdGg6IDk5OXB4KScpLm1hdGNoZXMgPyAnPGJyPicgOiAnJztcblxuICAgIGlmICh2YWx1ZS5sZW5ndGggPiAxKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gJCgnPHNwYW4+JyArIHZhbHVlWzBdICsgJzwvc3Bhbj4nICsgYnIgKyAnPHNwYW4+JyArIHZhbHVlWzFdICsgJzwvc3Bhbj4nKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBpdGVtLnRleHQ7XG4gICAgfVxuICB9XG5cbiAgJCgnLnNlbGVjdCcpLnNlbGVjdDIoe1xuICAgIHRlbXBsYXRlUmVzdWx0OiBmb3JtYXRPcHRpb24sXG4gICAgdGVtcGxhdGVTZWxlY3Rpb246IGZvcm1hdE9wdGlvblxuICB9KTtcbiAgJCgnLnNlbGVjdCcpLm9uKCdzZWxlY3QyOnNlbGVjdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgJCh0aGlzKS5hZGRDbGFzcygncGlja2VkJyk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24gKCkge1xuICAgIHZhciBzd2lwZXIgPSBuZXcgU3dpcGVyKCcuc3Vic2NyaXB0aW9uLXRhYnMnLCB7XG4gICAgICBmcmVlTW9kZTogdHJ1ZSxcbiAgICAgIHNsaWRlc1BlclZpZXc6ICdhdXRvJyxcbiAgICAgIHdhdGNoT3ZlcmZsb3c6IHRydWVcbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgZGVsaXZlcnlUaW1lSW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtdGltZScpO1xuXG4gIGlmICghZGVsaXZlcnlUaW1lSW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGltID0gbmV3IElucHV0bWFzayhcIjk5Ojk5XCIpO1xuICBkZWxpdmVyeVRpbWVJbnB1dHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGltLm1hc2soaXRlbSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvdW50LWNyZWF0aW9uX19uZXcnKTtcblxuICBpZiAoIWNhbmNlbGxhdGlvbkJ0blswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2NvdW50LWNyZWF0aW9uJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNhbmNlbGxhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAvLyBjb25zdCB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG4gIC8vIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2NvdW50LWNyZWF0aW9uJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciAkaW5wdXQgPSAkKCcuYWNjb3VudC1jcmVhdGlvbl9faW5wdXQgLmlucHV0LXRleHQnKTtcbiAgdmFyICRidG4gPSAkKCcjYWNjb3VudC1jcmVhdGlvbiAubW9kYWxfX3NhdmUnKTtcblxuICB2YXIgb25JbnB1dCA9IGZ1bmN0aW9uIG9uSW5wdXQoZSkge1xuICAgIHZhciAkZW1wdHlJbnB1dCA9ICRpbnB1dC5maWx0ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMudmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJycgfHwgdGhpcy52YWx1ZS5sZW5ndGggPT09IDA7XG4gICAgfSk7XG5cbiAgICBpZiAoJGVtcHR5SW5wdXQubGVuZ3RoID09PSAwKSB7XG4gICAgICAkYnRuLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICRidG4uYXR0cignZGlzYWJsZWQnLCAnJyk7XG4gICAgfSAvLyBpZiAoXG4gICAgLy8gICB2YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJ1xuICAgIC8vICAgfHwgdmFsdWUubGVuZ3RoID09PSAwXG4gICAgLy8gKSB7XG4gICAgLy8gICBpZiAoIWJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAvLyAgICAgYnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuXG4gIH07IC8vIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KVxuXG5cbiAgJGlucHV0Lm9uKCdpbnB1dCcsIG9uSW5wdXQpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyICR0Ym9keSA9ICQoXCIuYWdlbnQtcmVwb3J0X19lcXVpcG1lbnQgIHRhYmxlICB0Ym9keVwiKTtcbiAgdmFyICRsaW5lID0gJHRib2R5LmNoaWxkcmVuKCkuZXEoMSk7XG4gICQoXCIuYWdlbnQtcmVwb3J0X19hZGQtbGluZVwiKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAkdGJvZHkuYXBwZW5kKCRsaW5lLmNsb25lKCkpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWdlbnRzX191c2Vycy1ibG9jay1tb2JpbGUnKTtcblxuICBpZiAoIWNvbnRyYWN0cykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBzbGlkZXIgPSBuZXcgU3dpcGVyKCcuYWdlbnRzX191c2Vycy1ibG9jay1tb2JpbGVfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLmFnZW50c19fdXNlcnMtYmxvY2stbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlXG4gICAgfVxuICB9KTtcbiAgJCgnLmFnZW50c19fdXNlcnMtYnRuJykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAkKCcuYWdlbnRzX191c2Vycy1idG4nKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY2FuY2VsbGF0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWluZm9fX2NhbmNlbGxhdGlvbicpO1xuXG4gIGlmICghY2FuY2VsbGF0aW9uQnRuWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbGxhdGlvbl9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY2FuY2VsbGF0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjaGFuZ2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudXNlci1zZXR0aW5nc19fY2hhbmdlLWVtYWlsJyk7XG5cbiAgaWYgKCFjaGFuZ2VCdXR0b25bMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbmdlLWVtYWlsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNoYW5nZUJ1dHRvbi5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAvLyBjb25zdCB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG4gIC8vIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFuZ2UtZW1haWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoYW5nZS1lbWFpbF9faW5wdXQgLmlucHV0LXRleHQnKTtcbiAgdmFyIGJ0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIHZhciBvbklucHV0ID0gZnVuY3Rpb24gb25JbnB1dChlKSB7XG4gICAgaWYgKGUudGFyZ2V0LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICBidG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIH1cblxuICAgIGlmICghZS50YXJnZXQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIGlmICghYnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgICBidG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH07IC8vIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KVxuXG5cbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbklucHV0KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjaGFuZ2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudXNlci1zZXR0aW5nc19fY2hhbmdlLXBob25lJyk7XG5cbiAgaWYgKCFjaGFuZ2VCdXR0b25bMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbmdlLXBob25lJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNoYW5nZUJ1dHRvbi5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAvLyBjb25zdCB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG4gIC8vIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFuZ2UtcGhvbmUnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoYW5nZS1waG9uZV9faW5wdXQgLmlucHV0LXRleHQnKTtcbiAgdmFyIGJ0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIHZhciBvbklucHV0ID0gZnVuY3Rpb24gb25JbnB1dChlKSB7XG4gICAgaWYgKGUudGFyZ2V0LnZhbHVlLmluZGV4T2YoJ18nKSA9PT0gLTEpIHtcbiAgICAgIGJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfVxuXG4gICAgaWYgKGUudGFyZ2V0LnZhbHVlLmluZGV4T2YoJ18nKSAhPT0gLTEpIHtcbiAgICAgIGlmICghYnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgICBidG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH07IC8vIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KVxuXG5cbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbklucHV0KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciByYWRpb3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtY3JlYXRpb25fX2NsaWVudC10eXBlICBpbnB1dCcpO1xuXG4gIGlmICghcmFkaW9zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3QtY3JlYXRpb25fX2RldGFpbHMnKTtcblxuICBmdW5jdGlvbiBvblJhZGlvQ2hhbmdlKCkge1xuICAgIGlmIChyYWRpb3NbMF0uY2hlY2tlZCkge1xuICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1lbnRpdHknKTtcbiAgICB9XG5cbiAgICBpZiAocmFkaW9zWzFdLmNoZWNrZWQpIHtcbiAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgnc2hvdy1mb3ItZW50aXR5Jyk7XG4gICAgfVxuICB9XG5cbiAgcmFkaW9zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uUmFkaW9DaGFuZ2UpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2xpZW50cy1tb2JpbGUtYmxvY2snKTtcblxuICBpZiAoIWNvbnRyYWN0cykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBzbGlkZXIgPSBuZXcgU3dpcGVyKCcuY2xpZW50cy1tb2JpbGUtYmxvY2tfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLmNsaWVudHMtbW9iaWxlLWJsb2NrX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlXG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciB0cmlnZ2VycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXRyaWdnZXJdJyk7XG4gIHRyaWdnZXJzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICB2YXIgbmFtZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXRyaWdnZXInKTtcbiAgICB2YXIgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1tb2RhbD0nICsgbmFtZSArICddJyk7XG5cbiAgICBpZiAobW9kYWwpIHtcbiAgICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIC8vIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcbiAgLy8gaWYgKCF2ZXJpZmljYXRpb25CdG5bMF0pIHtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm1hdGlvbi1jb2RlJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jb25maXJtYXRpb24tY29kZV9faW5wdXQgLmlucHV0LXRleHQnKTtcbiAgdmFyIGJ0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIHZhciBvbklucHV0ID0gZnVuY3Rpb24gb25JbnB1dChlKSB7XG4gICAgaWYgKGUudGFyZ2V0LnZhbHVlLmxlbmd0aCA9PT0gNikge1xuICAgICAgYnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoZS50YXJnZXQudmFsdWUubGVuZ3RoIDwgNikge1xuICAgICAgaWYgKCFidG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICAgIGJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgfVxuICAgIH1cbiAgfTsgLy8gdmVyaWZpY2F0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIC8vIH0pXG5cblxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uSW5wdXQpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCgnLmRlbGl2ZXJ5LW9yLXBpY2t1cC5kb25lJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykuZmluZCgnLmNvbnRyYWN0LWluZm9fX2RlbGl2ZXJlZC1hZHJlc3MnKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykuZmluZCgnLmNvbnRyYWN0LWluZm9fX2RlbGl2ZXJlZC10b2dnbGUnKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbnRyYWN0U2VydmljZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3Qtc2VydmljZXMnKTtcblxuICBpZiAoIWNvbnRyYWN0U2VydmljZXMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3Qtc2VydmljZXNfX2xpbmsnKTtcblxuICB2YXIgb25MaW5rQ2xpY2sgPSBmdW5jdGlvbiBvbkxpbmtDbGljayhlKSB7XG4gICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuXG4gICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrYm94LWJ0bl9fbGFiZWwnKSB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2NoZWNrYm94JykgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJykgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY29udHJhY3Qtc2VydmljZXNfX2RlbGl2ZXJ5LWNvbmZpcm0nKSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgfTtcblxuICBsaW5rcy5mb3JFYWNoKGZ1bmN0aW9uIChsaW5rKSB7XG4gICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTGlua0NsaWNrKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY29udHJhY3RzTGlua0FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuY29udHJhY3RzX19saW5rXCIpO1xuXG4gIGlmICghY29udHJhY3RzTGlua0FsbFswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBvbkxpbmtDbGljayA9IGZ1bmN0aW9uIG9uTGlua0NsaWNrKGUpIHtcbiAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQ7XG5cbiAgICBpZiAodGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNoZWNrYm94LWJ0bl9fbGFiZWxcIikgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNoZWNrYm94LWJ0bl9fY2hlY2tib3hcIikgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvblwiKSB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicGF5bWVudC13YWl0aW5nX19jb25maXJtLWJ0blwiKSB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY29udHJhY3Qtc2VydmljZXNfX2RlbGl2ZXJ5LWNvbmZpcm1cIikgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInJlcG9ydHNfX2Rvd25sb2FkLWJ0blwiKSB8fCAkKHRhcmdldCkucGFyZW50cyhcIi5yZXBvcnRzX19kb3dubG9hZC1idG5cIikubGVuZ3RoID4gMCkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgfTtcblxuICBjb250cmFjdHNMaW5rQWxsLmZvckVhY2goZnVuY3Rpb24gKGxpbmspIHtcbiAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBvbkxpbmtDbGljayk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbnRyYWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1zZXJ2aWNlcy1tb2JpbGUnKTtcblxuICBpZiAoIWNvbnRyYWN0cykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBzbGlkZXIgPSBuZXcgU3dpcGVyKCcuY29udHJhY3Qtc2VydmljZXMtbW9iaWxlX19zbGlkZXInLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy5jb250cmFjdC1zZXJ2aWNlcy1tb2JpbGVfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWVcbiAgICB9XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbnRyYWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdHMtbW9iaWxlJyk7XG5cbiAgaWYgKCFjb250cmFjdHMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc2xpZGVyID0gbmV3IFN3aXBlcignLmNvbnRyYWN0cy1tb2JpbGVfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLmNvbnRyYWN0cy1tb2JpbGVfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWVcbiAgICB9XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdWJzY3JpcHRpb24tcGFnZV9fYWN0aW9uLWl0ZW0tLWRlbGV0ZScpO1xuXG4gIGlmICghY2FuY2VsbGF0aW9uQnRuWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGV0ZS1zZXJ2aWNlX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjYW5jZWxsYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRlbGl2ZXJ5QnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyLW9yLXBpY2t1cF9fY29uZmlybS1idG4nKTtcblxuICBpZiAoIWRlbGl2ZXJ5QnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfSAvLyAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZGF0ZVRleHQpIHtcbiAgLy8gICBvbkZpZWxkQ2hhbmdlKCk7XG4gIC8vIH0pO1xuXG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9IC8vIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICAvLyBjb25zdCBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIC8vIGNvbnN0IHN1Ym1pdCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc3VibWl0Jyk7XG4gIC8vIGNvbnN0IGZpbGVJbnB1dEJsb2NrID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtaW5wdXQtZmlsZScpO1xuICAvLyBjb25zdCBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgLy8gY29uc3QgZGF0ZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtZGF0ZScpO1xuICAvLyBjb25zdCB0aW1lSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC10aW1lJyk7XG4gIC8vIGNvbnN0IGNvbmZpcm1DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGVja2JveF9faW5wdXQnKTtcblxuXG4gIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uIChidG4pIHtcbiAgICBuZXcgTW9kYWwoYnRuLCBtb2RhbCk7XG4gIH0pOyAvLyBjb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAvLyAgICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gIC8vICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAvLyAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgLy8gICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgLy8gICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyAgIGRhdGVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHRpbWVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgJCgnI2RlbGl2ZXJ5LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAvLyB9XG4gIC8vIGNvbnN0IG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAvLyAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgLy8gICAgIG9uQ2xvc2VDbGljaygpO1xuICAvLyAgIH1cbiAgLy8gfVxuICAvLyBjb25zdCBvbkZpZWxkQ2hhbmdlID0gZnVuY3Rpb24oZSkge1xuICAvLyAgIGlmIChpc0Zvcm1GaWxsZWQoKSAmJiBzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gIC8vICAgICBzdWJtaXQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAvLyAgIH0gZWxzZSBpZiAoIWlzRm9ybUZpbGxlZCgpICYmICFzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gIC8vICAgICBzdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gY29uc3QgaXNGb3JtRmlsbGVkID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgcmV0dXJuICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignZ2V0RGF0ZScpXG4gIC8vICAgICAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnXG4gIC8vICAgICAmJiBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9PT0gdHJ1ZVxuICAvLyAgICAgJiYgZmlsZUlucHV0LnZhbHVlICE9PSAnJ1xuICAvLyB9XG4gIC8vIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgLy8gb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgLy8gZGF0ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIC8vIHRpbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICAvLyBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWVsZENoYW5nZSk7XG4gIC8vIGNvbmZpcm1DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBkZXZpY2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWNyZWF0aW9uX19kZWxpdmVyeS1kZXZpY2UnKTtcblxuICBpZiAoIWRldmljZXNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBkZXZpY2VzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICB2YXIgcmFkaW9zID0gaXRlbS5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtY3JlYXRpb25fX2RlbGl2ZXJ5LXR5cGUtd3JhcHBlciAgaW5wdXQnKTtcblxuICAgIGZ1bmN0aW9uIG9uUmFkaW9DaGFuZ2UoZSkge1xuICAgICAgdmFyIHdyYXBwZXIgPSBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcblxuICAgICAgaWYgKHJhZGlvc1swXS5jaGVja2VkKSB7XG4gICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdy1mb3ItcGlja3VwJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChyYWRpb3NbMV0uY2hlY2tlZCkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Nob3ctZm9yLXBpY2t1cCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJhZGlvcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uUmFkaW9DaGFuZ2UpO1xuICAgIH0pO1xuICB9KTtcbn0pKCk7IC8vIChmdW5jdGlvbigpIHtcbi8vICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbCcpO1xuLy8gICBpZiAoIW1vZGFsKSB7XG4vLyAgICAgcmV0dXJuO1xuLy8gICB9XG4vLyAgIGNvbnN0ICRkYXRlID0gJCgnI2RlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwgLmRhdGUtaW5wdXQnKTtcbi8vICAgJGRhdGUuZGF0ZXBpY2tlcigpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihkYXRlVGV4dCkge1xuLy8gICAgIGlmICgkKCcjZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbCcpLmhhc0NsYXNzKCdqcy1zaG93JykpIHtcbi8vICAgICAgIG9uRmllbGRDaGFuZ2UoKTtcbi8vICAgICB9XG4vLyAgIH0pO1xuLy8gICBjb25zdCBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbi8vICAgY29uc3Qgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuLy8gICBjb25zdCBzdWJtaXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3N1Ym1pdCcpO1xuLy8gICBjb25zdCBmaWxlSW5wdXRCbG9jayA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLWlucHV0LWZpbGUnKTtcbi8vICAgY29uc3QgZmlsZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG4vLyAgIGNvbnN0IGZpbGVDbGVhciA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG4vLyAgIGNvbnN0IGRhdGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLWRhdGUnKTtcbi8vICAgY29uc3QgdGltZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtdGltZScpO1xuLy8gICBjb25zdCBjb25maXJtQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuY2hlY2tib3hfX2lucHV0Jyk7XG4vLyAgIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuLy8gICAgIGlmIChmaWxlSW5wdXRCbG9jayAmJiBmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QuY29udGFpbnMoJ2xvYWRlZCcpKSB7XG4vLyAgICAgICBmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcbi8vICAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuLy8gICAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4vLyAgICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuLy8gICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuLy8gICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbi8vICAgICAgIH1cbi8vICAgICB9XG4vLyAgICAgZGF0ZUlucHV0LnZhbHVlID0gJyc7XG4vLyAgICAgdGltZUlucHV0LnZhbHVlID0gJyc7XG4vLyAgICAgaWYgKGNvbmZpcm1DaGVja2JveCkge1xuLy8gICAgICAgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbi8vICAgICB9XG4vLyAgICAgJGRhdGUuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbi8vICAgfVxuLy8gICBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbi8vICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4vLyAgICAgICBvbkNsb3NlQ2xpY2soKTtcbi8vICAgICB9XG4vLyAgIH1cbi8vICAgY29uc3Qgb25GaWVsZENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbi8vICAgICBjb25zb2xlLmxvZyhlLnRhcmdldCk7XG4vLyAgICAgaWYgKGlzRm9ybUZpbGxlZCgpICYmIHN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbi8vICAgICAgIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4vLyAgICAgfSBlbHNlIGlmICghaXNGb3JtRmlsbGVkKCkgJiYgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbi8vICAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuLy8gICAgIH1cbi8vICAgfVxuLy8gICBjb25zdCBvbkZpbGVDbGVhciA9IGZ1bmN0aW9uKCkge1xuLy8gICAgIGlmICghc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuLy8gICAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4vLyAgICAgfVxuLy8gICB9XG4vLyAgIGNvbnN0IGlzRm9ybUZpbGxlZCA9IGZ1bmN0aW9uKCkge1xuLy8gICAgIGNvbnNvbGUubG9nKCEhZmlsZUlucHV0ICYmICEhY29uZmlybUNoZWNrYm94KTtcbi8vICAgICByZXR1cm4gZmlsZUlucHV0ICYmIGNvbmZpcm1DaGVja2JveFxuLy8gICAgICAgP1xuLy8gICAgICAgJGRhdGUuZGF0ZXBpY2tlcignZ2V0RGF0ZScpXG4vLyAgICAgICAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnXG4vLyAgICAgICAmJiBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9PT0gdHJ1ZVxuLy8gICAgICAgJiYgZmlsZUlucHV0LnZhbHVlICE9PSAnJ1xuLy8gICAgICAgOlxuLy8gICAgICAgJGRhdGUuZGF0ZXBpY2tlcignZ2V0RGF0ZScpXG4vLyAgICAgICAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnO1xuLy8gICB9XG4vLyAgIHdpbmRvdy5vbkRlbGl2ZXJ5RmlsZURyb3AgPSBmdW5jdGlvbiAoKSB7XG4vLyAgICAgb25GaWVsZENoYW5nZSgpO1xuLy8gICB9XG4vLyAgIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbi8vICAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbi8vICAgZGF0ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4vLyAgIHRpbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuLy8gICBmaWxlSW5wdXQgJiYgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5vbkRlbGl2ZXJ5RmlsZURyb3ApO1xuLy8gICBjb25maXJtQ2hlY2tib3ggJiYgY29uZmlybUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmllbGRDaGFuZ2UpO1xuLy8gICBmaWxlQ2xlYXIgJiYgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25GaWxlQ2xlYXIpO1xuLy8gfSkoKTtcblxuXG4oZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBnZXRZZWFyTGFiZWwobnVtKSB7XG4gICAgdmFyIHRleHQgPSBcIlwiICsgbnVtO1xuICAgIHZhciBsYXN0TnVtYmVyID0gK3RleHRbdGV4dC5sZW5ndGggLSAxXTtcbiAgICB2YXIgcHJlTGFzdE51bWJlciA9ICt0ZXh0W3RleHQubGVuZ3RoIC0gMl07XG5cbiAgICBpZiAocHJlTGFzdE51bWJlciA9PT0gMSkge1xuICAgICAgcmV0dXJuIFwiXCIuY29uY2F0KG51bSwgXCIgXFx1MDQzQlxcdTA0MzVcXHUwNDQyXCIpO1xuICAgIH1cblxuICAgIGlmIChsYXN0TnVtYmVyID09PSAxKSB7XG4gICAgICByZXR1cm4gXCJcIi5jb25jYXQobnVtLCBcIiBcXHUwNDMzXFx1MDQzRVxcdTA0MzRcIik7XG4gICAgfVxuXG4gICAgaWYgKGxhc3ROdW1iZXIgPiAxICYmIGxhc3ROdW1iZXIgPCA1KSB7XG4gICAgICByZXR1cm4gXCJcIi5jb25jYXQobnVtLCBcIiBcXHUwNDMzXFx1MDQzRVxcdTA0MzRcXHUwNDMwXCIpO1xuICAgIH1cblxuICAgIGlmIChsYXN0TnVtYmVyID4gNCB8fCBsYXN0TnVtYmVyID09PSAwKSB7XG4gICAgICByZXR1cm4gXCJcIi5jb25jYXQobnVtLCBcIiBcXHUwNDNCXFx1MDQzNVxcdTA0NDJcIik7XG4gICAgfVxuICB9XG5cbiAgdmFyICR5ZWFycyA9ICQoXCIuZGV2aWNlLXBlcmlvZF9fcmFuZ2UtdmFsdWUteWVhclwiKTtcbiAgdmFyICRwcmljZSA9ICQoXCIuZGV2aWNlLXBlcmlvZF9fcmFuZ2UtdmFsdWUtcHJpY2VcIik7XG4gIHZhciBwcmljZUN1cnJlbmN5ID0gJHByaWNlLnRleHQoKTtcbiAgdmFyIHByaWNlQmFzaWMgPSArJHByaWNlLmF0dHIoXCJkYXRhLXByaWNlXCIpO1xuXG4gIGZ1bmN0aW9uIGdldFByaWNlKG51bSkge1xuICAgIHZhciB2YWx1ZSA9IHByaWNlQmFzaWMgKiBudW07XG4gICAgcmV0dXJuIFwiXCIuY29uY2F0KHZhbHVlLCBcIiBcIikuY29uY2F0KHByaWNlQ3VycmVuY3kpO1xuICB9XG5cbiAgJChcIi5qcy1yYW5nZS1zaW5nbGUtc2xpZGVyXCIpLmlvblJhbmdlU2xpZGVyKHtcbiAgICB0eXBlOiBcInNpbmdsZVwiLFxuICAgIGdyaWQ6IGZhbHNlLFxuICAgIGhpZGVfbWluX21heDogdHJ1ZSxcbiAgICBleHRyYV9jbGFzc2VzOiBcInNpbmdsZS1zbGlkZXJcIixcbiAgICBvblN0YXJ0OiBmdW5jdGlvbiBvblN0YXJ0KGRhdGEpIHtcbiAgICAgICR5ZWFycy50ZXh0KGdldFllYXJMYWJlbChkYXRhLmZyb20pKTtcbiAgICAgICRwcmljZS50ZXh0KGdldFByaWNlKGRhdGEuZnJvbSkpO1xuICAgIH0sXG4gICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGRhdGEpIHtcbiAgICAgICR5ZWFycy50ZXh0KGdldFllYXJMYWJlbChkYXRhLmZyb20pKTtcbiAgICAgICRwcmljZS50ZXh0KGdldFByaWNlKGRhdGEuZnJvbSkpO1xuICAgIH1cbiAgfSk7XG4gICQoXCIuaXJzLS1mbGF0XCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICBjb25zb2xlLmxvZyhlLnRhcmdldCk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIG1lbnUgPSAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51Jyk7XG4gIHZhciBidG4gPSAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKTtcbiAgJC5leHRlbmQoJC5kYXRlcGlja2VyLCB7XG4gICAgLy8gUmVmZXJlbmNlIHRoZSBvcmlnbmFsIGZ1bmN0aW9uIHNvIHdlIGNhbiBvdmVycmlkZSBpdCBhbmQgY2FsbCBpdCBsYXRlclxuICAgIF9pbmxpbmVEYXRlcGlja2VyMjogJC5kYXRlcGlja2VyLl9pbmxpbmVEYXRlcGlja2VyLFxuICAgIC8vIE92ZXJyaWRlIHRoZSBfaW5saW5lRGF0ZXBpY2tlciBtZXRob2RcbiAgICBfaW5saW5lRGF0ZXBpY2tlcjogZnVuY3Rpb24gX2lubGluZURhdGVwaWNrZXIodGFyZ2V0LCBpbnN0KSB7XG4gICAgICAvLyBDYWxsIHRoZSBvcmlnaW5hbFxuICAgICAgdGhpcy5faW5saW5lRGF0ZXBpY2tlcjIodGFyZ2V0LCBpbnN0KTtcblxuICAgICAgdmFyIGJlZm9yZVNob3cgPSAkLmRhdGVwaWNrZXIuX2dldChpbnN0LCAnYmVmb3JlU2hvdycpO1xuXG4gICAgICBpZiAoYmVmb3JlU2hvdykge1xuICAgICAgICBiZWZvcmVTaG93LmFwcGx5KHRhcmdldCwgW3RhcmdldCwgaW5zdF0pO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51JykudG9nZ2xlKCk7XG4gIH0pO1xuICAkKCcjZWFybmVkLWRhdGUnKS5kYXRlcGlja2VyKHtcbiAgICByYW5nZTogJ3BlcmlvZCcsXG4gICAgaW5saW5lOiB0cnVlLFxuICAgIHNob3dCdXR0b25QYW5lbDogdHJ1ZSxcbiAgICBzaG93T3RoZXJNb250aHM6IHRydWUsXG4gICAgc2VsZWN0T3RoZXJNb250aHM6IHRydWUsXG4gICAgY2xvc2VUZXh0OiBcItCT0L7RgtC+0LLQvlwiLFxuICAgIGRhdGVGb3JtYXQ6ICdkZC5tbS55eScsXG4gICAgYmVmb3JlU2hvdzogZnVuY3Rpb24gYmVmb3JlU2hvdyhpbnB1dCwgaW5zdCkge1xuICAgICAgaW5zdC5kcERpdi5jc3MoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGVYKC0yNHB4KScpO1xuICAgICAgaW5zdC5kcERpdi5hZGRDbGFzcygnY2FsZW5kYXItcmFuZ2UnKTtcbiAgICB9LFxuICAgIG9uU2VsZWN0OiBmdW5jdGlvbiBvblNlbGVjdChkYXRlVGV4dCwgaW5zdCwgZXh0ZW5zaW9uUmFuZ2UpIHtcbiAgICAgICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLWJ0bicpLnRleHQoZXh0ZW5zaW9uUmFuZ2Uuc3RhcnREYXRlVGV4dCArICcgLSAnICsgZXh0ZW5zaW9uUmFuZ2UuZW5kRGF0ZVRleHQpO1xuICAgIH1cbiAgfSk7XG4gICQoZG9jdW1lbnQpLm1vdXNldXAoZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgbWVudSA9ICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLW1lbnUnKTtcbiAgICB2YXIgYnRuID0gJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJyk7XG5cbiAgICBpZiAoIW1lbnUuaXMoZS50YXJnZXQpICYmIG1lbnUuaGFzKGUudGFyZ2V0KS5sZW5ndGggPT09IDAgJiYgIWJ0bi5pcyhlLnRhcmdldCkgJiYgYnRuLmhhcyhlLnRhcmdldCkubGVuZ3RoID09PSAwKSB7XG4gICAgICBtZW51LmhpZGUoKTtcbiAgICB9XG4gIH0pO1xuICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51LWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnYWxsLXRpbWUnKSkge1xuICAgICAgJCgnLmVhcm5lZC1kYXRlX19zdGFydC1wZXJpb2QnKS50ZXh0KCkgPT09ICcnID8gJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJykudGV4dCgkKHRoaXMpLnRleHQoKSkgOiAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKS50ZXh0KCQodGhpcykudGV4dCgpICsgXCIgKFxcdTA0NDFcXHhBMFwiICsgJCgnLmVhcm5lZC1kYXRlX19zdGFydC1wZXJpb2QnKS50ZXh0KCkgKyAnKScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKS50ZXh0KCQodGhpcykudGV4dCgpKTtcbiAgICB9XG5cbiAgICBtZW51LmhpZGUoKTtcbiAgfSk7XG4gICQoJy5lYXJuZWQtZGF0ZV9fc3RhcnQtcGVyaW9kJykudGV4dCgpID09PSAnJyA/ICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLWJ0bicpLnRleHQoJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtbWVudS1idG4uYWxsLXRpbWUnKS50ZXh0KCkpIDogJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJykudGV4dCgkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51LWJ0bi5hbGwtdGltZScpLnRleHQoKSArIFwiIChcXHUwNDQxXFx4QTBcIiArICQoJy5lYXJuZWQtZGF0ZV9fc3RhcnQtcGVyaW9kJykudGV4dCgpICsgJyknKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5maWx0ZXJzX19idG4nKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG4gICQoJy5maWx0ZXJzX19idG4tY2xlYXInKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgJCgnLmZpbHRlcnMgLnNlbGVjdCcpLnZhbCgn0JLRgdC1Jyk7XG4gICAgJCgnLmZpbHRlcnMgLnNlbGVjdCcpLnRyaWdnZXIoJ2NoYW5nZScpO1xuICAgICQoJy5maWx0ZXJzIC5zZWxlY3QnKS5yZW1vdmVDbGFzcygncGlja2VkJyk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyICR0cmlnZ2VyID0gJChcIi5zdWJzY3JpcHRpb24tYWxsX19oaWVyYXJjaHktdHJpZ2dlclwiKTtcbiAgdmFyICRtb2RhbCA9ICQoXCIuaGllcmFyY2h5XCIpO1xuICB2YXIgJGJsYWNrb3V0ID0gJG1vZGFsLmZpbmQoXCIuaGllcmFyY2h5X19ibGFja291dFwiKTtcbiAgdmFyICRjbG9zZSA9ICRtb2RhbC5maW5kKFwiLmhpZXJhcmNoeV9fY2xvc2VcIik7XG4gICR0cmlnZ2VyLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICRtb2RhbC5hZGRDbGFzcyhcIm9wZW5lZFwiKTtcbiAgfSk7XG4gICRibGFja291dC5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAkbW9kYWwucmVtb3ZlQ2xhc3MoXCJvcGVuZWRcIik7XG4gIH0pO1xuICAkY2xvc2Uub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgJG1vZGFsLnJlbW92ZUNsYXNzKFwib3BlbmVkXCIpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciAkbGluZSA9ICQoXCIuaGllcmFyY2h5X19saW5lXCIpO1xuICAkbGluZS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLmZpbmQoXCIuaGllcmFyY2h5X19vcGVuLWJ0blwiKS50b2dnbGVDbGFzcyhcIm9wZW5lZFwiKTtcbiAgICAkKHRoaXMpLm5leHQoKS50b2dnbGVDbGFzcyhcIm9wZW5lZFwiKTtcblxuICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcyhcIm1hcmtlZFwiKSkge1xuICAgICAgJGxpbmUucmVtb3ZlQ2xhc3MoXCJtYXJrZWRcIik7XG4gICAgICAkKHRoaXMpLmFkZENsYXNzKFwibWFya2VkXCIpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY29udHJhY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmluc3RhbGxhdGlvbi1hY2NvdW50cy1tb2JpbGUnKTtcblxuICBpZiAoIWNvbnRyYWN0cykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBzbGlkZXIgPSBuZXcgU3dpcGVyKCcuaW5zdGFsbGF0aW9uLWFjY291bnRzLW1vYmlsZV9fc2xpZGVyJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcuaW5zdGFsbGF0aW9uLWFjY291bnRzLW1vYmlsZV9fcGFnaW5hdGlvbicsXG4gICAgICBkeW5hbWljQnVsbGV0czogdHJ1ZVxuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgZGVsaXZlcnlCdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmluc3RhbGxhdGlvbl9fY29uZmlybS1idG4nKTtcblxuICBpZiAoIWRlbGl2ZXJ5QnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfSAvLyAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZGF0ZVRleHQpIHtcbiAgLy8gICBvbkZpZWxkQ2hhbmdlKCk7XG4gIC8vIH0pO1xuXG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luc3RhbGxhdGlvbl9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9IC8vIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICAvLyBjb25zdCBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIC8vIGNvbnN0IHN1Ym1pdCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc3VibWl0Jyk7XG4gIC8vIGNvbnN0IGZpbGVJbnB1dEJsb2NrID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtaW5wdXQtZmlsZScpO1xuICAvLyBjb25zdCBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgLy8gY29uc3QgZGF0ZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtZGF0ZScpO1xuICAvLyBjb25zdCB0aW1lSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC10aW1lJyk7XG4gIC8vIGNvbnN0IGNvbmZpcm1DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGVja2JveF9faW5wdXQnKTtcblxuXG4gIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uIChidG4pIHtcbiAgICBuZXcgTW9kYWwoYnRuLCBtb2RhbCk7XG4gIH0pOyAvL2NvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAvLyBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAvLyAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuICAvLyAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAvLyAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gIC8vICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAvLyAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vICAgZGF0ZUlucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgdGltZUlucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgLy8gICAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG4gIC8vIH1cbiAgLy8gY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gIC8vICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAvLyAgICAgb25DbG9zZUNsaWNrKCk7XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vIGNvbnN0IG9uRmllbGRDaGFuZ2UgPSBmdW5jdGlvbihlKSB7XG4gIC8vICAgaWYgKGlzRm9ybUZpbGxlZCgpICYmIHN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgLy8gICAgIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gIC8vICAgfSBlbHNlIGlmICghaXNGb3JtRmlsbGVkKCkgJiYgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgLy8gICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAvLyAgIH1cbiAgLy8gfVxuICAvLyBjb25zdCBpc0Zvcm1GaWxsZWQgPSBmdW5jdGlvbigpIHtcbiAgLy8gICByZXR1cm4gJCgnI2RlbGl2ZXJ5LWRhdGUnKS5kYXRlcGlja2VyKCdnZXREYXRlJylcbiAgLy8gICAgICYmIHRpbWVJbnB1dC52YWx1ZSAhPT0gJydcbiAgLy8gICAgICYmIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID09PSB0cnVlXG4gIC8vICAgICAvLyYmIGZpbGVJbnB1dC52YWx1ZSAhPT0gJydcbiAgLy8gfVxuICAvLyBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIC8vIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIC8vIGRhdGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICAvLyB0aW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgLy9maWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWVsZENoYW5nZSk7XG4gIC8vY29uZmlybUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmllbGRDaGFuZ2UpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHJhZGlvcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyeS1vci1waWNrdXBfX2luc3RhbGxhdGlvbi1jaG9vc2UtYmxvY2sgIGlucHV0Jyk7XG5cbiAgaWYgKCFyYWRpb3NbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgd3JhcHBlciA9IHJhZGlvc1swXS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuXG4gIGZ1bmN0aW9uIG9uUmFkaW9DaGFuZ2UoKSB7XG4gICAgY29uc29sZS5sb2cod3JhcHBlcik7XG5cbiAgICBpZiAocmFkaW9zWzBdLmNoZWNrZWQpIHtcbiAgICAgIGlmICh3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItbWFudWFsJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1tYW51YWwnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1yZWdpc3RyYXRpb24nKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3ctZm9yLXJlZ2lzdHJhdGlvbicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1kZWxpdmVyeScpKSB7XG4gICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgnc2hvdy1mb3ItZGVsaXZlcnknKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocmFkaW9zWzFdLmNoZWNrZWQpIHtcbiAgICAgIGlmICh3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItbWFudWFsJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1tYW51YWwnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1kZWxpdmVyeScpKSB7XG4gICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdy1mb3ItZGVsaXZlcnknKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCF3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItcmVnaXN0cmF0aW9uJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKCdzaG93LWZvci1yZWdpc3RyYXRpb24nKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocmFkaW9zWzJdLmNoZWNrZWQpIHtcbiAgICAgIGlmICh3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItZGVsaXZlcnknKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3ctZm9yLWRlbGl2ZXJ5Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmICh3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItcmVnaXN0cmF0aW9uJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1yZWdpc3RyYXRpb24nKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCF3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItbWFudWFsJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKCdzaG93LWZvci1tYW51YWwnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByYWRpb3MuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25SYWRpb0NoYW5nZSk7XG4gIH0pO1xufSkoKTsgLy8gKGZ1bmN0aW9uKCkge1xuLy8gICAvLyBjb25zdCBkZWxpdmVyeUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5zdGFsbGF0aW9uX19jb25maXJtLWJ0bicpO1xuLy8gICAvLyBpZiAoIWRlbGl2ZXJ5QnRuc1swXSkge1xuLy8gICAvLyAgIHJldHVybjtcbi8vICAgLy8gfVxuLy8gICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnN0YWxsYXRpb25fX21vZGFsJyk7XG4vLyAgIGlmICghbW9kYWwpIHtcbi8vICAgICByZXR1cm47XG4vLyAgIH1cbi8vICAgY29uc3QgJGRhdGUgPSAkKCcjaW5zdGFsbGF0aW9uX19tb2RhbCAuZGF0ZS1pbnB1dCcpO1xuLy8gICAkZGF0ZS5kYXRlcGlja2VyKCkub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGRhdGVUZXh0KSB7XG4vLyAgICAgaWYgKCQoJyNpbnN0YWxsYXRpb25fX21vZGFsJykuaGFzQ2xhc3MoJ2pzLXNob3cnKSkge1xuLy8gICAgICAgb25GaWVsZENoYW5nZSgpO1xuLy8gICAgIH1cbi8vICAgfSk7XG4vLyAgIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuLy8gICBjb25zdCBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4vLyAgIGNvbnN0IHN1Ym1pdCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc3VibWl0Jyk7XG4vLyAgIGNvbnN0IGZpbGVJbnB1dEJsb2NrID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtaW5wdXQtZmlsZScpO1xuLy8gICBjb25zdCBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbi8vICAgY29uc3QgZmlsZUNsZWFyID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fY2xlYXInKTtcbi8vICAgY29uc3QgZGF0ZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtZGF0ZScpO1xuLy8gICBjb25zdCB0aW1lSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC10aW1lJyk7XG4vLyAgIGNvbnN0IGNvbmZpcm1DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGVja2JveF9faW5wdXQnKTtcbi8vICAgLy8gZGVsaXZlcnlCdG5zLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7XG4vLyAgIC8vICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuLy8gICAvLyB9KTtcbi8vICAgY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4vLyAgICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbi8vICAgICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuLy8gICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG4vLyAgICAgICBzdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbi8vICAgICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4vLyAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4vLyAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuLy8gICAgICAgfVxuLy8gICAgIH1cbi8vICAgICBkYXRlSW5wdXQudmFsdWUgPSAnJztcbi8vICAgICB0aW1lSW5wdXQudmFsdWUgPSAnJztcbi8vICAgICBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuLy8gICAgICRkYXRlLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG4vLyAgIH1cbi8vICAgY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4vLyAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuLy8gICAgICAgb25DbG9zZUNsaWNrKCk7XG4vLyAgICAgfVxuLy8gICB9XG4vLyAgIGNvbnN0IG9uRmllbGRDaGFuZ2UgPSBmdW5jdGlvbihlKSB7XG4vLyAgICAgaWYgKGlzRm9ybUZpbGxlZCgpICYmIHN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbi8vICAgICAgIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4vLyAgICAgfSBlbHNlIGlmICghaXNGb3JtRmlsbGVkKCkgJiYgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbi8vICAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuLy8gICAgIH1cbi8vICAgfVxuLy8gICBjb25zdCBpc0Zvcm1GaWxsZWQgPSBmdW5jdGlvbigpIHtcbi8vICAgICByZXR1cm4gJGRhdGUuZGF0ZXBpY2tlcignZ2V0RGF0ZScpXG4vLyAgICAgICAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnXG4vLyAgICAgICAmJiBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9PT0gdHJ1ZVxuLy8gICAgICAgJiYgZmlsZUlucHV0LnZhbHVlICE9PSAnJ1xuLy8gICB9XG4vLyAgIGNvbnN0IG9uRmlsZUNsZWFyID0gZnVuY3Rpb24oKSB7XG4vLyAgICAgaWYgKCFzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4vLyAgICAgICBzdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbi8vICAgICB9XG4vLyAgIH1cbi8vICAgd2luZG93Lm9uSW5zdGFsbGF0aW9uRmlsZURyb3AgPSBmdW5jdGlvbigpIHtcbi8vICAgICBvbkZpZWxkQ2hhbmdlKCk7XG4vLyAgIH1cbi8vICAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuLy8gICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuLy8gICBkYXRlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkZpZWxkQ2hhbmdlKTtcbi8vICAgdGltZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4vLyAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cub25JbnN0YWxsYXRpb25GaWxlRHJvcCk7XG4vLyAgIGNvbmZpcm1DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbi8vICAgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25GaWxlQ2xlYXIpO1xuLy8gfSkoKTtcblxuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgcGF5bWVudENvbmZpcm1CdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm11dHVhbC1jYWxjc19fbWFrZS1wYXltZW50Jyk7XG5cbiAgaWYgKCFwYXltZW50Q29uZmlybUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5bWVudC13YWl0aW5nX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH0gLy8gY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIC8vIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgLy8gY29uc3QgbWFpbkNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnRyYW5zYWN0aW9uc19fY2hlY2stYWxsIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHNlbmRlcklucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc2VuZGVyIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHJlY2lwaWVudElucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcmVjaXBpZW50IGlucHV0Jyk7XG4gIC8vIGNvbnN0IHN1bUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc3VtIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHB1cnBvc2VJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXB1cnBvc2UgaW5wdXQnKTtcbiAgLy8gY29uc3QgZ2V0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbigpIHtcbiAgLy8gICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fY2hlY2sgaW5wdXQnKTtcbiAgLy8gfTtcbiAgLy8gY29uc3Qgb25BbGxDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgY29uc3Qgcm93ID0gaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAvLyAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gIC8vICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG4gIC8vICAgICAgIGlmICghcm93LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpKSB7XG4gIC8vICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgLy8gICAgICAgfVxuICAvLyAgICAgfSBlbHNlIHtcbiAgLy8gICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgICAgIGlmIChyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgLy8gICAgICAgICByb3cuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9XG4gIC8vICAgfSlcbiAgLy8gfTtcbiAgLy8gY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgbWFpbkNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgLy8gICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgICBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgIH0pO1xuICAvLyAgICQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAvLyAgIHNlbmRlcklucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgcmVjaXBpZW50SW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICBzdW1JbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHB1cnBvc2VJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyB9O1xuICAvLyBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gIC8vICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gY29uc3Qgb25DaGVja2JveENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2hlY2tlZCkge1xuICAvLyAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjaGVja2VkJyk7XG4gIC8vICAgfSBlbHNlIHtcbiAgLy8gICAgIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG5cbiAgcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24gKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7IC8vIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgLy8gb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgLy8gbWFpbkNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQWxsQ2hhbmdlKTtcbiAgLy8gZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQ2hlY2tib3hDaGFuZ2UpO1xuICAvLyB9KVxufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIG1lbnVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyX19uYXYtYnRuJyk7XG5cbiAgaWYgKCFtZW51QnRuKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGNsb3NlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlcl9fY2xvc2UtYnRuJyk7XG4gIHZhciBuYXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyX19uYXYnKTtcblxuICB2YXIgY2hlY2tJZlRhYmxldCA9IGZ1bmN0aW9uIGNoZWNrSWZUYWJsZXQoKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5tYXRjaE1lZGlhKCcobWF4LXdpZHRoOiAxNDM5cHgpJykubWF0Y2hlcztcbiAgfTtcblxuICB2YXIgaXNUYWJsZXQgPSBjaGVja0lmVGFibGV0KCk7XG5cbiAgdmFyIG9uQnRuQ2xpY2sgPSBmdW5jdGlvbiBvbkJ0bkNsaWNrKCkge1xuICAgIGlmIChjaGVja0lmVGFibGV0KCkpIHtcbiAgICAgIG1lbnVCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnanMtb3BlbmVkJyk7XG4gICAgICBuYXYuY2xhc3NMaXN0LnRvZ2dsZSgnanMtc2hvdycpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24gb25DbG9zZUNsaWNrKCkge1xuICAgIG5hdi5jbGFzc0xpc3QucmVtb3ZlKCdqcy1zaG93Jyk7XG4gICAgbWVudUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdqcy1vcGVuZWQnKTtcbiAgfTtcblxuICBtZW51QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25CdG5DbGljayk7XG4gIGNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXV0dWFsLWNhbGNzLXBheW1lbnQtbW9iaWxlJyk7XG5cbiAgaWYgKCFjb250cmFjdHMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc2xpZGVyID0gbmV3IFN3aXBlcignLm11dHVhbC1jYWxjcy1wYXltZW50LW1vYmlsZV9fc2xpZGVyJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcubXV0dWFsLWNhbGNzLXBheW1lbnQtbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlXG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXV0dWFsLWNhbGNzLWJsb2NrLW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNsaWRlciA9IG5ldyBTd2lwZXIoJy5tdXR1YWwtY2FsY3MtYmxvY2stbW9iaWxlX19zbGlkZXInLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy5tdXR1YWwtY2FsY3MtYmxvY2stbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlXG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBwYXNzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXBhc3N3b3JkJyk7XG5cbiAgaWYgKCFwYXNzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5pbnB1dC1pY29uLS1zaG93LXBhc3N3b3JkJywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAkKHRoaXMpLm5leHQoKS5hdHRyKCd0eXBlJywgJ3RleHQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJCh0aGlzKS5uZXh0KCkuYXR0cigndHlwZScsICdwYXNzd29yZCcpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgcGF5bWVudENvbmZpcm1CdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBheW1lbnQtd2FpdGluZ19fY29uZmlybS1idG4nKTtcblxuICBpZiAoIXBheW1lbnRDb25maXJtQnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfSAvLyQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCk7XG5cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5bWVudC13YWl0aW5nX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH0gLy8gY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIC8vIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgLy8gY29uc3QgbWFpbkNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnRyYW5zYWN0aW9uc19fY2hlY2stYWxsIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHNlbmRlcklucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc2VuZGVyIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHJlY2lwaWVudElucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcmVjaXBpZW50IGlucHV0Jyk7XG4gIC8vIGNvbnN0IHN1bUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc3VtIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHB1cnBvc2VJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXB1cnBvc2UgaW5wdXQnKTtcbiAgLy8gY29uc3QgZ2V0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbigpIHtcbiAgLy8gICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fY2hlY2sgaW5wdXQnKTtcbiAgLy8gfTtcbiAgLy8gY29uc3Qgb25BbGxDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgY29uc3Qgcm93ID0gaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAvLyAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gIC8vICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG4gIC8vICAgICAgIGlmICghcm93LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpKSB7XG4gIC8vICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgLy8gICAgICAgfVxuICAvLyAgICAgfSBlbHNlIHtcbiAgLy8gICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgICAgIGlmIChyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgLy8gICAgICAgICByb3cuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9XG4gIC8vICAgfSlcbiAgLy8gfTtcbiAgLy8gY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgbWFpbkNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgLy8gICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgICBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgIH0pO1xuICAvLyAgICQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAvLyAgIHNlbmRlcklucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgcmVjaXBpZW50SW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICBzdW1JbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHB1cnBvc2VJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyB9O1xuICAvLyBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gIC8vICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gY29uc3Qgb25DaGVja2JveENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2hlY2tlZCkge1xuICAvLyAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjaGVja2VkJyk7XG4gIC8vICAgfSBlbHNlIHtcbiAgLy8gICAgIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG5cbiAgcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24gKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7IC8vIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgLy8gb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgLy8gbWFpbkNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQWxsQ2hhbmdlKTtcbiAgLy8gZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQ2hlY2tib3hDaGFuZ2UpO1xuICAvLyB9KVxufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgLy8gY29uc3QgcGF5bWVudENvbmZpcm1CdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBheW1lbnQtd2FpdGluZ19fY29uZmlybS1idG4nKTtcbiAgLy8gaWYgKCFwYXltZW50Q29uZmlybUJ0bnNbMF0pIHtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheW1lbnQtd2FpdGluZ19fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICB2YXIgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICB2YXIgbWFpbkNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnRyYW5zYWN0aW9uc19fY2hlY2stYWxsIGlucHV0Jyk7XG4gIHZhciBzZW5kZXJJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXNlbmRlciBpbnB1dCcpO1xuICB2YXIgcmVjaXBpZW50SW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1yZWNpcGllbnQgaW5wdXQnKTtcbiAgdmFyIHN1bUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc3VtIGlucHV0Jyk7XG4gIHZhciBwdXJwb3NlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1wdXJwb3NlIGlucHV0Jyk7XG5cbiAgdmFyIGdldEFsbENoZWNrYm94ID0gZnVuY3Rpb24gZ2V0QWxsQ2hlY2tib3goKSB7XG4gICAgcmV0dXJuIG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2FjdGlvbnNfX2NoZWNrIGlucHV0Jyk7XG4gIH07XG5cbiAgdmFyIGdldEFsbE1vYmlsZUNoZWNrYm94ID0gZnVuY3Rpb24gZ2V0QWxsTW9iaWxlQ2hlY2tib3goKSB7XG4gICAgcmV0dXJuIG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2FjdGlvbnNfX21vYmlsZS1jaGVjayBpbnB1dCcpO1xuICB9O1xuXG4gIHZhciBvbkFsbENoYW5nZSA9IGZ1bmN0aW9uIG9uQWxsQ2hhbmdlKCkge1xuICAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgdmFyIHJvdyA9IGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcblxuICAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG5cbiAgICAgICAgaWYgKCFyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgnY2hlY2tlZCcpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcblxuICAgICAgICBpZiAocm93LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpKSB7XG4gICAgICAgICAgcm93LmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHZhciBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiBvbkNsb3NlQ2xpY2soKSB7XG4gICAgbWFpbkNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICB9KTtcbiAgICBnZXRBbGxNb2JpbGVDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gICAgfSk7XG4gICAgJCgnI3BheW1lbnQtZGF0ZScpLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG4gICAgc2VuZGVySW5wdXQudmFsdWUgPSAnJztcbiAgICByZWNpcGllbnRJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHN1bUlucHV0LnZhbHVlID0gJyc7XG4gICAgcHVycG9zZUlucHV0LnZhbHVlID0gJyc7XG4gIH07XG5cbiAgdmFyIG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24gb25PdmVybGF5Q2xpY2soZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgICAgIG9uQ2xvc2VDbGljaygpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgb25DaGVja2JveENoYW5nZSA9IGZ1bmN0aW9uIG9uQ2hlY2tib3hDaGFuZ2UoZSkge1xuICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7XG4gICAgICBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbk1vYmlsZUNoZWNrYm94Q2hhbmdlID0gZnVuY3Rpb24gb25Nb2JpbGVDaGVja2JveENoYW5nZShlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHtcbiAgICAgIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAgIH1cbiAgfTsgLy8gcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7XG4gIC8vICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICAvLyB9KTtcblxuXG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgbWFpbkNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQWxsQ2hhbmdlKTtcbiAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkNoZWNrYm94Q2hhbmdlKTtcbiAgfSk7XG4gIGdldEFsbE1vYmlsZUNoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25Nb2JpbGVDaGVja2JveENoYW5nZSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHBheW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm11dHVhbC1jYWxjcy1wYXltZW50LWJsb2NrX19saW5rJyk7XG5cbiAgaWYgKCFwYXltZW50c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXltZW50LWluZm9fX21vZGFsJyk7XG4gIHBheW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIC8vICAgdmFyIGpiU2Nhbm5lcjtcbiAgLy8gZnVuY3Rpb24gb25RUkNvZGVTY2FubmVkKHNjYW5uZWRUZXh0KSB7XG4gIC8vICAgdmFyIHNjYW5uZWRUZXh0TWVtbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc3Vic2NyaWJlLXJlZ2lzdGVyX19pbnB1dCAgaW5wdXRcIik7XG4gIC8vICAgY29uc29sZS5sb2coc2Nhbm5lZFRleHRNZW1vKTtcbiAgLy8gICBpZihzY2FubmVkVGV4dE1lbW8pXG4gIC8vICAge1xuICAvLyAgICAgICBzY2FubmVkVGV4dE1lbW8udmFsdWUgPSBzY2FubmVkVGV4dDtcbiAgLy8gICAgICAgJChcIi5xci1zY2FubmVyLW1vZGFsXCIpLnJlbW92ZUNsYXNzKFwianMtc2hvd1wiKTtcbiAgLy8gICAgICAgamJTY2FubmVyLnN0b3BTY2FubmluZygpO1xuICAvLyAgIH1cbiAgLy8gfVxuICAvLyAgICAgICAgICAgICBmdW5jdGlvbiBwcm92aWRlVmlkZW8oKVxuICAvLyAgICAgICAgICAgICB7XG4gIC8vICAgICAgICAgICAgICAgICB2YXIgbiA9IG5hdmlnYXRvcjtcbiAgLy8gICAgICAgICAgICAgICAgIGlmIChuLm1lZGlhRGV2aWNlcyAmJiBuLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpXG4gIC8vICAgICAgICAgICAgICAgICB7XG4gIC8vICAgICAgICAgICAgICAgICAgIHJldHVybiBuLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuICAvLyAgICAgICAgICAgICAgICAgICAgIHZpZGVvOiB7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICBmYWNpbmdNb2RlOiBcImVudmlyb25tZW50XCJcbiAgLy8gICAgICAgICAgICAgICAgICAgICB9LFxuICAvLyAgICAgICAgICAgICAgICAgICAgIGF1ZGlvOiBmYWxzZVxuICAvLyAgICAgICAgICAgICAgICAgICB9KTtcbiAgLy8gICAgICAgICAgICAgICAgIH1cbiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgZ2V0VXNlck1lZGlhJyk7XG4gIC8vICAgICAgICAgICAgIH1cbiAgLy8gICAgICAgICAgICAgZnVuY3Rpb24gcHJvdmlkZVZpZGVvUVEoKVxuICAvLyAgICAgICAgICAgICB7XG4gIC8vICAgICAgICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKClcbiAgLy8gICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRldmljZXMpIHtcbiAgLy8gICAgICAgICAgICAgICAgICAgICB2YXIgZXhDYW1lcmFzID0gW107XG4gIC8vICAgICAgICAgICAgICAgICAgICAgZGV2aWNlcy5mb3JFYWNoKGZ1bmN0aW9uKGRldmljZSkge1xuICAvLyAgICAgICAgICAgICAgICAgICAgIGlmIChkZXZpY2Uua2luZCA9PT0gJ3ZpZGVvaW5wdXQnKSB7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgZXhDYW1lcmFzLnB1c2goZGV2aWNlLmRldmljZUlkKVxuICAvLyAgICAgICAgICAgICAgICAgICAgIH1cbiAgLy8gICAgICAgICAgICAgICAgIH0pO1xuICAvLyAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZXhDYW1lcmFzKTtcbiAgLy8gICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oaWRzKXtcbiAgLy8gICAgICAgICAgICAgICAgICAgICBpZihpZHMubGVuZ3RoID09PSAwKVxuICAvLyAgICAgICAgICAgICAgICAgICAgIHtcbiAgLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ0NvdWxkIG5vdCBmaW5kIGEgd2ViY2FtJyk7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgfVxuICAvLyAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvOiB7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICAgICdvcHRpb25hbCc6IFt7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlSWQnOiBpZHMubGVuZ3RoID09PSAxID8gaWRzWzBdIDogaWRzWzFdLy90aGlzIHdheSBRUSBicm93c2VyIG9wZW5zIHRoZSByZWFyIGNhbWVyYVxuICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAvLyAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAvLyAgICAgICAgICAgICAgICAgfSk7XG4gIC8vICAgICAgICAgICAgIH1cbiAgLy8gICAkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnN1YnNjcmliZS1yZWdpc3Rlcl9fYnRuXCIsIChlKSA9PiB7XG4gIC8vICAgICAgICAgICAgICAgaWYgKGpiU2Nhbm5lcikge1xuICAvLyAgICAgICAgICAgICAgICAgICBqYlNjYW5uZXIucmVzdW1lU2Nhbm5pbmcoKTtcbiAgLy8gICAgICAgICAgICAgICB9IGVsc2Uge1xuICAvLyAgICAgICAgICAgICAgICAgICBqYlNjYW5uZXIgPSBuZXcgSnNRUlNjYW5uZXIob25RUkNvZGVTY2FubmVkKTtcbiAgLy8gICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coamJTY2FubmVyKTtcbiAgLy8gICAgICAgICAgICAgICAgICAgamJTY2FubmVyLnNldFNuYXBJbWFnZU1heFNpemUoMzAwKTtcbiAgLy8gICAgICAgICAgICAgICAgICAgdmFyIHNjYW5uZXJQYXJlbnRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJqcy12aWRlby1ib3hcIik7XG4gIC8vICAgICAgICAgICAgICAgICAgIGlmKHNjYW5uZXJQYXJlbnRFbGVtZW50KVxuICAvLyAgICAgICAgICAgICAgICAgICB7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICAvL2FwcGVuZCB0aGUgamJTY2FubmVyIHRvIGFuIGV4aXN0aW5nIERPTSBlbGVtZW50XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICBqYlNjYW5uZXIuYXBwZW5kVG8oc2Nhbm5lclBhcmVudEVsZW1lbnQpO1xuICAvLyAgICAgICAgICAgICAgICAgICB9XG4gIC8vICAgICAgICAgICAgICAgfVxuICAvLyAgIH0pO1xuICAvLyAgICQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucXItc2Nhbm5lci1tb2RhbCAucXItc2Nhbm5lci1tb2RhbF9fY2xvc2VcIiwgKGUpID0+IHtcbiAgLy8gICAgICAgamJTY2FubmVyLnN0b3BTY2FubmluZygpO1xuICAvLyAgIH0pO1xuICB2YXIgc2Nhbm5lclBhcmVudEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImpzLXZpZGVvLWJveFwiKTtcbiAgdmFyIGpiU2Nhbm5lcjtcbiAgJCgnLnN1YnNjcmliZS1yZWdpc3Rlcl9faW5wdXQgLmlucHV0LXRleHQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHtcbiAgICB2YXIgJGlucHV0ID0gJCh0aGlzKTsgLy8gZnVuY3Rpb24gb25RUkNvZGVTY2FubmVkKHNjYW5uZWRUZXh0KSB7XG4gICAgLy8gICAgICAgJGlucHV0LnZhbChzY2FubmVkVGV4dCk7XG4gICAgLy8gICAgICAgJChcIi5xci1zY2FubmVyLW1vZGFsXCIpLnJlbW92ZUNsYXNzKFwianMtc2hvd1wiKTtcbiAgICAvLyAgICAgICBqYlNjYW5uZXIuc3RvcFNjYW5uaW5nKCk7XG4gICAgLy8gfVxuXG4gICAgZnVuY3Rpb24gb25RUkNvZGVTY2FubmVkKGVsKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHNjYW5uZWRUZXh0KSB7XG4gICAgICAgIGVsLnZhbChzY2FubmVkVGV4dCk7XG4gICAgICAgICQoXCIucXItc2Nhbm5lci1tb2RhbFwiKS5yZW1vdmVDbGFzcyhcImpzLXNob3dcIik7XG4gICAgICAgIGpiU2Nhbm5lci5zdG9wU2Nhbm5pbmcoKTtcbiAgICAgICAgamJTY2FubmVyLnJlbW92ZUZyb20oc2Nhbm5lclBhcmVudEVsZW1lbnQpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwcm92aWRlVmlkZW8oKSB7XG4gICAgICB2YXIgbiA9IG5hdmlnYXRvcjtcblxuICAgICAgaWYgKG4ubWVkaWFEZXZpY2VzICYmIG4ubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSkge1xuICAgICAgICByZXR1cm4gbi5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHtcbiAgICAgICAgICB2aWRlbzoge1xuICAgICAgICAgICAgZmFjaW5nTW9kZTogXCJlbnZpcm9ubWVudFwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhdWRpbzogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgZ2V0VXNlck1lZGlhJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcHJvdmlkZVZpZGVvUVEoKSB7XG4gICAgICByZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKCkudGhlbihmdW5jdGlvbiAoZGV2aWNlcykge1xuICAgICAgICB2YXIgZXhDYW1lcmFzID0gW107XG4gICAgICAgIGRldmljZXMuZm9yRWFjaChmdW5jdGlvbiAoZGV2aWNlKSB7XG4gICAgICAgICAgaWYgKGRldmljZS5raW5kID09PSAndmlkZW9pbnB1dCcpIHtcbiAgICAgICAgICAgIGV4Q2FtZXJhcy5wdXNoKGRldmljZS5kZXZpY2VJZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShleENhbWVyYXMpO1xuICAgICAgfSkudGhlbihmdW5jdGlvbiAoaWRzKSB7XG4gICAgICAgIGlmIChpZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdDb3VsZCBub3QgZmluZCBhIHdlYmNhbScpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHtcbiAgICAgICAgICB2aWRlbzoge1xuICAgICAgICAgICAgJ29wdGlvbmFsJzogW3tcbiAgICAgICAgICAgICAgJ3NvdXJjZUlkJzogaWRzLmxlbmd0aCA9PT0gMSA/IGlkc1swXSA6IGlkc1sxXSAvL3RoaXMgd2F5IFFRIGJyb3dzZXIgb3BlbnMgdGhlIHJlYXIgY2FtZXJhXG5cbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgICRpbnB1dC5zaWJsaW5ncygnLnN1YnNjcmliZS1yZWdpc3Rlcl9fYnRuJykub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgamJTY2FubmVyID0gbmV3IEpzUVJTY2FubmVyKG9uUVJDb2RlU2Nhbm5lZCgkaW5wdXQpKTsgLy9jb25zb2xlLmxvZyhqYlNjYW5uZXIpO1xuXG4gICAgICBqYlNjYW5uZXIuc2V0U25hcEltYWdlTWF4U2l6ZSgzMDApOyAvL3ZhciBzY2FubmVyUGFyZW50RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwianMtdmlkZW8tYm94XCIpO1xuXG4gICAgICBpZiAoc2Nhbm5lclBhcmVudEVsZW1lbnQpIHtcbiAgICAgICAgc2Nhbm5lclBhcmVudEVsZW1lbnQuaW5uZXJIVE1MID0gJyc7IC8vYXBwZW5kIHRoZSBqYlNjYW5uZXIgdG8gYW4gZXhpc3RpbmcgRE9NIGVsZW1lbnRcblxuICAgICAgICBqYlNjYW5uZXIuYXBwZW5kVG8oc2Nhbm5lclBhcmVudEVsZW1lbnQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5xci1zY2FubmVyLW1vZGFsIC5xci1zY2FubmVyLW1vZGFsX19jbG9zZVwiLCBmdW5jdGlvbiAoZSkge1xuICAgIGpiU2Nhbm5lci5zdG9wU2Nhbm5pbmcoKTtcbiAgICBqYlNjYW5uZXIucmVtb3ZlRnJvbShzY2FubmVyUGFyZW50RWxlbWVudCk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyICRidG4gPSAkKFwiLnJlcG9ydHNfX2Rvd25sb2FkLWJ0blwiKTtcbiAgdmFyICRkcm9wZG93biA9ICQoXCIucmVwb3J0c19fZG93bmxvYWQtZHJvcGRvd25cIik7XG5cbiAgaWYgKCRidG4ubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJGJ0bi5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaXNPcGVuZWQgPSAkKHRoaXMpLm5leHQoKS5oYXNDbGFzcyhcInNob3duXCIpO1xuICAgICRkcm9wZG93bi5yZW1vdmVDbGFzcyhcInNob3duXCIpO1xuICAgICFpc09wZW5lZCAmJiAkKHRoaXMpLm5leHQoKS5hZGRDbGFzcyhcInNob3duXCIpO1xuICB9KTtcbiAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgIHZhciAkdGFyZ2V0ID0gJChlLnRhcmdldCk7XG5cbiAgICBpZiAoJHRhcmdldC5oYXNDbGFzcyhcInJlcG9ydHNfX2Rvd25sb2FkLWJ0blwiKSB8fCAkdGFyZ2V0LnBhcmVudHMoXCIucmVwb3J0c19fZG93bmxvYWQtYnRuXCIpLmxlbmd0aCA+IDAgfHwgJHRhcmdldC5oYXNDbGFzcyhcInJlcG9ydHNfX2Rvd25sb2FkLWRyb3Bkb3duXCIpIHx8ICR0YXJnZXQucGFyZW50cyhcIi5yZXBvcnRzX19kb3dubG9hZC1kcm9wZG93blwiKS5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgICRkcm9wZG93bi5yZW1vdmVDbGFzcyhcInNob3duXCIpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgcmV3YXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1YnNjcmlwdGlvbi1wYWdlX19yZXdhcmQtbW9iaWxlJyk7XG5cbiAgaWYgKCFyZXdhcmQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc2xpZGVyID0gbmV3IFN3aXBlcignLnN1YnNjcmlwdGlvbi1wYWdlX19yZXdhcmQtbW9iaWxlJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcuc3Vic2NyaXB0aW9uLXBhZ2VfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWVcbiAgICB9XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNjaGVkdWxlQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1kZXZpY2VfX3NjaGVkdWxlJyk7XG5cbiAgaWYgKCFzY2hlZHVsZUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NoZWR1bGVfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfSAvLyBjb25zdCByYWRpb3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2NoZWR1bGVfX21vZGFsLXRvZ2dsZSBpbnB1dCcpO1xuICAvLyBjb25zdCB0b2dnbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVfX21vZGFsLXRvZ2dsZScpO1xuICAvLyByYWRpb3MuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpZCkge1xuICAvLyAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gIC8vICAgICBpZiAoaWQgPT09IDApIHtcbiAgLy8gICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5yZW1vdmUoJ3NlY29uZC10YWInKTtcbiAgLy8gICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5hZGQoJ2ZpcnN0LXRhYicpO1xuICAvLyAgICAgfVxuICAvLyAgICAgaWYgKGlkID09PSAxKSB7XG4gIC8vICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QucmVtb3ZlKCdmaXJzdC10YWInKTtcbiAgLy8gICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5hZGQoJ3NlY29uZC10YWInKTtcbiAgLy8gICAgIH1cbiAgLy8gICB9KVxuICAvLyB9KVxuXG5cbiAgc2NoZWR1bGVCdG5zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIC8vIGNvbnN0IHNjaGVkdWxlQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1kZXZpY2VfX3NjaGVkdWxlJyk7XG4gIC8vIGlmICghc2NoZWR1bGVCdG5zWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2hlZHVsZV9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHJhZGlvcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zY2hlZHVsZV9fbW9kYWwtdG9nZ2xlIGlucHV0Jyk7XG4gIHZhciB0b2dnbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVfX21vZGFsLXRvZ2dsZScpO1xuICByYWRpb3MuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaWQpIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChpZCA9PT0gMCkge1xuICAgICAgICB0b2dnbGUuY2xhc3NMaXN0LnJlbW92ZSgnc2Vjb25kLXRhYicpO1xuICAgICAgICB0b2dnbGUuY2xhc3NMaXN0LmFkZCgnZmlyc3QtdGFiJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChpZCA9PT0gMSkge1xuICAgICAgICB0b2dnbGUuY2xhc3NMaXN0LnJlbW92ZSgnZmlyc3QtdGFiJyk7XG4gICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QuYWRkKCdzZWNvbmQtdGFiJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pOyAvLyBzY2hlZHVsZUJ0bnMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgLy8gfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge30pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBtYWluUGFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYWluLXBhZ2UnKTtcblxuICBpZiAoIW1haW5QYWdlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHN1cHBvcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3VwcG9ydCcpO1xuICB2YXIgc3VwcG9ydENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdXBwb3J0X19jb250YWluZXInKTtcbiAgdmFyIGl0ZW1zID0gc3VwcG9ydC5xdWVyeVNlbGVjdG9yQWxsKCcuc3VwcG9ydF9faXRlbScpO1xuXG4gIGZ1bmN0aW9uIG1ha2VTbGlkZXIoKSB7XG4gICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc3dpcGVyLWNvbnRhaW5lcicpO1xuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdzdXBwb3J0X19zbGlkZXInKTtcbiAgICB2YXIgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgnc3dpcGVyLXdyYXBwZXInKTtcbiAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpZHgpIHtcbiAgICAgIHZhciBzbGlkZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgc2xpZGUuY2xhc3NMaXN0LmFkZCgnc3dpcGVyLXNsaWRlJyk7XG4gICAgICB2YXIgbm9kZSA9IGl0ZW0uY2xvbmVOb2RlKHRydWUpO1xuICAgICAgc2xpZGUuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKHNsaWRlKTtcbiAgICB9KTtcbiAgICB2YXIgcGFnaW5hdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHBhZ2luYXRpb24uY2xhc3NMaXN0LmFkZCgnc3VwcG9ydF9fc2xpZGVyLXBhZ2luYXRpb24nLCAnc3dpcGVyLXBhZ2luYXRpb24nKTtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQod3JhcHBlcik7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHBhZ2luYXRpb24pO1xuICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG4gICAgc3VwcG9ydENvbnRhaW5lci5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gICAgdmFyIHNsaWRlciA9IG5ldyBTd2lwZXIoJy5zdXBwb3J0X19zbGlkZXInLCB7XG4gICAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBlbDogJy5zdXBwb3J0X19zbGlkZXItcGFnaW5hdGlvbidcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIG1ha2VTbGlkZXIoKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5zdXBwb3J0X19kb2NzLWJ0bicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciB0cmFuc2FjdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudHJhbnNhY3Rpb25zLW1vYmlsZS1ibG9jaycpO1xuXG4gIGlmICghdHJhbnNhY3Rpb25zKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNsaWRlciA9IG5ldyBTd2lwZXIoJy50cmFuc2FjdGlvbnMtbW9iaWxlLWJsb2NrX19zbGlkZXInLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy50cmFuc2FjdGlvbnMtbW9iaWxlLWJsb2NrX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlXG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5oZWFkZXJfX3VzZXItYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoJCh0aGlzKS5pcyhlLnRhcmdldCkpIHtcbiAgICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgIH1cbiAgfSk7XG4gICQoZG9jdW1lbnQpLm9uKCdtb3VzZXVwJywgZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgYmxvY2sgPSAkKCcuaGVhZGVyX191c2VyLWJ0bicpO1xuXG4gICAgaWYgKCFibG9jay5pcyhlLnRhcmdldCkgJiYgYmxvY2suaGFzKGUudGFyZ2V0KS5sZW5ndGggPT09IDApIHtcbiAgICAgIGJsb2NrLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICB9XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcblxuICBpZiAoIXZlcmlmaWNhdGlvbkJ0blswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ZXJpZmljYXRpb25fX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfSAvLyBjb25zdCBmaWxlSW5wdXRCbG9jayA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy52ZXJpZmljYXRpb25fX21vZGFsLWlucHV0LWZpbGUnKTtcbiAgLy8gY29uc3QgZmlsZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG4gIC8vIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICAvLyBjb25zdCBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIC8vIGNvbnN0IHNhdmVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcbiAgLy8gY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgLy8gICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuICAvLyAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgICBzYXZlQnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gIC8vICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAvLyAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAvLyAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgLy8gICAgIH1cbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gIC8vICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAvLyAgICAgb25DbG9zZUNsaWNrKCk7XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vIGNvbnN0IG9uSW5wdXRDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBpZiAoZmlsZUlucHV0LnZhbHVlICE9PSAnJykge1xuICAvLyAgICAgc2F2ZUJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gIC8vICAgfVxuICAvLyB9XG5cblxuICB2ZXJpZmljYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pOyAvLyBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIC8vIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIC8vIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbklucHV0Q2hhbmdlKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIC8vIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcbiAgLy8gaWYgKCF2ZXJpZmljYXRpb25CdG5bMF0pIHtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZlcmlmaWNhdGlvbl9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGZpbGVJbnB1dEJsb2NrID0gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnZlcmlmaWNhdGlvbl9fbW9kYWwtaW5wdXQtZmlsZScpOyAvL2NvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICAvL2NvbnN0IGZpbGVDbGVhciA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG5cbiAgdmFyIGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICB2YXIgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICB2YXIgc2F2ZUJ0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIHZhciBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiBvbkNsb3NlQ2xpY2soKSB7XG4gICAgZmlsZUlucHV0QmxvY2suZm9yRWFjaChmdW5jdGlvbiAoaW5wdXRCbG9jaykge1xuICAgICAgdmFyIGZpbGVJbnB1dCA9IGlucHV0QmxvY2sucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG5cbiAgICAgIGlmIChpbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgICAgICAgaW5wdXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcbiAgICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG4gICAgICAgIHNhdmVCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcblxuICAgICAgICBpZiAoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHZhciBjaGVja0lucHV0cyA9IGZ1bmN0aW9uIGNoZWNrSW5wdXRzKCkge1xuICAgIHZhciBmaWxsZWQgPSB0cnVlO1xuICAgIGZpbGVJbnB1dEJsb2NrLmZvckVhY2goZnVuY3Rpb24gKGlucHV0QmxvY2spIHtcbiAgICAgIHZhciBmaWxlSW5wdXQgPSBpbnB1dEJsb2NrLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuXG4gICAgICBpZiAoZmlsZUlucHV0LnZhbHVlID09PSAnJykge1xuICAgICAgICBmaWxsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChmaWxsZWQgJiYgc2F2ZUJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHNhdmVCdG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIH1cblxuICAgIGlmICghZmlsbGVkICYmICFzYXZlQnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc2F2ZUJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbiBvbk92ZXJsYXlDbGljayhlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAgICAgb25DbG9zZUNsaWNrKCk7XG4gICAgfVxuICB9OyAvLyBjb25zdCBvbklucHV0Q2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgaWYgKGZpbGVJbnB1dC52YWx1ZSAhPT0gJycpIHtcbiAgLy8gICAgIHNhdmVCdG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG5cbiAgdmFyIG9uRmlsZUNsZWFyID0gZnVuY3Rpb24gb25GaWxlQ2xlYXIoKSB7XG4gICAgaWYgKCFzYXZlQnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc2F2ZUJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfTsgLy8gdmVyaWZpY2F0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIC8vIH0pXG5cblxuICB3aW5kb3cub25WZXJpZmljYXRpb25GaWxlRHJvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjaGVja0lucHV0cygpO1xuICB9O1xuXG4gIGZpbGVJbnB1dEJsb2NrLmZvckVhY2goZnVuY3Rpb24gKGlucHV0QmxvY2spIHtcbiAgICB2YXIgZmlsZUlucHV0ID0gaW5wdXRCbG9jay5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgICB2YXIgZmlsZUNsZWFyID0gaW5wdXRCbG9jay5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cub25WZXJpZmljYXRpb25GaWxlRHJvcCk7XG4gICAgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25GaWxlQ2xlYXIpO1xuICB9KTtcbiAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX19zZXJpYWwtYnRuJyk7XG5cbiAgaWYgKCFjYW5jZWxsYXRpb25CdG5bMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd3JpdGUtc2VyaWFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNhbmNlbGxhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAvLyBjb25zdCB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG4gIC8vIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3cml0ZS1zZXJpYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLndyaXRlLXNlcmlhbF9faW5wdXQgLmlucHV0LXRleHQnKTtcbiAgdmFyIGJ0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIHZhciBvbklucHV0ID0gZnVuY3Rpb24gb25JbnB1dChlKSB7XG4gICAgdmFyIHZhbHVlID0gZS50YXJnZXQudmFsdWU7XG5cbiAgICBpZiAodmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSAhPT0gJycgJiYgdmFsdWUubGVuZ3RoID4gMCAmJiBidG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBidG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIH1cblxuICAgIGlmICh2YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJyB8fCB2YWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgIGlmICghYnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgICBidG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH07IC8vIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KVxuXG5cbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbklucHV0KTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjaGVja2JveDIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2hlY2tib3gtMl9faW5wdXQnKTtcblxuICBpZiAoIWNoZWNrYm94MlswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNoZWNrYm94Mi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgaWYgKHRhcmdldC5jaGVja2VkID09PSB0cnVlKSB7XG4gICAgICAgIHRhcmdldC5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhcmdldC5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICQoJy5kYXRlLWlucHV0Om5vdCguZGF0ZS1pbnB1dC1yYW5nZSknKS5kYXRlcGlja2VyKHtkYXRlRm9ybWF0OiAnZGQubW0ueXknfSk7XG5cbiAgJCgnLmRhdGUtaW5wdXQtcmFuZ2UnKS5kYXRlcGlja2VyKHtcbiAgICByYW5nZTogJ3BlcmlvZCcsXG4gICAgaW5saW5lOiB0cnVlLFxuICAgIHNob3dCdXR0b25QYW5lbDogdHJ1ZSxcbiAgICBzaG93T3RoZXJNb250aHM6IHRydWUsXG4gICAgc2VsZWN0T3RoZXJNb250aHM6IHRydWUsXG4gICAgY2xvc2VUZXh0IDogXCLQk9C+0YLQvtCy0L5cIixcbiAgICBkYXRlRm9ybWF0OiAnZGQubW0ueXknLFxuXG4gICAgYmVmb3JlU2hvdzogZnVuY3Rpb24oaW5wdXQsIGluc3QpIHtcbiAgICAgIGluc3QuZHBEaXYuY3NzKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlWCgtMjRweCknKTtcbiAgICAgIGluc3QuZHBEaXYuYWRkQ2xhc3MoJ2NhbGVuZGFyLXJhbmdlJyk7XG4gICAgfSxcblxuICAgIG9uU2VsZWN0OiBmdW5jdGlvbihkYXRlVGV4dCwgaW5zdCwgZXh0ZW5zaW9uUmFuZ2UpIHtcbiAgICAgIGluc3QuaW5wdXQudmFsKGV4dGVuc2lvblJhbmdlLnN0YXJ0RGF0ZVRleHQgKyAnIC0gJyArIGV4dGVuc2lvblJhbmdlLmVuZERhdGVUZXh0KTtcbiAgICB9LFxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHJlcXVlc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC5yZXF1ZXN0cy11cGxvYWQnKTtcblxuICBpZiAoIXJlcXVlc3RNb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGZpbGVzV3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC5yZXF1ZXN0cy11cGxvYWQgLmlucHV0LWZpbGVfX3dyYXBwZXInKTtcbiAgY29uc3QgZmlsZUlucHV0SXRlbSA9IGZpbGVzV3JhcHBlci5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZScpO1xuICBjb25zdCBuZXdGaWxlSW5wdXRJdGVtID0gZmlsZUlucHV0SXRlbS5jbG9uZU5vZGUodHJ1ZSk7XG4gIGNvbnN0IHN1Ym1pdCA9IHJlcXVlc3RNb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcbiAgY29uc3QgY2FuY2VsID0gcmVxdWVzdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcblxuICBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdHMgKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfTtcblxuICBmdW5jdGlvbiBtYWtlSW5wdXRzTmFtZXMoKSB7XG4gICAgZmlsZXNXcmFwcGVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2lucHV0JykuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpZHgpIHtcbiAgICAgIGl0ZW0ubmFtZSA9ICdmaWxlLScgKyBpZHg7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBjbGVhcklucHV0cygpIHtcbiAgICBmaWxlc1dyYXBwZXIucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LWZpbGUtcmVxdWVzdHMnKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0sIGlkeCkge1xuICAgICAgaWYgKGlkeCAhPT0gMCkge1xuICAgICAgICByZW1vdmVFdmVudExpc3RlbmVycyhpdGVtKTtcbiAgICAgICAgaXRlbS5yZW1vdmUoKTtcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgJiYgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gIH1cblxuICBmdW5jdGlvbiBjaGVja0Zvcm0oKSB7XG4gICAgY29uc3QgZmlsZXMgPSBmaWxlc1dyYXBwZXIucXVlcnlTZWxlY3RvckFsbCgnLmZpbGUtbG9hZC5sb2FkZWQnKTtcblxuICAgIGZpbGVzLmxlbmd0aCA+IDBcbiAgICAgICYmIHN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJylcbiAgICAgICYmIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJylcblxuICAgIGZpbGVzLmxlbmd0aCA9PT0gMFxuICAgICAgJiYgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJylcbiAgICAgICYmIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpXG4gIH1cblxuICBmdW5jdGlvbiByZWFkVXJsKGlucHV0KSB7XG4gICAgY29uc3QgZmllbElucHV0SXRlbSA9IGlucHV0LnBhcmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICBjb25zdCBmaWxlRHJvcEFyZWEgPSBpbnB1dC5wYXJlbnROb2RlO1xuICAgIGNvbnN0IGJhciA9IGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX3Byb2dyZXNzLWN1cnJlbnQnKTtcbiAgICBjb25zdCBzdGF0dXMgPSBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19zdGF0dXMgc3BhbicpO1xuICAgIGNvbnN0IGZpbGVMb2FkID0gZmlsZURyb3BBcmVhLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZCcpO1xuICAgIGNvbnN0IGZpbGVJbmZvID0gZmlsZURyb3BBcmVhLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fc2l6ZScpO1xuXG4gICAgaWYgKGlucHV0LmZpbGVzICYmIGlucHV0LmZpbGVzWzBdKSB7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgcmVhZGVyLm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdsb2FkZWQnKTtcbiAgICAgIH1cblxuICAgICAgcmVhZGVyLm9ucHJvZ3Jlc3M9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGJhci5zdHlsZS53aWR0aCA9IE1hdGgucm91bmQoZS5sb2FkZWQgLyBlLnRvdGFsICogMTAwKSArICclJztcbiAgICAgICAgc3RhdHVzLnRleHRDb250ZW50ID0gTWF0aC5yb3VuZChlLmxvYWRlZCAvIGUudG90YWwgKiAxMDApXG4gICAgICB9XG5cbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBiYXIuc3R5bGUud2lkdGggPSAnMTAwJSc7XG4gICAgICAgIGZpbGVEcm9wQXJlYVxuICAgICAgICAgIC5uZXh0RWxlbWVudFNpYmxpbmdcbiAgICAgICAgICAucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fbmFtZScpXG4gICAgICAgICAgLnRleHRDb250ZW50ID0gaW5wdXQuZmlsZXNbMF0ubmFtZTtcblxuICAgICAgICBsZXQgc2l6ZSA9IGlucHV0LmZpbGVzWzBdLnNpemU7XG4gICAgICAgIGxldCBzaXplRGltID0gJyDQsdCw0LnRgic7XG4gICAgICAgIGxldCB0eXBlID0gJ1hMU1gsICdcblxuICAgICAgICBpZiAoc2l6ZSA+PSAxMDI0ICYmIHNpemUgPCAxMDQ4NTc2KSB7XG4gICAgICAgICAgc2l6ZSA9IE1hdGgucm91bmQoc2l6ZSAvIDEwMjQpO1xuICAgICAgICAgIHNpemVEaW0gPSAnINCa0LHQsNC50YInO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNpemUgPSBNYXRoLnJvdW5kKHNpemUgLyAxMDI0IC8gMTAyNCk7XG4gICAgICAgICAgc2l6ZURpbSA9ICcg0JzQsdCw0LnRgic7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaW5wdXQuZmlsZXNbMF0udHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcpIHtcbiAgICAgICAgICB0eXBlID0gJ1hMUywgJ1xuICAgICAgICB9XG5cbiAgICAgICAgZmlsZUxvYWQuY2xhc3NMaXN0LmFkZCgnbG9hZGVkJyk7XG4gICAgICAgIGZpbGVJbmZvLnRleHRDb250ZW50ID0gdHlwZSArIHNpemUgKyBzaXplRGltO1xuXG4gICAgICAgIGNvbnN0IG5ld0l0ZW0gPSBuZXdGaWxlSW5wdXRJdGVtLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgICAgZmlsZXNXcmFwcGVyLnByZXBlbmQobmV3SXRlbSk7XG4gICAgICAgIGFkZEV2ZW50TGlzdGVuZXJzKG5ld0l0ZW0pO1xuICAgICAgICBtYWtlSW5wdXRzTmFtZXMoKTtcbiAgICAgICAgY2hlY2tGb3JtKCk7XG4gICAgICB9XG5cbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGlucHV0LmZpbGVzWzBdKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVEcm9wKGUpIHtcbiAgICBjb25zdCBmaWxlSW5wdXQgPSBlLmN1cnJlbnRUYXJnZXQucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcbiAgICBsZXQgZHQgPSBlLmRhdGFUcmFuc2ZlclxuICAgIGxldCBmaWxlcyA9IGR0LmZpbGVzXG5cbiAgICBjb25zb2xlLmxvZyhmaWxlcyk7XG5cbiAgICBpZiAoZmlsZUlucHV0LmZpbGVzICYmIGZpbGVJbnB1dC5maWxlc1swXSkge1xuICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGZpbGVzWzBdLnR5cGUgPT09ICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnXG4gICAgICAgIHx8IGZpbGVzWzBdLnR5cGUgPT09ICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCdcbiAgICApIHtcbiAgICAgIGZpbGVJbnB1dC5maWxlcyA9IGZpbGVzO1xuICAgICAgcmVhZFVybChmaWxlSW5wdXQpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBvbkZpbGVDaGFuZ2UgPSAoZSkgPT4ge1xuICAgIHJlYWRVcmwoZS50YXJnZXQpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25DbGVhcihlKSB7XG4gICAgY29uc3QgZmlsZUlucHV0SXRlbSA9IGUuY3VycmVudFRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG4gICAgY29uc3QgZmlsZUlucHV0ID0gZmlsZUlucHV0SXRlbS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuXG4gICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgIH1cblxuICAgIHJlbW92ZUV2ZW50TGlzdGVuZXJzKGZpbGVJbnB1dEl0ZW0pO1xuICAgIGZpbGVJbnB1dEl0ZW0ucmVtb3ZlKCk7XG4gICAgY2hlY2tGb3JtKCk7XG4gIH1cblxuXG5cblxuICBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVycyhpdGVtKSB7XG4gICAgY29uc3QgZHJvcEFyZWEgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19sYWJlbCcpO1xuICAgIGNvbnN0IGZpbGVJbnB1dCA9IGl0ZW0ucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcbiAgICBjb25zdCBmaWxlQ2xlYXIgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG5cbiAgICBmdW5jdGlvbiBoaWdobGlnaHQoZSkge1xuICAgICBkcm9wQXJlYS5jbGFzc0xpc3QuYWRkKCdoaWdobGlnaHQnKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gdW5oaWdobGlnaHQoZSkge1xuICAgICBkcm9wQXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQnKTtcbiAgICB9O1xuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInLCAnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgICBkcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcHJldmVudERlZmF1bHRzLCBmYWxzZSlcbiAgICB9KTtcblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhpZ2hsaWdodCwgZmFsc2UpXG4gICAgfSk7XG5cbiAgICBbJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHVuaGlnaGxpZ2h0LCBmYWxzZSlcbiAgICB9KTtcblxuICAgIGRyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBoYW5kbGVEcm9wKVxuICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpbGVDaGFuZ2UpO1xuICAgIGZpbGVDbGVhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xlYXIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoaXRlbSkge1xuICAgIGNvbnN0IGRyb3BBcmVhID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9fbGFiZWwnKTtcbiAgICBjb25zdCBmaWxlSW5wdXQgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG4gICAgY29uc3QgZmlsZUNsZWFyID0gaXRlbS5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuXG4gICAgZnVuY3Rpb24gaGlnaGxpZ2h0KGUpIHtcbiAgICAgZHJvcEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHVuaGlnaGxpZ2h0KGUpIHtcbiAgICAgZHJvcEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0Jyk7XG4gICAgfTtcblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJywgJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZHJvcEFyZWEucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHByZXZlbnREZWZhdWx0cywgZmFsc2UpXG4gICAgfSk7XG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlciddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgIGRyb3BBcmVhLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoaWdobGlnaHQsIGZhbHNlKVxuICAgIH0pO1xuXG4gICAgWydkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgIGRyb3BBcmVhLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB1bmhpZ2hsaWdodCwgZmFsc2UpXG4gICAgfSk7XG5cbiAgICBkcm9wQXJlYS5yZW1vdmVFdmVudExpc3RlbmVyKCdkcm9wJywgaGFuZGxlRHJvcClcbiAgICBmaWxlSW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWxlQ2hhbmdlKTtcbiAgICBmaWxlQ2xlYXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsZWFyKTtcbiAgfVxuXG5cbiAgYWRkRXZlbnRMaXN0ZW5lcnMoZmlsZUlucHV0SXRlbSk7XG4gIGNhbmNlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgIGNsZWFySW5wdXRzKCk7XG4gIH0pXG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCBzY2FuVXBsb2FkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZW5kLXNjYW5fX3VwbG9hZC1maWxlXCIpO1xuXG4gIGlmICghc2NhblVwbG9hZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGZpbGVJbnB1dEl0ZW0gPSBzY2FuVXBsb2FkLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuaW5wdXQtZmlsZVwiKTtcbiAgY29uc3Qgc3VibWl0ID0gc2NhblVwbG9hZC5xdWVyeVNlbGVjdG9yKFwiLnNlbmQtc2Nhbl9fc3VibWl0XCIpO1xuXG4gIGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0cyhlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH1cblxuICBmdW5jdGlvbiBpc0ZpbGxlZCgpIHtcbiAgICBsZXQgZmlsbGVkID0gdHJ1ZTtcblxuICAgIGZpbGVJbnB1dEl0ZW0uZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgZmlsZSA9IGl0ZW0ucXVlcnlTZWxlY3RvcihcIi5maWxlLWxvYWRcIik7XG5cbiAgICAgIGlmICghZmlsZS5jbGFzc0xpc3QuY29udGFpbnMoXCJsb2FkZWRcIikpIHtcbiAgICAgICAgZmlsbGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZmlsbGVkO1xuICB9XG5cbiAgLy8gZnVuY3Rpb24gbWFrZUlucHV0c05hbWVzKCkge1xuICAvLyAgIGZpbGVzV3JhcHBlci5xdWVyeVNlbGVjdG9yQWxsKCdpbnB1dCcpLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaWR4KSB7XG4gIC8vICAgICBpdGVtLm5hbWUgPSAnZmlsZS0nICsgaWR4O1xuICAvLyAgIH0pO1xuICAvLyB9XG5cbiAgLy8gZnVuY3Rpb24gY2xlYXJJbnB1dHMoKSB7XG4gIC8vICAgZmlsZXNXcmFwcGVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1maWxlLXJlcXVlc3RzJykuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpZHgpIHtcbiAgLy8gICAgIGlmIChpZHggIT09IDApIHtcbiAgLy8gICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcnMoaXRlbSk7XG4gIC8vICAgICAgIGl0ZW0ucmVtb3ZlKCk7XG4gIC8vICAgICB9XG4gIC8vICAgfSlcblxuICAvLyAgICFzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpICYmIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAvLyB9XG5cbiAgLy8gZnVuY3Rpb24gY2hlY2tGb3JtKCkge1xuICAvLyAgIGNvbnN0IGZpbGVzID0gZmlsZXNXcmFwcGVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5maWxlLWxvYWQubG9hZGVkJyk7XG5cbiAgLy8gICBmaWxlcy5sZW5ndGggPiAwXG4gIC8vICAgICAmJiBzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gIC8vICAgICAmJiBzdWJtaXQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpXG5cbiAgLy8gICBmaWxlcy5sZW5ndGggPT09IDBcbiAgLy8gICAgICYmICFzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gIC8vICAgICAmJiBzdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKVxuICAvLyB9XG5cbiAgZnVuY3Rpb24gcmVhZFVybChpbnB1dCkge1xuICAgIC8vY29uc3QgZmllbElucHV0SXRlbSA9IGlucHV0LnBhcmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICBjb25zdCBmaWxlRHJvcEFyZWEgPSBpbnB1dC5wYXJlbnROb2RlO1xuICAgIGNvbnN0IGJhciA9IGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5maWxlLWxvYWRfX3Byb2dyZXNzLWN1cnJlbnRcIlxuICAgICk7XG4gICAgY29uc3Qgc3RhdHVzID0gZmlsZURyb3BBcmVhLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLmZpbGUtbG9hZF9fc3RhdHVzIHNwYW5cIlxuICAgICk7XG4gICAgY29uc3QgZmlsZUxvYWQgPSBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKFwiLmZpbGUtbG9hZFwiKTtcbiAgICBjb25zdCBmaWxlSW5mbyA9IGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoXCIuZmlsZS1sb2FkX19zaXplXCIpO1xuXG4gICAgaWYgKGlucHV0LmZpbGVzICYmIGlucHV0LmZpbGVzWzBdKSB7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgcmVhZGVyLm9ubG9hZHN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKFwibG9hZGVkXCIpO1xuICAgICAgfTtcblxuICAgICAgcmVhZGVyLm9ucHJvZ3Jlc3MgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBiYXIuc3R5bGUud2lkdGggPSBNYXRoLnJvdW5kKChlLmxvYWRlZCAvIGUudG90YWwpICogMTAwKSArIFwiJVwiO1xuICAgICAgICBzdGF0dXMudGV4dENvbnRlbnQgPSBNYXRoLnJvdW5kKChlLmxvYWRlZCAvIGUudG90YWwpICogMTAwKTtcbiAgICAgIH07XG5cbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBiYXIuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcbiAgICAgICAgZmlsZURyb3BBcmVhLm5leHRFbGVtZW50U2libGluZy5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgIFwiLmZpbGUtbG9hZF9fbmFtZVwiXG4gICAgICAgICkudGV4dENvbnRlbnQgPSBpbnB1dC5maWxlc1swXS5uYW1lO1xuXG4gICAgICAgIGxldCBzaXplID0gaW5wdXQuZmlsZXNbMF0uc2l6ZTtcbiAgICAgICAgbGV0IHNpemVEaW0gPSBcIiDQsdCw0LnRglwiO1xuXG4gICAgICAgIGlmIChzaXplID49IDEwMjQgJiYgc2l6ZSA8IDEwNDg1NzYpIHtcbiAgICAgICAgICBzaXplID0gTWF0aC5yb3VuZChzaXplIC8gMTAyNCk7XG4gICAgICAgICAgc2l6ZURpbSA9IFwiINCa0LHQsNC50YJcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzaXplID0gTWF0aC5yb3VuZChzaXplIC8gMTAyNCAvIDEwMjQpO1xuICAgICAgICAgIHNpemVEaW0gPSBcIiDQnNCx0LDQudGCXCI7XG4gICAgICAgIH1cblxuICAgICAgICBmaWxlTG9hZC5jbGFzc0xpc3QuYWRkKFwibG9hZGVkXCIpO1xuICAgICAgICBmaWxlSW5mby50ZXh0Q29udGVudCA9IHNpemUgKyBzaXplRGltO1xuICAgICAgICBpc0ZpbGxlZCgpICYmIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgLy8gY29uc3QgbmV3SXRlbSA9IG5ld0ZpbGVJbnB1dEl0ZW0uY2xvbmVOb2RlKHRydWUpO1xuICAgICAgICAvLyBmaWxlc1dyYXBwZXIucHJlcGVuZChuZXdJdGVtKTtcbiAgICAgICAgLy8gYWRkRXZlbnRMaXN0ZW5lcnMobmV3SXRlbSk7XG4gICAgICAgIC8vIG1ha2VJbnB1dHNOYW1lcygpO1xuICAgICAgICAvLyBjaGVja0Zvcm0oKTtcbiAgICAgIH07XG5cbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGlucHV0LmZpbGVzWzBdKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVEcm9wKGUpIHtcbiAgICBjb25zdCBmaWxlSW5wdXQgPSBlLmN1cnJlbnRUYXJnZXQucXVlcnlTZWxlY3RvcihcImlucHV0XCIpO1xuICAgIGxldCBkdCA9IGUuZGF0YVRyYW5zZmVyO1xuICAgIGxldCBmaWxlcyA9IGR0LmZpbGVzO1xuXG4gICAgY29uc29sZS5sb2coZmlsZXMpO1xuXG4gICAgaWYgKGZpbGVJbnB1dC5maWxlcyAmJiBmaWxlSW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgIGZpbGVJbnB1dC52YWx1ZSA9IFwiXCI7XG5cbiAgICAgIGlmICghL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSBcIlwiO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9IFwiZmlsZVwiO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZpbGVJbnB1dC5maWxlcyA9IGZpbGVzO1xuICAgIHJlYWRVcmwoZmlsZUlucHV0KTtcbiAgfVxuXG4gIGNvbnN0IG9uRmlsZUNoYW5nZSA9IChlKSA9PiB7XG4gICAgcmVhZFVybChlLnRhcmdldCk7XG4gIH07XG5cbiAgZnVuY3Rpb24gb25DbGVhcihlKSB7XG4gICAgY29uc3QgZmlsZUlucHV0SXRlbSA9IGUuY3VycmVudFRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG4gICAgY29uc3QgZmlsZUlucHV0ID0gZmlsZUlucHV0SXRlbS5xdWVyeVNlbGVjdG9yKFwiaW5wdXRcIik7XG4gICAgY29uc3QgZmlsZUxvYWQgPSBmaWxlSW5wdXRJdGVtLnF1ZXJ5U2VsZWN0b3IoXCIuZmlsZS1sb2FkXCIpO1xuXG4gICAgZmlsZUlucHV0LnZhbHVlID0gXCJcIjtcblxuICAgIGlmICghL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgIGZpbGVJbnB1dC50eXBlID0gXCJcIjtcbiAgICAgIGZpbGVJbnB1dC50eXBlID0gXCJmaWxlXCI7XG4gICAgfVxuXG4gICAgLy9yZW1vdmVFdmVudExpc3RlbmVycyhmaWxlSW5wdXRJdGVtKTtcbiAgICBmaWxlSW5wdXRJdGVtLmNsYXNzTGlzdC5yZW1vdmUoXCJsb2FkZWRcIik7XG4gICAgc3VibWl0LnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwiXCIpO1xuICAgIGZpbGVMb2FkLmNsYXNzTGlzdC5yZW1vdmUoXCJsb2FkZWRcIik7XG4gICAgLy9jaGVja0Zvcm0oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXJzKGl0ZW0pIHtcbiAgICBjb25zdCBkcm9wQXJlYSA9IGl0ZW0ucXVlcnlTZWxlY3RvcihcIi5pbnB1dC1maWxlX19sYWJlbFwiKTtcbiAgICBjb25zdCBmaWxlSW5wdXQgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoXCJpbnB1dFwiKTtcbiAgICBjb25zdCBmaWxlQ2xlYXIgPSBpdGVtLnF1ZXJ5U2VsZWN0b3IoXCIuZmlsZS1sb2FkX19jbGVhclwiKTtcblxuICAgIGZ1bmN0aW9uIGhpZ2hsaWdodChlKSB7XG4gICAgICBkcm9wQXJlYS5jbGFzc0xpc3QuYWRkKFwiaGlnaGxpZ2h0XCIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVuaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGRyb3BBcmVhLmNsYXNzTGlzdC5yZW1vdmUoXCJoaWdobGlnaHRcIik7XG4gICAgfVxuXG4gICAgW1wiZHJhZ2VudGVyXCIsIFwiZHJhZ292ZXJcIiwgXCJkcmFnbGVhdmVcIiwgXCJkcm9wXCJdLmZvckVhY2goKGV2ZW50TmFtZSkgPT4ge1xuICAgICAgZHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHByZXZlbnREZWZhdWx0cywgZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgW1wiZHJhZ2VudGVyXCIsIFwiZHJhZ292ZXJcIl0uZm9yRWFjaCgoZXZlbnROYW1lKSA9PiB7XG4gICAgICBkcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGlnaGxpZ2h0LCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBbXCJkcmFnbGVhdmVcIiwgXCJkcm9wXCJdLmZvckVhY2goKGV2ZW50TmFtZSkgPT4ge1xuICAgICAgZHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHVuaGlnaGxpZ2h0LCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBkcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCBoYW5kbGVEcm9wKTtcbiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCBvbkZpbGVDaGFuZ2UpO1xuICAgIGZpbGVDbGVhci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgb25DbGVhcik7XG4gIH1cblxuICBmaWxlSW5wdXRJdGVtLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICBhZGRFdmVudExpc3RlbmVycyhpdGVtKTtcbiAgfSk7XG5cbiAgLy9hZGRFdmVudExpc3RlbmVycyhmaWxlSW5wdXRJdGVtKTtcbiAgLy8gY2FuY2VsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gIC8vICAgY2xlYXJJbnB1dHMoKTtcbiAgLy8gfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGZpbGVEcm9wQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1maWxlX19sYWJlbCcpO1xuICBjb25zdCByZXF1ZXN0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubW9kYWwucmVxdWVzdHMtdXBsb2FkJyk7XG5cbiAgaWYgKHJlcXVlc3RNb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnNvbGUubG9nKCdpbnB1dCBmaWxlJyk7XG5cbiAgZnVuY3Rpb24gbWFrZUZpbGVMb2FkKGZpbGVEcm9wQXJlYSkge1xuICAgIGNvbnN0IGZpbGVJbnB1dCA9IGZpbGVEcm9wQXJlYS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIGNvbnN0IGZpbGVDbGVhciA9IGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG4gICAgLy8g0KHQsdGA0LDRgdGL0LLQsNC10Lwg0YHRgtCw0L3QtNCw0YDRgtC90YvQtSDRgdC+0LHRi9GC0LjRjyDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlcicsICdkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcHJldmVudERlZmF1bHRzLCBmYWxzZSlcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0cyAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9O1xuXG4gICAgLy8g0JTQvtCx0LDQstC70Y/QtdC8INGB0YLQuNC70Lgg0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsCDQvdCw0LQg0L3Rg9C20L3QvtC5INC+0LHQu9Cw0YHRgtGM0Y5cblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoaWdobGlnaHQsIGZhbHNlKVxuICAgIH0pO1xuXG4gICAgWydkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdW5oaWdobGlnaHQsIGZhbHNlKVxuICAgIH0pXG5cbiAgICBmdW5jdGlvbiBoaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodCcpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiB1bmhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0Jyk7XG4gICAgfTtcblxuICAgIC8vXG5cbiAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGhhbmRsZURyb3AsIGZhbHNlKVxuXG4gICAgZnVuY3Rpb24gaGFuZGxlRHJvcChlKSB7XG4gICAgICBsZXQgZHQgPSBlLmRhdGFUcmFuc2ZlclxuICAgICAgbGV0IGZpbGVzID0gZHQuZmlsZXNcblxuICAgICAgaWYgKGZpbGVJbnB1dC5maWxlcyAmJiBmaWxlSW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZpbGVJbnB1dC5maWxlcyA9IGZpbGVzO1xuICAgICAgb25GaWxlQ2hhbmdlKCk7XG4gICAgICB3aW5kb3cub25WZXJpZmljYXRpb25GaWxlRHJvcCAmJiB3aW5kb3cub25WZXJpZmljYXRpb25GaWxlRHJvcCgpO1xuICAgICAgd2luZG93Lm9uRGVsaXZlcnlGaWxlRHJvcCAmJiB3aW5kb3cub25EZWxpdmVyeUZpbGVEcm9wKCk7XG4gICAgICB3aW5kb3cub25JbnN0YWxsYXRpb25GaWxlRHJvcCAmJiB3aW5kb3cub25JbnN0YWxsYXRpb25GaWxlRHJvcCgpO1xuICAgIH07XG5cbiAgICBjb25zdCBvbkZpbGVDaGFuZ2UgPSAoKSA9PiB7XG4gICAgICByZWFkVXJsKGZpbGVJbnB1dCk7XG4gICAgfVxuXG4gICAgY29uc3QgcmVhZFVybCA9IChpbnB1dCkgPT4ge1xuICAgICAgaWYgKGlucHV0LmZpbGVzICYmIGlucHV0LmZpbGVzWzBdKSB7XG4gICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuXG4gICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgIGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2xvYWRlZCcpO1xuICAgICAgICAgIGZpbGVEcm9wQXJlYVxuICAgICAgICAgICAgLm5leHRFbGVtZW50U2libGluZ1xuICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX25hbWUnKVxuICAgICAgICAgICAgLnRleHRDb250ZW50ID0gaW5wdXQuZmlsZXNbMF0ubmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGlucHV0LmZpbGVzWzBdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbkNsZWFyKCkge1xuICAgICAgZmlsZURyb3BBcmVhLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG5cbiAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWxlQ2hhbmdlKTtcbiAgICBmaWxlQ2xlYXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsZWFyKTtcbiAgfVxuXG4gIHdpbmRvdy5tYWtlRmlsZUxvYWQgPSBtYWtlRmlsZUxvYWQ7XG5cblxuICBpZiAoIWZpbGVEcm9wQXJlYVswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGZpbGVEcm9wQXJlYS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBtYWtlRmlsZUxvYWQoaXRlbSk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXRleHQnKTtcblxuICBpZiAoIWlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uKGlucHV0KSB7XG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKFxuICAgICAgICBpbnB1dC52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJ1xuICAgICAgKSB7XG4gICAgICAgIGlucHV0LnZhbHVlID0gJyc7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgaW5wdXQudmFsdWUgIT09ICcnXG4gICAgICAgICYmICFpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKVxuICAgICAgKSB7XG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpbnB1dC52YWx1ZSA9PT0gJydcbiAgICAgICAgJiYgaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSkoKTtcbiIsIigoKSA9PiB7XG4gIGxldCB2aCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMDE7XG4gIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIGAke3ZofXB4YCk7XG5cbiAgY29uc3QgJGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG5cbiAgZnVuY3Rpb24gZGVib3VuY2UoZnVuYyl7XG4gICAgdmFyIHRpbWVyO1xuICAgIHJldHVybiBmdW5jdGlvbihldmVudCl7XG4gICAgICBpZih0aW1lcikgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jLDEwMCxldmVudCk7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUmVzaXplKCkge1xuICAgICAgbGV0IHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIGAke3ZofXB4YCk7XG4gIH07XG5cbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGRlYm91bmNlKG9uUmVzaXplKSk7XG5cbiAgZnVuY3Rpb24gTW9kYWwgKHRyaWdnZXIsIG1vZGFsKSB7XG4gICAgdGhpcy50cmlnZ2VyID0gdHJpZ2dlcjtcbiAgICB0aGlzLm1vZGFsID0gbW9kYWw7XG4gICAgdGhpcy5vdmVybGF5ID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgICB0aGlzLmNsb3NlQnRuID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG5cbiAgICB0aGlzLm9uT3ZlcmxheUNsaWNrID0gdGhpcy5vbk92ZXJsYXlDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DbG9zZUNsaWNrID0gdGhpcy5vbkNsb3NlQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uVHJpZ2dlckNsaWNrID0gdGhpcy5vblRyaWdnZXJDbGljay5iaW5kKHRoaXMpO1xuICAgIC8vdGhpcy5vblJlc2l6ZSA9IHRoaXMub25SZXNpemUuYmluZCh0aGlzKTtcblxuICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QuYWRkKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LmFkZCgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMub3ZlcmxheSkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub25UcmlnZ2VyQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9wZW4oKTtcbiAgfVxuXG4gIC8vIE1vZGFsLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uKCkge1xuICAvLyAgICAgbGV0IHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgLy8gICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIGAke3ZofXB4YCk7XG4gIC8vIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbk92ZXJsYXlDbGljayk7XG4gICAgdGhpcy5jbG9zZUJ0biAmJiB0aGlzLmNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsb3NlQ2xpY2spO1xuICAgIHRoaXMudHJpZ2dlciAmJiB0aGlzLnRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uVHJpZ2dlckNsaWNrKTtcbiAgfVxuXG4gIHdpbmRvdy5Nb2RhbCA9IE1vZGFsO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgICAkKCcuaW5wdXQtbW9uZXknKS5tYXNrKCcjICMjMCDigr0nLCB7XG4gICAgICByZXZlcnNlOiB0cnVlLFxuICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXBob25lJyk7XG5cbiAgaWYgKCFpbnB1dHNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBpbSA9IG5ldyBJbnB1dG1hc2soXCIrNyg5OTkpIDk5OS05OS05OVwiKTtcblxuICBpbnB1dHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgaW0ubWFzayhpdGVtKTtcbiAgfSlcbn0pKCk7XG4iLCIoKCkgPT4ge1xuICBjb25zdCBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2gnKTtcbiAgY29uc3QgY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoICsgLnNlYXJjaC1jbG9zZScpO1xuXG4gIGlmICghaXRlbXNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gIC8vICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+e1xuICAvLyAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnanMtZm9jdXMnKTtcbiAgLy8gICB9KTtcbiAgLy8gfSk7XG5cbiAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgaXRlbS52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJ1xuICAgICAgKSB7XG4gICAgICAgIGl0ZW0udmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpdGVtLnZhbHVlICE9PSAnJ1xuICAgICAgICAmJiAhaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKVxuICAgICAgKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIGl0ZW0udmFsdWUgPT09ICcnXG4gICAgICAgICYmIGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KVxuICB9KTtcblxuICBjbG9zZS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNlYXJjaCA9IGl0ZW0ucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgIHNlYXJjaC52YWx1ZSA9ICcnO1xuICAgICAgaWYgKFxuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pXG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICBmdW5jdGlvbiBmb3JtYXRPcHRpb24gKGl0ZW0pIHtcbiAgICBjb25zdCB2YWx1ZSA9IGl0ZW0udGV4dC5zcGxpdCgnc3BsaXR0ZXInKTtcbiAgICBjb25zdCBiciA9IHdpbmRvdy5tYXRjaE1lZGlhKCcobWF4LXdpZHRoOiA5OTlweCknKS5tYXRjaGVzID8gJzxicj4nIDogJyc7XG5cbiAgICBpZiAodmFsdWUubGVuZ3RoID4gMSkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gJCgnPHNwYW4+J1xuICAgICAgICArIHZhbHVlWzBdXG4gICAgICAgICsgJzwvc3Bhbj4nXG4gICAgICAgICsgYnJcbiAgICAgICAgKyAnPHNwYW4+J1xuICAgICAgICArIHZhbHVlWzFdXG4gICAgICAgICsgJzwvc3Bhbj4nKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBpdGVtLnRleHQ7XG4gICAgfVxuICB9XG5cbiAgJCgnLnNlbGVjdCcpLnNlbGVjdDIoe1xuICAgIHRlbXBsYXRlUmVzdWx0OiBmb3JtYXRPcHRpb24sXG4gICAgdGVtcGxhdGVTZWxlY3Rpb246IGZvcm1hdE9wdGlvblxuICB9KTtcblxuICAkKCcuc2VsZWN0Jykub24oJ3NlbGVjdDI6c2VsZWN0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAkKHRoaXMpLmFkZENsYXNzKCdwaWNrZWQnKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3Qgc3dpcGVyID0gbmV3IFN3aXBlcignLnN1YnNjcmlwdGlvbi10YWJzJywge1xuICAgICAgZnJlZU1vZGU6IHRydWUsXG4gICAgICBzbGlkZXNQZXJWaWV3OiAnYXV0bycsXG4gICAgICB3YXRjaE92ZXJmbG93OiB0cnVlLFxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGRlbGl2ZXJ5VGltZUlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcblxuICBpZiAoIWRlbGl2ZXJ5VGltZUlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbSA9IG5ldyBJbnB1dG1hc2soXCI5OTo5OVwiKTtcblxuICBkZWxpdmVyeVRpbWVJbnB1dHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgaW0ubWFzayhpdGVtKTtcbiAgfSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvdW50LWNyZWF0aW9uX19uZXcnKTtcblxuICBpZiAoIWNhbmNlbGxhdGlvbkJ0blswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY291bnQtY3JlYXRpb24nKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY2FuY2VsbGF0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xuXG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIC8vIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcblxuICAvLyBpZiAoIXZlcmlmaWNhdGlvbkJ0blswXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY291bnQtY3JlYXRpb24nKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgJGlucHV0ID0gJCgnLmFjY291bnQtY3JlYXRpb25fX2lucHV0IC5pbnB1dC10ZXh0Jyk7XG4gIGNvbnN0ICRidG4gPSAkKCcjYWNjb3VudC1jcmVhdGlvbiAubW9kYWxfX3NhdmUnKTtcblxuICBjb25zdCBvbklucHV0ID0gZnVuY3Rpb24oZSkge1xuICAgIGNvbnN0ICRlbXB0eUlucHV0ID0gJGlucHV0LmZpbHRlcihmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLnZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnXG4gICAgICAgIHx8IHRoaXMudmFsdWUubGVuZ3RoID09PSAwO1xuICAgIH0pO1xuXG4gICAgaWYgKFxuICAgICAgJGVtcHR5SW5wdXQubGVuZ3RoID09PSAwXG4gICAgKSB7XG4gICAgICAkYnRuLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJylcbiAgICB9IGVsc2Uge1xuICAgICAgJGJ0bi5hdHRyKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG5cbiAgICAvLyBpZiAoXG4gICAgLy8gICB2YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJ1xuICAgIC8vICAgfHwgdmFsdWUubGVuZ3RoID09PSAwXG4gICAgLy8gKSB7XG4gICAgLy8gICBpZiAoIWJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAvLyAgICAgYnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuICB9XG5cbiAgLy8gdmVyaWZpY2F0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIC8vIH0pXG5cbiAgJGlucHV0Lm9uKCdpbnB1dCcsIG9uSW5wdXQpO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gIGNvbnN0ICR0Ym9keSA9ICQoXCIuYWdlbnQtcmVwb3J0X19lcXVpcG1lbnQgIHRhYmxlICB0Ym9keVwiKTtcbiAgY29uc3QgJGxpbmUgPSAkdGJvZHkuY2hpbGRyZW4oKS5lcSgxKTtcblxuICAkKFwiLmFnZW50LXJlcG9ydF9fYWRkLWxpbmVcIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgJHRib2R5LmFwcGVuZCgkbGluZS5jbG9uZSgpKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWdlbnRzX191c2Vycy1ibG9jay1tb2JpbGUnKTtcblxuICBpZiAoIWNvbnRyYWN0cykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHNsaWRlciA9IG5ldyBTd2lwZXIoJy5hZ2VudHNfX3VzZXJzLWJsb2NrLW1vYmlsZV9fc2xpZGVyJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcuYWdlbnRzX191c2Vycy1ibG9jay1tb2JpbGVfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWUsXG4gICAgfVxuICB9KTtcblxuXG4gICQoJy5hZ2VudHNfX3VzZXJzLWJ0bicpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJCgnLmFnZW50c19fdXNlcnMtYnRuJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX19jYW5jZWxsYXRpb24nKTtcblxuICBpZiAoIWNhbmNlbGxhdGlvbkJ0blswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbGxhdGlvbl9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY2FuY2VsbGF0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xuXG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNoYW5nZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy51c2VyLXNldHRpbmdzX19jaGFuZ2UtZW1haWwnKTtcblxuICBpZiAoIWNoYW5nZUJ1dHRvblswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYW5nZS1lbWFpbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjaGFuZ2VCdXR0b24uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgfSk7XG5cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgLy8gY29uc3QgdmVyaWZpY2F0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvbicpO1xuXG4gIC8vIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbmdlLWVtYWlsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoYW5nZS1lbWFpbF9faW5wdXQgLmlucHV0LXRleHQnKTtcbiAgY29uc3QgYnRuID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zYXZlJyk7XG5cbiAgY29uc3Qgb25JbnB1dCA9IGZ1bmN0aW9uKGUpIHtcblxuICAgIGlmIChcbiAgICAgIGUudGFyZ2V0LnZhbGlkaXR5LnZhbGlkXG4gICAgKSB7XG4gICAgICBidG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgIWUudGFyZ2V0LnZhbGlkaXR5LnZhbGlkXG4gICAgKSB7XG4gICAgICBpZiAoIWJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgICAgYnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gdmVyaWZpY2F0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIC8vIH0pXG5cbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbklucHV0KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNoYW5nZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy51c2VyLXNldHRpbmdzX19jaGFuZ2UtcGhvbmUnKTtcblxuICBpZiAoIWNoYW5nZUJ1dHRvblswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYW5nZS1waG9uZScpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjaGFuZ2VCdXR0b24uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgfSk7XG5cblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgLy8gY29uc3QgdmVyaWZpY2F0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvbicpO1xuXG4gIC8vIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbmdlLXBob25lJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoYW5nZS1waG9uZV9faW5wdXQgLmlucHV0LXRleHQnKTtcbiAgY29uc3QgYnRuID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zYXZlJyk7XG5cbiAgY29uc3Qgb25JbnB1dCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoXG4gICAgICBlLnRhcmdldC52YWx1ZS5pbmRleE9mKCdfJykgPT09IC0xXG4gICAgKSB7XG4gICAgICBidG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgZS50YXJnZXQudmFsdWUuaW5kZXhPZignXycpICE9PSAtMVxuICAgICkge1xuICAgICAgaWYgKCFidG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICAgIGJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KVxuXG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25JbnB1dCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCByYWRpb3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtY3JlYXRpb25fX2NsaWVudC10eXBlICBpbnB1dCcpO1xuXG4gIGlmICghcmFkaW9zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1jcmVhdGlvbl9fZGV0YWlscycpO1xuXG4gIGZ1bmN0aW9uIG9uUmFkaW9DaGFuZ2UoKSB7XG4gICAgaWYgKHJhZGlvc1swXS5jaGVja2VkKSB7XG4gICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3ctZm9yLWVudGl0eScpO1xuICAgIH1cblxuICAgIGlmIChyYWRpb3NbMV0uY2hlY2tlZCkge1xuICAgICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKCdzaG93LWZvci1lbnRpdHknKTtcbiAgICB9XG4gIH1cblxuICByYWRpb3MuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvblJhZGlvQ2hhbmdlKTtcbiAgfSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNvbnRyYWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jbGllbnRzLW1vYmlsZS1ibG9jaycpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLmNsaWVudHMtbW9iaWxlLWJsb2NrX19zbGlkZXInLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy5jbGllbnRzLW1vYmlsZS1ibG9ja19fcGFnaW5hdGlvbicsXG4gICAgICBkeW5hbWljQnVsbGV0czogdHJ1ZSxcbiAgICB9XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IHRyaWdnZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtdHJpZ2dlcl0nKTtcblxuICB0cmlnZ2Vycy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBjb25zdCBuYW1lID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdHJpZ2dlcicpO1xuXG4gICAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1tb2RhbD0nICsgbmFtZSArICddJyk7XG5cbiAgICBpZiAobW9kYWwpIHtcbiAgICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gICAgfVxuICB9KVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgLy8gY29uc3QgdmVyaWZpY2F0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvbicpO1xuXG4gIC8vIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmlybWF0aW9uLWNvZGUnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgaW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuY29uZmlybWF0aW9uLWNvZGVfX2lucHV0IC5pbnB1dC10ZXh0Jyk7XG4gIGNvbnN0IGJ0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIGNvbnN0IG9uSW5wdXQgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKFxuICAgICAgZS50YXJnZXQudmFsdWUubGVuZ3RoID09PSA2XG4gICAgKSB7XG4gICAgICBidG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgZS50YXJnZXQudmFsdWUubGVuZ3RoIDwgNlxuICAgICkge1xuICAgICAgaWYgKCFidG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICAgIGJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KVxuXG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25JbnB1dCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICQoJy5kZWxpdmVyeS1vci1waWNrdXAuZG9uZScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICQodGhpcykuZmluZCgnLmNvbnRyYWN0LWluZm9fX2RlbGl2ZXJlZC1hZHJlc3MnKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykuZmluZCgnLmNvbnRyYWN0LWluZm9fX2RlbGl2ZXJlZC10b2dnbGUnKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgY29udHJhY3RTZXJ2aWNlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1zZXJ2aWNlcycpO1xuXG4gIGlmICghY29udHJhY3RTZXJ2aWNlcykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LXNlcnZpY2VzX19saW5rJyk7XG5cbiAgY29uc3Qgb25MaW5rQ2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XG5cbiAgICBpZiAoXG4gICAgICB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2xhYmVsJylcbiAgICAgIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrYm94LWJ0bl9fY2hlY2tib3gnKVxuICAgICAgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJylcbiAgICAgIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbnRyYWN0LXNlcnZpY2VzX19kZWxpdmVyeS1jb25maXJtJylcbiAgICApIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH1cblxuICBsaW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmspIHtcbiAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25MaW5rQ2xpY2spO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCBjb250cmFjdHNMaW5rQWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5jb250cmFjdHNfX2xpbmtcIik7XG5cbiAgaWYgKCFjb250cmFjdHNMaW5rQWxsWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgb25MaW5rQ2xpY2sgPSBmdW5jdGlvbiAoZSkge1xuICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuXG4gICAgaWYgKFxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNoZWNrYm94LWJ0bl9fbGFiZWxcIikgfHxcbiAgICAgIHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJjaGVja2JveC1idG5fX2NoZWNrYm94XCIpIHx8XG4gICAgICB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uXCIpIHx8XG4gICAgICB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicGF5bWVudC13YWl0aW5nX19jb25maXJtLWJ0blwiKSB8fFxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcImNvbnRyYWN0LXNlcnZpY2VzX19kZWxpdmVyeS1jb25maXJtXCIpIHx8XG4gICAgICB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicmVwb3J0c19fZG93bmxvYWQtYnRuXCIpIHx8XG4gICAgICAkKHRhcmdldCkucGFyZW50cyhcIi5yZXBvcnRzX19kb3dubG9hZC1idG5cIikubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgfTtcblxuICBjb250cmFjdHNMaW5rQWxsLmZvckVhY2goZnVuY3Rpb24gKGxpbmspIHtcbiAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBvbkxpbmtDbGljayk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgY29udHJhY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LXNlcnZpY2VzLW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLmNvbnRyYWN0LXNlcnZpY2VzLW1vYmlsZV9fc2xpZGVyJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcuY29udHJhY3Qtc2VydmljZXMtbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlLFxuICAgIH1cbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3RzLW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLmNvbnRyYWN0cy1tb2JpbGVfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLmNvbnRyYWN0cy1tb2JpbGVfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWUsXG4gICAgfVxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdWJzY3JpcHRpb24tcGFnZV9fYWN0aW9uLWl0ZW0tLWRlbGV0ZScpO1xuXG4gIGlmICghY2FuY2VsbGF0aW9uQnRuWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsZXRlLXNlcnZpY2VfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNhbmNlbGxhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KVxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBkZWxpdmVyeUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFkZWxpdmVyeUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZGF0ZVRleHQpIHtcbiAgLy8gICBvbkZpZWxkQ2hhbmdlKCk7XG4gIC8vIH0pO1xuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIC8vIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgLy8gY29uc3Qgc3VibWl0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQnKTtcbiAgLy8gY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIC8vIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICAvLyBjb25zdCBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1kYXRlJyk7XG4gIC8vIGNvbnN0IHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgLy8gY29uc3QgY29uZmlybUNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoZWNrYm94X19pbnB1dCcpO1xuXG4gIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgLy8gY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgLy8gICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuXG4gIC8vICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuXG4gIC8vICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAvLyAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAvLyAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgLy8gICAgIH1cbiAgLy8gICB9XG5cbiAgLy8gICBkYXRlSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICB0aW1lSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAvLyAgICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgLy8gfVxuXG4gIC8vIGNvbnN0IG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAvLyAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgLy8gICAgIG9uQ2xvc2VDbGljaygpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG4gIC8vIGNvbnN0IG9uRmllbGRDaGFuZ2UgPSBmdW5jdGlvbihlKSB7XG4gIC8vICAgaWYgKGlzRm9ybUZpbGxlZCgpICYmIHN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgLy8gICAgIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gIC8vICAgfSBlbHNlIGlmICghaXNGb3JtRmlsbGVkKCkgJiYgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgLy8gICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG4gIC8vIGNvbnN0IGlzRm9ybUZpbGxlZCA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIHJldHVybiAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoJ2dldERhdGUnKVxuICAvLyAgICAgJiYgdGltZUlucHV0LnZhbHVlICE9PSAnJ1xuICAvLyAgICAgJiYgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPT09IHRydWVcbiAgLy8gICAgICYmIGZpbGVJbnB1dC52YWx1ZSAhPT0gJydcbiAgLy8gfVxuXG4gIC8vIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgLy8gb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgLy8gZGF0ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIC8vIHRpbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICAvLyBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWVsZENoYW5nZSk7XG4gIC8vIGNvbmZpcm1DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGRldmljZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtY3JlYXRpb25fX2RlbGl2ZXJ5LWRldmljZScpO1xuXG4gIGlmICghZGV2aWNlc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGRldmljZXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgY29uc3QgcmFkaW9zID0gaXRlbS5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtY3JlYXRpb25fX2RlbGl2ZXJ5LXR5cGUtd3JhcHBlciAgaW5wdXQnKTtcblxuICAgIGZ1bmN0aW9uIG9uUmFkaW9DaGFuZ2UoZSkge1xuICAgICAgY29uc3Qgd3JhcHBlciA9IGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuXG4gICAgICBpZiAocmFkaW9zWzBdLmNoZWNrZWQpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1waWNrdXAnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJhZGlvc1sxXS5jaGVja2VkKSB7XG4gICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgnc2hvdy1mb3ItcGlja3VwJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmFkaW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvblJhZGlvQ2hhbmdlKTtcbiAgICB9KTtcbiAgfSlcblxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIGdldFllYXJMYWJlbChudW0pIHtcbiAgICBjb25zdCB0ZXh0ID0gXCJcIiArIG51bTtcbiAgICBjb25zdCBsYXN0TnVtYmVyID0gK3RleHRbdGV4dC5sZW5ndGggLSAxXTtcbiAgICBjb25zdCBwcmVMYXN0TnVtYmVyID0gK3RleHRbdGV4dC5sZW5ndGggLSAyXTtcblxuICAgIGlmIChwcmVMYXN0TnVtYmVyID09PSAxKSB7XG4gICAgICByZXR1cm4gYCR7bnVtfSDQu9C10YJgO1xuICAgIH1cblxuICAgIGlmIChsYXN0TnVtYmVyID09PSAxKSB7XG4gICAgICByZXR1cm4gYCR7bnVtfSDQs9C+0LRgO1xuICAgIH1cblxuICAgIGlmIChsYXN0TnVtYmVyID4gMSAmJiBsYXN0TnVtYmVyIDwgNSkge1xuICAgICAgcmV0dXJuIGAke251bX0g0LPQvtC00LBgO1xuICAgIH1cblxuICAgIGlmIChsYXN0TnVtYmVyID4gNCB8fCBsYXN0TnVtYmVyID09PSAwKSB7XG4gICAgICByZXR1cm4gYCR7bnVtfSDQu9C10YJgO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0ICR5ZWFycyA9ICQoXCIuZGV2aWNlLXBlcmlvZF9fcmFuZ2UtdmFsdWUteWVhclwiKTtcbiAgY29uc3QgJHByaWNlID0gJChcIi5kZXZpY2UtcGVyaW9kX19yYW5nZS12YWx1ZS1wcmljZVwiKTtcbiAgY29uc3QgcHJpY2VDdXJyZW5jeSA9ICRwcmljZS50ZXh0KCk7XG4gIGNvbnN0IHByaWNlQmFzaWMgPSArJHByaWNlLmF0dHIoXCJkYXRhLXByaWNlXCIpO1xuXG4gIGZ1bmN0aW9uIGdldFByaWNlKG51bSkge1xuICAgIGNvbnN0IHZhbHVlID0gcHJpY2VCYXNpYyAqIG51bTtcbiAgICByZXR1cm4gYCR7dmFsdWV9ICR7cHJpY2VDdXJyZW5jeX1gO1xuICB9XG5cbiAgJChcIi5qcy1yYW5nZS1zaW5nbGUtc2xpZGVyXCIpLmlvblJhbmdlU2xpZGVyKHtcbiAgICB0eXBlOiBcInNpbmdsZVwiLFxuICAgIGdyaWQ6IGZhbHNlLFxuICAgIGhpZGVfbWluX21heDogdHJ1ZSxcbiAgICBleHRyYV9jbGFzc2VzOiBcInNpbmdsZS1zbGlkZXJcIixcbiAgICBvblN0YXJ0OiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgJHllYXJzLnRleHQoZ2V0WWVhckxhYmVsKGRhdGEuZnJvbSkpO1xuICAgICAgJHByaWNlLnRleHQoZ2V0UHJpY2UoZGF0YS5mcm9tKSk7XG4gICAgfSxcbiAgICBvbkNoYW5nZTogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICR5ZWFycy50ZXh0KGdldFllYXJMYWJlbChkYXRhLmZyb20pKTtcbiAgICAgICRwcmljZS50ZXh0KGdldFByaWNlKGRhdGEuZnJvbSkpO1xuICAgIH0sXG4gIH0pO1xuXG4gICQoXCIuaXJzLS1mbGF0XCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICBjb25zb2xlLmxvZyhlLnRhcmdldCk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgbWVudSA9ICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLW1lbnUnKTtcbiAgY29uc3QgYnRuID0gJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJyk7XG5cbiAgICAkLmV4dGVuZCgkLmRhdGVwaWNrZXIsIHtcblxuICAgICAgICAvLyBSZWZlcmVuY2UgdGhlIG9yaWduYWwgZnVuY3Rpb24gc28gd2UgY2FuIG92ZXJyaWRlIGl0IGFuZCBjYWxsIGl0IGxhdGVyXG4gICAgICAgIF9pbmxpbmVEYXRlcGlja2VyMjogJC5kYXRlcGlja2VyLl9pbmxpbmVEYXRlcGlja2VyLFxuXG4gICAgICAgIC8vIE92ZXJyaWRlIHRoZSBfaW5saW5lRGF0ZXBpY2tlciBtZXRob2RcbiAgICAgICAgX2lubGluZURhdGVwaWNrZXI6IGZ1bmN0aW9uICh0YXJnZXQsIGluc3QpIHtcblxuICAgICAgICAgICAgLy8gQ2FsbCB0aGUgb3JpZ2luYWxcbiAgICAgICAgICAgIHRoaXMuX2lubGluZURhdGVwaWNrZXIyKHRhcmdldCwgaW5zdCk7XG5cbiAgICAgICAgICAgIHZhciBiZWZvcmVTaG93ID0gJC5kYXRlcGlja2VyLl9nZXQoaW5zdCwgJ2JlZm9yZVNob3cnKTtcblxuICAgICAgICAgICAgaWYgKGJlZm9yZVNob3cpIHtcbiAgICAgICAgICAgICAgICBiZWZvcmVTaG93LmFwcGx5KHRhcmdldCwgW3RhcmdldCwgaW5zdF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cblxuICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51JykudG9nZ2xlKCk7XG4gIH0pO1xuXG4gICQoJyNlYXJuZWQtZGF0ZScpLmRhdGVwaWNrZXIoe1xuICAgIHJhbmdlOiAncGVyaW9kJyxcbiAgICBpbmxpbmU6IHRydWUsXG4gICAgc2hvd0J1dHRvblBhbmVsOiB0cnVlLFxuICAgIHNob3dPdGhlck1vbnRoczogdHJ1ZSxcbiAgICBzZWxlY3RPdGhlck1vbnRoczogdHJ1ZSxcbiAgICBjbG9zZVRleHQgOiBcItCT0L7RgtC+0LLQvlwiLFxuICAgIGRhdGVGb3JtYXQ6ICdkZC5tbS55eScsXG5cbiAgICBiZWZvcmVTaG93OiBmdW5jdGlvbihpbnB1dCwgaW5zdCkge1xuICAgICAgaW5zdC5kcERpdi5jc3MoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGVYKC0yNHB4KScpO1xuICAgICAgaW5zdC5kcERpdi5hZGRDbGFzcygnY2FsZW5kYXItcmFuZ2UnKTtcbiAgICB9LFxuXG4gICAgb25TZWxlY3Q6IGZ1bmN0aW9uKGRhdGVUZXh0LCBpbnN0LCBleHRlbnNpb25SYW5nZSkge1xuICAgICAgJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJykudGV4dChleHRlbnNpb25SYW5nZS5zdGFydERhdGVUZXh0ICsgJyAtICcgKyBleHRlbnNpb25SYW5nZS5lbmREYXRlVGV4dCk7XG5cbiAgICB9XG4gIH0pO1xuXG4gICQoZG9jdW1lbnQpLm1vdXNldXAoZnVuY3Rpb24gKGUpe1xuXHRcdGNvbnN0IG1lbnUgPSAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51Jyk7XG5cdFx0Y29uc3QgYnRuID0gJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJyk7XG4gICAgaWYgKCFtZW51LmlzKGUudGFyZ2V0KVxuICAgICAgJiYgbWVudS5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMFxuICAgICAgJiYgIWJ0bi5pcyhlLnRhcmdldClcbiAgICAgICYmIGJ0bi5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMFxuICAgICkge1xuXHRcdFx0bWVudS5oaWRlKCk7XG5cdFx0fVxuICB9KTtcblxuICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51LWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdhbGwtdGltZScpKSB7XG4gICAgICAkKCcuZWFybmVkLWRhdGVfX3N0YXJ0LXBlcmlvZCcpLnRleHQoKSA9PT0gJydcbiAgICAgID8gJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJykudGV4dChcbiAgICAgICAgICAkKHRoaXMpLnRleHQoKVxuICAgICAgICApXG4gICAgICA6ICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLWJ0bicpLnRleHQoXG4gICAgICAgICAgJCh0aGlzKS50ZXh0KClcbiAgICAgICAgICArICcgKNGBXFx1MDBhMCdcbiAgICAgICAgICArICQoJy5lYXJuZWQtZGF0ZV9fc3RhcnQtcGVyaW9kJykudGV4dCgpXG4gICAgICAgICAgKyAnKSdcbiAgICAgICAgKVxuICAgIH0gZWxzZSB7XG4gICAgICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKS50ZXh0KFxuICAgICAgICAkKHRoaXMpLnRleHQoKVxuICAgICAgKVxuICAgIH1cblxuICAgIG1lbnUuaGlkZSgpO1xuXG4gIH0pO1xuXG4gICQoJy5lYXJuZWQtZGF0ZV9fc3RhcnQtcGVyaW9kJykudGV4dCgpID09PSAnJ1xuICAgICAgPyAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKS50ZXh0KFxuICAgICAgICAgICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLW1lbnUtYnRuLmFsbC10aW1lJykudGV4dCgpXG4gICAgICAgIClcbiAgICAgIDogJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJykudGV4dChcbiAgICAgICAgICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51LWJ0bi5hbGwtdGltZScpLnRleHQoKVxuICAgICAgICAgICsgJyAo0YFcXHUwMGEwJ1xuICAgICAgICAgICsgJCgnLmVhcm5lZC1kYXRlX19zdGFydC1wZXJpb2QnKS50ZXh0KClcbiAgICAgICAgICArICcpJ1xuICAgICAgICApXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAkKCcuZmlsdGVyc19fYnRuJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG5cbiAgJCgnLmZpbHRlcnNfX2J0bi1jbGVhcicpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICQoJy5maWx0ZXJzIC5zZWxlY3QnKS52YWwoJ9CS0YHQtScpO1xuICAgICQoJy5maWx0ZXJzIC5zZWxlY3QnKS50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAkKCcuZmlsdGVycyAuc2VsZWN0JykucmVtb3ZlQ2xhc3MoJ3BpY2tlZCcpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCAkdHJpZ2dlciA9ICQoXCIuc3Vic2NyaXB0aW9uLWFsbF9faGllcmFyY2h5LXRyaWdnZXJcIik7XG4gIGNvbnN0ICRtb2RhbCA9ICQoXCIuaGllcmFyY2h5XCIpO1xuICBjb25zdCAkYmxhY2tvdXQgPSAkbW9kYWwuZmluZChcIi5oaWVyYXJjaHlfX2JsYWNrb3V0XCIpO1xuICBjb25zdCAkY2xvc2UgPSAkbW9kYWwuZmluZChcIi5oaWVyYXJjaHlfX2Nsb3NlXCIpO1xuXG4gICR0cmlnZ2VyLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICRtb2RhbC5hZGRDbGFzcyhcIm9wZW5lZFwiKTtcbiAgfSk7XG5cbiAgJGJsYWNrb3V0Lm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICRtb2RhbC5yZW1vdmVDbGFzcyhcIm9wZW5lZFwiKTtcbiAgfSk7XG5cbiAgJGNsb3NlLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICRtb2RhbC5yZW1vdmVDbGFzcyhcIm9wZW5lZFwiKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgY29uc3QgJGxpbmUgPSAkKFwiLmhpZXJhcmNoeV9fbGluZVwiKTtcblxuICAkbGluZS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLmZpbmQoXCIuaGllcmFyY2h5X19vcGVuLWJ0blwiKS50b2dnbGVDbGFzcyhcIm9wZW5lZFwiKTtcbiAgICAkKHRoaXMpLm5leHQoKS50b2dnbGVDbGFzcyhcIm9wZW5lZFwiKTtcblxuICAgIGlmICghJCh0aGlzKS5oYXNDbGFzcyhcIm1hcmtlZFwiKSkge1xuICAgICAgJGxpbmUucmVtb3ZlQ2xhc3MoXCJtYXJrZWRcIik7XG4gICAgICAkKHRoaXMpLmFkZENsYXNzKFwibWFya2VkXCIpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaW5zdGFsbGF0aW9uLWFjY291bnRzLW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLmluc3RhbGxhdGlvbi1hY2NvdW50cy1tb2JpbGVfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLmluc3RhbGxhdGlvbi1hY2NvdW50cy1tb2JpbGVfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWUsXG4gICAgfVxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGRlbGl2ZXJ5QnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnN0YWxsYXRpb25fX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFkZWxpdmVyeUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZGF0ZVRleHQpIHtcbiAgLy8gICBvbkZpZWxkQ2hhbmdlKCk7XG4gIC8vIH0pO1xuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luc3RhbGxhdGlvbl9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIC8vIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgLy8gY29uc3Qgc3VibWl0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQnKTtcbiAgLy8gY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIC8vIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICAvLyBjb25zdCBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1kYXRlJyk7XG4gIC8vIGNvbnN0IHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgLy8gY29uc3QgY29uZmlybUNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoZWNrYm94X19pbnB1dCcpO1xuXG4gIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgLy9jb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAgIC8vICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG5cbiAgICAvLyAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgIC8vICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG5cbiAgICAvLyAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgLy8gICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgLy8gICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgIC8vICAgfVxuICAgIC8vIH1cblxuICAvLyAgIGRhdGVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHRpbWVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgJCgnI2RlbGl2ZXJ5LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAvLyB9XG5cbiAgLy8gY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gIC8vICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAvLyAgICAgb25DbG9zZUNsaWNrKCk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgLy8gY29uc3Qgb25GaWVsZENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoaXNGb3JtRmlsbGVkKCkgJiYgc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAvLyAgICAgc3VibWl0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgLy8gICB9IGVsc2UgaWYgKCFpc0Zvcm1GaWxsZWQoKSAmJiAhc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAvLyAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgLy8gY29uc3QgaXNGb3JtRmlsbGVkID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgcmV0dXJuICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignZ2V0RGF0ZScpXG4gIC8vICAgICAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnXG4gIC8vICAgICAmJiBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9PT0gdHJ1ZVxuICAvLyAgICAgLy8mJiBmaWxlSW5wdXQudmFsdWUgIT09ICcnXG4gIC8vIH1cblxuICAvLyBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIC8vIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIC8vIGRhdGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICAvLyB0aW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgLy9maWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWVsZENoYW5nZSk7XG4gIC8vY29uZmlybUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmllbGRDaGFuZ2UpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgcmFkaW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGl2ZXJ5LW9yLXBpY2t1cF9faW5zdGFsbGF0aW9uLWNob29zZS1ibG9jayAgaW5wdXQnKTtcblxuICBpZiAoIXJhZGlvc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHdyYXBwZXIgPSByYWRpb3NbMF0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcblxuICBmdW5jdGlvbiBvblJhZGlvQ2hhbmdlKCkge1xuICAgIGNvbnNvbGUubG9nKHdyYXBwZXIpO1xuICAgIGlmIChyYWRpb3NbMF0uY2hlY2tlZCkge1xuICAgICAgaWYgKCB3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItbWFudWFsJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1tYW51YWwnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCB3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItcmVnaXN0cmF0aW9uJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1yZWdpc3RyYXRpb24nKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCAhd3JhcHBlci5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3ctZm9yLWRlbGl2ZXJ5JykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKCdzaG93LWZvci1kZWxpdmVyeScpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyYWRpb3NbMV0uY2hlY2tlZCkge1xuICAgICAgaWYgKCB3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItbWFudWFsJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1tYW51YWwnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCB3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItZGVsaXZlcnknKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3ctZm9yLWRlbGl2ZXJ5Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmICggIXdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1yZWdpc3RyYXRpb24nKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Nob3ctZm9yLXJlZ2lzdHJhdGlvbicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyYWRpb3NbMl0uY2hlY2tlZCkge1xuICAgICAgaWYgKCB3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItZGVsaXZlcnknKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3ctZm9yLWRlbGl2ZXJ5Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmICggd3JhcHBlci5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3ctZm9yLXJlZ2lzdHJhdGlvbicpKSB7XG4gICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdy1mb3ItcmVnaXN0cmF0aW9uJyk7XG4gICAgICB9XG5cbiAgICAgIGlmICggIXdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1tYW51YWwnKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Nob3ctZm9yLW1hbnVhbCcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJhZGlvcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uUmFkaW9DaGFuZ2UpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHBheW1lbnRDb25maXJtQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tdXR1YWwtY2FsY3NfX21ha2UtcGF5bWVudCcpO1xuXG4gIGlmICghcGF5bWVudENvbmZpcm1CdG5zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5bWVudC13YWl0aW5nX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjb25zdCBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgLy8gY29uc3Qgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAvLyBjb25zdCBtYWluQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudHJhbnNhY3Rpb25zX19jaGVjay1hbGwgaW5wdXQnKTtcbiAgLy8gY29uc3Qgc2VuZGVySW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zZW5kZXIgaW5wdXQnKTtcbiAgLy8gY29uc3QgcmVjaXBpZW50SW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1yZWNpcGllbnQgaW5wdXQnKTtcbiAgLy8gY29uc3Qgc3VtSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zdW0gaW5wdXQnKTtcbiAgLy8gY29uc3QgcHVycG9zZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcHVycG9zZSBpbnB1dCcpO1xuXG4gIC8vIGNvbnN0IGdldEFsbENoZWNrYm94ID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgcmV0dXJuIG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2FjdGlvbnNfX2NoZWNrIGlucHV0Jyk7XG4gIC8vIH07XG5cbiAgLy8gY29uc3Qgb25BbGxDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgY29uc3Qgcm93ID0gaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAvLyAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gIC8vICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG4gIC8vICAgICAgIGlmICghcm93LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpKSB7XG4gIC8vICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgLy8gICAgICAgfVxuICAvLyAgICAgfSBlbHNlIHtcbiAgLy8gICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgICAgIGlmIChyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgLy8gICAgICAgICByb3cuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9XG4gIC8vICAgfSlcbiAgLy8gfTtcblxuICAvLyBjb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBtYWluQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAvLyAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgLy8gICAgIGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gIC8vICAgfSk7XG4gIC8vICAgJCgnI3BheW1lbnQtZGF0ZScpLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG4gIC8vICAgc2VuZGVySW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICByZWNpcGllbnRJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHN1bUlucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgcHVycG9zZUlucHV0LnZhbHVlID0gJyc7XG4gIC8vIH07XG5cbiAgLy8gY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gIC8vICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAvLyAgICAgb25DbG9zZUNsaWNrKCk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgLy8gY29uc3Qgb25DaGVja2JveENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2hlY2tlZCkge1xuICAvLyAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjaGVja2VkJyk7XG4gIC8vICAgfSBlbHNlIHtcbiAgLy8gICAgIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG4gIHBheW1lbnRDb25maXJtQnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgLy8gY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICAvLyBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuICAvLyBtYWluQ2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25BbGxDaGFuZ2UpO1xuICAvLyBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25DaGVja2JveENoYW5nZSk7XG4gIC8vIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBtZW51QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlcl9fbmF2LWJ0bicpO1xuXG4gIGlmICghbWVudUJ0bikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGNsb3NlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlcl9fY2xvc2UtYnRuJyk7XG4gIGNvbnN0IG5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkZXJfX25hdicpO1xuXG4gIGNvbnN0IGNoZWNrSWZUYWJsZXQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gd2luZG93Lm1hdGNoTWVkaWEoJyhtYXgtd2lkdGg6IDE0MzlweCknKS5tYXRjaGVzXG4gIH07XG5cbiAgbGV0IGlzVGFibGV0ID0gY2hlY2tJZlRhYmxldCgpO1xuXG4gIGNvbnN0IG9uQnRuQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoY2hlY2tJZlRhYmxldCgpKSB7XG4gICAgICBtZW51QnRuLmNsYXNzTGlzdC50b2dnbGUoJ2pzLW9wZW5lZCcpO1xuICAgICAgbmF2LmNsYXNzTGlzdC50b2dnbGUoJ2pzLXNob3cnKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICBuYXYuY2xhc3NMaXN0LnJlbW92ZSgnanMtc2hvdycpO1xuICAgIG1lbnVCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnanMtb3BlbmVkJyk7XG4gIH1cblxuICBtZW51QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25CdG5DbGljayk7XG4gIGNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNvbnRyYWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tdXR1YWwtY2FsY3MtcGF5bWVudC1tb2JpbGUnKTtcblxuICBpZiAoIWNvbnRyYWN0cykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHNsaWRlciA9IG5ldyBTd2lwZXIoJy5tdXR1YWwtY2FsY3MtcGF5bWVudC1tb2JpbGVfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLm11dHVhbC1jYWxjcy1wYXltZW50LW1vYmlsZV9fcGFnaW5hdGlvbicsXG4gICAgICBkeW5hbWljQnVsbGV0czogdHJ1ZSxcbiAgICB9XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgY29udHJhY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm11dHVhbC1jYWxjcy1ibG9jay1tb2JpbGUnKTtcblxuICBpZiAoIWNvbnRyYWN0cykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHNsaWRlciA9IG5ldyBTd2lwZXIoJy5tdXR1YWwtY2FsY3MtYmxvY2stbW9iaWxlX19zbGlkZXInLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy5tdXR1YWwtY2FsY3MtYmxvY2stbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlLFxuICAgIH1cbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBwYXNzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXBhc3N3b3JkJyk7XG5cbiAgaWYgKCFwYXNzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5pbnB1dC1pY29uLS1zaG93LXBhc3N3b3JkJywgZnVuY3Rpb24oKXtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcblxuICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuICAgICAgJCh0aGlzKS5uZXh0KCkuYXR0cigndHlwZScsICd0ZXh0Jyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQodGhpcykubmV4dCgpLmF0dHIoJ3R5cGUnLCAncGFzc3dvcmQnKTtcbiAgICB9XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgcGF5bWVudENvbmZpcm1CdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBheW1lbnQtd2FpdGluZ19fY29uZmlybS1idG4nKTtcblxuICBpZiAoIXBheW1lbnRDb25maXJtQnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vJCgnI3BheW1lbnQtZGF0ZScpLmRhdGVwaWNrZXIoKTtcblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXltZW50LXdhaXRpbmdfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuICAvLyBjb25zdCBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgLy8gY29uc3Qgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAvLyBjb25zdCBtYWluQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudHJhbnNhY3Rpb25zX19jaGVjay1hbGwgaW5wdXQnKTtcbiAgLy8gY29uc3Qgc2VuZGVySW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zZW5kZXIgaW5wdXQnKTtcbiAgLy8gY29uc3QgcmVjaXBpZW50SW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1yZWNpcGllbnQgaW5wdXQnKTtcbiAgLy8gY29uc3Qgc3VtSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zdW0gaW5wdXQnKTtcbiAgLy8gY29uc3QgcHVycG9zZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcHVycG9zZSBpbnB1dCcpO1xuXG4gIC8vIGNvbnN0IGdldEFsbENoZWNrYm94ID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgcmV0dXJuIG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2FjdGlvbnNfX2NoZWNrIGlucHV0Jyk7XG4gIC8vIH07XG5cbiAgLy8gY29uc3Qgb25BbGxDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgY29uc3Qgcm93ID0gaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAvLyAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gIC8vICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG4gIC8vICAgICAgIGlmICghcm93LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpKSB7XG4gIC8vICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgLy8gICAgICAgfVxuICAvLyAgICAgfSBlbHNlIHtcbiAgLy8gICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgICAgIGlmIChyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgLy8gICAgICAgICByb3cuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9XG4gIC8vICAgfSlcbiAgLy8gfTtcblxuICAvLyBjb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBtYWluQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAvLyAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgLy8gICAgIGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gIC8vICAgfSk7XG4gIC8vICAgJCgnI3BheW1lbnQtZGF0ZScpLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG4gIC8vICAgc2VuZGVySW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICByZWNpcGllbnRJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHN1bUlucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgcHVycG9zZUlucHV0LnZhbHVlID0gJyc7XG4gIC8vIH07XG5cbiAgLy8gY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gIC8vICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAvLyAgICAgb25DbG9zZUNsaWNrKCk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgLy8gY29uc3Qgb25DaGVja2JveENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2hlY2tlZCkge1xuICAvLyAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjaGVja2VkJyk7XG4gIC8vICAgfSBlbHNlIHtcbiAgLy8gICAgIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG4gIHBheW1lbnRDb25maXJtQnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgLy8gY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICAvLyBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuICAvLyBtYWluQ2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25BbGxDaGFuZ2UpO1xuICAvLyBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25DaGVja2JveENoYW5nZSk7XG4gIC8vIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAvLyBjb25zdCBwYXltZW50Q29uZmlybUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGF5bWVudC13YWl0aW5nX19jb25maXJtLWJ0bicpO1xuXG4gIC8vIGlmICghcGF5bWVudENvbmZpcm1CdG5zWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5bWVudC13YWl0aW5nX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgY29uc3Qgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICBjb25zdCBtYWluQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudHJhbnNhY3Rpb25zX19jaGVjay1hbGwgaW5wdXQnKTtcbiAgY29uc3Qgc2VuZGVySW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zZW5kZXIgaW5wdXQnKTtcbiAgY29uc3QgcmVjaXBpZW50SW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1yZWNpcGllbnQgaW5wdXQnKTtcbiAgY29uc3Qgc3VtSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zdW0gaW5wdXQnKTtcbiAgY29uc3QgcHVycG9zZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcHVycG9zZSBpbnB1dCcpO1xuXG4gIGNvbnN0IGdldEFsbENoZWNrYm94ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2FjdGlvbnNfX2NoZWNrIGlucHV0Jyk7XG4gIH07XG5cbiAgY29uc3QgZ2V0QWxsTW9iaWxlQ2hlY2tib3ggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fbW9iaWxlLWNoZWNrIGlucHV0Jyk7XG4gIH1cblxuICBjb25zdCBvbkFsbENoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICBjb25zdCByb3cgPSBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG4gICAgICBpZiAobWFpbkNoZWNrYm94LmNoZWNrZWQpIHtcbiAgICAgICAgaXRlbS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgaWYgKCFyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgnY2hlY2tlZCcpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHJvdy5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrZWQnKSkge1xuICAgICAgICAgIHJvdy5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICB9O1xuXG4gIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIG1haW5DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG5cbiAgICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gICAgICBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAgIH0pO1xuXG4gICAgZ2V0QWxsTW9iaWxlQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gICAgfSk7XG5cbiAgICAkKCcjcGF5bWVudC1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgICBzZW5kZXJJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHJlY2lwaWVudElucHV0LnZhbHVlID0gJyc7XG4gICAgc3VtSW5wdXQudmFsdWUgPSAnJztcbiAgICBwdXJwb3NlSW5wdXQudmFsdWUgPSAnJztcbiAgfTtcblxuICBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBvbkNoZWNrYm94Q2hhbmdlID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7XG4gICAgICBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgb25Nb2JpbGVDaGVja2JveENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2hlY2tlZCkge1xuICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnY2hlY2tlZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gICAgfVxuICB9XG5cbiAgLy8gcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7XG4gIC8vICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICAvLyB9KTtcblxuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIG1haW5DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkFsbENoYW5nZSk7XG4gIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkNoZWNrYm94Q2hhbmdlKTtcbiAgfSlcblxuICBnZXRBbGxNb2JpbGVDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25Nb2JpbGVDaGVja2JveENoYW5nZSk7XG4gIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBwYXltZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tdXR1YWwtY2FsY3MtcGF5bWVudC1ibG9ja19fbGluaycpO1xuXG4gIGlmICghcGF5bWVudHNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXltZW50LWluZm9fX21vZGFsJyk7XG5cbiAgcGF5bWVudHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgfSlcblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbi8vICAgdmFyIGpiU2Nhbm5lcjtcblxuXG4vLyBmdW5jdGlvbiBvblFSQ29kZVNjYW5uZWQoc2Nhbm5lZFRleHQpIHtcbi8vICAgdmFyIHNjYW5uZWRUZXh0TWVtbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc3Vic2NyaWJlLXJlZ2lzdGVyX19pbnB1dCAgaW5wdXRcIik7XG4vLyAgIGNvbnNvbGUubG9nKHNjYW5uZWRUZXh0TWVtbyk7XG4vLyAgIGlmKHNjYW5uZWRUZXh0TWVtbylcbi8vICAge1xuLy8gICAgICAgc2Nhbm5lZFRleHRNZW1vLnZhbHVlID0gc2Nhbm5lZFRleHQ7XG4vLyAgICAgICAkKFwiLnFyLXNjYW5uZXItbW9kYWxcIikucmVtb3ZlQ2xhc3MoXCJqcy1zaG93XCIpO1xuLy8gICAgICAgamJTY2FubmVyLnN0b3BTY2FubmluZygpO1xuLy8gICB9XG4vLyB9XG5cblxuLy8gICAgICAgICAgICAgZnVuY3Rpb24gcHJvdmlkZVZpZGVvKClcbi8vICAgICAgICAgICAgIHtcbi8vICAgICAgICAgICAgICAgICB2YXIgbiA9IG5hdmlnYXRvcjtcblxuLy8gICAgICAgICAgICAgICAgIGlmIChuLm1lZGlhRGV2aWNlcyAmJiBuLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpXG4vLyAgICAgICAgICAgICAgICAge1xuLy8gICAgICAgICAgICAgICAgICAgcmV0dXJuIG4ubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7XG4vLyAgICAgICAgICAgICAgICAgICAgIHZpZGVvOiB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgZmFjaW5nTW9kZTogXCJlbnZpcm9ubWVudFwiXG4vLyAgICAgICAgICAgICAgICAgICAgIH0sXG4vLyAgICAgICAgICAgICAgICAgICAgIGF1ZGlvOiBmYWxzZVxuLy8gICAgICAgICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgICAgICAgICAgfVxuXG4vLyAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdZb3VyIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBnZXRVc2VyTWVkaWEnKTtcbi8vICAgICAgICAgICAgIH1cblxuXG4vLyAgICAgICAgICAgICBmdW5jdGlvbiBwcm92aWRlVmlkZW9RUSgpXG4vLyAgICAgICAgICAgICB7XG4vLyAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcygpXG4vLyAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oZGV2aWNlcykge1xuLy8gICAgICAgICAgICAgICAgICAgICB2YXIgZXhDYW1lcmFzID0gW107XG4vLyAgICAgICAgICAgICAgICAgICAgIGRldmljZXMuZm9yRWFjaChmdW5jdGlvbihkZXZpY2UpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgaWYgKGRldmljZS5raW5kID09PSAndmlkZW9pbnB1dCcpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgZXhDYW1lcmFzLnB1c2goZGV2aWNlLmRldmljZUlkKVxuLy8gICAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICAgfSk7XG5cbi8vICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShleENhbWVyYXMpO1xuLy8gICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oaWRzKXtcbi8vICAgICAgICAgICAgICAgICAgICAgaWYoaWRzLmxlbmd0aCA9PT0gMClcbi8vICAgICAgICAgICAgICAgICAgICAge1xuLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ0NvdWxkIG5vdCBmaW5kIGEgd2ViY2FtJyk7XG4vLyAgICAgICAgICAgICAgICAgICAgIH1cblxuLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW86IHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICdvcHRpb25hbCc6IFt7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3NvdXJjZUlkJzogaWRzLmxlbmd0aCA9PT0gMSA/IGlkc1swXSA6IGlkc1sxXS8vdGhpcyB3YXkgUVEgYnJvd3NlciBvcGVucyB0aGUgcmVhciBjYW1lcmFcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XVxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICAgIH1cblxuXG5cblxuXG5cblxuLy8gICAkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnN1YnNjcmliZS1yZWdpc3Rlcl9fYnRuXCIsIChlKSA9PiB7XG5cblxuXG4vLyAgICAgICAgICAgICAgIGlmIChqYlNjYW5uZXIpIHtcbi8vICAgICAgICAgICAgICAgICAgIGpiU2Nhbm5lci5yZXN1bWVTY2FubmluZygpO1xuLy8gICAgICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgICAgamJTY2FubmVyID0gbmV3IEpzUVJTY2FubmVyKG9uUVJDb2RlU2Nhbm5lZCk7XG4vLyAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhqYlNjYW5uZXIpO1xuLy8gICAgICAgICAgICAgICAgICAgamJTY2FubmVyLnNldFNuYXBJbWFnZU1heFNpemUoMzAwKTtcbi8vICAgICAgICAgICAgICAgICAgIHZhciBzY2FubmVyUGFyZW50RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwianMtdmlkZW8tYm94XCIpO1xuLy8gICAgICAgICAgICAgICAgICAgaWYoc2Nhbm5lclBhcmVudEVsZW1lbnQpXG4vLyAgICAgICAgICAgICAgICAgICB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgLy9hcHBlbmQgdGhlIGpiU2Nhbm5lciB0byBhbiBleGlzdGluZyBET00gZWxlbWVudFxuLy8gICAgICAgICAgICAgICAgICAgICAgIGpiU2Nhbm5lci5hcHBlbmRUbyhzY2FubmVyUGFyZW50RWxlbWVudCk7XG4vLyAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgIH1cblxuXG5cblxuLy8gICB9KTtcblxuLy8gICAkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnFyLXNjYW5uZXItbW9kYWwgLnFyLXNjYW5uZXItbW9kYWxfX2Nsb3NlXCIsIChlKSA9PiB7XG4vLyAgICAgICBqYlNjYW5uZXIuc3RvcFNjYW5uaW5nKCk7XG4vLyAgIH0pO1xuXG5cbnZhciBzY2FubmVyUGFyZW50RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwianMtdmlkZW8tYm94XCIpO1xudmFyIGpiU2Nhbm5lcjtcblxuICAkKCcuc3Vic2NyaWJlLXJlZ2lzdGVyX19pbnB1dCAuaW5wdXQtdGV4dCcpLmVhY2goZnVuY3Rpb24oaW5kZXgsIHZhbHVlKSB7XG5cbiAgICBjb25zdCAkaW5wdXQgPSAkKHRoaXMpO1xuXG4gICAgLy8gZnVuY3Rpb24gb25RUkNvZGVTY2FubmVkKHNjYW5uZWRUZXh0KSB7XG5cbiAgICAvLyAgICAgICAkaW5wdXQudmFsKHNjYW5uZWRUZXh0KTtcbiAgICAvLyAgICAgICAkKFwiLnFyLXNjYW5uZXItbW9kYWxcIikucmVtb3ZlQ2xhc3MoXCJqcy1zaG93XCIpO1xuICAgIC8vICAgICAgIGpiU2Nhbm5lci5zdG9wU2Nhbm5pbmcoKTtcblxuICAgIC8vIH1cblxuICAgIGZ1bmN0aW9uIG9uUVJDb2RlU2Nhbm5lZChlbCkge1xuXG4gICAgICByZXR1cm4gZnVuY3Rpb24oc2Nhbm5lZFRleHQpIHtcblxuICAgICAgICBlbC52YWwoc2Nhbm5lZFRleHQpO1xuICAgICAgICAkKFwiLnFyLXNjYW5uZXItbW9kYWxcIikucmVtb3ZlQ2xhc3MoXCJqcy1zaG93XCIpO1xuICAgICAgICBqYlNjYW5uZXIuc3RvcFNjYW5uaW5nKCk7XG4gICAgICAgIGpiU2Nhbm5lci5yZW1vdmVGcm9tKHNjYW5uZXJQYXJlbnRFbGVtZW50KTtcbiAgICAgIH1cblxuICAgIH1cblxuXG4gICAgICAgICAgICBmdW5jdGlvbiBwcm92aWRlVmlkZW8oKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHZhciBuID0gbmF2aWdhdG9yO1xuXG4gICAgICAgICAgICAgICAgaWYgKG4ubWVkaWFEZXZpY2VzICYmIG4ubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSlcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gbi5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHtcbiAgICAgICAgICAgICAgICAgICAgdmlkZW86IHtcbiAgICAgICAgICAgICAgICAgICAgICBmYWNpbmdNb2RlOiBcImVudmlyb25tZW50XCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYXVkaW86IGZhbHNlXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ1lvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IGdldFVzZXJNZWRpYScpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHByb3ZpZGVWaWRlb1FRKClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKClcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkZXZpY2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBleENhbWVyYXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZGV2aWNlcy5mb3JFYWNoKGZ1bmN0aW9uKGRldmljZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGV2aWNlLmtpbmQgPT09ICd2aWRlb2lucHV0Jykge1xuICAgICAgICAgICAgICAgICAgICBleENhbWVyYXMucHVzaChkZXZpY2UuZGV2aWNlSWQpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGV4Q2FtZXJhcyk7XG4gICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihpZHMpe1xuICAgICAgICAgICAgICAgICAgICBpZihpZHMubGVuZ3RoID09PSAwKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnQ291bGQgbm90IGZpbmQgYSB3ZWJjYW0nKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7XG4gICAgICAgICAgICAgICAgICAgICAgICB2aWRlbzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ29wdGlvbmFsJzogW3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlSWQnOiBpZHMubGVuZ3RoID09PSAxID8gaWRzWzBdIDogaWRzWzFdLy90aGlzIHdheSBRUSBicm93c2VyIG9wZW5zIHRoZSByZWFyIGNhbWVyYVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG5cblxuXG5cblxuXG4gICAgJGlucHV0LnNpYmxpbmdzKCcuc3Vic2NyaWJlLXJlZ2lzdGVyX19idG4nKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG5cblxuXG5cbiAgICAgIGpiU2Nhbm5lciA9IG5ldyBKc1FSU2Nhbm5lcihvblFSQ29kZVNjYW5uZWQoJGlucHV0KSk7XG4gICAgICAvL2NvbnNvbGUubG9nKGpiU2Nhbm5lcik7XG4gICAgICBqYlNjYW5uZXIuc2V0U25hcEltYWdlTWF4U2l6ZSgzMDApO1xuICAgICAgLy92YXIgc2Nhbm5lclBhcmVudEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImpzLXZpZGVvLWJveFwiKTtcbiAgICAgIGlmKHNjYW5uZXJQYXJlbnRFbGVtZW50KVxuICAgICAge1xuICAgICAgICBzY2FubmVyUGFyZW50RWxlbWVudC5pbm5lckhUTUwgPSAnJztcbiAgICAgICAgICAvL2FwcGVuZCB0aGUgamJTY2FubmVyIHRvIGFuIGV4aXN0aW5nIERPTSBlbGVtZW50XG4gICAgICAgICAgamJTY2FubmVyLmFwcGVuZFRvKHNjYW5uZXJQYXJlbnRFbGVtZW50KTtcbiAgICAgIH1cblxuXG5cblxuXG4gICAgfSk7XG4gIH0pXG5cbiAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5xci1zY2FubmVyLW1vZGFsIC5xci1zY2FubmVyLW1vZGFsX19jbG9zZVwiLCAoZSkgPT4ge1xuICAgICAgamJTY2FubmVyLnN0b3BTY2FubmluZygpO1xuICAgICAgamJTY2FubmVyLnJlbW92ZUZyb20oc2Nhbm5lclBhcmVudEVsZW1lbnQpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCAkYnRuID0gJChcIi5yZXBvcnRzX19kb3dubG9hZC1idG5cIik7XG4gIGNvbnN0ICRkcm9wZG93biA9ICQoXCIucmVwb3J0c19fZG93bmxvYWQtZHJvcGRvd25cIik7XG5cbiAgaWYgKCRidG4ubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJGJ0bi5vbihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zdCBpc09wZW5lZCA9ICQodGhpcykubmV4dCgpLmhhc0NsYXNzKFwic2hvd25cIik7XG5cbiAgICAkZHJvcGRvd24ucmVtb3ZlQ2xhc3MoXCJzaG93blwiKTtcblxuICAgICFpc09wZW5lZCAmJiAkKHRoaXMpLm5leHQoKS5hZGRDbGFzcyhcInNob3duXCIpO1xuICB9KTtcblxuICAkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgY29uc3QgJHRhcmdldCA9ICQoZS50YXJnZXQpO1xuXG4gICAgaWYgKFxuICAgICAgJHRhcmdldC5oYXNDbGFzcyhcInJlcG9ydHNfX2Rvd25sb2FkLWJ0blwiKSB8fFxuICAgICAgJHRhcmdldC5wYXJlbnRzKFwiLnJlcG9ydHNfX2Rvd25sb2FkLWJ0blwiKS5sZW5ndGggPiAwIHx8XG4gICAgICAkdGFyZ2V0Lmhhc0NsYXNzKFwicmVwb3J0c19fZG93bmxvYWQtZHJvcGRvd25cIikgfHxcbiAgICAgICR0YXJnZXQucGFyZW50cyhcIi5yZXBvcnRzX19kb3dubG9hZC1kcm9wZG93blwiKS5sZW5ndGggPiAwXG4gICAgKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgICRkcm9wZG93bi5yZW1vdmVDbGFzcyhcInNob3duXCIpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCByZXdhcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3Vic2NyaXB0aW9uLXBhZ2VfX3Jld2FyZC1tb2JpbGUnKTtcblxuICBpZiAoIXJld2FyZCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHNsaWRlciA9IG5ldyBTd2lwZXIoJy5zdWJzY3JpcHRpb24tcGFnZV9fcmV3YXJkLW1vYmlsZScsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLnN1YnNjcmlwdGlvbi1wYWdlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlLFxuICAgIH1cbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBzY2hlZHVsZUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtZGV2aWNlX19zY2hlZHVsZScpO1xuXG4gIGlmICghc2NoZWR1bGVCdG5zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NoZWR1bGVfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNvbnN0IHJhZGlvcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zY2hlZHVsZV9fbW9kYWwtdG9nZ2xlIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHRvZ2dsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZV9fbW9kYWwtdG9nZ2xlJyk7XG5cbiAgLy8gcmFkaW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaWQpIHtcbiAgLy8gICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAvLyAgICAgaWYgKGlkID09PSAwKSB7XG4gIC8vICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QucmVtb3ZlKCdzZWNvbmQtdGFiJyk7XG4gIC8vICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QuYWRkKCdmaXJzdC10YWInKTtcbiAgLy8gICAgIH1cblxuICAvLyAgICAgaWYgKGlkID09PSAxKSB7XG4gIC8vICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QucmVtb3ZlKCdmaXJzdC10YWInKTtcbiAgLy8gICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5hZGQoJ3NlY29uZC10YWInKTtcbiAgLy8gICAgIH1cbiAgLy8gICB9KVxuICAvLyB9KVxuXG4gIHNjaGVkdWxlQnRucy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIC8vIGNvbnN0IHNjaGVkdWxlQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1kZXZpY2VfX3NjaGVkdWxlJyk7XG5cbiAgLy8gaWYgKCFzY2hlZHVsZUJ0bnNbMF0pIHtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2hlZHVsZV9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgcmFkaW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNjaGVkdWxlX19tb2RhbC10b2dnbGUgaW5wdXQnKTtcbiAgY29uc3QgdG9nZ2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlX19tb2RhbC10b2dnbGUnKTtcblxuICByYWRpb3MuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpZCkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoaWQgPT09IDApIHtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5yZW1vdmUoJ3NlY29uZC10YWInKTtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5hZGQoJ2ZpcnN0LXRhYicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaWQgPT09IDEpIHtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5yZW1vdmUoJ2ZpcnN0LXRhYicpO1xuICAgICAgICB0b2dnbGUuY2xhc3NMaXN0LmFkZCgnc2Vjb25kLXRhYicpO1xuICAgICAgfVxuICAgIH0pXG4gIH0pXG5cbiAgLy8gc2NoZWR1bGVCdG5zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIC8vIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IG1haW5QYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1haW4tcGFnZScpO1xuXG4gIGlmICghbWFpblBhZ2UpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBzdXBwb3J0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1cHBvcnQnKTtcbiAgY29uc3Qgc3VwcG9ydENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdXBwb3J0X19jb250YWluZXInKTtcbiAgY29uc3QgaXRlbXMgPSBzdXBwb3J0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdXBwb3J0X19pdGVtJyk7XG5cbiAgZnVuY3Rpb24gbWFrZVNsaWRlcigpIHtcbiAgICBjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc3dpcGVyLWNvbnRhaW5lcicpO1xuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdzdXBwb3J0X19zbGlkZXInKTtcbiAgICBjb25zdCB3cmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKCdzd2lwZXItd3JhcHBlcicpO1xuXG4gICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpZHgpIHtcbiAgICAgIGNvbnN0IHNsaWRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBzbGlkZS5jbGFzc0xpc3QuYWRkKCdzd2lwZXItc2xpZGUnKVxuICAgICAgY29uc3Qgbm9kZSA9IGl0ZW0uY2xvbmVOb2RlKHRydWUpO1xuICAgICAgc2xpZGUuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgICB3cmFwcGVyLmFwcGVuZENoaWxkKHNsaWRlKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHBhZ2luYXRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBwYWdpbmF0aW9uLmNsYXNzTGlzdC5hZGQoJ3N1cHBvcnRfX3NsaWRlci1wYWdpbmF0aW9uJywnc3dpcGVyLXBhZ2luYXRpb24nKTtcblxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh3cmFwcGVyKTtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocGFnaW5hdGlvbik7XG4gICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoY29udGFpbmVyKTtcblxuICAgIHN1cHBvcnRDb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuXG4gICAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLnN1cHBvcnRfX3NsaWRlcicsIHtcbiAgICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgICBwYWdpbmF0aW9uOiB7XG4gICAgICAgIGVsOiAnLnN1cHBvcnRfX3NsaWRlci1wYWdpbmF0aW9uJ1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgbWFrZVNsaWRlcigpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJCgnLnN1cHBvcnRfX2RvY3MtYnRuJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHRyYW5zYWN0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50cmFuc2FjdGlvbnMtbW9iaWxlLWJsb2NrJyk7XG5cbiAgaWYgKCF0cmFuc2FjdGlvbnMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBzbGlkZXIgPSBuZXcgU3dpcGVyKCcudHJhbnNhY3Rpb25zLW1vYmlsZS1ibG9ja19fc2xpZGVyJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcudHJhbnNhY3Rpb25zLW1vYmlsZS1ibG9ja19fcGFnaW5hdGlvbicsXG4gICAgICBkeW5hbWljQnVsbGV0czogdHJ1ZSxcbiAgICB9XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJCgnLmhlYWRlcl9fdXNlci1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgaWYgKCQodGhpcykuaXMoZS50YXJnZXQpKSB7XG4gICAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcbiAgICB9XG4gIH0pO1xuXG4gICQoZG9jdW1lbnQpLm9uKCdtb3VzZXVwJywgZnVuY3Rpb24oZSkge1xuICAgIHZhciBibG9jayA9ICQoJy5oZWFkZXJfX3VzZXItYnRuJyk7XG5cbiAgICBpZiAoIWJsb2NrLmlzKGUudGFyZ2V0KSAmJiBibG9jay5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMCkge1xuICAgICAgYmxvY2sucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG5cbiAgaWYgKCF2ZXJpZmljYXRpb25CdG5bMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ZXJpZmljYXRpb25fX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNvbnN0IGZpbGVJbnB1dEJsb2NrID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnZlcmlmaWNhdGlvbl9fbW9kYWwtaW5wdXQtZmlsZScpO1xuICAvLyBjb25zdCBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgLy8gY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIC8vIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgLy8gY29uc3Qgc2F2ZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIC8vIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIGlmIChmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QuY29udGFpbnMoJ2xvYWRlZCcpKSB7XG4gIC8vICAgICBmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcblxuICAvLyAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgICBzYXZlQnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG5cbiAgLy8gICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gIC8vICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gIC8vICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAvLyAgICAgfVxuICAvLyAgIH1cbiAgLy8gfVxuXG4gIC8vIGNvbnN0IG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAvLyAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgLy8gICAgIG9uQ2xvc2VDbGljaygpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG4gIC8vIGNvbnN0IG9uSW5wdXRDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBpZiAoZmlsZUlucHV0LnZhbHVlICE9PSAnJykge1xuICAvLyAgICAgc2F2ZUJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgdmVyaWZpY2F0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pXG5cbiAgLy8gY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICAvLyBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuICAvLyBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25JbnB1dENoYW5nZSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAvLyBjb25zdCB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG5cbiAgLy8gaWYgKCF2ZXJpZmljYXRpb25CdG5bMF0pIHtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ZXJpZmljYXRpb25fX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGZpbGVJbnB1dEJsb2NrID0gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnZlcmlmaWNhdGlvbl9fbW9kYWwtaW5wdXQtZmlsZScpO1xuICAvL2NvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICAvL2NvbnN0IGZpbGVDbGVhciA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG5cbiAgY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgY29uc3Qgc2F2ZUJ0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIGZpbGVJbnB1dEJsb2NrLmZvckVhY2goZnVuY3Rpb24oaW5wdXRCbG9jaykge1xuICAgICAgY29uc3QgZmlsZUlucHV0ID0gaW5wdXRCbG9jay5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcblxuICAgICAgaWYgKGlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAgICAgICBpbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuXG4gICAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgICBzYXZlQnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG5cbiAgICAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGNvbnN0IGNoZWNrSW5wdXRzID0gZnVuY3Rpb24oKSB7XG4gICAgbGV0IGZpbGxlZCA9IHRydWU7XG5cbiAgICBmaWxlSW5wdXRCbG9jay5mb3JFYWNoKGZ1bmN0aW9uKGlucHV0QmxvY2spIHtcbiAgICAgIGNvbnN0IGZpbGVJbnB1dCA9IGlucHV0QmxvY2sucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG5cbiAgICAgIGlmIChmaWxlSW5wdXQudmFsdWUgPT09ICcnKSB7XG4gICAgICAgIGZpbGxlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKGZpbGxlZCAmJiBzYXZlQnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc2F2ZUJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfVxuXG4gICAgaWYgKCFmaWxsZWQgJiYgIXNhdmVCdG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBzYXZlQnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAgICAgb25DbG9zZUNsaWNrKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gY29uc3Qgb25JbnB1dENoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIGlmIChmaWxlSW5wdXQudmFsdWUgIT09ICcnKSB7XG4gIC8vICAgICBzYXZlQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgLy8gICB9XG4gIC8vIH1cblxuICBjb25zdCBvbkZpbGVDbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICghc2F2ZUJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHNhdmVCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH1cblxuICAvLyB2ZXJpZmljYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgLy8gfSlcblxuICB3aW5kb3cub25WZXJpZmljYXRpb25GaWxlRHJvcCA9IGZ1bmN0aW9uKCkge1xuICAgIGNoZWNrSW5wdXRzKCk7XG4gIH07XG5cbiAgZmlsZUlucHV0QmxvY2suZm9yRWFjaChmdW5jdGlvbihpbnB1dEJsb2NrKSB7XG4gICAgY29uc3QgZmlsZUlucHV0ID0gaW5wdXRCbG9jay5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgICBjb25zdCBmaWxlQ2xlYXIgPSBpbnB1dEJsb2NrLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG5cblxuICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cub25WZXJpZmljYXRpb25GaWxlRHJvcCk7XG4gICAgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25GaWxlQ2xlYXIpO1xuICB9KVxuXG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX19zZXJpYWwtYnRuJyk7XG5cbiAgaWYgKCFjYW5jZWxsYXRpb25CdG5bMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3cml0ZS1zZXJpYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY2FuY2VsbGF0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xuXG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIC8vIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcblxuICAvLyBpZiAoIXZlcmlmaWNhdGlvbkJ0blswXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dyaXRlLXNlcmlhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBpbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy53cml0ZS1zZXJpYWxfX2lucHV0IC5pbnB1dC10ZXh0Jyk7XG4gIGNvbnN0IGJ0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIGNvbnN0IG9uSW5wdXQgPSBmdW5jdGlvbihlKSB7XG4gICAgY29uc3QgdmFsdWUgPSBlLnRhcmdldC52YWx1ZTtcblxuICAgIGlmIChcbiAgICAgIHZhbHVlLnNwbGl0KCcgJykuam9pbignJykgIT09ICcnXG4gICAgICAmJiB2YWx1ZS5sZW5ndGggPiAwXG4gICAgICAmJiBidG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgKSB7XG4gICAgICBidG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpXG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgdmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJydcbiAgICAgIHx8IHZhbHVlLmxlbmd0aCA9PT0gMFxuICAgICkge1xuICAgICAgaWYgKCFidG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICAgIGJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KVxuXG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25JbnB1dCk7XG59KSgpO1xuIl19
