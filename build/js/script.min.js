"use strict";!function(){var e=document.querySelectorAll(".checkbox-2__input");e[0]&&e.forEach((function(e){e.addEventListener("change",(function(e){var t=e.target;!0===t.checked?t.parentNode.classList.add("checked"):t.parentNode.classList.remove("checked")}))}))}(),$(".date-input:not(.date-input-range)").datepicker({dateFormat:"dd.mm.yy"}),$(".date-input-range").datepicker({range:"period",inline:!0,showButtonPanel:!0,showOtherMonths:!0,selectOtherMonths:!0,closeText:"Готово",dateFormat:"dd.mm.yy",beforeShow:function(e,t){t.dpDiv.css("transform","translateX(-24px)"),t.dpDiv.addClass("calendar-range")},onSelect:function(e,t,n){t.input.val(n.startDateText+" - "+n.endDateText)}}),function(){var e=document.querySelectorAll(".input-file__label");function t(e){var t=e.querySelector("input"),n=e.parentNode.querySelector(".file-load__clear");function i(e){e.preventDefault(),e.stopPropagation()}function a(t){e.classList.add("highlight")}function o(t){e.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,i,!1)})),["dragenter","dragover"].forEach((function(t){e.addEventListener(t,a,!1)})),["dragleave","drop"].forEach((function(t){e.addEventListener(t,o,!1)})),e.addEventListener("drop",(function(e){var n=e.dataTransfer.files;t.files&&t.files[0]&&(t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file"));t.files=n,c(),window.onVerificationFileDrop&&window.onVerificationFileDrop(),window.onDeliveryFileDrop&&window.onDeliveryFileDrop(),window.onInstallationFileDrop&&window.onInstallationFileDrop()}),!1);var c=function(){r(t)},r=function(t){if(t.files&&t.files[0]){var n=new FileReader;n.onload=function(n){e.parentNode.classList.add("loaded"),e.nextElementSibling.querySelector(".file-load__name").textContent=t.files[0].name},n.readAsDataURL(t.files[0])}};t.addEventListener("change",c),n.addEventListener("click",(function(){e.parentNode.classList.remove("loaded"),t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file")}))}window.makeFileLoad=t,e[0]&&e.forEach((function(e){t(e)}))}(),function(){var e=document.querySelectorAll(".input-text");e[0]&&e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))}))}(),function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));var t,n,i=document.querySelector("body");function a(e,t){this.trigger=e,this.modal=t,this.overlay=this.modal.querySelector(".modal__overlay"),this.closeBtn=this.modal.querySelector(".modal__close"),this.onOverlayClick=this.onOverlayClick.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onTriggerClick=this.onTriggerClick.bind(this),this.addEventListeners()}window.addEventListener("resize",(t=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))},function(e){n&&clearTimeout(n),n=setTimeout(t,100,e)})),a.prototype.open=function(){this.modal.classList.add("js-show"),i.classList.add("js__body-no-scroll")},a.prototype.close=function(){this.modal.classList.remove("js-show"),i.classList.remove("js__body-no-scroll")},a.prototype.onOverlayClick=function(e){e.target===this.overlay&&this.close()},a.prototype.onCloseClick=function(){this.close()},a.prototype.onTriggerClick=function(){this.open()},a.prototype.addEventListeners=function(){this.overlay.addEventListener("click",this.onOverlayClick),this.closeBtn.addEventListener("click",this.onCloseClick),this.trigger.addEventListener("click",this.onTriggerClick)},window.Modal=a}(),$(".input-money").mask("# ##0 ₽",{reverse:!0}),function(){var e=document.querySelectorAll(".input-phone");if(e[0]){var t=new Inputmask("+7(999) 999-99-99");e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelectorAll(".search"),t=document.querySelectorAll(".search + .search-close");e[0]&&(e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))})),t.forEach((function(e){e.addEventListener("click",(function(){var t=e.previousElementSibling;t.value="",t.classList.contains("js-inputed")&&t.classList.remove("js-inputed")}))})))}(),function(){function e(e){var t=e.text.split("splitter"),n=window.matchMedia("(max-width: 999px)").matches?"<br>":"";return t.length>1?$("<span>"+t[0]+"</span>"+n+"<span>"+t[1]+"</span>"):e.text}$(".select").select2({templateResult:e,templateSelection:e}),$(".select").on("select2:select",(function(e){$(this).addClass("picked")}))}(),function(){var e=document.querySelectorAll(".delivery-or-pickup__modal-time");if(e[0]){var t=new Inputmask("99:99");e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelectorAll(".account-creation__new");if(e[0]){var t=document.getElementById("account-creation");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){if(document.getElementById("account-creation")){var e=$(".account-creation__input .input-text"),t=$("#account-creation .modal__save");e.on("input",(function(n){0===e.filter((function(){return""===this.value.split(" ").join("")||0===this.value.length})).length?t.removeAttr("disabled"):t.attr("disabled","")}))}}(),function(){if(document.querySelector(".agents__users-block-mobile")){new Swiper(".agents__users-block-mobile__slider",{slidesPerView:1,pagination:{el:".agents__users-block-mobile__pagination",dynamicBullets:!0}});$(".agents__users-btn").parent().next().slideToggle()}}(),$(".agents__users-btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){var e=document.querySelectorAll(".contract-info__cancellation");if(e[0]){var t=document.getElementById("cancellation__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.querySelectorAll(".user-settings__change-email");if(e[0]){var t=document.getElementById("change-email");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.getElementById("change-email");if(e){var t=e.querySelector(".change-email__input .input-text"),n=e.querySelector(".modal__save");t.addEventListener("input",(function(e){e.target.validity.valid&&n.removeAttribute("disabled"),e.target.validity.valid||n.hasAttribute("disabled")||n.setAttribute("disabled","")}))}}(),function(){var e=document.querySelectorAll(".user-settings__change-phone");if(e[0]){var t=document.getElementById("change-phone");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.getElementById("change-phone");if(e){var t=e.querySelector(".change-phone__input .input-text"),n=e.querySelector(".modal__save");t.addEventListener("input",(function(e){-1===e.target.value.indexOf("_")&&n.removeAttribute("disabled"),-1!==e.target.value.indexOf("_")&&(n.hasAttribute("disabled")||n.setAttribute("disabled",""))}))}}(),function(){var e=document.querySelectorAll(".contract-creation__client-type  input");if(e[0]){var t=document.querySelector(".contract-creation__details");e.forEach((function(e){e.addEventListener("change",n)}))}function n(){e[0].checked&&t.classList.remove("show-for-entity"),e[1].checked&&t.classList.add("show-for-entity")}}(),function(){if(document.querySelector(".clients-mobile-block"))new Swiper(".clients-mobile-block__slider",{slidesPerView:1,pagination:{el:".clients-mobile-block__pagination",dynamicBullets:!0}})}(),document.querySelectorAll("[data-trigger]").forEach((function(e){var t=e.getAttribute("data-trigger"),n=document.querySelector("[data-modal="+t+"]");n&&new Modal(e,n)})),function(){var e=document.getElementById("confirmation-code");if(e){var t=e.querySelector(".confirmation-code__input .input-text"),n=e.querySelector(".modal__save");t.addEventListener("input",(function(e){6===e.target.value.length&&n.removeAttribute("disabled"),e.target.value.length<6&&(n.hasAttribute("disabled")||n.setAttribute("disabled",""))}))}}(),$(".delivery-or-pickup.done").click((function(){$(this).find(".contract-info__delivered-adress").slideToggle(),$(this).find(".contract-info__delivered-toggle").toggleClass("opened")})),function(){if(document.querySelector(".contract-services")){var e=document.querySelectorAll(".contract-services__link"),t=function(e){var t=e.target;(t.classList.contains("checkbox-btn__label")||t.classList.contains("checkbox-btn__checkbox")||t.classList.contains("deliver-or-pickup__confirm-btn")||t.classList.contains("contract-services__delivery-confirm"))&&e.preventDefault()};e.forEach((function(e){e.addEventListener("click",t)}))}}(),function(){var e=document.querySelectorAll(".contracts__link");if(e[0]){var t=function(e){var t=e.target;(t.classList.contains("checkbox-btn__label")||t.classList.contains("checkbox-btn__checkbox")||t.classList.contains("contract-info__verification")||t.classList.contains("payment-waiting__confirm-btn")||t.classList.contains("contract-services__delivery-confirm"))&&e.preventDefault()};e.forEach((function(e){e.addEventListener("click",t)}))}}(),function(){if(document.querySelector(".contract-services-mobile"))new Swiper(".contract-services-mobile__slider",{slidesPerView:1,pagination:{el:".contract-services-mobile__pagination",dynamicBullets:!0}})}(),function(){if(document.querySelector(".contracts-mobile"))new Swiper(".contracts-mobile__slider",{slidesPerView:1,pagination:{el:".contracts-mobile__pagination",dynamicBullets:!0}})}(),function(){var e=document.querySelectorAll(".subscription-page__action-item--delete");if(e[0]){var t=document.getElementById("delete-service__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.querySelectorAll(".deliver-or-pickup__confirm-btn");if(e[0]){var t=document.getElementById("delivery-or-pickup__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.querySelectorAll(".contract-creation__delivery-device");e[0]&&e.forEach((function(e){var t=e.querySelectorAll(".contract-creation__delivery-type-wrapper  input");function n(e){var n=e.target.parentNode.parentNode.parentNode;t[0].checked&&n.classList.remove("show-for-pickup"),t[1].checked&&n.classList.add("show-for-pickup")}t.forEach((function(e){e.addEventListener("change",n)}))}))}(),function(){var e=document.getElementById("delivery-or-pickup__modal");if(e){var t=$("#delivery-or-pickup__modal .date-input");t.datepicker().on("change",(function(e){$("#delivery-or-pickup__modal").hasClass("js-show")&&m()}));var n=e.querySelector(".modal__close"),i=e.querySelector(".modal__overlay"),a=e.querySelector(".modal__submit"),o=e.querySelector(".delivery-or-pickup__modal-input-file"),c=e.querySelector(".input-file__input"),r=e.querySelector(".file-load__clear"),l=e.querySelector(".delivery-or-pickup__modal-date"),s=e.querySelector(".delivery-or-pickup__modal-time"),d=e.querySelector(".checkbox__input"),u=function(){o.classList.contains("loaded")&&(o.classList.remove("loaded"),c.value="",a.setAttribute("disabled",""),/safari/i.test(navigator.userAgent)||(c.type="",c.type="file")),l.value="",s.value="",d.checked=!1,t.datepicker("setDate","")},m=function(e){p()&&a.hasAttribute("disabled")?a.removeAttribute("disabled"):p()||a.hasAttribute("disabled")||a.setAttribute("disabled","")},p=function(){return t.datepicker("getDate")&&""!==s.value&&!0===d.checked&&""!==c.value};window.onDeliveryFileDrop=function(){m()},n.addEventListener("click",u),i.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&u()})),l.addEventListener("input",m),s.addEventListener("input",m),c.addEventListener("change",window.onDeliveryFileDrop),d.addEventListener("change",m),r.addEventListener("click",(function(){a.hasAttribute("disabled")||a.setAttribute("disabled","")}))}}(),function(){var e=$(".mutual-calcs__earned-date-menu");$(".mutual-calcs__earned-date-btn");$.extend($.datepicker,{_inlineDatepicker2:$.datepicker._inlineDatepicker,_inlineDatepicker:function(e,t){this._inlineDatepicker2(e,t);var n=$.datepicker._get(t,"beforeShow");n&&n.apply(e,[e,t])}}),$(".mutual-calcs__earned-date-btn").on("click",(function(){$(".mutual-calcs__earned-date-menu").toggle()})),$("#earned-date").datepicker({range:"period",inline:!0,showButtonPanel:!0,showOtherMonths:!0,selectOtherMonths:!0,closeText:"Готово",dateFormat:"dd.mm.yy",beforeShow:function(e,t){t.dpDiv.css("transform","translateX(-24px)"),t.dpDiv.addClass("calendar-range")},onSelect:function(e,t,n){$(".mutual-calcs__earned-date-btn").text(n.startDateText+" - "+n.endDateText)}}),$(document).mouseup((function(e){var t=$(".mutual-calcs__earned-date-menu"),n=$(".mutual-calcs__earned-date-btn");t.is(e.target)||0!==t.has(e.target).length||n.is(e.target)||0!==n.has(e.target).length||t.hide()})),$(".mutual-calcs__earned-date-menu-btn").on("click",(function(){$(this).hasClass("all-time")?$(".mutual-calcs__earned-date-btn").text($(this).text()+" (с "+$(".earned-date__start-period").text()+")"):$(".mutual-calcs__earned-date-btn").text($(this).text()),e.hide()})),$(".mutual-calcs__earned-date-btn").text($(".mutual-calcs__earned-date-menu-btn.all-time").text()+" (с "+$(".earned-date__start-period").text()+")")}(),$(".filters__btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),$(".filters__btn-clear").click((function(){$(".filters .select").val("Все"),$(".filters .select").trigger("change"),$(".filters .select").removeClass("picked")})),function(){if(document.querySelector(".installation-accounts-mobile"))new Swiper(".installation-accounts-mobile__slider",{slidesPerView:1,pagination:{el:".installation-accounts-mobile__pagination",dynamicBullets:!0}})}(),function(){var e=document.querySelectorAll(".installation__confirm-btn");if(e[0]){var t=document.getElementById("installation__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.querySelectorAll(".delivery-or-pickup__installation-choose-block  input");if(e[0]){var t=e[0].parentNode.parentNode.parentNode.parentNode;e.forEach((function(e){e.addEventListener("change",n)}))}function n(){console.log(t),e[0].checked&&(t.classList.contains("show-for-manual")&&t.classList.remove("show-for-manual"),t.classList.contains("show-for-registration")&&t.classList.remove("show-for-registration"),t.classList.contains("show-for-delivery")||t.classList.add("show-for-delivery")),e[1].checked&&(t.classList.contains("show-for-manual")&&t.classList.remove("show-for-manual"),t.classList.contains("show-for-delivery")&&t.classList.remove("show-for-delivery"),t.classList.contains("show-for-registration")||t.classList.add("show-for-registration")),e[2].checked&&(t.classList.contains("show-for-delivery")&&t.classList.remove("show-for-delivery"),t.classList.contains("show-for-registration")&&t.classList.remove("show-for-registration"),t.classList.contains("show-for-manual")||t.classList.add("show-for-manual"))}}(),function(){var e=document.getElementById("installation__modal");if(e){var t=$("#installation__modal .date-input");t.datepicker().on("change",(function(e){$("#installation__modal").hasClass("js-show")&&m()}));var n=e.querySelector(".modal__close"),i=e.querySelector(".modal__overlay"),a=e.querySelector(".modal__submit"),o=e.querySelector(".delivery-or-pickup__modal-input-file"),c=e.querySelector(".input-file__input"),r=e.querySelector(".file-load__clear"),l=e.querySelector(".delivery-or-pickup__modal-date"),s=e.querySelector(".delivery-or-pickup__modal-time"),d=e.querySelector(".checkbox__input"),u=function(){o.classList.contains("loaded")&&(o.classList.remove("loaded"),c.value="",a.setAttribute("disabled",""),/safari/i.test(navigator.userAgent)||(c.type="",c.type="file")),l.value="",s.value="",d.checked=!1,t.datepicker("setDate","")},m=function(e){p()&&a.hasAttribute("disabled")?a.removeAttribute("disabled"):p()||a.hasAttribute("disabled")||a.setAttribute("disabled","")},p=function(){return t.datepicker("getDate")&&""!==s.value&&!0===d.checked&&""!==c.value};window.onInstallationFileDrop=function(){m()},n.addEventListener("click",u),i.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&u()})),l.addEventListener("input",m),s.addEventListener("input",m),c.addEventListener("change",window.onInstallationFileDrop),d.addEventListener("change",m),r.addEventListener("click",(function(){a.hasAttribute("disabled")||a.setAttribute("disabled","")}))}}(),function(){var e=document.querySelectorAll(".mutual-calcs__make-payment");if(e[0]){var t=document.getElementById("payment-waiting__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.querySelector(".header__nav-btn");if(e){var t=document.querySelector(".header__close-btn"),n=document.querySelector(".header__nav"),i=function(){return window.matchMedia("(max-width: 1439px)").matches};i();e.addEventListener("click",(function(){i()&&(e.classList.toggle("js-opened"),n.classList.toggle("js-show"))})),t.addEventListener("click",(function(){n.classList.remove("js-show"),e.classList.toggle("js-opened")}))}}(),function(){if(document.querySelector(".mutual-calcs-payment-mobile"))new Swiper(".mutual-calcs-payment-mobile__slider",{slidesPerView:1,pagination:{el:".mutual-calcs-payment-mobile__pagination",dynamicBullets:!0}})}(),function(){if(document.querySelector(".mutual-calcs-block-mobile"))new Swiper(".mutual-calcs-block-mobile__slider",{slidesPerView:1,pagination:{el:".mutual-calcs-block-mobile__pagination",dynamicBullets:!0}})}(),document.querySelectorAll(".input-password")[0]&&$(document).on("click",".input-icon--show-password",(function(){$(this).toggleClass("active"),$(this).hasClass("active")?$(this).next().attr("type","text"):$(this).next().attr("type","password")})),function(){var e=document.querySelectorAll(".payment-waiting__confirm-btn");if(e[0]){var t=document.getElementById("payment-waiting__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.getElementById("payment-waiting__modal");if(e){var t=e.querySelector(".modal__close"),n=e.querySelector(".modal__overlay"),i=e.querySelector(".transactions__check-all input"),a=e.querySelector(".payment-waiting__modal-sender input"),o=e.querySelector(".payment-waiting__modal-recipient input"),c=e.querySelector(".payment-waiting__modal-sum input"),r=e.querySelector(".payment-waiting__modal-purpose input"),l=function(){return e.querySelectorAll(".transactions__check input")},s=function(){return e.querySelectorAll(".transactions__mobile-check input")},d=function(){i.checked=!1,l().forEach((function(e){e.checked=!1,e.parentNode.parentNode.parentNode.parentNode.classList.remove("checked")})),s().forEach((function(e){e.checked=!1,e.parentNode.parentNode.parentNode.classList.remove("checked")})),$("#payment-date").datepicker("setDate",""),a.value="",o.value="",c.value="",r.value=""},u=function(e){e.target.checked?e.target.parentNode.parentNode.parentNode.parentNode.classList.add("checked"):e.target.parentNode.parentNode.parentNode.parentNode.classList.remove("checked")},m=function(e){e.target.checked?e.target.parentNode.parentNode.parentNode.classList.add("checked"):e.target.parentNode.parentNode.parentNode.classList.remove("checked")};t.addEventListener("click",d),n.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&d()})),i.addEventListener("change",(function(){l().forEach((function(e){var t=e.parentNode.parentNode.parentNode.parentNode;i.checked?(e.checked=!0,t.classList.contains("checked")||t.classList.add("checked")):(e.checked=!1,t.classList.contains("checked")&&t.classList.remove("checked"))}))})),l().forEach((function(e){e.addEventListener("change",u)})),s().forEach((function(e){e.addEventListener("change",m)}))}}(),function(){var e=document.querySelectorAll(".mutual-calcs-payment-block__link");if(e[0]){var t=document.getElementById("payment-info__modal");e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e,t=document.getElementById("js-video-box");$(".subscribe-register__input .input-text").each((function(n,i){var a=$(this);a.siblings(".subscribe-register__btn").on("click",(function(n){var i;(e=new JsQRScanner((i=a,function(n){i.val(n),$(".qr-scanner-modal").removeClass("js-show"),e.stopScanning(),e.removeFrom(t)}))).setSnapImageMaxSize(300),t&&(t.innerHTML="",e.appendTo(t))}))})),$(document).on("click",".qr-scanner-modal .qr-scanner-modal__close",(function(n){e.stopScanning(),e.removeFrom(t)}))}(),function(){if(document.querySelector(".subscription-page__reward-mobile"))new Swiper(".subscription-page__reward-mobile",{slidesPerView:1,pagination:{el:".subscription-page__pagination",dynamicBullets:!0}})}(),function(){var e=document.querySelectorAll(".contract-device__schedule");if(e[0]){var t=document.getElementById("schedule__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){if(document.getElementById("schedule__modal")){var e=document.querySelectorAll(".schedule__modal-toggle input"),t=document.querySelector(".schedule__modal-toggle");e.forEach((function(e,n){e.addEventListener("change",(function(){0===n&&(t.classList.remove("second-tab"),t.classList.add("first-tab")),1===n&&(t.classList.remove("first-tab"),t.classList.add("second-tab"))}))}))}}(),function(){if(document.querySelector(".main-page")){var e=document.querySelector(".support"),t=document.querySelector(".support__container"),n=e.querySelectorAll(".support__item");!function(){var e=document.createDocumentFragment(),i=document.createElement("div");i.classList.add("swiper-container"),i.classList.add("support__slider");var a=document.createElement("div");a.classList.add("swiper-wrapper"),n.forEach((function(e,t){var n=document.createElement("div");n.classList.add("swiper-slide");var i=e.cloneNode(!0);n.appendChild(i),a.appendChild(n)}));var o=document.createElement("div");o.classList.add("support__slider-pagination","swiper-pagination"),i.appendChild(a),i.appendChild(o),e.appendChild(i),t.appendChild(e),new Swiper(".support__slider",{slidesPerView:1,pagination:{el:".support__slider-pagination"}})}()}}(),$(".support__docs-btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){if(document.querySelector(".transactions-mobile-block"))new Swiper(".transactions-mobile-block__slider",{slidesPerView:1,pagination:{el:".transactions-mobile-block__pagination",dynamicBullets:!0}})}(),$(".header__user-btn").on("click",(function(e){$(this).is(e.target)&&$(this).toggleClass("active")})),$(document).on("mouseup",(function(e){var t=$(".header__user-btn");t.is(e.target)||0!==t.has(e.target).length||t.removeClass("active")})),function(){var e=document.querySelectorAll(".contract-info__verification");if(e[0]){var t=document.getElementById("verification__modal");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.getElementById("verification__modal");if(e){var t=e.querySelectorAll(".verification__modal-input-file"),n=e.querySelector(".modal__close"),i=e.querySelector(".modal__overlay"),a=e.querySelector(".modal__save"),o=function(){t.forEach((function(e){var t=e.querySelector(".input-file__input");e.classList.contains("loaded")&&(e.classList.remove("loaded"),t.value="",a.setAttribute("disabled",""),/safari/i.test(navigator.userAgent)||(t.type="",t.type="file"))}))},c=function(){a.hasAttribute("disabled")||a.setAttribute("disabled","")};window.onVerificationFileDrop=function(){var e;e=!0,t.forEach((function(t){""===t.querySelector(".input-file__input").value&&(e=!1)})),e&&a.hasAttribute("disabled")&&a.removeAttribute("disabled"),e||a.hasAttribute("disabled")||a.setAttribute("disabled","")},t.forEach((function(e){var t=e.querySelector(".input-file__input"),n=e.querySelector(".file-load__clear");t.addEventListener("change",window.onVerificationFileDrop),n.addEventListener("click",c)})),n.addEventListener("click",o),i.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&o()}))}}(),function(){var e=document.querySelectorAll(".contract-info__serial-btn");if(e[0]){var t=document.getElementById("write-serial");t&&e.forEach((function(e){new Modal(e,t)}))}}(),function(){var e=document.getElementById("write-serial");if(e){var t=e.querySelector(".write-serial__input .input-text"),n=e.querySelector(".modal__save");t.addEventListener("input",(function(e){var t=e.target.value;""!==t.split(" ").join("")&&t.length>0&&n.hasAttribute("disabled")&&n.removeAttribute("disabled"),""!==t.split(" ").join("")&&0!==t.length||n.hasAttribute("disabled")||n.setAttribute("disabled","")}))}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyIsImNoZWNrYm94LTIuanMiLCJkYXRlLWlucHV0LmpzIiwiaW5wdXQtZmlsZS5qcyIsImlucHV0LXRleHQuanMiLCJtb2RhbC5qcyIsIm1vbmV5LW1hc2suanMiLCJwaG9uZS1tYXNrLmpzIiwic2VhcmNoLmpzIiwic2VsZWN0LmpzIiwidGltZS1tYXNrLmpzIiwiYWNjb3VudC1jcmVhdGlvbi1tb2RhbC5qcyIsImFjY291bnQtY3JlYXRpb24uanMiLCJhZ2VudC11c2Vycy1zbGlkZXIuanMiLCJhZ2VudHMuanMiLCJjYW5jZWxsYXRpb24tbW9kYWwuanMiLCJjaGFuZ2UtZW1haWwtbW9kYWwuanMiLCJjaGFuZ2UtZW1haWwuanMiLCJjaGFuZ2UtcGhvbmUtbW9kYWwuanMiLCJjaGFuZ2UtcGhvbmUuanMiLCJjbGllbnQtdHlwZS5qcyIsImNsaWVudHMtc2xpZGVyLmpzIiwiY29tbW9uLW1vZGFsLmpzIiwiY29uZmlybWF0aW9uLWNvZGUuanMiLCJjb250cmFjdC1wYWdlLmpzIiwiY29udHJhY3Qtc2VydmljZXMuanMiLCJjb250cmFjdHMtYWxsLmpzIiwiY29udHJhY3RzLXNlcnZpY2VzLXNsaWRlci5qcyIsImNvbnRyYWN0cy1zbGlkZXIuanMiLCJkZWxldGUtc2VydmljZS1tb2RhbC5qcyIsImRlbGl2ZXJ5LW1vZGFsLmpzIiwiZGVsaXZlcnktdHlwZS5qcyIsImRlbGl2ZXJ5LmpzIiwiZWFybmVkLWRhdGUuanMiLCJmaWx0ZXJzLmpzIiwiaW5zdGFsbGF0aW9uLWFjY291bnRzLXNsaWRlci5qcyIsImluc3RhbGxhdGlvbi1tb2RhbC5qcyIsImluc3RhbGxhdGlvbi13YWl0aW5nLmpzIiwiaW5zdGFsbGF0aW9uLmpzIiwibWFrZS1wYXltZW50LW1vZGFsLmpzIiwibWVudS5qcyIsIm11dHVhbC1jYWxjcy1wYXltZW50LXNsaWRlci5qcyIsIm11dHVhbC1jYWxjcy1zbGlkZXIuanMiLCJwYXNzd29yZC1pbnB1dC5qcyIsInBheW1lbnQtY29uZmlybS1tb2RhbC5qcyIsInBheW1lbnQtY29uZmlybS5qcyIsInBheW1lbnQtaW5mby1tb2RhbC5qcyIsInFyc2Nhbm5lci5qcyIsInJld2FyZC1zbGlkZXIuanMiLCJzY2hlZHVsZS1tb2RhbC5qcyIsInNjaGVkdWxlLmpzIiwic3VwcG9ydC1zbGlkZXIuanMiLCJzdXBwb3J0LmpzIiwidHJhbnNhY3Rpb25zLXNsaWRlci5qcyIsInVzZXItYnRuLmpzIiwidmVyaWZpY2F0aW9uLW1vZGFsLmpzIiwidmVyaWZpY2F0aW9uLmpzIiwid3JpdGUtc2VyaWFsLW1vZGFsLmpzIiwid3JpdGUtc2VyaWFsLmpzIl0sIm5hbWVzIjpbImNoZWNrYm94MiIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJpdGVtIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ0YXJnZXQiLCJjaGVja2VkIiwicGFyZW50Tm9kZSIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsIiQiLCJkYXRlcGlja2VyIiwiZGF0ZUZvcm1hdCIsInJhbmdlIiwiaW5saW5lIiwic2hvd0J1dHRvblBhbmVsIiwic2hvd090aGVyTW9udGhzIiwic2VsZWN0T3RoZXJNb250aHMiLCJjbG9zZVRleHQiLCJiZWZvcmVTaG93IiwiaW5wdXQiLCJpbnN0IiwiZHBEaXYiLCJjc3MiLCJhZGRDbGFzcyIsIm9uU2VsZWN0IiwiZGF0ZVRleHQiLCJleHRlbnNpb25SYW5nZSIsInZhbCIsInN0YXJ0RGF0ZVRleHQiLCJlbmREYXRlVGV4dCIsImZpbGVEcm9wQXJlYSIsIm1ha2VGaWxlTG9hZCIsImZpbGVJbnB1dCIsInF1ZXJ5U2VsZWN0b3IiLCJmaWxlQ2xlYXIiLCJwcmV2ZW50RGVmYXVsdHMiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsImhpZ2hsaWdodCIsInVuaGlnaGxpZ2h0IiwiZXZlbnROYW1lIiwiZmlsZXMiLCJkYXRhVHJhbnNmZXIiLCJ2YWx1ZSIsInRlc3QiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJ0eXBlIiwib25GaWxlQ2hhbmdlIiwid2luZG93Iiwib25WZXJpZmljYXRpb25GaWxlRHJvcCIsIm9uRGVsaXZlcnlGaWxlRHJvcCIsIm9uSW5zdGFsbGF0aW9uRmlsZURyb3AiLCJyZWFkVXJsIiwicmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsIm5leHRFbGVtZW50U2libGluZyIsInRleHRDb250ZW50IiwibmFtZSIsInJlYWRBc0RhdGFVUkwiLCJpbnB1dHMiLCJzcGxpdCIsImpvaW4iLCJjb250YWlucyIsInZoIiwiaW5uZXJIZWlnaHQiLCJkb2N1bWVudEVsZW1lbnQiLCJzdHlsZSIsInNldFByb3BlcnR5IiwiY29uY2F0IiwiZnVuYyIsInRpbWVyIiwiJGJvZHkiLCJNb2RhbCIsInRyaWdnZXIiLCJtb2RhbCIsInRoaXMiLCJvdmVybGF5IiwiY2xvc2VCdG4iLCJvbk92ZXJsYXlDbGljayIsImJpbmQiLCJvbkNsb3NlQ2xpY2siLCJvblRyaWdnZXJDbGljayIsImFkZEV2ZW50TGlzdGVuZXJzIiwiZXZlbnQiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwicHJvdG90eXBlIiwib3BlbiIsImNsb3NlIiwibWFzayIsInJldmVyc2UiLCJpbSIsIklucHV0bWFzayIsIml0ZW1zIiwic2VhcmNoIiwicHJldmlvdXNFbGVtZW50U2libGluZyIsImZvcm1hdE9wdGlvbiIsInRleHQiLCJiciIsIm1hdGNoTWVkaWEiLCJtYXRjaGVzIiwibGVuZ3RoIiwic2VsZWN0MiIsInRlbXBsYXRlUmVzdWx0IiwidGVtcGxhdGVTZWxlY3Rpb24iLCJvbiIsImRlbGl2ZXJ5VGltZUlucHV0cyIsImNhbmNlbGxhdGlvbkJ0biIsImdldEVsZW1lbnRCeUlkIiwiJGlucHV0IiwiJGJ0biIsImZpbHRlciIsInJlbW92ZUF0dHIiLCJhdHRyIiwiU3dpcGVyIiwic2xpZGVzUGVyVmlldyIsInBhZ2luYXRpb24iLCJlbCIsImR5bmFtaWNCdWxsZXRzIiwicGFyZW50IiwibmV4dCIsInNsaWRlVG9nZ2xlIiwiY2xpY2siLCJ0b2dnbGVDbGFzcyIsImNoYW5nZUJ1dHRvbiIsImJ0biIsInZhbGlkaXR5IiwidmFsaWQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJoYXNBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJpbmRleE9mIiwicmFkaW9zIiwid3JhcHBlciIsIm9uUmFkaW9DaGFuZ2UiLCJnZXRBdHRyaWJ1dGUiLCJmaW5kIiwibGlua3MiLCJvbkxpbmtDbGljayIsImxpbmsiLCJjb250cmFjdHNMaW5rQWxsIiwiZGVsaXZlcnlCdG5zIiwiZGV2aWNlcyIsIiRkYXRlIiwiaGFzQ2xhc3MiLCJvbkZpZWxkQ2hhbmdlIiwic3VibWl0IiwiZmlsZUlucHV0QmxvY2siLCJkYXRlSW5wdXQiLCJ0aW1lSW5wdXQiLCJjb25maXJtQ2hlY2tib3giLCJpc0Zvcm1GaWxsZWQiLCJtZW51IiwiZXh0ZW5kIiwiX2lubGluZURhdGVwaWNrZXIyIiwiX2lubGluZURhdGVwaWNrZXIiLCJfZ2V0IiwiYXBwbHkiLCJ0b2dnbGUiLCJtb3VzZXVwIiwiaXMiLCJoYXMiLCJoaWRlIiwicmVtb3ZlQ2xhc3MiLCJjb25zb2xlIiwibG9nIiwicGF5bWVudENvbmZpcm1CdG5zIiwibWVudUJ0biIsIm5hdiIsImNoZWNrSWZUYWJsZXQiLCJtYWluQ2hlY2tib3giLCJzZW5kZXJJbnB1dCIsInJlY2lwaWVudElucHV0Iiwic3VtSW5wdXQiLCJwdXJwb3NlSW5wdXQiLCJnZXRBbGxDaGVja2JveCIsImdldEFsbE1vYmlsZUNoZWNrYm94Iiwib25DaGVja2JveENoYW5nZSIsIm9uTW9iaWxlQ2hlY2tib3hDaGFuZ2UiLCJyb3ciLCJwYXltZW50cyIsImpiU2Nhbm5lciIsInNjYW5uZXJQYXJlbnRFbGVtZW50IiwiZWFjaCIsImluZGV4Iiwic2libGluZ3MiLCJKc1FSU2Nhbm5lciIsInNjYW5uZWRUZXh0Iiwic3RvcFNjYW5uaW5nIiwicmVtb3ZlRnJvbSIsInNldFNuYXBJbWFnZU1heFNpemUiLCJpbm5lckhUTUwiLCJhcHBlbmRUbyIsInNjaGVkdWxlQnRucyIsImlkIiwic3VwcG9ydCIsInN1cHBvcnRDb250YWluZXIiLCJmcmFnbWVudCIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJjb250YWluZXIiLCJjcmVhdGVFbGVtZW50IiwiaWR4Iiwic2xpZGUiLCJub2RlIiwiY2xvbmVOb2RlIiwiYXBwZW5kQ2hpbGQiLCJtYWtlU2xpZGVyIiwiYmxvY2siLCJ2ZXJpZmljYXRpb25CdG4iLCJzYXZlQnRuIiwiaW5wdXRCbG9jayIsIm9uRmlsZUNsZWFyIiwiZmlsbGVkIl0sIm1hcHBpbmdzIjoiQUFBQSxjQ0FBLFdBQ0EsSUFBQUEsRUFBQUMsU0FBQUMsaUJBQUEsc0JBRUFGLEVBQUEsSUFJQUEsRUFBQUcsU0FBQSxTQUFBQyxHQUNBQSxFQUFBQyxpQkFBQSxVQUFBLFNBQUFDLEdBQ0EsSUFBQUMsRUFBQUQsRUFBQUMsUUFDQSxJQUFBQSxFQUFBQyxRQUNBRCxFQUFBRSxXQUFBQyxVQUFBQyxJQUFBLFdBRUFKLEVBQUFFLFdBQUFDLFVBQUFFLE9BQUEsaUJBYkEsR0NDQUMsRUFBQSxzQ0FBQUMsV0FBQSxDQUFBQyxXQUFBLGFBRUFGLEVBQUEscUJBQUFDLFdBQUEsQ0FDQUUsTUFBQSxTQUNBQyxRQUFBLEVBQ0FDLGlCQUFBLEVBQ0FDLGlCQUFBLEVBQ0FDLG1CQUFBLEVBQ0FDLFVBQUEsU0FDQU4sV0FBQSxXQUVBTyxXQUFBLFNBQUFDLEVBQUFDLEdBQ0FBLEVBQUFDLE1BQUFDLElBQUEsWUFBQSxxQkFDQUYsRUFBQUMsTUFBQUUsU0FBQSxtQkFHQUMsU0FBQSxTQUFBQyxFQUFBTCxFQUFBTSxHQUNBTixFQUFBRCxNQUFBUSxJQUFBRCxFQUFBRSxjQUFBLE1BQUFGLEVBQUFHLGdCQ2xCQSxXQUNBLElBQUFDLEVBQUFqQyxTQUFBQyxpQkFBQSxzQkFFQSxTQUFBaUMsRUFBQUQsR0FDQSxJQUFBRSxFQUFBRixFQUFBRyxjQUFBLFNBQ0FDLEVBQUFKLEVBQUF6QixXQUFBNEIsY0FBQSxxQkFPQSxTQUFBRSxFQUFBakMsR0FDQUEsRUFBQWtDLGlC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QSxJQUFBcEIsRUFBQTRELFFBRUF3QixFQUFBSSxhQUFBLGFBQ0FKLEVBQUFLLGFBQUEsV0FBQSxRQWhDQSIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjaGVja2JveDIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2hlY2tib3gtMl9faW5wdXQnKTtcblxuICBpZiAoIWNoZWNrYm94MlswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNoZWNrYm94Mi5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuXG4gICAgICBpZiAodGFyZ2V0LmNoZWNrZWQgPT09IHRydWUpIHtcbiAgICAgICAgdGFyZ2V0LnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnY2hlY2tlZCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGFyZ2V0LnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5kYXRlLWlucHV0Om5vdCguZGF0ZS1pbnB1dC1yYW5nZSknKS5kYXRlcGlja2VyKHtcbiAgICBkYXRlRm9ybWF0OiAnZGQubW0ueXknXG4gIH0pO1xuICAkKCcuZGF0ZS1pbnB1dC1yYW5nZScpLmRhdGVwaWNrZXIoe1xuICAgIHJhbmdlOiAncGVyaW9kJyxcbiAgICBpbmxpbmU6IHRydWUsXG4gICAgc2hvd0J1dHRvblBhbmVsOiB0cnVlLFxuICAgIHNob3dPdGhlck1vbnRoczogdHJ1ZSxcbiAgICBzZWxlY3RPdGhlck1vbnRoczogdHJ1ZSxcbiAgICBjbG9zZVRleHQ6IFwi0JPQvtGC0L7QstC+XCIsXG4gICAgZGF0ZUZvcm1hdDogJ2RkLm1tLnl5JyxcbiAgICBiZWZvcmVTaG93OiBmdW5jdGlvbiBiZWZvcmVTaG93KGlucHV0LCBpbnN0KSB7XG4gICAgICBpbnN0LmRwRGl2LmNzcygndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZVgoLTI0cHgpJyk7XG4gICAgICBpbnN0LmRwRGl2LmFkZENsYXNzKCdjYWxlbmRhci1yYW5nZScpO1xuICAgIH0sXG4gICAgb25TZWxlY3Q6IGZ1bmN0aW9uIG9uU2VsZWN0KGRhdGVUZXh0LCBpbnN0LCBleHRlbnNpb25SYW5nZSkge1xuICAgICAgaW5zdC5pbnB1dC52YWwoZXh0ZW5zaW9uUmFuZ2Uuc3RhcnREYXRlVGV4dCArICcgLSAnICsgZXh0ZW5zaW9uUmFuZ2UuZW5kRGF0ZVRleHQpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgZmlsZURyb3BBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LWZpbGVfX2xhYmVsJyk7XG5cbiAgZnVuY3Rpb24gbWFrZUZpbGVMb2FkKGZpbGVEcm9wQXJlYSkge1xuICAgIHZhciBmaWxlSW5wdXQgPSBmaWxlRHJvcEFyZWEucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcbiAgICB2YXIgZmlsZUNsZWFyID0gZmlsZURyb3BBcmVhLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fY2xlYXInKTsgLy8g0KHQsdGA0LDRgdGL0LLQsNC10Lwg0YHRgtCw0L3QtNCw0YDRgtC90YvQtSDRgdC+0LHRi9GC0LjRjyDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlcicsICdkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBwcmV2ZW50RGVmYXVsdHMsIGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0cyhlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cblxuICAgIDsgLy8g0JTQvtCx0LDQstC70Y/QtdC8INGB0YLQuNC70Lgg0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsCDQvdCw0LQg0L3Rg9C20L3QvtC5INC+0LHQu9Cw0YHRgtGM0Y5cblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhpZ2hsaWdodCwgZmFsc2UpO1xuICAgIH0pO1xuICAgIFsnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdW5oaWdobGlnaHQsIGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XG4gICAgfVxuXG4gICAgO1xuXG4gICAgZnVuY3Rpb24gdW5oaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZ2hsaWdodCcpO1xuICAgIH1cblxuICAgIDsgLy9cblxuICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgaGFuZGxlRHJvcCwgZmFsc2UpO1xuXG4gICAgZnVuY3Rpb24gaGFuZGxlRHJvcChlKSB7XG4gICAgICB2YXIgZHQgPSBlLmRhdGFUcmFuc2ZlcjtcbiAgICAgIHZhciBmaWxlcyA9IGR0LmZpbGVzO1xuXG4gICAgICBpZiAoZmlsZUlucHV0LmZpbGVzICYmIGZpbGVJbnB1dC5maWxlc1swXSkge1xuICAgICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgICBpZiAoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmaWxlSW5wdXQuZmlsZXMgPSBmaWxlcztcbiAgICAgIG9uRmlsZUNoYW5nZSgpO1xuICAgICAgd2luZG93Lm9uVmVyaWZpY2F0aW9uRmlsZURyb3AgJiYgd2luZG93Lm9uVmVyaWZpY2F0aW9uRmlsZURyb3AoKTtcbiAgICAgIHdpbmRvdy5vbkRlbGl2ZXJ5RmlsZURyb3AgJiYgd2luZG93Lm9uRGVsaXZlcnlGaWxlRHJvcCgpO1xuICAgICAgd2luZG93Lm9uSW5zdGFsbGF0aW9uRmlsZURyb3AgJiYgd2luZG93Lm9uSW5zdGFsbGF0aW9uRmlsZURyb3AoKTtcbiAgICB9XG5cbiAgICA7XG5cbiAgICB2YXIgb25GaWxlQ2hhbmdlID0gZnVuY3Rpb24gb25GaWxlQ2hhbmdlKCkge1xuICAgICAgcmVhZFVybChmaWxlSW5wdXQpO1xuICAgIH07XG5cbiAgICB2YXIgcmVhZFVybCA9IGZ1bmN0aW9uIHJlYWRVcmwoaW5wdXQpIHtcbiAgICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlc1swXSkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdsb2FkZWQnKTtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEubmV4dEVsZW1lbnRTaWJsaW5nLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX25hbWUnKS50ZXh0Q29udGVudCA9IGlucHV0LmZpbGVzWzBdLm5hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW5wdXQuZmlsZXNbMF0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBvbkNsZWFyKCkge1xuICAgICAgZmlsZURyb3BBcmVhLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWxlQ2hhbmdlKTtcbiAgICBmaWxlQ2xlYXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsZWFyKTtcbiAgfVxuXG4gIHdpbmRvdy5tYWtlRmlsZUxvYWQgPSBtYWtlRmlsZUxvYWQ7XG5cbiAgaWYgKCFmaWxlRHJvcEFyZWFbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBmaWxlRHJvcEFyZWEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG1ha2VGaWxlTG9hZChpdGVtKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXRleHQnKTtcblxuICBpZiAoIWlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaW5wdXQudmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJycpIHtcbiAgICAgICAgaW5wdXQudmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKGlucHV0LnZhbHVlICE9PSAnJyAmJiAhaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJykpIHtcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaW5wdXQudmFsdWUgPT09ICcnICYmIGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBcIlwiLmNvbmNhdCh2aCwgXCJweFwiKSk7XG4gIHZhciAkYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcblxuICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jKSB7XG4gICAgdmFyIHRpbWVyO1xuICAgIHJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmICh0aW1lcikgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jLCAxMDAsIGV2ZW50KTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gb25SZXNpemUoKSB7XG4gICAgdmFyIHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBcIlwiLmNvbmNhdCh2aCwgXCJweFwiKSk7XG4gIH1cblxuICA7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBkZWJvdW5jZShvblJlc2l6ZSkpO1xuXG4gIGZ1bmN0aW9uIE1vZGFsKHRyaWdnZXIsIG1vZGFsKSB7XG4gICAgdGhpcy50cmlnZ2VyID0gdHJpZ2dlcjtcbiAgICB0aGlzLm1vZGFsID0gbW9kYWw7XG4gICAgdGhpcy5vdmVybGF5ID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgICB0aGlzLmNsb3NlQnRuID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gICAgdGhpcy5vbk92ZXJsYXlDbGljayA9IHRoaXMub25PdmVybGF5Q2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uQ2xvc2VDbGljayA9IHRoaXMub25DbG9zZUNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vblRyaWdnZXJDbGljayA9IHRoaXMub25UcmlnZ2VyQ2xpY2suYmluZCh0aGlzKTsgLy90aGlzLm9uUmVzaXplID0gdGhpcy5vblJlc2l6ZS5iaW5kKHRoaXMpO1xuXG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QuYWRkKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LmFkZCgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5vbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLm92ZXJsYXkpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uVHJpZ2dlckNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub3BlbigpO1xuICB9OyAvLyBNb2RhbC5wcm90b3R5cGUub25SZXNpemUgPSBmdW5jdGlvbigpIHtcbiAgLy8gICAgIGxldCB2aCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMDE7XG4gIC8vICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBgJHt2aH1weGApO1xuICAvLyB9O1xuXG5cbiAgTW9kYWwucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25PdmVybGF5Q2xpY2spO1xuICAgIHRoaXMuY2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2xvc2VDbGljayk7XG4gICAgdGhpcy50cmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vblRyaWdnZXJDbGljayk7XG4gIH07XG5cbiAgd2luZG93Lk1vZGFsID0gTW9kYWw7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAkKCcuaW5wdXQtbW9uZXknKS5tYXNrKCcjICMjMCDigr0nLCB7XG4gICAgcmV2ZXJzZTogdHJ1ZVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtcGhvbmUnKTtcblxuICBpZiAoIWlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbSA9IG5ldyBJbnB1dG1hc2soXCIrNyg5OTkpIDk5OS05OS05OVwiKTtcbiAgaW5wdXRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpbS5tYXNrKGl0ZW0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2gnKTtcbiAgdmFyIGNsb3NlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCArIC5zZWFyY2gtY2xvc2UnKTtcblxuICBpZiAoIWl0ZW1zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9IC8vIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgLy8gICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgKCkgPT57XG4gIC8vICAgICBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdqcy1mb2N1cycpO1xuICAvLyAgIH0pO1xuICAvLyB9KTtcblxuXG4gIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaXRlbS52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJykge1xuICAgICAgICBpdGVtLnZhbHVlID0gJyc7XG4gICAgICB9XG5cbiAgICAgIGlmIChpdGVtLnZhbHVlICE9PSAnJyAmJiAhaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGl0ZW0udmFsdWUgPT09ICcnICYmIGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJykpIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuICBjbG9zZS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBzZWFyY2ggPSBpdGVtLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG4gICAgICBzZWFyY2gudmFsdWUgPSAnJztcblxuICAgICAgaWYgKHNlYXJjaC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIGZvcm1hdE9wdGlvbihpdGVtKSB7XG4gICAgdmFyIHZhbHVlID0gaXRlbS50ZXh0LnNwbGl0KCdzcGxpdHRlcicpO1xuICAgIHZhciBiciA9IHdpbmRvdy5tYXRjaE1lZGlhKCcobWF4LXdpZHRoOiA5OTlweCknKS5tYXRjaGVzID8gJzxicj4nIDogJyc7XG5cbiAgICBpZiAodmFsdWUubGVuZ3RoID4gMSkge1xuICAgICAgdmFyIHJlc3VsdCA9ICQoJzxzcGFuPicgKyB2YWx1ZVswXSArICc8L3NwYW4+JyArIGJyICsgJzxzcGFuPicgKyB2YWx1ZVsxXSArICc8L3NwYW4+Jyk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gaXRlbS50ZXh0O1xuICAgIH1cbiAgfVxuXG4gICQoJy5zZWxlY3QnKS5zZWxlY3QyKHtcbiAgICB0ZW1wbGF0ZVJlc3VsdDogZm9ybWF0T3B0aW9uLFxuICAgIHRlbXBsYXRlU2VsZWN0aW9uOiBmb3JtYXRPcHRpb25cbiAgfSk7XG4gICQoJy5zZWxlY3QnKS5vbignc2VsZWN0MjpzZWxlY3QnLCBmdW5jdGlvbiAoZSkge1xuICAgICQodGhpcykuYWRkQ2xhc3MoJ3BpY2tlZCcpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBkZWxpdmVyeVRpbWVJbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC10aW1lJyk7XG5cbiAgaWYgKCFkZWxpdmVyeVRpbWVJbnB1dHNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgaW0gPSBuZXcgSW5wdXRtYXNrKFwiOTk6OTlcIik7XG4gIGRlbGl2ZXJ5VGltZUlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaW0ubWFzayhpdGVtKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY2FuY2VsbGF0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFjY291bnQtY3JlYXRpb25fX25ldycpO1xuXG4gIGlmICghY2FuY2VsbGF0aW9uQnRuWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY291bnQtY3JlYXRpb24nKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY2FuY2VsbGF0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIC8vIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcbiAgLy8gaWYgKCF2ZXJpZmljYXRpb25CdG5bMF0pIHtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY291bnQtY3JlYXRpb24nKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyICRpbnB1dCA9ICQoJy5hY2NvdW50LWNyZWF0aW9uX19pbnB1dCAuaW5wdXQtdGV4dCcpO1xuICB2YXIgJGJ0biA9ICQoJyNhY2NvdW50LWNyZWF0aW9uIC5tb2RhbF9fc2F2ZScpO1xuXG4gIHZhciBvbklucHV0ID0gZnVuY3Rpb24gb25JbnB1dChlKSB7XG4gICAgdmFyICRlbXB0eUlucHV0ID0gJGlucHV0LmZpbHRlcihmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJyB8fCB0aGlzLnZhbHVlLmxlbmd0aCA9PT0gMDtcbiAgICB9KTtcblxuICAgIGlmICgkZW1wdHlJbnB1dC5sZW5ndGggPT09IDApIHtcbiAgICAgICRidG4ucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJGJ0bi5hdHRyKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9IC8vIGlmIChcbiAgICAvLyAgIHZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnXG4gICAgLy8gICB8fCB2YWx1ZS5sZW5ndGggPT09IDBcbiAgICAvLyApIHtcbiAgICAvLyAgIGlmICghYnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgIC8vICAgICBidG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAvLyAgIH1cbiAgICAvLyB9XG5cbiAgfTsgLy8gdmVyaWZpY2F0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIC8vIH0pXG5cblxuICAkaW5wdXQub24oJ2lucHV0Jywgb25JbnB1dCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY29udHJhY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFnZW50c19fdXNlcnMtYmxvY2stbW9iaWxlJyk7XG5cbiAgaWYgKCFjb250cmFjdHMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc2xpZGVyID0gbmV3IFN3aXBlcignLmFnZW50c19fdXNlcnMtYmxvY2stbW9iaWxlX19zbGlkZXInLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy5hZ2VudHNfX3VzZXJzLWJsb2NrLW1vYmlsZV9fcGFnaW5hdGlvbicsXG4gICAgICBkeW5hbWljQnVsbGV0czogdHJ1ZVxuICAgIH1cbiAgfSk7XG4gICQoJy5hZ2VudHNfX3VzZXJzLWJ0bicpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgJCgnLmFnZW50c19fdXNlcnMtYnRuJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX19jYW5jZWxsYXRpb24nKTtcblxuICBpZiAoIWNhbmNlbGxhdGlvbkJ0blswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWxsYXRpb25fX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNhbmNlbGxhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY2hhbmdlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnVzZXItc2V0dGluZ3NfX2NoYW5nZS1lbWFpbCcpO1xuXG4gIGlmICghY2hhbmdlQnV0dG9uWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYW5nZS1lbWFpbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjaGFuZ2VCdXR0b24uZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgLy8gY29uc3QgdmVyaWZpY2F0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvbicpO1xuICAvLyBpZiAoIXZlcmlmaWNhdGlvbkJ0blswXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbmdlLWVtYWlsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGFuZ2UtZW1haWxfX2lucHV0IC5pbnB1dC10ZXh0Jyk7XG4gIHZhciBidG4gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcblxuICB2YXIgb25JbnB1dCA9IGZ1bmN0aW9uIG9uSW5wdXQoZSkge1xuICAgIGlmIChlLnRhcmdldC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgYnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWUudGFyZ2V0LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICBpZiAoIWJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgICAgYnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgICB9XG4gICAgfVxuICB9OyAvLyB2ZXJpZmljYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgLy8gfSlcblxuXG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25JbnB1dCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY2hhbmdlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnVzZXItc2V0dGluZ3NfX2NoYW5nZS1waG9uZScpO1xuXG4gIGlmICghY2hhbmdlQnV0dG9uWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYW5nZS1waG9uZScpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjaGFuZ2VCdXR0b24uZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgLy8gY29uc3QgdmVyaWZpY2F0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvbicpO1xuICAvLyBpZiAoIXZlcmlmaWNhdGlvbkJ0blswXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhbmdlLXBob25lJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGFuZ2UtcGhvbmVfX2lucHV0IC5pbnB1dC10ZXh0Jyk7XG4gIHZhciBidG4gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcblxuICB2YXIgb25JbnB1dCA9IGZ1bmN0aW9uIG9uSW5wdXQoZSkge1xuICAgIGlmIChlLnRhcmdldC52YWx1ZS5pbmRleE9mKCdfJykgPT09IC0xKSB7XG4gICAgICBidG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIH1cblxuICAgIGlmIChlLnRhcmdldC52YWx1ZS5pbmRleE9mKCdfJykgIT09IC0xKSB7XG4gICAgICBpZiAoIWJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgICAgYnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgICB9XG4gICAgfVxuICB9OyAvLyB2ZXJpZmljYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgLy8gfSlcblxuXG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25JbnB1dCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgcmFkaW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWNyZWF0aW9uX19jbGllbnQtdHlwZSAgaW5wdXQnKTtcblxuICBpZiAoIXJhZGlvc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciB3cmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LWNyZWF0aW9uX19kZXRhaWxzJyk7XG5cbiAgZnVuY3Rpb24gb25SYWRpb0NoYW5nZSgpIHtcbiAgICBpZiAocmFkaW9zWzBdLmNoZWNrZWQpIHtcbiAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdy1mb3ItZW50aXR5Jyk7XG4gICAgfVxuXG4gICAgaWYgKHJhZGlvc1sxXS5jaGVja2VkKSB7XG4gICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Nob3ctZm9yLWVudGl0eScpO1xuICAgIH1cbiAgfVxuXG4gIHJhZGlvcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvblJhZGlvQ2hhbmdlKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY29udHJhY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNsaWVudHMtbW9iaWxlLWJsb2NrJyk7XG5cbiAgaWYgKCFjb250cmFjdHMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc2xpZGVyID0gbmV3IFN3aXBlcignLmNsaWVudHMtbW9iaWxlLWJsb2NrX19zbGlkZXInLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy5jbGllbnRzLW1vYmlsZS1ibG9ja19fcGFnaW5hdGlvbicsXG4gICAgICBkeW5hbWljQnVsbGV0czogdHJ1ZVxuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgdHJpZ2dlcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdbZGF0YS10cmlnZ2VyXScpO1xuICB0cmlnZ2Vycy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgdmFyIG5hbWUgPSBpdGVtLmdldEF0dHJpYnV0ZSgnZGF0YS10cmlnZ2VyJyk7XG4gICAgdmFyIG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtbW9kYWw9JyArIG5hbWUgKyAnXScpO1xuXG4gICAgaWYgKG1vZGFsKSB7XG4gICAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAvLyBjb25zdCB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG4gIC8vIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb25maXJtYXRpb24tY29kZScpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgaW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuY29uZmlybWF0aW9uLWNvZGVfX2lucHV0IC5pbnB1dC10ZXh0Jyk7XG4gIHZhciBidG4gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcblxuICB2YXIgb25JbnB1dCA9IGZ1bmN0aW9uIG9uSW5wdXQoZSkge1xuICAgIGlmIChlLnRhcmdldC52YWx1ZS5sZW5ndGggPT09IDYpIHtcbiAgICAgIGJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfVxuXG4gICAgaWYgKGUudGFyZ2V0LnZhbHVlLmxlbmd0aCA8IDYpIHtcbiAgICAgIGlmICghYnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgICBidG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH07IC8vIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KVxuXG5cbiAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbklucHV0KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5kZWxpdmVyeS1vci1waWNrdXAuZG9uZScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLmZpbmQoJy5jb250cmFjdC1pbmZvX19kZWxpdmVyZWQtYWRyZXNzJykuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLmZpbmQoJy5jb250cmFjdC1pbmZvX19kZWxpdmVyZWQtdG9nZ2xlJykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjb250cmFjdFNlcnZpY2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LXNlcnZpY2VzJyk7XG5cbiAgaWYgKCFjb250cmFjdFNlcnZpY2VzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LXNlcnZpY2VzX19saW5rJyk7XG5cbiAgdmFyIG9uTGlua0NsaWNrID0gZnVuY3Rpb24gb25MaW5rQ2xpY2soZSkge1xuICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDtcblxuICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2xhYmVsJykgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tib3gtYnRuX19jaGVja2JveCcpIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2RlbGl2ZXItb3ItcGlja3VwX19jb25maXJtLWJ0bicpIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbnRyYWN0LXNlcnZpY2VzX19kZWxpdmVyeS1jb25maXJtJykpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH07XG5cbiAgbGlua3MuZm9yRWFjaChmdW5jdGlvbiAobGluaykge1xuICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkxpbmtDbGljayk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbnRyYWN0c0xpbmtBbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3RzX19saW5rJyk7XG5cbiAgaWYgKCFjb250cmFjdHNMaW5rQWxsWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG9uTGlua0NsaWNrID0gZnVuY3Rpb24gb25MaW5rQ2xpY2soZSkge1xuICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDtcblxuICAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2xhYmVsJykgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tib3gtYnRuX19jaGVja2JveCcpIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvbicpIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ3BheW1lbnQtd2FpdGluZ19fY29uZmlybS1idG4nKSB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb250cmFjdC1zZXJ2aWNlc19fZGVsaXZlcnktY29uZmlybScpKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnRyYWN0c0xpbmtBbGwuZm9yRWFjaChmdW5jdGlvbiAobGluaykge1xuICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkxpbmtDbGljayk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbnRyYWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1zZXJ2aWNlcy1tb2JpbGUnKTtcblxuICBpZiAoIWNvbnRyYWN0cykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBzbGlkZXIgPSBuZXcgU3dpcGVyKCcuY29udHJhY3Qtc2VydmljZXMtbW9iaWxlX19zbGlkZXInLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy5jb250cmFjdC1zZXJ2aWNlcy1tb2JpbGVfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWVcbiAgICB9XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbnRyYWN0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdHMtbW9iaWxlJyk7XG5cbiAgaWYgKCFjb250cmFjdHMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc2xpZGVyID0gbmV3IFN3aXBlcignLmNvbnRyYWN0cy1tb2JpbGVfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLmNvbnRyYWN0cy1tb2JpbGVfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWVcbiAgICB9XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdWJzY3JpcHRpb24tcGFnZV9fYWN0aW9uLWl0ZW0tLWRlbGV0ZScpO1xuXG4gIGlmICghY2FuY2VsbGF0aW9uQnRuWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGV0ZS1zZXJ2aWNlX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjYW5jZWxsYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRlbGl2ZXJ5QnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyLW9yLXBpY2t1cF9fY29uZmlybS1idG4nKTtcblxuICBpZiAoIWRlbGl2ZXJ5QnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfSAvLyAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZGF0ZVRleHQpIHtcbiAgLy8gICBvbkZpZWxkQ2hhbmdlKCk7XG4gIC8vIH0pO1xuXG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9IC8vIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICAvLyBjb25zdCBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIC8vIGNvbnN0IHN1Ym1pdCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc3VibWl0Jyk7XG4gIC8vIGNvbnN0IGZpbGVJbnB1dEJsb2NrID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtaW5wdXQtZmlsZScpO1xuICAvLyBjb25zdCBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgLy8gY29uc3QgZGF0ZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtZGF0ZScpO1xuICAvLyBjb25zdCB0aW1lSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC10aW1lJyk7XG4gIC8vIGNvbnN0IGNvbmZpcm1DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGVja2JveF9faW5wdXQnKTtcblxuXG4gIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uIChidG4pIHtcbiAgICBuZXcgTW9kYWwoYnRuLCBtb2RhbCk7XG4gIH0pOyAvLyBjb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAvLyAgICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gIC8vICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAvLyAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgLy8gICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgLy8gICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyAgIGRhdGVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHRpbWVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgJCgnI2RlbGl2ZXJ5LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAvLyB9XG4gIC8vIGNvbnN0IG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAvLyAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgLy8gICAgIG9uQ2xvc2VDbGljaygpO1xuICAvLyAgIH1cbiAgLy8gfVxuICAvLyBjb25zdCBvbkZpZWxkQ2hhbmdlID0gZnVuY3Rpb24oZSkge1xuICAvLyAgIGlmIChpc0Zvcm1GaWxsZWQoKSAmJiBzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gIC8vICAgICBzdWJtaXQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAvLyAgIH0gZWxzZSBpZiAoIWlzRm9ybUZpbGxlZCgpICYmICFzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gIC8vICAgICBzdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gY29uc3QgaXNGb3JtRmlsbGVkID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgcmV0dXJuICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignZ2V0RGF0ZScpXG4gIC8vICAgICAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnXG4gIC8vICAgICAmJiBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9PT0gdHJ1ZVxuICAvLyAgICAgJiYgZmlsZUlucHV0LnZhbHVlICE9PSAnJ1xuICAvLyB9XG4gIC8vIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgLy8gb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgLy8gZGF0ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIC8vIHRpbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICAvLyBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWVsZENoYW5nZSk7XG4gIC8vIGNvbmZpcm1DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBkZXZpY2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWNyZWF0aW9uX19kZWxpdmVyeS1kZXZpY2UnKTtcblxuICBpZiAoIWRldmljZXNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBkZXZpY2VzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICB2YXIgcmFkaW9zID0gaXRlbS5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtY3JlYXRpb25fX2RlbGl2ZXJ5LXR5cGUtd3JhcHBlciAgaW5wdXQnKTtcblxuICAgIGZ1bmN0aW9uIG9uUmFkaW9DaGFuZ2UoZSkge1xuICAgICAgdmFyIHdyYXBwZXIgPSBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcblxuICAgICAgaWYgKHJhZGlvc1swXS5jaGVja2VkKSB7XG4gICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdy1mb3ItcGlja3VwJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChyYWRpb3NbMV0uY2hlY2tlZCkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Nob3ctZm9yLXBpY2t1cCcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJhZGlvcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uUmFkaW9DaGFuZ2UpO1xuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWxpdmVyeS1vci1waWNrdXBfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciAkZGF0ZSA9ICQoJyNkZWxpdmVyeS1vci1waWNrdXBfX21vZGFsIC5kYXRlLWlucHV0Jyk7XG4gICRkYXRlLmRhdGVwaWNrZXIoKS5vbignY2hhbmdlJywgZnVuY3Rpb24gKGRhdGVUZXh0KSB7XG4gICAgaWYgKCQoJyNkZWxpdmVyeS1vci1waWNrdXBfX21vZGFsJykuaGFzQ2xhc3MoJ2pzLXNob3cnKSkge1xuICAgICAgb25GaWVsZENoYW5nZSgpO1xuICAgIH1cbiAgfSk7XG4gIHZhciBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgdmFyIG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgdmFyIHN1Ym1pdCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc3VibWl0Jyk7XG4gIHZhciBmaWxlSW5wdXRCbG9jayA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLWlucHV0LWZpbGUnKTtcbiAgdmFyIGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICB2YXIgZmlsZUNsZWFyID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fY2xlYXInKTtcbiAgdmFyIGRhdGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLWRhdGUnKTtcbiAgdmFyIHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgdmFyIGNvbmZpcm1DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGVja2JveF9faW5wdXQnKTtcblxuICB2YXIgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24gb25DbG9zZUNsaWNrKCkge1xuICAgIGlmIChmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QuY29udGFpbnMoJ2xvYWRlZCcpKSB7XG4gICAgICBmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcbiAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG5cbiAgICAgIGlmICghL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZGF0ZUlucHV0LnZhbHVlID0gJyc7XG4gICAgdGltZUlucHV0LnZhbHVlID0gJyc7XG4gICAgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAkZGF0ZS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICB9O1xuXG4gIHZhciBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uIG9uT3ZlcmxheUNsaWNrKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIG9uRmllbGRDaGFuZ2UgPSBmdW5jdGlvbiBvbkZpZWxkQ2hhbmdlKGUpIHtcbiAgICBpZiAoaXNGb3JtRmlsbGVkKCkgJiYgc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc3VibWl0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9IGVsc2UgaWYgKCFpc0Zvcm1GaWxsZWQoKSAmJiAhc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbkZpbGVDbGVhciA9IGZ1bmN0aW9uIG9uRmlsZUNsZWFyKCkge1xuICAgIGlmICghc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBpc0Zvcm1GaWxsZWQgPSBmdW5jdGlvbiBpc0Zvcm1GaWxsZWQoKSB7XG4gICAgcmV0dXJuICRkYXRlLmRhdGVwaWNrZXIoJ2dldERhdGUnKSAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnICYmIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID09PSB0cnVlICYmIGZpbGVJbnB1dC52YWx1ZSAhPT0gJyc7XG4gIH07XG5cbiAgd2luZG93Lm9uRGVsaXZlcnlGaWxlRHJvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICBvbkZpZWxkQ2hhbmdlKCk7XG4gIH07XG5cbiAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuICBkYXRlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgdGltZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cub25EZWxpdmVyeUZpbGVEcm9wKTtcbiAgY29uZmlybUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmllbGRDaGFuZ2UpO1xuICBmaWxlQ2xlYXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkZpbGVDbGVhcik7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgbWVudSA9ICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLW1lbnUnKTtcbiAgdmFyIGJ0biA9ICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLWJ0bicpO1xuICAkLmV4dGVuZCgkLmRhdGVwaWNrZXIsIHtcbiAgICAvLyBSZWZlcmVuY2UgdGhlIG9yaWduYWwgZnVuY3Rpb24gc28gd2UgY2FuIG92ZXJyaWRlIGl0IGFuZCBjYWxsIGl0IGxhdGVyXG4gICAgX2lubGluZURhdGVwaWNrZXIyOiAkLmRhdGVwaWNrZXIuX2lubGluZURhdGVwaWNrZXIsXG4gICAgLy8gT3ZlcnJpZGUgdGhlIF9pbmxpbmVEYXRlcGlja2VyIG1ldGhvZFxuICAgIF9pbmxpbmVEYXRlcGlja2VyOiBmdW5jdGlvbiBfaW5saW5lRGF0ZXBpY2tlcih0YXJnZXQsIGluc3QpIHtcbiAgICAgIC8vIENhbGwgdGhlIG9yaWdpbmFsXG4gICAgICB0aGlzLl9pbmxpbmVEYXRlcGlja2VyMih0YXJnZXQsIGluc3QpO1xuXG4gICAgICB2YXIgYmVmb3JlU2hvdyA9ICQuZGF0ZXBpY2tlci5fZ2V0KGluc3QsICdiZWZvcmVTaG93Jyk7XG5cbiAgICAgIGlmIChiZWZvcmVTaG93KSB7XG4gICAgICAgIGJlZm9yZVNob3cuYXBwbHkodGFyZ2V0LCBbdGFyZ2V0LCBpbnN0XSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbiAgJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLW1lbnUnKS50b2dnbGUoKTtcbiAgfSk7XG4gICQoJyNlYXJuZWQtZGF0ZScpLmRhdGVwaWNrZXIoe1xuICAgIHJhbmdlOiAncGVyaW9kJyxcbiAgICBpbmxpbmU6IHRydWUsXG4gICAgc2hvd0J1dHRvblBhbmVsOiB0cnVlLFxuICAgIHNob3dPdGhlck1vbnRoczogdHJ1ZSxcbiAgICBzZWxlY3RPdGhlck1vbnRoczogdHJ1ZSxcbiAgICBjbG9zZVRleHQ6IFwi0JPQvtGC0L7QstC+XCIsXG4gICAgZGF0ZUZvcm1hdDogJ2RkLm1tLnl5JyxcbiAgICBiZWZvcmVTaG93OiBmdW5jdGlvbiBiZWZvcmVTaG93KGlucHV0LCBpbnN0KSB7XG4gICAgICBpbnN0LmRwRGl2LmNzcygndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZVgoLTI0cHgpJyk7XG4gICAgICBpbnN0LmRwRGl2LmFkZENsYXNzKCdjYWxlbmRhci1yYW5nZScpO1xuICAgIH0sXG4gICAgb25TZWxlY3Q6IGZ1bmN0aW9uIG9uU2VsZWN0KGRhdGVUZXh0LCBpbnN0LCBleHRlbnNpb25SYW5nZSkge1xuICAgICAgJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJykudGV4dChleHRlbnNpb25SYW5nZS5zdGFydERhdGVUZXh0ICsgJyAtICcgKyBleHRlbnNpb25SYW5nZS5lbmREYXRlVGV4dCk7XG4gICAgfVxuICB9KTtcbiAgJChkb2N1bWVudCkubW91c2V1cChmdW5jdGlvbiAoZSkge1xuICAgIHZhciBtZW51ID0gJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtbWVudScpO1xuICAgIHZhciBidG4gPSAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKTtcblxuICAgIGlmICghbWVudS5pcyhlLnRhcmdldCkgJiYgbWVudS5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMCAmJiAhYnRuLmlzKGUudGFyZ2V0KSAmJiBidG4uaGFzKGUudGFyZ2V0KS5sZW5ndGggPT09IDApIHtcbiAgICAgIG1lbnUuaGlkZSgpO1xuICAgIH1cbiAgfSk7XG4gICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLW1lbnUtYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdhbGwtdGltZScpKSB7XG4gICAgICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKS50ZXh0KCQodGhpcykudGV4dCgpICsgXCIgKFxcdTA0NDFcXHhBMFwiICsgJCgnLmVhcm5lZC1kYXRlX19zdGFydC1wZXJpb2QnKS50ZXh0KCkgKyAnKScpO1xuICAgIH0gZWxzZSB7XG4gICAgICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKS50ZXh0KCQodGhpcykudGV4dCgpKTtcbiAgICB9XG5cbiAgICBtZW51LmhpZGUoKTtcbiAgfSk7XG4gICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLWJ0bicpLnRleHQoJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtbWVudS1idG4uYWxsLXRpbWUnKS50ZXh0KCkgKyBcIiAoXFx1MDQ0MVxceEEwXCIgKyAkKCcuZWFybmVkLWRhdGVfX3N0YXJ0LXBlcmlvZCcpLnRleHQoKSArICcpJyk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAkKCcuZmlsdGVyc19fYnRuJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xuICAkKCcuZmlsdGVyc19fYnRuLWNsZWFyJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICQoJy5maWx0ZXJzIC5zZWxlY3QnKS52YWwoJ9CS0YHQtScpO1xuICAgICQoJy5maWx0ZXJzIC5zZWxlY3QnKS50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAkKCcuZmlsdGVycyAuc2VsZWN0JykucmVtb3ZlQ2xhc3MoJ3BpY2tlZCcpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaW5zdGFsbGF0aW9uLWFjY291bnRzLW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNsaWRlciA9IG5ldyBTd2lwZXIoJy5pbnN0YWxsYXRpb24tYWNjb3VudHMtbW9iaWxlX19zbGlkZXInLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy5pbnN0YWxsYXRpb24tYWNjb3VudHMtbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlXG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBkZWxpdmVyeUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5zdGFsbGF0aW9uX19jb25maXJtLWJ0bicpO1xuXG4gIGlmICghZGVsaXZlcnlCdG5zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9IC8vICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcigpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihkYXRlVGV4dCkge1xuICAvLyAgIG9uRmllbGRDaGFuZ2UoKTtcbiAgLy8gfSk7XG5cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zdGFsbGF0aW9uX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH0gLy8gY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIC8vIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgLy8gY29uc3Qgc3VibWl0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQnKTtcbiAgLy8gY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIC8vIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICAvLyBjb25zdCBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1kYXRlJyk7XG4gIC8vIGNvbnN0IHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgLy8gY29uc3QgY29uZmlybUNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoZWNrYm94X19pbnB1dCcpO1xuXG5cbiAgZGVsaXZlcnlCdG5zLmZvckVhY2goZnVuY3Rpb24gKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7IC8vY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vIGlmIChmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QuY29udGFpbnMoJ2xvYWRlZCcpKSB7XG4gIC8vICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gIC8vICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gIC8vICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgLy8gICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gIC8vICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gICBkYXRlSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICB0aW1lSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAvLyAgICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgLy8gfVxuICAvLyBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gIC8vICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gY29uc3Qgb25GaWVsZENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoaXNGb3JtRmlsbGVkKCkgJiYgc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAvLyAgICAgc3VibWl0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgLy8gICB9IGVsc2UgaWYgKCFpc0Zvcm1GaWxsZWQoKSAmJiAhc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAvLyAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vIGNvbnN0IGlzRm9ybUZpbGxlZCA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIHJldHVybiAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoJ2dldERhdGUnKVxuICAvLyAgICAgJiYgdGltZUlucHV0LnZhbHVlICE9PSAnJ1xuICAvLyAgICAgJiYgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPT09IHRydWVcbiAgLy8gICAgIC8vJiYgZmlsZUlucHV0LnZhbHVlICE9PSAnJ1xuICAvLyB9XG4gIC8vIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgLy8gb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgLy8gZGF0ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIC8vIHRpbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICAvL2ZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgLy9jb25maXJtQ2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWVsZENoYW5nZSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgcmFkaW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGl2ZXJ5LW9yLXBpY2t1cF9faW5zdGFsbGF0aW9uLWNob29zZS1ibG9jayAgaW5wdXQnKTtcblxuICBpZiAoIXJhZGlvc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciB3cmFwcGVyID0gcmFkaW9zWzBdLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG5cbiAgZnVuY3Rpb24gb25SYWRpb0NoYW5nZSgpIHtcbiAgICBjb25zb2xlLmxvZyh3cmFwcGVyKTtcblxuICAgIGlmIChyYWRpb3NbMF0uY2hlY2tlZCkge1xuICAgICAgaWYgKHdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1tYW51YWwnKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3ctZm9yLW1hbnVhbCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAod3JhcHBlci5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3ctZm9yLXJlZ2lzdHJhdGlvbicpKSB7XG4gICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdy1mb3ItcmVnaXN0cmF0aW9uJyk7XG4gICAgICB9XG5cbiAgICAgIGlmICghd3JhcHBlci5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3ctZm9yLWRlbGl2ZXJ5JykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKCdzaG93LWZvci1kZWxpdmVyeScpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyYWRpb3NbMV0uY2hlY2tlZCkge1xuICAgICAgaWYgKHdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1tYW51YWwnKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3ctZm9yLW1hbnVhbCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAod3JhcHBlci5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3ctZm9yLWRlbGl2ZXJ5JykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1kZWxpdmVyeScpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1yZWdpc3RyYXRpb24nKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Nob3ctZm9yLXJlZ2lzdHJhdGlvbicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyYWRpb3NbMl0uY2hlY2tlZCkge1xuICAgICAgaWYgKHdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1kZWxpdmVyeScpKSB7XG4gICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdy1mb3ItZGVsaXZlcnknKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1yZWdpc3RyYXRpb24nKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3ctZm9yLXJlZ2lzdHJhdGlvbicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1tYW51YWwnKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Nob3ctZm9yLW1hbnVhbCcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJhZGlvcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvblJhZGlvQ2hhbmdlKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAvLyBjb25zdCBkZWxpdmVyeUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5zdGFsbGF0aW9uX19jb25maXJtLWJ0bicpO1xuICAvLyBpZiAoIWRlbGl2ZXJ5QnRuc1swXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zdGFsbGF0aW9uX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgJGRhdGUgPSAkKCcjaW5zdGFsbGF0aW9uX19tb2RhbCAuZGF0ZS1pbnB1dCcpO1xuICAkZGF0ZS5kYXRlcGlja2VyKCkub24oJ2NoYW5nZScsIGZ1bmN0aW9uIChkYXRlVGV4dCkge1xuICAgIGlmICgkKCcjaW5zdGFsbGF0aW9uX19tb2RhbCcpLmhhc0NsYXNzKCdqcy1zaG93JykpIHtcbiAgICAgIG9uRmllbGRDaGFuZ2UoKTtcbiAgICB9XG4gIH0pO1xuICB2YXIgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIHZhciBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIHZhciBzdWJtaXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3N1Ym1pdCcpO1xuICB2YXIgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIHZhciBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgdmFyIGZpbGVDbGVhciA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG4gIHZhciBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1kYXRlJyk7XG4gIHZhciB0aW1lSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC10aW1lJyk7XG4gIHZhciBjb25maXJtQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuY2hlY2tib3hfX2lucHV0Jyk7IC8vIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAvLyAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgLy8gfSk7XG5cbiAgdmFyIG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uIG9uQ2xvc2VDbGljaygpIHtcbiAgICBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAgICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuXG4gICAgICBpZiAoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRhdGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHRpbWVJbnB1dC52YWx1ZSA9ICcnO1xuICAgIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gICAgJGRhdGUuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgfTtcblxuICB2YXIgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbiBvbk92ZXJsYXlDbGljayhlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAgICAgb25DbG9zZUNsaWNrKCk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbkZpZWxkQ2hhbmdlID0gZnVuY3Rpb24gb25GaWVsZENoYW5nZShlKSB7XG4gICAgaWYgKGlzRm9ybUZpbGxlZCgpICYmIHN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIGlmICghaXNGb3JtRmlsbGVkKCkgJiYgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgaXNGb3JtRmlsbGVkID0gZnVuY3Rpb24gaXNGb3JtRmlsbGVkKCkge1xuICAgIHJldHVybiAkZGF0ZS5kYXRlcGlja2VyKCdnZXREYXRlJykgJiYgdGltZUlucHV0LnZhbHVlICE9PSAnJyAmJiBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9PT0gdHJ1ZSAmJiBmaWxlSW5wdXQudmFsdWUgIT09ICcnO1xuICB9O1xuXG4gIHZhciBvbkZpbGVDbGVhciA9IGZ1bmN0aW9uIG9uRmlsZUNsZWFyKCkge1xuICAgIGlmICghc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9O1xuXG4gIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wID0gZnVuY3Rpb24gKCkge1xuICAgIG9uRmllbGRDaGFuZ2UoKTtcbiAgfTtcblxuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIGRhdGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICB0aW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wKTtcbiAgY29uZmlybUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmllbGRDaGFuZ2UpO1xuICBmaWxlQ2xlYXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkZpbGVDbGVhcik7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgcGF5bWVudENvbmZpcm1CdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm11dHVhbC1jYWxjc19fbWFrZS1wYXltZW50Jyk7XG5cbiAgaWYgKCFwYXltZW50Q29uZmlybUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5bWVudC13YWl0aW5nX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH0gLy8gY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIC8vIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgLy8gY29uc3QgbWFpbkNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnRyYW5zYWN0aW9uc19fY2hlY2stYWxsIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHNlbmRlcklucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc2VuZGVyIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHJlY2lwaWVudElucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcmVjaXBpZW50IGlucHV0Jyk7XG4gIC8vIGNvbnN0IHN1bUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc3VtIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHB1cnBvc2VJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXB1cnBvc2UgaW5wdXQnKTtcbiAgLy8gY29uc3QgZ2V0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbigpIHtcbiAgLy8gICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fY2hlY2sgaW5wdXQnKTtcbiAgLy8gfTtcbiAgLy8gY29uc3Qgb25BbGxDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgY29uc3Qgcm93ID0gaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAvLyAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gIC8vICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG4gIC8vICAgICAgIGlmICghcm93LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpKSB7XG4gIC8vICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgLy8gICAgICAgfVxuICAvLyAgICAgfSBlbHNlIHtcbiAgLy8gICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgICAgIGlmIChyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgLy8gICAgICAgICByb3cuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9XG4gIC8vICAgfSlcbiAgLy8gfTtcbiAgLy8gY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgbWFpbkNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgLy8gICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgICBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgIH0pO1xuICAvLyAgICQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAvLyAgIHNlbmRlcklucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgcmVjaXBpZW50SW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICBzdW1JbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHB1cnBvc2VJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyB9O1xuICAvLyBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gIC8vICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gY29uc3Qgb25DaGVja2JveENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2hlY2tlZCkge1xuICAvLyAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjaGVja2VkJyk7XG4gIC8vICAgfSBlbHNlIHtcbiAgLy8gICAgIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG5cbiAgcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24gKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7IC8vIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgLy8gb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgLy8gbWFpbkNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQWxsQ2hhbmdlKTtcbiAgLy8gZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQ2hlY2tib3hDaGFuZ2UpO1xuICAvLyB9KVxufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIG1lbnVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyX19uYXYtYnRuJyk7XG5cbiAgaWYgKCFtZW51QnRuKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGNsb3NlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlcl9fY2xvc2UtYnRuJyk7XG4gIHZhciBuYXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyX19uYXYnKTtcblxuICB2YXIgY2hlY2tJZlRhYmxldCA9IGZ1bmN0aW9uIGNoZWNrSWZUYWJsZXQoKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5tYXRjaE1lZGlhKCcobWF4LXdpZHRoOiAxNDM5cHgpJykubWF0Y2hlcztcbiAgfTtcblxuICB2YXIgaXNUYWJsZXQgPSBjaGVja0lmVGFibGV0KCk7XG5cbiAgdmFyIG9uQnRuQ2xpY2sgPSBmdW5jdGlvbiBvbkJ0bkNsaWNrKCkge1xuICAgIGlmIChjaGVja0lmVGFibGV0KCkpIHtcbiAgICAgIG1lbnVCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnanMtb3BlbmVkJyk7XG4gICAgICBuYXYuY2xhc3NMaXN0LnRvZ2dsZSgnanMtc2hvdycpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24gb25DbG9zZUNsaWNrKCkge1xuICAgIG5hdi5jbGFzc0xpc3QucmVtb3ZlKCdqcy1zaG93Jyk7XG4gICAgbWVudUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdqcy1vcGVuZWQnKTtcbiAgfTtcblxuICBtZW51QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25CdG5DbGljayk7XG4gIGNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXV0dWFsLWNhbGNzLXBheW1lbnQtbW9iaWxlJyk7XG5cbiAgaWYgKCFjb250cmFjdHMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgc2xpZGVyID0gbmV3IFN3aXBlcignLm11dHVhbC1jYWxjcy1wYXltZW50LW1vYmlsZV9fc2xpZGVyJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcubXV0dWFsLWNhbGNzLXBheW1lbnQtbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlXG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXV0dWFsLWNhbGNzLWJsb2NrLW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNsaWRlciA9IG5ldyBTd2lwZXIoJy5tdXR1YWwtY2FsY3MtYmxvY2stbW9iaWxlX19zbGlkZXInLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy5tdXR1YWwtY2FsY3MtYmxvY2stbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlXG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBwYXNzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXBhc3N3b3JkJyk7XG5cbiAgaWYgKCFwYXNzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5pbnB1dC1pY29uLS1zaG93LXBhc3N3b3JkJywgZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAkKHRoaXMpLm5leHQoKS5hdHRyKCd0eXBlJywgJ3RleHQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJCh0aGlzKS5uZXh0KCkuYXR0cigndHlwZScsICdwYXNzd29yZCcpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgcGF5bWVudENvbmZpcm1CdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBheW1lbnQtd2FpdGluZ19fY29uZmlybS1idG4nKTtcblxuICBpZiAoIXBheW1lbnRDb25maXJtQnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfSAvLyQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCk7XG5cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5bWVudC13YWl0aW5nX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH0gLy8gY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIC8vIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgLy8gY29uc3QgbWFpbkNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnRyYW5zYWN0aW9uc19fY2hlY2stYWxsIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHNlbmRlcklucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc2VuZGVyIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHJlY2lwaWVudElucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcmVjaXBpZW50IGlucHV0Jyk7XG4gIC8vIGNvbnN0IHN1bUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc3VtIGlucHV0Jyk7XG4gIC8vIGNvbnN0IHB1cnBvc2VJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXB1cnBvc2UgaW5wdXQnKTtcbiAgLy8gY29uc3QgZ2V0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbigpIHtcbiAgLy8gICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fY2hlY2sgaW5wdXQnKTtcbiAgLy8gfTtcbiAgLy8gY29uc3Qgb25BbGxDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgY29uc3Qgcm93ID0gaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuICAvLyAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gIC8vICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG4gIC8vICAgICAgIGlmICghcm93LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpKSB7XG4gIC8vICAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgLy8gICAgICAgfVxuICAvLyAgICAgfSBlbHNlIHtcbiAgLy8gICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgICAgIGlmIChyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgLy8gICAgICAgICByb3cuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9XG4gIC8vICAgfSlcbiAgLy8gfTtcbiAgLy8gY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgbWFpbkNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgLy8gICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgICBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgIH0pO1xuICAvLyAgICQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAvLyAgIHNlbmRlcklucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgcmVjaXBpZW50SW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICBzdW1JbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHB1cnBvc2VJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyB9O1xuICAvLyBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gIC8vICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgLy8gICB9XG4gIC8vIH1cbiAgLy8gY29uc3Qgb25DaGVja2JveENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2hlY2tlZCkge1xuICAvLyAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjaGVja2VkJyk7XG4gIC8vICAgfSBlbHNlIHtcbiAgLy8gICAgIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG5cbiAgcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24gKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7IC8vIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgLy8gb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgLy8gbWFpbkNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQWxsQ2hhbmdlKTtcbiAgLy8gZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQ2hlY2tib3hDaGFuZ2UpO1xuICAvLyB9KVxufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgLy8gY29uc3QgcGF5bWVudENvbmZpcm1CdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBheW1lbnQtd2FpdGluZ19fY29uZmlybS1idG4nKTtcbiAgLy8gaWYgKCFwYXltZW50Q29uZmlybUJ0bnNbMF0pIHtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheW1lbnQtd2FpdGluZ19fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICB2YXIgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICB2YXIgbWFpbkNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnRyYW5zYWN0aW9uc19fY2hlY2stYWxsIGlucHV0Jyk7XG4gIHZhciBzZW5kZXJJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXNlbmRlciBpbnB1dCcpO1xuICB2YXIgcmVjaXBpZW50SW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1yZWNpcGllbnQgaW5wdXQnKTtcbiAgdmFyIHN1bUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc3VtIGlucHV0Jyk7XG4gIHZhciBwdXJwb3NlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1wdXJwb3NlIGlucHV0Jyk7XG5cbiAgdmFyIGdldEFsbENoZWNrYm94ID0gZnVuY3Rpb24gZ2V0QWxsQ2hlY2tib3goKSB7XG4gICAgcmV0dXJuIG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2FjdGlvbnNfX2NoZWNrIGlucHV0Jyk7XG4gIH07XG5cbiAgdmFyIGdldEFsbE1vYmlsZUNoZWNrYm94ID0gZnVuY3Rpb24gZ2V0QWxsTW9iaWxlQ2hlY2tib3goKSB7XG4gICAgcmV0dXJuIG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy50cmFuc2FjdGlvbnNfX21vYmlsZS1jaGVjayBpbnB1dCcpO1xuICB9O1xuXG4gIHZhciBvbkFsbENoYW5nZSA9IGZ1bmN0aW9uIG9uQWxsQ2hhbmdlKCkge1xuICAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgdmFyIHJvdyA9IGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcblxuICAgICAgaWYgKG1haW5DaGVja2JveC5jaGVja2VkKSB7XG4gICAgICAgIGl0ZW0uY2hlY2tlZCA9IHRydWU7XG5cbiAgICAgICAgaWYgKCFyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgnY2hlY2tlZCcpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcblxuICAgICAgICBpZiAocm93LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpKSB7XG4gICAgICAgICAgcm93LmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIHZhciBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiBvbkNsb3NlQ2xpY2soKSB7XG4gICAgbWFpbkNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICB9KTtcbiAgICBnZXRBbGxNb2JpbGVDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gICAgfSk7XG4gICAgJCgnI3BheW1lbnQtZGF0ZScpLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG4gICAgc2VuZGVySW5wdXQudmFsdWUgPSAnJztcbiAgICByZWNpcGllbnRJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHN1bUlucHV0LnZhbHVlID0gJyc7XG4gICAgcHVycG9zZUlucHV0LnZhbHVlID0gJyc7XG4gIH07XG5cbiAgdmFyIG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24gb25PdmVybGF5Q2xpY2soZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgICAgIG9uQ2xvc2VDbGljaygpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgb25DaGVja2JveENoYW5nZSA9IGZ1bmN0aW9uIG9uQ2hlY2tib3hDaGFuZ2UoZSkge1xuICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7XG4gICAgICBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbk1vYmlsZUNoZWNrYm94Q2hhbmdlID0gZnVuY3Rpb24gb25Nb2JpbGVDaGVja2JveENoYW5nZShlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHtcbiAgICAgIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAgIH1cbiAgfTsgLy8gcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7XG4gIC8vICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICAvLyB9KTtcblxuXG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgbWFpbkNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQWxsQ2hhbmdlKTtcbiAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkNoZWNrYm94Q2hhbmdlKTtcbiAgfSk7XG4gIGdldEFsbE1vYmlsZUNoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25Nb2JpbGVDaGVja2JveENoYW5nZSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHBheW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm11dHVhbC1jYWxjcy1wYXltZW50LWJsb2NrX19saW5rJyk7XG5cbiAgaWYgKCFwYXltZW50c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXltZW50LWluZm9fX21vZGFsJyk7XG4gIHBheW1lbnRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIC8vICAgdmFyIGpiU2Nhbm5lcjtcbiAgLy8gZnVuY3Rpb24gb25RUkNvZGVTY2FubmVkKHNjYW5uZWRUZXh0KSB7XG4gIC8vICAgdmFyIHNjYW5uZWRUZXh0TWVtbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc3Vic2NyaWJlLXJlZ2lzdGVyX19pbnB1dCAgaW5wdXRcIik7XG4gIC8vICAgY29uc29sZS5sb2coc2Nhbm5lZFRleHRNZW1vKTtcbiAgLy8gICBpZihzY2FubmVkVGV4dE1lbW8pXG4gIC8vICAge1xuICAvLyAgICAgICBzY2FubmVkVGV4dE1lbW8udmFsdWUgPSBzY2FubmVkVGV4dDtcbiAgLy8gICAgICAgJChcIi5xci1zY2FubmVyLW1vZGFsXCIpLnJlbW92ZUNsYXNzKFwianMtc2hvd1wiKTtcbiAgLy8gICAgICAgamJTY2FubmVyLnN0b3BTY2FubmluZygpO1xuICAvLyAgIH1cbiAgLy8gfVxuICAvLyAgICAgICAgICAgICBmdW5jdGlvbiBwcm92aWRlVmlkZW8oKVxuICAvLyAgICAgICAgICAgICB7XG4gIC8vICAgICAgICAgICAgICAgICB2YXIgbiA9IG5hdmlnYXRvcjtcbiAgLy8gICAgICAgICAgICAgICAgIGlmIChuLm1lZGlhRGV2aWNlcyAmJiBuLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEpXG4gIC8vICAgICAgICAgICAgICAgICB7XG4gIC8vICAgICAgICAgICAgICAgICAgIHJldHVybiBuLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuICAvLyAgICAgICAgICAgICAgICAgICAgIHZpZGVvOiB7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICBmYWNpbmdNb2RlOiBcImVudmlyb25tZW50XCJcbiAgLy8gICAgICAgICAgICAgICAgICAgICB9LFxuICAvLyAgICAgICAgICAgICAgICAgICAgIGF1ZGlvOiBmYWxzZVxuICAvLyAgICAgICAgICAgICAgICAgICB9KTtcbiAgLy8gICAgICAgICAgICAgICAgIH1cbiAgLy8gICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgZ2V0VXNlck1lZGlhJyk7XG4gIC8vICAgICAgICAgICAgIH1cbiAgLy8gICAgICAgICAgICAgZnVuY3Rpb24gcHJvdmlkZVZpZGVvUVEoKVxuICAvLyAgICAgICAgICAgICB7XG4gIC8vICAgICAgICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKClcbiAgLy8gICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRldmljZXMpIHtcbiAgLy8gICAgICAgICAgICAgICAgICAgICB2YXIgZXhDYW1lcmFzID0gW107XG4gIC8vICAgICAgICAgICAgICAgICAgICAgZGV2aWNlcy5mb3JFYWNoKGZ1bmN0aW9uKGRldmljZSkge1xuICAvLyAgICAgICAgICAgICAgICAgICAgIGlmIChkZXZpY2Uua2luZCA9PT0gJ3ZpZGVvaW5wdXQnKSB7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgZXhDYW1lcmFzLnB1c2goZGV2aWNlLmRldmljZUlkKVxuICAvLyAgICAgICAgICAgICAgICAgICAgIH1cbiAgLy8gICAgICAgICAgICAgICAgIH0pO1xuICAvLyAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZXhDYW1lcmFzKTtcbiAgLy8gICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oaWRzKXtcbiAgLy8gICAgICAgICAgICAgICAgICAgICBpZihpZHMubGVuZ3RoID09PSAwKVxuICAvLyAgICAgICAgICAgICAgICAgICAgIHtcbiAgLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ0NvdWxkIG5vdCBmaW5kIGEgd2ViY2FtJyk7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgfVxuICAvLyAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvOiB7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICAgICdvcHRpb25hbCc6IFt7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlSWQnOiBpZHMubGVuZ3RoID09PSAxID8gaWRzWzBdIDogaWRzWzFdLy90aGlzIHdheSBRUSBicm93c2VyIG9wZW5zIHRoZSByZWFyIGNhbWVyYVxuICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAvLyAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAvLyAgICAgICAgICAgICAgICAgfSk7XG4gIC8vICAgICAgICAgICAgIH1cbiAgLy8gICAkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnN1YnNjcmliZS1yZWdpc3Rlcl9fYnRuXCIsIChlKSA9PiB7XG4gIC8vICAgICAgICAgICAgICAgaWYgKGpiU2Nhbm5lcikge1xuICAvLyAgICAgICAgICAgICAgICAgICBqYlNjYW5uZXIucmVzdW1lU2Nhbm5pbmcoKTtcbiAgLy8gICAgICAgICAgICAgICB9IGVsc2Uge1xuICAvLyAgICAgICAgICAgICAgICAgICBqYlNjYW5uZXIgPSBuZXcgSnNRUlNjYW5uZXIob25RUkNvZGVTY2FubmVkKTtcbiAgLy8gICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coamJTY2FubmVyKTtcbiAgLy8gICAgICAgICAgICAgICAgICAgamJTY2FubmVyLnNldFNuYXBJbWFnZU1heFNpemUoMzAwKTtcbiAgLy8gICAgICAgICAgICAgICAgICAgdmFyIHNjYW5uZXJQYXJlbnRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJqcy12aWRlby1ib3hcIik7XG4gIC8vICAgICAgICAgICAgICAgICAgIGlmKHNjYW5uZXJQYXJlbnRFbGVtZW50KVxuICAvLyAgICAgICAgICAgICAgICAgICB7XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICAvL2FwcGVuZCB0aGUgamJTY2FubmVyIHRvIGFuIGV4aXN0aW5nIERPTSBlbGVtZW50XG4gIC8vICAgICAgICAgICAgICAgICAgICAgICBqYlNjYW5uZXIuYXBwZW5kVG8oc2Nhbm5lclBhcmVudEVsZW1lbnQpO1xuICAvLyAgICAgICAgICAgICAgICAgICB9XG4gIC8vICAgICAgICAgICAgICAgfVxuICAvLyAgIH0pO1xuICAvLyAgICQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucXItc2Nhbm5lci1tb2RhbCAucXItc2Nhbm5lci1tb2RhbF9fY2xvc2VcIiwgKGUpID0+IHtcbiAgLy8gICAgICAgamJTY2FubmVyLnN0b3BTY2FubmluZygpO1xuICAvLyAgIH0pO1xuICB2YXIgc2Nhbm5lclBhcmVudEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImpzLXZpZGVvLWJveFwiKTtcbiAgdmFyIGpiU2Nhbm5lcjtcbiAgJCgnLnN1YnNjcmliZS1yZWdpc3Rlcl9faW5wdXQgLmlucHV0LXRleHQnKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHtcbiAgICB2YXIgJGlucHV0ID0gJCh0aGlzKTsgLy8gZnVuY3Rpb24gb25RUkNvZGVTY2FubmVkKHNjYW5uZWRUZXh0KSB7XG4gICAgLy8gICAgICAgJGlucHV0LnZhbChzY2FubmVkVGV4dCk7XG4gICAgLy8gICAgICAgJChcIi5xci1zY2FubmVyLW1vZGFsXCIpLnJlbW92ZUNsYXNzKFwianMtc2hvd1wiKTtcbiAgICAvLyAgICAgICBqYlNjYW5uZXIuc3RvcFNjYW5uaW5nKCk7XG4gICAgLy8gfVxuXG4gICAgZnVuY3Rpb24gb25RUkNvZGVTY2FubmVkKGVsKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKHNjYW5uZWRUZXh0KSB7XG4gICAgICAgIGVsLnZhbChzY2FubmVkVGV4dCk7XG4gICAgICAgICQoXCIucXItc2Nhbm5lci1tb2RhbFwiKS5yZW1vdmVDbGFzcyhcImpzLXNob3dcIik7XG4gICAgICAgIGpiU2Nhbm5lci5zdG9wU2Nhbm5pbmcoKTtcbiAgICAgICAgamJTY2FubmVyLnJlbW92ZUZyb20oc2Nhbm5lclBhcmVudEVsZW1lbnQpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwcm92aWRlVmlkZW8oKSB7XG4gICAgICB2YXIgbiA9IG5hdmlnYXRvcjtcblxuICAgICAgaWYgKG4ubWVkaWFEZXZpY2VzICYmIG4ubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSkge1xuICAgICAgICByZXR1cm4gbi5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHtcbiAgICAgICAgICB2aWRlbzoge1xuICAgICAgICAgICAgZmFjaW5nTW9kZTogXCJlbnZpcm9ubWVudFwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhdWRpbzogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgZ2V0VXNlck1lZGlhJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcHJvdmlkZVZpZGVvUVEoKSB7XG4gICAgICByZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKCkudGhlbihmdW5jdGlvbiAoZGV2aWNlcykge1xuICAgICAgICB2YXIgZXhDYW1lcmFzID0gW107XG4gICAgICAgIGRldmljZXMuZm9yRWFjaChmdW5jdGlvbiAoZGV2aWNlKSB7XG4gICAgICAgICAgaWYgKGRldmljZS5raW5kID09PSAndmlkZW9pbnB1dCcpIHtcbiAgICAgICAgICAgIGV4Q2FtZXJhcy5wdXNoKGRldmljZS5kZXZpY2VJZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShleENhbWVyYXMpO1xuICAgICAgfSkudGhlbihmdW5jdGlvbiAoaWRzKSB7XG4gICAgICAgIGlmIChpZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdDb3VsZCBub3QgZmluZCBhIHdlYmNhbScpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHtcbiAgICAgICAgICB2aWRlbzoge1xuICAgICAgICAgICAgJ29wdGlvbmFsJzogW3tcbiAgICAgICAgICAgICAgJ3NvdXJjZUlkJzogaWRzLmxlbmd0aCA9PT0gMSA/IGlkc1swXSA6IGlkc1sxXSAvL3RoaXMgd2F5IFFRIGJyb3dzZXIgb3BlbnMgdGhlIHJlYXIgY2FtZXJhXG5cbiAgICAgICAgICAgIH1dXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgICRpbnB1dC5zaWJsaW5ncygnLnN1YnNjcmliZS1yZWdpc3Rlcl9fYnRuJykub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgamJTY2FubmVyID0gbmV3IEpzUVJTY2FubmVyKG9uUVJDb2RlU2Nhbm5lZCgkaW5wdXQpKTsgLy9jb25zb2xlLmxvZyhqYlNjYW5uZXIpO1xuXG4gICAgICBqYlNjYW5uZXIuc2V0U25hcEltYWdlTWF4U2l6ZSgzMDApOyAvL3ZhciBzY2FubmVyUGFyZW50RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwianMtdmlkZW8tYm94XCIpO1xuXG4gICAgICBpZiAoc2Nhbm5lclBhcmVudEVsZW1lbnQpIHtcbiAgICAgICAgc2Nhbm5lclBhcmVudEVsZW1lbnQuaW5uZXJIVE1MID0gJyc7IC8vYXBwZW5kIHRoZSBqYlNjYW5uZXIgdG8gYW4gZXhpc3RpbmcgRE9NIGVsZW1lbnRcblxuICAgICAgICBqYlNjYW5uZXIuYXBwZW5kVG8oc2Nhbm5lclBhcmVudEVsZW1lbnQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgJChkb2N1bWVudCkub24oXCJjbGlja1wiLCBcIi5xci1zY2FubmVyLW1vZGFsIC5xci1zY2FubmVyLW1vZGFsX19jbG9zZVwiLCBmdW5jdGlvbiAoZSkge1xuICAgIGpiU2Nhbm5lci5zdG9wU2Nhbm5pbmcoKTtcbiAgICBqYlNjYW5uZXIucmVtb3ZlRnJvbShzY2FubmVyUGFyZW50RWxlbWVudCk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHJld2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdWJzY3JpcHRpb24tcGFnZV9fcmV3YXJkLW1vYmlsZScpO1xuXG4gIGlmICghcmV3YXJkKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIHNsaWRlciA9IG5ldyBTd2lwZXIoJy5zdWJzY3JpcHRpb24tcGFnZV9fcmV3YXJkLW1vYmlsZScsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLnN1YnNjcmlwdGlvbi1wYWdlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlXG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBzY2hlZHVsZUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtZGV2aWNlX19zY2hlZHVsZScpO1xuXG4gIGlmICghc2NoZWR1bGVCdG5zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjaGVkdWxlX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH0gLy8gY29uc3QgcmFkaW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNjaGVkdWxlX19tb2RhbC10b2dnbGUgaW5wdXQnKTtcbiAgLy8gY29uc3QgdG9nZ2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlX19tb2RhbC10b2dnbGUnKTtcbiAgLy8gcmFkaW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaWQpIHtcbiAgLy8gICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAvLyAgICAgaWYgKGlkID09PSAwKSB7XG4gIC8vICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QucmVtb3ZlKCdzZWNvbmQtdGFiJyk7XG4gIC8vICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QuYWRkKCdmaXJzdC10YWInKTtcbiAgLy8gICAgIH1cbiAgLy8gICAgIGlmIChpZCA9PT0gMSkge1xuICAvLyAgICAgICB0b2dnbGUuY2xhc3NMaXN0LnJlbW92ZSgnZmlyc3QtdGFiJyk7XG4gIC8vICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QuYWRkKCdzZWNvbmQtdGFiJyk7XG4gIC8vICAgICB9XG4gIC8vICAgfSlcbiAgLy8gfSlcblxuXG4gIHNjaGVkdWxlQnRucy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAvLyBjb25zdCBzY2hlZHVsZUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtZGV2aWNlX19zY2hlZHVsZScpO1xuICAvLyBpZiAoIXNjaGVkdWxlQnRuc1swXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NoZWR1bGVfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciByYWRpb3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2NoZWR1bGVfX21vZGFsLXRvZ2dsZSBpbnB1dCcpO1xuICB2YXIgdG9nZ2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlX19tb2RhbC10b2dnbGUnKTtcbiAgcmFkaW9zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGlkKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaWQgPT09IDApIHtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5yZW1vdmUoJ3NlY29uZC10YWInKTtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5hZGQoJ2ZpcnN0LXRhYicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaWQgPT09IDEpIHtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5yZW1vdmUoJ2ZpcnN0LXRhYicpO1xuICAgICAgICB0b2dnbGUuY2xhc3NMaXN0LmFkZCgnc2Vjb25kLXRhYicpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTsgLy8gc2NoZWR1bGVCdG5zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIC8vIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHt9KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgbWFpblBhZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWFpbi1wYWdlJyk7XG5cbiAgaWYgKCFtYWluUGFnZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBzdXBwb3J0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1cHBvcnQnKTtcbiAgdmFyIHN1cHBvcnRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3VwcG9ydF9fY29udGFpbmVyJyk7XG4gIHZhciBpdGVtcyA9IHN1cHBvcnQucXVlcnlTZWxlY3RvckFsbCgnLnN1cHBvcnRfX2l0ZW0nKTtcblxuICBmdW5jdGlvbiBtYWtlU2xpZGVyKCkge1xuICAgIHZhciBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3N3aXBlci1jb250YWluZXInKTtcbiAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc3VwcG9ydF9fc2xpZGVyJyk7XG4gICAgdmFyIHdyYXBwZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3N3aXBlci13cmFwcGVyJyk7XG4gICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaWR4KSB7XG4gICAgICB2YXIgc2xpZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIHNsaWRlLmNsYXNzTGlzdC5hZGQoJ3N3aXBlci1zbGlkZScpO1xuICAgICAgdmFyIG5vZGUgPSBpdGVtLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgIHNsaWRlLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChzbGlkZSk7XG4gICAgfSk7XG4gICAgdmFyIHBhZ2luYXRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBwYWdpbmF0aW9uLmNsYXNzTGlzdC5hZGQoJ3N1cHBvcnRfX3NsaWRlci1wYWdpbmF0aW9uJywgJ3N3aXBlci1wYWdpbmF0aW9uJyk7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHdyYXBwZXIpO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChwYWdpbmF0aW9uKTtcbiAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuICAgIHN1cHBvcnRDb250YWluZXIuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuICAgIHZhciBzbGlkZXIgPSBuZXcgU3dpcGVyKCcuc3VwcG9ydF9fc2xpZGVyJywge1xuICAgICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICAgIHBhZ2luYXRpb246IHtcbiAgICAgICAgZWw6ICcuc3VwcG9ydF9fc2xpZGVyLXBhZ2luYXRpb24nXG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBtYWtlU2xpZGVyKCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAkKCcuc3VwcG9ydF9fZG9jcy1idG4nKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgdHJhbnNhY3Rpb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRyYW5zYWN0aW9ucy1tb2JpbGUtYmxvY2snKTtcblxuICBpZiAoIXRyYW5zYWN0aW9ucykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBzbGlkZXIgPSBuZXcgU3dpcGVyKCcudHJhbnNhY3Rpb25zLW1vYmlsZS1ibG9ja19fc2xpZGVyJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcudHJhbnNhY3Rpb25zLW1vYmlsZS1ibG9ja19fcGFnaW5hdGlvbicsXG4gICAgICBkeW5hbWljQnVsbGV0czogdHJ1ZVxuICAgIH1cbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAkKCcuaGVhZGVyX191c2VyLWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCQodGhpcykuaXMoZS50YXJnZXQpKSB7XG4gICAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdhY3RpdmUnKTtcbiAgICB9XG4gIH0pO1xuICAkKGRvY3VtZW50KS5vbignbW91c2V1cCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIGJsb2NrID0gJCgnLmhlYWRlcl9fdXNlci1idG4nKTtcblxuICAgIGlmICghYmxvY2suaXMoZS50YXJnZXQpICYmIGJsb2NrLmhhcyhlLnRhcmdldCkubGVuZ3RoID09PSAwKSB7XG4gICAgICBibG9jay5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgfVxuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG5cbiAgaWYgKCF2ZXJpZmljYXRpb25CdG5bMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyaWZpY2F0aW9uX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH0gLy8gY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudmVyaWZpY2F0aW9uX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIC8vIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICAvLyBjb25zdCBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgLy8gY29uc3Qgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAvLyBjb25zdCBzYXZlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19zYXZlJyk7XG4gIC8vIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIGlmIChmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QuY29udGFpbnMoJ2xvYWRlZCcpKSB7XG4gIC8vICAgICBmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcbiAgLy8gICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgICAgc2F2ZUJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAvLyAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgLy8gICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgLy8gICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vIGNvbnN0IG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAvLyAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgLy8gICAgIG9uQ2xvc2VDbGljaygpO1xuICAvLyAgIH1cbiAgLy8gfVxuICAvLyBjb25zdCBvbklucHV0Q2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgaWYgKGZpbGVJbnB1dC52YWx1ZSAhPT0gJycpIHtcbiAgLy8gICAgIHNhdmVCdG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG5cbiAgdmVyaWZpY2F0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KTsgLy8gY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICAvLyBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuICAvLyBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25JbnB1dENoYW5nZSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAvLyBjb25zdCB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG4gIC8vIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG4gIHZhciBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2ZXJpZmljYXRpb25fX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBmaWxlSW5wdXRCbG9jayA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy52ZXJpZmljYXRpb25fX21vZGFsLWlucHV0LWZpbGUnKTsgLy9jb25zdCBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgLy9jb25zdCBmaWxlQ2xlYXIgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuXG4gIHZhciBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgdmFyIG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgdmFyIHNhdmVCdG4gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcblxuICB2YXIgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24gb25DbG9zZUNsaWNrKCkge1xuICAgIGZpbGVJbnB1dEJsb2NrLmZvckVhY2goZnVuY3Rpb24gKGlucHV0QmxvY2spIHtcbiAgICAgIHZhciBmaWxlSW5wdXQgPSBpbnB1dEJsb2NrLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuXG4gICAgICBpZiAoaW5wdXRCbG9jay5jbGFzc0xpc3QuY29udGFpbnMoJ2xvYWRlZCcpKSB7XG4gICAgICAgIGlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gICAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgICBzYXZlQnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG5cbiAgICAgICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfTtcblxuICB2YXIgY2hlY2tJbnB1dHMgPSBmdW5jdGlvbiBjaGVja0lucHV0cygpIHtcbiAgICB2YXIgZmlsbGVkID0gdHJ1ZTtcbiAgICBmaWxlSW5wdXRCbG9jay5mb3JFYWNoKGZ1bmN0aW9uIChpbnB1dEJsb2NrKSB7XG4gICAgICB2YXIgZmlsZUlucHV0ID0gaW5wdXRCbG9jay5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcblxuICAgICAgaWYgKGZpbGVJbnB1dC52YWx1ZSA9PT0gJycpIHtcbiAgICAgICAgZmlsbGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoZmlsbGVkICYmIHNhdmVCdG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBzYXZlQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICBpZiAoIWZpbGxlZCAmJiAhc2F2ZUJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHNhdmVCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24gb25PdmVybGF5Q2xpY2soZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgICAgIG9uQ2xvc2VDbGljaygpO1xuICAgIH1cbiAgfTsgLy8gY29uc3Qgb25JbnB1dENoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIGlmIChmaWxlSW5wdXQudmFsdWUgIT09ICcnKSB7XG4gIC8vICAgICBzYXZlQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgLy8gICB9XG4gIC8vIH1cblxuXG4gIHZhciBvbkZpbGVDbGVhciA9IGZ1bmN0aW9uIG9uRmlsZUNsZWFyKCkge1xuICAgIGlmICghc2F2ZUJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHNhdmVCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH07IC8vIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KVxuXG5cbiAgd2luZG93Lm9uVmVyaWZpY2F0aW9uRmlsZURyb3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2hlY2tJbnB1dHMoKTtcbiAgfTtcblxuICBmaWxlSW5wdXRCbG9jay5mb3JFYWNoKGZ1bmN0aW9uIChpbnB1dEJsb2NrKSB7XG4gICAgdmFyIGZpbGVJbnB1dCA9IGlucHV0QmxvY2sucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG4gICAgdmFyIGZpbGVDbGVhciA9IGlucHV0QmxvY2sucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fY2xlYXInKTtcbiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgd2luZG93Lm9uVmVyaWZpY2F0aW9uRmlsZURyb3ApO1xuICAgIGZpbGVDbGVhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uRmlsZUNsZWFyKTtcbiAgfSk7XG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjYW5jZWxsYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fc2VyaWFsLWJ0bicpO1xuXG4gIGlmICghY2FuY2VsbGF0aW9uQnRuWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dyaXRlLXNlcmlhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjYW5jZWxsYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgLy8gY29uc3QgdmVyaWZpY2F0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvbicpO1xuICAvLyBpZiAoIXZlcmlmaWNhdGlvbkJ0blswXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd3JpdGUtc2VyaWFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy53cml0ZS1zZXJpYWxfX2lucHV0IC5pbnB1dC10ZXh0Jyk7XG4gIHZhciBidG4gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcblxuICB2YXIgb25JbnB1dCA9IGZ1bmN0aW9uIG9uSW5wdXQoZSkge1xuICAgIHZhciB2YWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xuXG4gICAgaWYgKHZhbHVlLnNwbGl0KCcgJykuam9pbignJykgIT09ICcnICYmIHZhbHVlLmxlbmd0aCA+IDAgJiYgYnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgYnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG5cbiAgICBpZiAodmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJycgfHwgdmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICBpZiAoIWJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgICAgYnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgICB9XG4gICAgfVxuICB9OyAvLyB2ZXJpZmljYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgLy8gfSlcblxuXG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25JbnB1dCk7XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgY2hlY2tib3gyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNoZWNrYm94LTJfX2lucHV0Jyk7XG5cbiAgaWYgKCFjaGVja2JveDJbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjaGVja2JveDIuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbihlKSB7XG4gICAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICAgIGlmICh0YXJnZXQuY2hlY2tlZCA9PT0gdHJ1ZSkge1xuICAgICAgICB0YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjaGVja2VkJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0YXJnZXQucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAkKCcuZGF0ZS1pbnB1dDpub3QoLmRhdGUtaW5wdXQtcmFuZ2UpJykuZGF0ZXBpY2tlcih7ZGF0ZUZvcm1hdDogJ2RkLm1tLnl5J30pO1xuXG4gICQoJy5kYXRlLWlucHV0LXJhbmdlJykuZGF0ZXBpY2tlcih7XG4gICAgcmFuZ2U6ICdwZXJpb2QnLFxuICAgIGlubGluZTogdHJ1ZSxcbiAgICBzaG93QnV0dG9uUGFuZWw6IHRydWUsXG4gICAgc2hvd090aGVyTW9udGhzOiB0cnVlLFxuICAgIHNlbGVjdE90aGVyTW9udGhzOiB0cnVlLFxuICAgIGNsb3NlVGV4dCA6IFwi0JPQvtGC0L7QstC+XCIsXG4gICAgZGF0ZUZvcm1hdDogJ2RkLm1tLnl5JyxcblxuICAgIGJlZm9yZVNob3c6IGZ1bmN0aW9uKGlucHV0LCBpbnN0KSB7XG4gICAgICBpbnN0LmRwRGl2LmNzcygndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZVgoLTI0cHgpJyk7XG4gICAgICBpbnN0LmRwRGl2LmFkZENsYXNzKCdjYWxlbmRhci1yYW5nZScpO1xuICAgIH0sXG5cbiAgICBvblNlbGVjdDogZnVuY3Rpb24oZGF0ZVRleHQsIGluc3QsIGV4dGVuc2lvblJhbmdlKSB7XG4gICAgICBpbnN0LmlucHV0LnZhbChleHRlbnNpb25SYW5nZS5zdGFydERhdGVUZXh0ICsgJyAtICcgKyBleHRlbnNpb25SYW5nZS5lbmREYXRlVGV4dCk7XG4gICAgfSxcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBmaWxlRHJvcEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtZmlsZV9fbGFiZWwnKTtcblxuICBmdW5jdGlvbiBtYWtlRmlsZUxvYWQoZmlsZURyb3BBcmVhKSB7XG4gICAgY29uc3QgZmlsZUlucHV0ID0gZmlsZURyb3BBcmVhLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG4gICAgY29uc3QgZmlsZUNsZWFyID0gZmlsZURyb3BBcmVhLnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fY2xlYXInKTtcbiAgICAvLyDQodCx0YDQsNGB0YvQstCw0LXQvCDRgdGC0LDQvdC00LDRgNGC0L3Ri9C1INGB0L7QsdGL0YLQuNGPINC/0YDQuCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNC4INGE0LDQudC70LBcblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJywgJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBwcmV2ZW50RGVmYXVsdHMsIGZhbHNlKVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gcHJldmVudERlZmF1bHRzIChlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH07XG5cbiAgICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0YHRgtC40LvQuCDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwINC90LDQtCDQvdGD0LbQvdC+0Lkg0L7QsdC70LDRgdGC0YzRjlxuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInXS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhpZ2hsaWdodCwgZmFsc2UpXG4gICAgfSk7XG5cbiAgICBbJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB1bmhpZ2hsaWdodCwgZmFsc2UpXG4gICAgfSlcblxuICAgIGZ1bmN0aW9uIGhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHVuaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQnKTtcbiAgICB9O1xuXG4gICAgLy9cblxuICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgaGFuZGxlRHJvcCwgZmFsc2UpXG5cbiAgICBmdW5jdGlvbiBoYW5kbGVEcm9wKGUpIHtcbiAgICAgIGxldCBkdCA9IGUuZGF0YVRyYW5zZmVyXG4gICAgICBsZXQgZmlsZXMgPSBkdC5maWxlc1xuXG4gICAgICBpZiAoZmlsZUlucHV0LmZpbGVzICYmIGZpbGVJbnB1dC5maWxlc1swXSkge1xuICAgICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZmlsZUlucHV0LmZpbGVzID0gZmlsZXM7XG4gICAgICBvbkZpbGVDaGFuZ2UoKTtcbiAgICAgIHdpbmRvdy5vblZlcmlmaWNhdGlvbkZpbGVEcm9wICYmIHdpbmRvdy5vblZlcmlmaWNhdGlvbkZpbGVEcm9wKCk7XG4gICAgICB3aW5kb3cub25EZWxpdmVyeUZpbGVEcm9wICYmIHdpbmRvdy5vbkRlbGl2ZXJ5RmlsZURyb3AoKTtcbiAgICAgIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wICYmIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wKCk7XG4gICAgfTtcblxuICAgIGNvbnN0IG9uRmlsZUNoYW5nZSA9ICgpID0+IHtcbiAgICAgIHJlYWRVcmwoZmlsZUlucHV0KTtcbiAgICB9XG5cbiAgICBjb25zdCByZWFkVXJsID0gKGlucHV0KSA9PiB7XG4gICAgICBpZiAoaW5wdXQuZmlsZXMgJiYgaW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgZmlsZURyb3BBcmVhLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnbG9hZGVkJyk7XG4gICAgICAgICAgZmlsZURyb3BBcmVhXG4gICAgICAgICAgICAubmV4dEVsZW1lbnRTaWJsaW5nXG4gICAgICAgICAgICAucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fbmFtZScpXG4gICAgICAgICAgICAudGV4dENvbnRlbnQgPSBpbnB1dC5maWxlc1swXS5uYW1lO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW5wdXQuZmlsZXNbMF0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uQ2xlYXIoKSB7XG4gICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcblxuICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpbGVDaGFuZ2UpO1xuICAgIGZpbGVDbGVhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xlYXIpO1xuICB9XG5cbiAgd2luZG93Lm1ha2VGaWxlTG9hZCA9IG1ha2VGaWxlTG9hZDtcblxuXG4gIGlmICghZmlsZURyb3BBcmVhWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgZmlsZURyb3BBcmVhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG1ha2VGaWxlTG9hZChpdGVtKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtdGV4dCcpO1xuXG4gIGlmICghaW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaW5wdXRzLmZvckVhY2goZnVuY3Rpb24oaW5wdXQpIHtcbiAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoXG4gICAgICAgIGlucHV0LnZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnXG4gICAgICApIHtcbiAgICAgICAgaW5wdXQudmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpbnB1dC52YWx1ZSAhPT0gJydcbiAgICAgICAgJiYgIWlucHV0LmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIGlucHV0LnZhbHVlID09PSAnJ1xuICAgICAgICAmJiBpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKVxuICAgICAgKSB7XG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuIiwiKCgpID0+IHtcbiAgbGV0IHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLXZoJywgYCR7dmh9cHhgKTtcblxuICBjb25zdCAkYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcblxuICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jKXtcbiAgICB2YXIgdGltZXI7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgIGlmKHRpbWVyKSBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmMsMTAwLGV2ZW50KTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gb25SZXNpemUoKSB7XG4gICAgICBsZXQgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLXZoJywgYCR7dmh9cHhgKTtcbiAgfTtcblxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGVib3VuY2Uob25SZXNpemUpKTtcblxuICBmdW5jdGlvbiBNb2RhbCAodHJpZ2dlciwgbW9kYWwpIHtcbiAgICB0aGlzLnRyaWdnZXIgPSB0cmlnZ2VyO1xuICAgIHRoaXMubW9kYWwgPSBtb2RhbDtcbiAgICB0aGlzLm92ZXJsYXkgPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAgIHRoaXMuY2xvc2VCdG4gPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcblxuICAgIHRoaXMub25PdmVybGF5Q2xpY2sgPSB0aGlzLm9uT3ZlcmxheUNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNsb3NlQ2xpY2sgPSB0aGlzLm9uQ2xvc2VDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25UcmlnZ2VyQ2xpY2sgPSB0aGlzLm9uVHJpZ2dlckNsaWNrLmJpbmQodGhpcyk7XG4gICAgLy90aGlzLm9uUmVzaXplID0gdGhpcy5vblJlc2l6ZS5iaW5kKHRoaXMpO1xuXG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGFsLmNsYXNzTGlzdC5hZGQoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QuYWRkKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5vdmVybGF5KSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2xvc2UoKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vblRyaWdnZXJDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMub3BlbigpO1xuICB9XG5cbiAgLy8gTW9kYWwucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgICBsZXQgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICAvLyAgICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLXZoJywgYCR7dmh9cHhgKTtcbiAgLy8gfTtcblxuICBNb2RhbC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uT3ZlcmxheUNsaWNrKTtcbiAgICB0aGlzLmNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbkNsb3NlQ2xpY2spO1xuICAgIHRoaXMudHJpZ2dlci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25UcmlnZ2VyQ2xpY2spO1xuICB9XG5cbiAgd2luZG93Lk1vZGFsID0gTW9kYWw7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAgICQoJy5pbnB1dC1tb25leScpLm1hc2soJyMgIyMwIOKCvScsIHtcbiAgICAgIHJldmVyc2U6IHRydWUsXG4gICAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtcGhvbmUnKTtcblxuICBpZiAoIWlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGltID0gbmV3IElucHV0bWFzayhcIis3KDk5OSkgOTk5LTk5LTk5XCIpO1xuXG4gIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpbS5tYXNrKGl0ZW0pO1xuICB9KVxufSkoKTtcbiIsIigoKSA9PiB7XG4gIGNvbnN0IGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCcpO1xuICBjb25zdCBjbG9zZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2ggKyAuc2VhcmNoLWNsb3NlJyk7XG5cbiAgaWYgKCFpdGVtc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgLy8gICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgKCkgPT57XG4gIC8vICAgICBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdqcy1mb2N1cycpO1xuICAvLyAgIH0pO1xuICAvLyB9KTtcblxuICBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgKCkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBpdGVtLnZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnXG4gICAgICApIHtcbiAgICAgICAgaXRlbS52YWx1ZSA9ICcnO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIGl0ZW0udmFsdWUgIT09ICcnXG4gICAgICAgICYmICFpdGVtLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgaXRlbS52YWx1ZSA9PT0gJydcbiAgICAgICAgJiYgaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKVxuICAgICAgKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pXG4gIH0pO1xuXG4gIGNsb3NlLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2VhcmNoID0gaXRlbS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICAgICAgc2VhcmNoLnZhbHVlID0gJyc7XG4gICAgICBpZiAoXG4gICAgICAgIHNlYXJjaC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKVxuICAgICAgKSB7XG4gICAgICAgIHNlYXJjaC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSlcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gIGZ1bmN0aW9uIGZvcm1hdE9wdGlvbiAoaXRlbSkge1xuICAgIGNvbnN0IHZhbHVlID0gaXRlbS50ZXh0LnNwbGl0KCdzcGxpdHRlcicpO1xuICAgIGNvbnN0IGJyID0gd2luZG93Lm1hdGNoTWVkaWEoJyhtYXgtd2lkdGg6IDk5OXB4KScpLm1hdGNoZXMgPyAnPGJyPicgOiAnJztcblxuICAgIGlmICh2YWx1ZS5sZW5ndGggPiAxKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSAkKCc8c3Bhbj4nXG4gICAgICAgICsgdmFsdWVbMF1cbiAgICAgICAgKyAnPC9zcGFuPidcbiAgICAgICAgKyBiclxuICAgICAgICArICc8c3Bhbj4nXG4gICAgICAgICsgdmFsdWVbMV1cbiAgICAgICAgKyAnPC9zcGFuPicpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGl0ZW0udGV4dDtcbiAgICB9XG4gIH1cblxuICAkKCcuc2VsZWN0Jykuc2VsZWN0Mih7XG4gICAgdGVtcGxhdGVSZXN1bHQ6IGZvcm1hdE9wdGlvbixcbiAgICB0ZW1wbGF0ZVNlbGVjdGlvbjogZm9ybWF0T3B0aW9uXG4gIH0pO1xuXG4gICQoJy5zZWxlY3QnKS5vbignc2VsZWN0MjpzZWxlY3QnLCBmdW5jdGlvbiAoZSkge1xuICAgICQodGhpcykuYWRkQ2xhc3MoJ3BpY2tlZCcpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGRlbGl2ZXJ5VGltZUlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcblxuICBpZiAoIWRlbGl2ZXJ5VGltZUlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbSA9IG5ldyBJbnB1dG1hc2soXCI5OTo5OVwiKTtcblxuICBkZWxpdmVyeVRpbWVJbnB1dHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgaW0ubWFzayhpdGVtKTtcbiAgfSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hY2NvdW50LWNyZWF0aW9uX19uZXcnKTtcblxuICBpZiAoIWNhbmNlbGxhdGlvbkJ0blswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY291bnQtY3JlYXRpb24nKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY2FuY2VsbGF0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xuXG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIC8vIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcblxuICAvLyBpZiAoIXZlcmlmaWNhdGlvbkJ0blswXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FjY291bnQtY3JlYXRpb24nKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgJGlucHV0ID0gJCgnLmFjY291bnQtY3JlYXRpb25fX2lucHV0IC5pbnB1dC10ZXh0Jyk7XG4gIGNvbnN0ICRidG4gPSAkKCcjYWNjb3VudC1jcmVhdGlvbiAubW9kYWxfX3NhdmUnKTtcblxuICBjb25zdCBvbklucHV0ID0gZnVuY3Rpb24oZSkge1xuICAgIGNvbnN0ICRlbXB0eUlucHV0ID0gJGlucHV0LmZpbHRlcihmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLnZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnXG4gICAgICAgIHx8IHRoaXMudmFsdWUubGVuZ3RoID09PSAwO1xuICAgIH0pO1xuXG4gICAgaWYgKFxuICAgICAgJGVtcHR5SW5wdXQubGVuZ3RoID09PSAwXG4gICAgKSB7XG4gICAgICAkYnRuLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJylcbiAgICB9IGVsc2Uge1xuICAgICAgJGJ0bi5hdHRyKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG5cbiAgICAvLyBpZiAoXG4gICAgLy8gICB2YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJ1xuICAgIC8vICAgfHwgdmFsdWUubGVuZ3RoID09PSAwXG4gICAgLy8gKSB7XG4gICAgLy8gICBpZiAoIWJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAvLyAgICAgYnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuICB9XG5cbiAgLy8gdmVyaWZpY2F0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIC8vIH0pXG5cbiAgJGlucHV0Lm9uKCdpbnB1dCcsIG9uSW5wdXQpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgY29udHJhY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFnZW50c19fdXNlcnMtYmxvY2stbW9iaWxlJyk7XG5cbiAgaWYgKCFjb250cmFjdHMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBzbGlkZXIgPSBuZXcgU3dpcGVyKCcuYWdlbnRzX191c2Vycy1ibG9jay1tb2JpbGVfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLmFnZW50c19fdXNlcnMtYmxvY2stbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlLFxuICAgIH1cbiAgfSk7XG5cblxuICAkKCcuYWdlbnRzX191c2Vycy1idG4nKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICQoJy5hZ2VudHNfX3VzZXJzLWJ0bicpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICQodGhpcykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjYW5jZWxsYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fY2FuY2VsbGF0aW9uJyk7XG5cbiAgaWYgKCFjYW5jZWxsYXRpb25CdG5bMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW5jZWxsYXRpb25fX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNhbmNlbGxhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KTtcblxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjaGFuZ2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudXNlci1zZXR0aW5nc19fY2hhbmdlLWVtYWlsJyk7XG5cbiAgaWYgKCFjaGFuZ2VCdXR0b25bMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFuZ2UtZW1haWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY2hhbmdlQnV0dG9uLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xuXG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIC8vIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcblxuICAvLyBpZiAoIXZlcmlmaWNhdGlvbkJ0blswXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYW5nZS1lbWFpbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBpbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGFuZ2UtZW1haWxfX2lucHV0IC5pbnB1dC10ZXh0Jyk7XG4gIGNvbnN0IGJ0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIGNvbnN0IG9uSW5wdXQgPSBmdW5jdGlvbihlKSB7XG5cbiAgICBpZiAoXG4gICAgICBlLnRhcmdldC52YWxpZGl0eS52YWxpZFxuICAgICkge1xuICAgICAgYnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgICFlLnRhcmdldC52YWxpZGl0eS52YWxpZFxuICAgICkge1xuICAgICAgaWYgKCFidG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICAgIGJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KVxuXG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25JbnB1dCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjaGFuZ2VCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudXNlci1zZXR0aW5nc19fY2hhbmdlLXBob25lJyk7XG5cbiAgaWYgKCFjaGFuZ2VCdXR0b25bMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGFuZ2UtcGhvbmUnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY2hhbmdlQnV0dG9uLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xuXG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIC8vIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcblxuICAvLyBpZiAoIXZlcmlmaWNhdGlvbkJ0blswXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYW5nZS1waG9uZScpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBpbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGFuZ2UtcGhvbmVfX2lucHV0IC5pbnB1dC10ZXh0Jyk7XG4gIGNvbnN0IGJ0biA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIGNvbnN0IG9uSW5wdXQgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKFxuICAgICAgZS50YXJnZXQudmFsdWUuaW5kZXhPZignXycpID09PSAtMVxuICAgICkge1xuICAgICAgYnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGUudGFyZ2V0LnZhbHVlLmluZGV4T2YoJ18nKSAhPT0gLTFcbiAgICApIHtcbiAgICAgIGlmICghYnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgICBidG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyB2ZXJpZmljYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgLy8gfSlcblxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uSW5wdXQpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgcmFkaW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWNyZWF0aW9uX19jbGllbnQtdHlwZSAgaW5wdXQnKTtcblxuICBpZiAoIXJhZGlvc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHdyYXBwZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3QtY3JlYXRpb25fX2RldGFpbHMnKTtcblxuICBmdW5jdGlvbiBvblJhZGlvQ2hhbmdlKCkge1xuICAgIGlmIChyYWRpb3NbMF0uY2hlY2tlZCkge1xuICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1lbnRpdHknKTtcbiAgICB9XG5cbiAgICBpZiAocmFkaW9zWzFdLmNoZWNrZWQpIHtcbiAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgnc2hvdy1mb3ItZW50aXR5Jyk7XG4gICAgfVxuICB9XG5cbiAgcmFkaW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25SYWRpb0NoYW5nZSk7XG4gIH0pO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY2xpZW50cy1tb2JpbGUtYmxvY2snKTtcblxuICBpZiAoIWNvbnRyYWN0cykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHNsaWRlciA9IG5ldyBTd2lwZXIoJy5jbGllbnRzLW1vYmlsZS1ibG9ja19fc2xpZGVyJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcuY2xpZW50cy1tb2JpbGUtYmxvY2tfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWUsXG4gICAgfVxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCB0cmlnZ2VycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLXRyaWdnZXJdJyk7XG5cbiAgdHJpZ2dlcnMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgY29uc3QgbmFtZSA9IGl0ZW0uZ2V0QXR0cmlidXRlKCdkYXRhLXRyaWdnZXInKTtcblxuICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtbW9kYWw9JyArIG5hbWUgKyAnXScpO1xuXG4gICAgaWYgKG1vZGFsKSB7XG4gICAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAgIH1cbiAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIC8vIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcblxuICAvLyBpZiAoIXZlcmlmaWNhdGlvbkJ0blswXSkge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpcm1hdGlvbi1jb2RlJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNvbmZpcm1hdGlvbi1jb2RlX19pbnB1dCAuaW5wdXQtdGV4dCcpO1xuICBjb25zdCBidG4gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcblxuICBjb25zdCBvbklucHV0ID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChcbiAgICAgIGUudGFyZ2V0LnZhbHVlLmxlbmd0aCA9PT0gNlxuICAgICkge1xuICAgICAgYnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgIGUudGFyZ2V0LnZhbHVlLmxlbmd0aCA8IDZcbiAgICApIHtcbiAgICAgIGlmICghYnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgICBidG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyB2ZXJpZmljYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgLy8gfSlcblxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uSW5wdXQpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICAkKCcuZGVsaXZlcnktb3ItcGlja3VwLmRvbmUnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLmZpbmQoJy5jb250cmFjdC1pbmZvX19kZWxpdmVyZWQtYWRyZXNzJykuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLmZpbmQoJy5jb250cmFjdC1pbmZvX19kZWxpdmVyZWQtdG9nZ2xlJykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNvbnRyYWN0U2VydmljZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3Qtc2VydmljZXMnKTtcblxuICBpZiAoIWNvbnRyYWN0U2VydmljZXMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBsaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1zZXJ2aWNlc19fbGluaycpO1xuXG4gIGNvbnN0IG9uTGlua0NsaWNrID0gZnVuY3Rpb24oZSkge1xuICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuXG4gICAgaWYgKFxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tib3gtYnRuX19sYWJlbCcpXG4gICAgICB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2NoZWNrYm94JylcbiAgICAgIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2RlbGl2ZXItb3ItcGlja3VwX19jb25maXJtLWJ0bicpXG4gICAgICB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb250cmFjdC1zZXJ2aWNlc19fZGVsaXZlcnktY29uZmlybScpXG4gICAgKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9XG5cbiAgbGlua3MuZm9yRWFjaChmdW5jdGlvbihsaW5rKSB7XG4gICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTGlua0NsaWNrKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdHNMaW5rQWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0c19fbGluaycpO1xuXG4gIGlmICghY29udHJhY3RzTGlua0FsbFswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG9uTGlua0NsaWNrID0gZnVuY3Rpb24oZSkge1xuICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuXG4gICAgaWYgKFxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tib3gtYnRuX19sYWJlbCcpXG4gICAgICB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2NoZWNrYm94JylcbiAgICAgIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvbicpXG4gICAgICB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdwYXltZW50LXdhaXRpbmdfX2NvbmZpcm0tYnRuJylcbiAgICAgIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbnRyYWN0LXNlcnZpY2VzX19kZWxpdmVyeS1jb25maXJtJylcbiAgICApIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH1cblxuICBjb250cmFjdHNMaW5rQWxsLmZvckVhY2goZnVuY3Rpb24obGluaykge1xuICAgIGxpbmsuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkxpbmtDbGljayk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgY29udHJhY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LXNlcnZpY2VzLW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLmNvbnRyYWN0LXNlcnZpY2VzLW1vYmlsZV9fc2xpZGVyJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcuY29udHJhY3Qtc2VydmljZXMtbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlLFxuICAgIH1cbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3RzLW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLmNvbnRyYWN0cy1tb2JpbGVfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLmNvbnRyYWN0cy1tb2JpbGVfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWUsXG4gICAgfVxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGNhbmNlbGxhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zdWJzY3JpcHRpb24tcGFnZV9fYWN0aW9uLWl0ZW0tLWRlbGV0ZScpO1xuXG4gIGlmICghY2FuY2VsbGF0aW9uQnRuWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsZXRlLXNlcnZpY2VfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNhbmNlbGxhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KVxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBkZWxpdmVyeUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFkZWxpdmVyeUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZGF0ZVRleHQpIHtcbiAgLy8gICBvbkZpZWxkQ2hhbmdlKCk7XG4gIC8vIH0pO1xuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIC8vIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgLy8gY29uc3Qgc3VibWl0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQnKTtcbiAgLy8gY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIC8vIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICAvLyBjb25zdCBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1kYXRlJyk7XG4gIC8vIGNvbnN0IHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgLy8gY29uc3QgY29uZmlybUNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoZWNrYm94X19pbnB1dCcpO1xuXG4gIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgLy8gY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgLy8gICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuXG4gIC8vICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuXG4gIC8vICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAvLyAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAvLyAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgLy8gICAgIH1cbiAgLy8gICB9XG5cbiAgLy8gICBkYXRlSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICB0aW1lSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAvLyAgICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgLy8gfVxuXG4gIC8vIGNvbnN0IG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAvLyAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgLy8gICAgIG9uQ2xvc2VDbGljaygpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG4gIC8vIGNvbnN0IG9uRmllbGRDaGFuZ2UgPSBmdW5jdGlvbihlKSB7XG4gIC8vICAgaWYgKGlzRm9ybUZpbGxlZCgpICYmIHN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgLy8gICAgIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gIC8vICAgfSBlbHNlIGlmICghaXNGb3JtRmlsbGVkKCkgJiYgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgLy8gICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG4gIC8vIGNvbnN0IGlzRm9ybUZpbGxlZCA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIHJldHVybiAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoJ2dldERhdGUnKVxuICAvLyAgICAgJiYgdGltZUlucHV0LnZhbHVlICE9PSAnJ1xuICAvLyAgICAgJiYgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPT09IHRydWVcbiAgLy8gICAgICYmIGZpbGVJbnB1dC52YWx1ZSAhPT0gJydcbiAgLy8gfVxuXG4gIC8vIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgLy8gb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgLy8gZGF0ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIC8vIHRpbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICAvLyBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWVsZENoYW5nZSk7XG4gIC8vIGNvbmZpcm1DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGRldmljZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtY3JlYXRpb25fX2RlbGl2ZXJ5LWRldmljZScpO1xuXG4gIGlmICghZGV2aWNlc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGRldmljZXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgY29uc3QgcmFkaW9zID0gaXRlbS5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtY3JlYXRpb25fX2RlbGl2ZXJ5LXR5cGUtd3JhcHBlciAgaW5wdXQnKTtcblxuICAgIGZ1bmN0aW9uIG9uUmFkaW9DaGFuZ2UoZSkge1xuICAgICAgY29uc3Qgd3JhcHBlciA9IGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlO1xuXG4gICAgICBpZiAocmFkaW9zWzBdLmNoZWNrZWQpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1waWNrdXAnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJhZGlvc1sxXS5jaGVja2VkKSB7XG4gICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgnc2hvdy1mb3ItcGlja3VwJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmFkaW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvblJhZGlvQ2hhbmdlKTtcbiAgICB9KTtcbiAgfSlcblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWxpdmVyeS1vci1waWNrdXBfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0ICRkYXRlID0gJCgnI2RlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwgLmRhdGUtaW5wdXQnKTtcblxuICAkZGF0ZS5kYXRlcGlja2VyKCkub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGRhdGVUZXh0KSB7XG4gICAgaWYgKCQoJyNkZWxpdmVyeS1vci1waWNrdXBfX21vZGFsJykuaGFzQ2xhc3MoJ2pzLXNob3cnKSkge1xuICAgICAgb25GaWVsZENoYW5nZSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgY29uc3Qgc3VibWl0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQnKTtcbiAgY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICBjb25zdCBmaWxlQ2xlYXIgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuICBjb25zdCBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1kYXRlJyk7XG4gIGNvbnN0IHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgY29uc3QgY29uZmlybUNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoZWNrYm94X19pbnB1dCcpO1xuXG4gIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QuY29udGFpbnMoJ2xvYWRlZCcpKSB7XG4gICAgICBmaWxlSW5wdXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcblxuICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG4gICAgICBzdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcblxuICAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZGF0ZUlucHV0LnZhbHVlID0gJyc7XG4gICAgdGltZUlucHV0LnZhbHVlID0gJyc7XG4gICAgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAkZGF0ZS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICB9XG5cbiAgY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAgICAgb25DbG9zZUNsaWNrKCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgb25GaWVsZENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoaXNGb3JtRmlsbGVkKCkgJiYgc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc3VibWl0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9IGVsc2UgaWYgKCFpc0Zvcm1GaWxsZWQoKSAmJiAhc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgb25GaWxlQ2xlYXIgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGlzRm9ybUZpbGxlZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAkZGF0ZS5kYXRlcGlja2VyKCdnZXREYXRlJylcbiAgICAgICYmIHRpbWVJbnB1dC52YWx1ZSAhPT0gJydcbiAgICAgICYmIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID09PSB0cnVlXG4gICAgICAmJiBmaWxlSW5wdXQudmFsdWUgIT09ICcnXG4gIH1cblxuICB3aW5kb3cub25EZWxpdmVyeUZpbGVEcm9wID0gZnVuY3Rpb24gKCkge1xuICAgIG9uRmllbGRDaGFuZ2UoKTtcbiAgfVxuXG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgZGF0ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIHRpbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgd2luZG93Lm9uRGVsaXZlcnlGaWxlRHJvcCk7XG4gIGNvbmZpcm1DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25GaWxlQ2xlYXIpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgbWVudSA9ICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLW1lbnUnKTtcbiAgY29uc3QgYnRuID0gJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJyk7XG5cbiAgICAkLmV4dGVuZCgkLmRhdGVwaWNrZXIsIHtcblxuICAgICAgICAvLyBSZWZlcmVuY2UgdGhlIG9yaWduYWwgZnVuY3Rpb24gc28gd2UgY2FuIG92ZXJyaWRlIGl0IGFuZCBjYWxsIGl0IGxhdGVyXG4gICAgICAgIF9pbmxpbmVEYXRlcGlja2VyMjogJC5kYXRlcGlja2VyLl9pbmxpbmVEYXRlcGlja2VyLFxuXG4gICAgICAgIC8vIE92ZXJyaWRlIHRoZSBfaW5saW5lRGF0ZXBpY2tlciBtZXRob2RcbiAgICAgICAgX2lubGluZURhdGVwaWNrZXI6IGZ1bmN0aW9uICh0YXJnZXQsIGluc3QpIHtcblxuICAgICAgICAgICAgLy8gQ2FsbCB0aGUgb3JpZ2luYWxcbiAgICAgICAgICAgIHRoaXMuX2lubGluZURhdGVwaWNrZXIyKHRhcmdldCwgaW5zdCk7XG5cbiAgICAgICAgICAgIHZhciBiZWZvcmVTaG93ID0gJC5kYXRlcGlja2VyLl9nZXQoaW5zdCwgJ2JlZm9yZVNob3cnKTtcblxuICAgICAgICAgICAgaWYgKGJlZm9yZVNob3cpIHtcbiAgICAgICAgICAgICAgICBiZWZvcmVTaG93LmFwcGx5KHRhcmdldCwgW3RhcmdldCwgaW5zdF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG5cblxuICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51JykudG9nZ2xlKCk7XG4gIH0pO1xuXG4gICQoJyNlYXJuZWQtZGF0ZScpLmRhdGVwaWNrZXIoe1xuICAgIHJhbmdlOiAncGVyaW9kJyxcbiAgICBpbmxpbmU6IHRydWUsXG4gICAgc2hvd0J1dHRvblBhbmVsOiB0cnVlLFxuICAgIHNob3dPdGhlck1vbnRoczogdHJ1ZSxcbiAgICBzZWxlY3RPdGhlck1vbnRoczogdHJ1ZSxcbiAgICBjbG9zZVRleHQgOiBcItCT0L7RgtC+0LLQvlwiLFxuICAgIGRhdGVGb3JtYXQ6ICdkZC5tbS55eScsXG5cbiAgICBiZWZvcmVTaG93OiBmdW5jdGlvbihpbnB1dCwgaW5zdCkge1xuICAgICAgaW5zdC5kcERpdi5jc3MoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGVYKC0yNHB4KScpO1xuICAgICAgaW5zdC5kcERpdi5hZGRDbGFzcygnY2FsZW5kYXItcmFuZ2UnKTtcbiAgICB9LFxuXG4gICAgb25TZWxlY3Q6IGZ1bmN0aW9uKGRhdGVUZXh0LCBpbnN0LCBleHRlbnNpb25SYW5nZSkge1xuICAgICAgJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJykudGV4dChleHRlbnNpb25SYW5nZS5zdGFydERhdGVUZXh0ICsgJyAtICcgKyBleHRlbnNpb25SYW5nZS5lbmREYXRlVGV4dCk7XG5cbiAgICB9XG4gIH0pO1xuXG4gICQoZG9jdW1lbnQpLm1vdXNldXAoZnVuY3Rpb24gKGUpe1xuXHRcdGNvbnN0IG1lbnUgPSAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51Jyk7XG5cdFx0Y29uc3QgYnRuID0gJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtYnRuJyk7XG4gICAgaWYgKCFtZW51LmlzKGUudGFyZ2V0KVxuICAgICAgJiYgbWVudS5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMFxuICAgICAgJiYgIWJ0bi5pcyhlLnRhcmdldClcbiAgICAgICYmIGJ0bi5oYXMoZS50YXJnZXQpLmxlbmd0aCA9PT0gMFxuICAgICkge1xuXHRcdFx0bWVudS5oaWRlKCk7XG5cdFx0fVxuICB9KTtcblxuICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1tZW51LWJ0bicpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgIGlmICgkKHRoaXMpLmhhc0NsYXNzKCdhbGwtdGltZScpKSB7XG4gICAgICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKS50ZXh0KFxuICAgICAgICAkKHRoaXMpLnRleHQoKVxuICAgICAgICArICcgKNGBXFx1MDBhMCdcbiAgICAgICAgKyAkKCcuZWFybmVkLWRhdGVfX3N0YXJ0LXBlcmlvZCcpLnRleHQoKVxuICAgICAgICArICcpJ1xuICAgICAgKVxuICAgIH0gZWxzZSB7XG4gICAgICAkKCcubXV0dWFsLWNhbGNzX19lYXJuZWQtZGF0ZS1idG4nKS50ZXh0KFxuICAgICAgICAkKHRoaXMpLnRleHQoKVxuICAgICAgKVxuICAgIH1cblxuICAgIG1lbnUuaGlkZSgpO1xuXG4gIH0pO1xuXG4gICQoJy5tdXR1YWwtY2FsY3NfX2Vhcm5lZC1kYXRlLWJ0bicpLnRleHQoXG4gICAgJCgnLm11dHVhbC1jYWxjc19fZWFybmVkLWRhdGUtbWVudS1idG4uYWxsLXRpbWUnKS50ZXh0KClcbiAgICArICcgKNGBXFx1MDBhMCdcbiAgICArICQoJy5lYXJuZWQtZGF0ZV9fc3RhcnQtcGVyaW9kJykudGV4dCgpXG4gICAgKyAnKSdcbiAgKVxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJCgnLmZpbHRlcnNfX2J0bicpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICQodGhpcykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xuXG4gICQoJy5maWx0ZXJzX19idG4tY2xlYXInKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAkKCcuZmlsdGVycyAuc2VsZWN0JykudmFsKCfQktGB0LUnKTtcbiAgICAkKCcuZmlsdGVycyAuc2VsZWN0JykudHJpZ2dlcignY2hhbmdlJyk7XG4gICAgJCgnLmZpbHRlcnMgLnNlbGVjdCcpLnJlbW92ZUNsYXNzKCdwaWNrZWQnKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaW5zdGFsbGF0aW9uLWFjY291bnRzLW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLmluc3RhbGxhdGlvbi1hY2NvdW50cy1tb2JpbGVfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLmluc3RhbGxhdGlvbi1hY2NvdW50cy1tb2JpbGVfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWUsXG4gICAgfVxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGRlbGl2ZXJ5QnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnN0YWxsYXRpb25fX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFkZWxpdmVyeUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZGF0ZVRleHQpIHtcbiAgLy8gICBvbkZpZWxkQ2hhbmdlKCk7XG4gIC8vIH0pO1xuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luc3RhbGxhdGlvbl9fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIC8vIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgLy8gY29uc3Qgc3VibWl0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQnKTtcbiAgLy8gY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIC8vIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICAvLyBjb25zdCBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1kYXRlJyk7XG4gIC8vIGNvbnN0IHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgLy8gY29uc3QgY29uZmlybUNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoZWNrYm94X19pbnB1dCcpO1xuXG4gIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgLy9jb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAgIC8vICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG5cbiAgICAvLyAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgIC8vICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG5cbiAgICAvLyAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgLy8gICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgLy8gICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgIC8vICAgfVxuICAgIC8vIH1cblxuICAvLyAgIGRhdGVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHRpbWVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgJCgnI2RlbGl2ZXJ5LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAvLyB9XG5cbiAgLy8gY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gIC8vICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAvLyAgICAgb25DbG9zZUNsaWNrKCk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgLy8gY29uc3Qgb25GaWVsZENoYW5nZSA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoaXNGb3JtRmlsbGVkKCkgJiYgc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAvLyAgICAgc3VibWl0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgLy8gICB9IGVsc2UgaWYgKCFpc0Zvcm1GaWxsZWQoKSAmJiAhc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAvLyAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgLy8gY29uc3QgaXNGb3JtRmlsbGVkID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgcmV0dXJuICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignZ2V0RGF0ZScpXG4gIC8vICAgICAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnXG4gIC8vICAgICAmJiBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9PT0gdHJ1ZVxuICAvLyAgICAgLy8mJiBmaWxlSW5wdXQudmFsdWUgIT09ICcnXG4gIC8vIH1cblxuICAvLyBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIC8vIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIC8vIGRhdGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICAvLyB0aW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgLy9maWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWVsZENoYW5nZSk7XG4gIC8vY29uZmlybUNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmllbGRDaGFuZ2UpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgcmFkaW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGl2ZXJ5LW9yLXBpY2t1cF9faW5zdGFsbGF0aW9uLWNob29zZS1ibG9jayAgaW5wdXQnKTtcblxuICBpZiAoIXJhZGlvc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHdyYXBwZXIgPSByYWRpb3NbMF0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcblxuICBmdW5jdGlvbiBvblJhZGlvQ2hhbmdlKCkge1xuICAgIGNvbnNvbGUubG9nKHdyYXBwZXIpO1xuICAgIGlmIChyYWRpb3NbMF0uY2hlY2tlZCkge1xuICAgICAgaWYgKCB3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItbWFudWFsJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1tYW51YWwnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCB3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItcmVnaXN0cmF0aW9uJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1yZWdpc3RyYXRpb24nKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCAhd3JhcHBlci5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3ctZm9yLWRlbGl2ZXJ5JykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QuYWRkKCdzaG93LWZvci1kZWxpdmVyeScpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyYWRpb3NbMV0uY2hlY2tlZCkge1xuICAgICAgaWYgKCB3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItbWFudWFsJykpIHtcbiAgICAgICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93LWZvci1tYW51YWwnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCB3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItZGVsaXZlcnknKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3ctZm9yLWRlbGl2ZXJ5Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmICggIXdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1yZWdpc3RyYXRpb24nKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Nob3ctZm9yLXJlZ2lzdHJhdGlvbicpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyYWRpb3NbMl0uY2hlY2tlZCkge1xuICAgICAgaWYgKCB3cmFwcGVyLmNsYXNzTGlzdC5jb250YWlucygnc2hvdy1mb3ItZGVsaXZlcnknKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5yZW1vdmUoJ3Nob3ctZm9yLWRlbGl2ZXJ5Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmICggd3JhcHBlci5jbGFzc0xpc3QuY29udGFpbnMoJ3Nob3ctZm9yLXJlZ2lzdHJhdGlvbicpKSB7XG4gICAgICAgIHdyYXBwZXIuY2xhc3NMaXN0LnJlbW92ZSgnc2hvdy1mb3ItcmVnaXN0cmF0aW9uJyk7XG4gICAgICB9XG5cbiAgICAgIGlmICggIXdyYXBwZXIuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaG93LWZvci1tYW51YWwnKSkge1xuICAgICAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoJ3Nob3ctZm9yLW1hbnVhbCcpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJhZGlvcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uUmFkaW9DaGFuZ2UpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIC8vIGNvbnN0IGRlbGl2ZXJ5QnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnN0YWxsYXRpb25fX2NvbmZpcm0tYnRuJyk7XG5cbiAgLy8gaWYgKCFkZWxpdmVyeUJ0bnNbMF0pIHtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbnN0YWxsYXRpb25fX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0ICRkYXRlID0gJCgnI2luc3RhbGxhdGlvbl9fbW9kYWwgLmRhdGUtaW5wdXQnKTtcblxuICAkZGF0ZS5kYXRlcGlja2VyKCkub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGRhdGVUZXh0KSB7XG4gICAgaWYgKCQoJyNpbnN0YWxsYXRpb25fX21vZGFsJykuaGFzQ2xhc3MoJ2pzLXNob3cnKSkge1xuICAgICAgb25GaWVsZENoYW5nZSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgY29uc3Qgc3VibWl0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQnKTtcbiAgY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICBjb25zdCBmaWxlQ2xlYXIgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuICBjb25zdCBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1kYXRlJyk7XG4gIGNvbnN0IHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgY29uc3QgY29uZmlybUNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoZWNrYm94X19pbnB1dCcpO1xuXG4gIC8vIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAvLyAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgLy8gfSk7XG5cbiAgY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuXG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuXG4gICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkYXRlSW5wdXQudmFsdWUgPSAnJztcbiAgICB0aW1lSW5wdXQudmFsdWUgPSAnJztcbiAgICBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgICRkYXRlLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG4gIH1cblxuICBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBvbkZpZWxkQ2hhbmdlID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChpc0Zvcm1GaWxsZWQoKSAmJiBzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBzdWJtaXQucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIH0gZWxzZSBpZiAoIWlzRm9ybUZpbGxlZCgpICYmICFzdWJtaXQuaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBzdWJtaXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBpc0Zvcm1GaWxsZWQgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gJGRhdGUuZGF0ZXBpY2tlcignZ2V0RGF0ZScpXG4gICAgICAmJiB0aW1lSW5wdXQudmFsdWUgIT09ICcnXG4gICAgICAmJiBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9PT0gdHJ1ZVxuICAgICAgJiYgZmlsZUlucHV0LnZhbHVlICE9PSAnJ1xuICB9XG5cbiAgY29uc3Qgb25GaWxlQ2xlYXIgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfVxuXG4gIHdpbmRvdy5vbkluc3RhbGxhdGlvbkZpbGVEcm9wID0gZnVuY3Rpb24oKSB7XG4gICAgb25GaWVsZENoYW5nZSgpO1xuICB9XG5cbiAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuICBkYXRlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgdGltZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB3aW5kb3cub25JbnN0YWxsYXRpb25GaWxlRHJvcCk7XG4gIGNvbmZpcm1DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgZmlsZUNsZWFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25GaWxlQ2xlYXIpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgcGF5bWVudENvbmZpcm1CdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm11dHVhbC1jYWxjc19fbWFrZS1wYXltZW50Jyk7XG5cbiAgaWYgKCFwYXltZW50Q29uZmlybUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXltZW50LXdhaXRpbmdfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICAvLyBjb25zdCBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIC8vIGNvbnN0IG1haW5DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy50cmFuc2FjdGlvbnNfX2NoZWNrLWFsbCBpbnB1dCcpO1xuICAvLyBjb25zdCBzZW5kZXJJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXNlbmRlciBpbnB1dCcpO1xuICAvLyBjb25zdCByZWNpcGllbnRJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXJlY2lwaWVudCBpbnB1dCcpO1xuICAvLyBjb25zdCBzdW1JbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXN1bSBpbnB1dCcpO1xuICAvLyBjb25zdCBwdXJwb3NlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1wdXJwb3NlIGlucHV0Jyk7XG5cbiAgLy8gY29uc3QgZ2V0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbigpIHtcbiAgLy8gICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fY2hlY2sgaW5wdXQnKTtcbiAgLy8gfTtcblxuICAvLyBjb25zdCBvbkFsbENoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgICBjb25zdCByb3cgPSBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG4gIC8vICAgICBpZiAobWFpbkNoZWNrYm94LmNoZWNrZWQpIHtcbiAgLy8gICAgICAgaXRlbS5jaGVja2VkID0gdHJ1ZTtcbiAgLy8gICAgICAgaWYgKCFyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgLy8gICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgnY2hlY2tlZCcpO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9IGVsc2Uge1xuICAvLyAgICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgLy8gICAgICAgaWYgKHJvdy5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrZWQnKSkge1xuICAvLyAgICAgICAgIHJvdy5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gIC8vICAgICAgIH1cbiAgLy8gICAgIH1cbiAgLy8gICB9KVxuICAvLyB9O1xuXG4gIC8vIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIG1haW5DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAvLyAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgLy8gICB9KTtcbiAgLy8gICAkKCcjcGF5bWVudC1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgLy8gICBzZW5kZXJJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHJlY2lwaWVudElucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgc3VtSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICBwdXJwb3NlSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gfTtcblxuICAvLyBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gIC8vICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgLy8gICB9XG4gIC8vIH1cblxuICAvLyBjb25zdCBvbkNoZWNrYm94Q2hhbmdlID0gZnVuY3Rpb24oZSkge1xuICAvLyAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7XG4gIC8vICAgICBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgLy8gICB9IGVsc2Uge1xuICAvLyAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7XG4gICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICB9KTtcblxuICAvLyBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIC8vIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIC8vIG1haW5DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkFsbENoYW5nZSk7XG4gIC8vIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkNoZWNrYm94Q2hhbmdlKTtcbiAgLy8gfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IG1lbnVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyX19uYXYtYnRuJyk7XG5cbiAgaWYgKCFtZW51QnRuKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgY2xvc2VCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVhZGVyX19jbG9zZS1idG4nKTtcbiAgY29uc3QgbmF2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhlYWRlcl9fbmF2Jyk7XG5cbiAgY29uc3QgY2hlY2tJZlRhYmxldCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB3aW5kb3cubWF0Y2hNZWRpYSgnKG1heC13aWR0aDogMTQzOXB4KScpLm1hdGNoZXNcbiAgfTtcblxuICBsZXQgaXNUYWJsZXQgPSBjaGVja0lmVGFibGV0KCk7XG5cbiAgY29uc3Qgb25CdG5DbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChjaGVja0lmVGFibGV0KCkpIHtcbiAgICAgIG1lbnVCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnanMtb3BlbmVkJyk7XG4gICAgICBuYXYuY2xhc3NMaXN0LnRvZ2dsZSgnanMtc2hvdycpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIG5hdi5jbGFzc0xpc3QucmVtb3ZlKCdqcy1zaG93Jyk7XG4gICAgbWVudUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdqcy1vcGVuZWQnKTtcbiAgfVxuXG4gIG1lbnVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkJ0bkNsaWNrKTtcbiAgY2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgY29udHJhY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm11dHVhbC1jYWxjcy1wYXltZW50LW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLm11dHVhbC1jYWxjcy1wYXltZW50LW1vYmlsZV9fc2xpZGVyJywge1xuICAgIHNsaWRlc1BlclZpZXc6IDEsXG4gICAgcGFnaW5hdGlvbjoge1xuICAgICAgZWw6ICcubXV0dWFsLWNhbGNzLXBheW1lbnQtbW9iaWxlX19wYWdpbmF0aW9uJyxcbiAgICAgIGR5bmFtaWNCdWxsZXRzOiB0cnVlLFxuICAgIH1cbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubXV0dWFsLWNhbGNzLWJsb2NrLW1vYmlsZScpO1xuXG4gIGlmICghY29udHJhY3RzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLm11dHVhbC1jYWxjcy1ibG9jay1tb2JpbGVfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLm11dHVhbC1jYWxjcy1ibG9jay1tb2JpbGVfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWUsXG4gICAgfVxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHBhc3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtcGFzc3dvcmQnKTtcblxuICBpZiAoIXBhc3NbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnLmlucHV0LWljb24tLXNob3ctcGFzc3dvcmQnLCBmdW5jdGlvbigpe1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAkKHRoaXMpLm5leHQoKS5hdHRyKCd0eXBlJywgJ3RleHQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJCh0aGlzKS5uZXh0KCkuYXR0cigndHlwZScsICdwYXNzd29yZCcpO1xuICAgIH1cbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBwYXltZW50Q29uZmlybUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucGF5bWVudC13YWl0aW5nX19jb25maXJtLWJ0bicpO1xuXG4gIGlmICghcGF5bWVudENvbmZpcm1CdG5zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8kKCcjcGF5bWVudC1kYXRlJykuZGF0ZXBpY2tlcigpO1xuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheW1lbnQtd2FpdGluZ19fbW9kYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICAvLyBjb25zdCBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIC8vIGNvbnN0IG1haW5DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy50cmFuc2FjdGlvbnNfX2NoZWNrLWFsbCBpbnB1dCcpO1xuICAvLyBjb25zdCBzZW5kZXJJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXNlbmRlciBpbnB1dCcpO1xuICAvLyBjb25zdCByZWNpcGllbnRJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXJlY2lwaWVudCBpbnB1dCcpO1xuICAvLyBjb25zdCBzdW1JbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXN1bSBpbnB1dCcpO1xuICAvLyBjb25zdCBwdXJwb3NlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1wdXJwb3NlIGlucHV0Jyk7XG5cbiAgLy8gY29uc3QgZ2V0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbigpIHtcbiAgLy8gICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fY2hlY2sgaW5wdXQnKTtcbiAgLy8gfTtcblxuICAvLyBjb25zdCBvbkFsbENoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgICBjb25zdCByb3cgPSBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGU7XG4gIC8vICAgICBpZiAobWFpbkNoZWNrYm94LmNoZWNrZWQpIHtcbiAgLy8gICAgICAgaXRlbS5jaGVja2VkID0gdHJ1ZTtcbiAgLy8gICAgICAgaWYgKCFyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2VkJykpIHtcbiAgLy8gICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgnY2hlY2tlZCcpO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9IGVsc2Uge1xuICAvLyAgICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgLy8gICAgICAgaWYgKHJvdy5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrZWQnKSkge1xuICAvLyAgICAgICAgIHJvdy5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gIC8vICAgICAgIH1cbiAgLy8gICAgIH1cbiAgLy8gICB9KVxuICAvLyB9O1xuXG4gIC8vIGNvbnN0IG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uKCkge1xuICAvLyAgIG1haW5DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gIC8vICAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAvLyAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgLy8gICB9KTtcbiAgLy8gICAkKCcjcGF5bWVudC1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgLy8gICBzZW5kZXJJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgIHJlY2lwaWVudElucHV0LnZhbHVlID0gJyc7XG4gIC8vICAgc3VtSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gICBwdXJwb3NlSW5wdXQudmFsdWUgPSAnJztcbiAgLy8gfTtcblxuICAvLyBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gIC8vICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgLy8gICB9XG4gIC8vIH1cblxuICAvLyBjb25zdCBvbkNoZWNrYm94Q2hhbmdlID0gZnVuY3Rpb24oZSkge1xuICAvLyAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7XG4gIC8vICAgICBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgLy8gICB9IGVsc2Uge1xuICAvLyAgICAgZS50YXJnZXQucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7XG4gICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICB9KTtcblxuICAvLyBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIC8vIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIC8vIG1haW5DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkFsbENoYW5nZSk7XG4gIC8vIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkNoZWNrYm94Q2hhbmdlKTtcbiAgLy8gfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIC8vIGNvbnN0IHBheW1lbnRDb25maXJtQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYXltZW50LXdhaXRpbmdfX2NvbmZpcm0tYnRuJyk7XG5cbiAgLy8gaWYgKCFwYXltZW50Q29uZmlybUJ0bnNbMF0pIHtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYXltZW50LXdhaXRpbmdfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICBjb25zdCBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIGNvbnN0IG1haW5DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy50cmFuc2FjdGlvbnNfX2NoZWNrLWFsbCBpbnB1dCcpO1xuICBjb25zdCBzZW5kZXJJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXNlbmRlciBpbnB1dCcpO1xuICBjb25zdCByZWNpcGllbnRJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXJlY2lwaWVudCBpbnB1dCcpO1xuICBjb25zdCBzdW1JbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXN1bSBpbnB1dCcpO1xuICBjb25zdCBwdXJwb3NlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1wdXJwb3NlIGlucHV0Jyk7XG5cbiAgY29uc3QgZ2V0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fY2hlY2sgaW5wdXQnKTtcbiAgfTtcblxuICBjb25zdCBnZXRBbGxNb2JpbGVDaGVja2JveCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBtb2RhbC5xdWVyeVNlbGVjdG9yQWxsKCcudHJhbnNhY3Rpb25zX19tb2JpbGUtY2hlY2sgaW5wdXQnKTtcbiAgfVxuXG4gIGNvbnN0IG9uQWxsQ2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGNvbnN0IHJvdyA9IGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICAgIGlmIChtYWluQ2hlY2tib3guY2hlY2tlZCkge1xuICAgICAgICBpdGVtLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgICBpZiAoIXJvdy5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrZWQnKSkge1xuICAgICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCdjaGVja2VkJyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICBpZiAocm93LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tlZCcpKSB7XG4gICAgICAgICAgcm93LmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH07XG5cbiAgY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgbWFpbkNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcblxuICAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgIGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdjaGVja2VkJyk7XG4gICAgfSk7XG5cbiAgICBnZXRBbGxNb2JpbGVDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gICAgICBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICB9KTtcblxuICAgICQoJyNwYXltZW50LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICAgIHNlbmRlcklucHV0LnZhbHVlID0gJyc7XG4gICAgcmVjaXBpZW50SW5wdXQudmFsdWUgPSAnJztcbiAgICBzdW1JbnB1dC52YWx1ZSA9ICcnO1xuICAgIHB1cnBvc2VJbnB1dC52YWx1ZSA9ICcnO1xuICB9O1xuXG4gIGNvbnN0IG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgICAgIG9uQ2xvc2VDbGljaygpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG9uQ2hlY2tib3hDaGFuZ2UgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHtcbiAgICAgIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnY2hlY2tlZCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBvbk1vYmlsZUNoZWNrYm94Q2hhbmdlID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7XG4gICAgICBlLnRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdjaGVja2VkJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGUudGFyZ2V0LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICB9XG4gIH1cblxuICAvLyBwYXltZW50Q29uZmlybUJ0bnMuZm9yRWFjaChmdW5jdGlvbihidG4pIHtcbiAgLy8gICBuZXcgTW9kYWwoYnRuLCBtb2RhbCk7XG4gIC8vIH0pO1xuXG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgbWFpbkNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQWxsQ2hhbmdlKTtcbiAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQ2hlY2tib3hDaGFuZ2UpO1xuICB9KVxuXG4gIGdldEFsbE1vYmlsZUNoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbk1vYmlsZUNoZWNrYm94Q2hhbmdlKTtcbiAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHBheW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm11dHVhbC1jYWxjcy1wYXltZW50LWJsb2NrX19saW5rJyk7XG5cbiAgaWYgKCFwYXltZW50c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheW1lbnQtaW5mb19fbW9kYWwnKTtcblxuICBwYXltZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KVxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuLy8gICB2YXIgamJTY2FubmVyO1xuXG5cbi8vIGZ1bmN0aW9uIG9uUVJDb2RlU2Nhbm5lZChzY2FubmVkVGV4dCkge1xuLy8gICB2YXIgc2Nhbm5lZFRleHRNZW1vID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zdWJzY3JpYmUtcmVnaXN0ZXJfX2lucHV0ICBpbnB1dFwiKTtcbi8vICAgY29uc29sZS5sb2coc2Nhbm5lZFRleHRNZW1vKTtcbi8vICAgaWYoc2Nhbm5lZFRleHRNZW1vKVxuLy8gICB7XG4vLyAgICAgICBzY2FubmVkVGV4dE1lbW8udmFsdWUgPSBzY2FubmVkVGV4dDtcbi8vICAgICAgICQoXCIucXItc2Nhbm5lci1tb2RhbFwiKS5yZW1vdmVDbGFzcyhcImpzLXNob3dcIik7XG4vLyAgICAgICBqYlNjYW5uZXIuc3RvcFNjYW5uaW5nKCk7XG4vLyAgIH1cbi8vIH1cblxuXG4vLyAgICAgICAgICAgICBmdW5jdGlvbiBwcm92aWRlVmlkZW8oKVxuLy8gICAgICAgICAgICAge1xuLy8gICAgICAgICAgICAgICAgIHZhciBuID0gbmF2aWdhdG9yO1xuXG4vLyAgICAgICAgICAgICAgICAgaWYgKG4ubWVkaWFEZXZpY2VzICYmIG4ubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSlcbi8vICAgICAgICAgICAgICAgICB7XG4vLyAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHtcbi8vICAgICAgICAgICAgICAgICAgICAgdmlkZW86IHtcbi8vICAgICAgICAgICAgICAgICAgICAgICBmYWNpbmdNb2RlOiBcImVudmlyb25tZW50XCJcbi8vICAgICAgICAgICAgICAgICAgICAgfSxcbi8vICAgICAgICAgICAgICAgICAgICAgYXVkaW86IGZhbHNlXG4vLyAgICAgICAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICAgICAgICB9XG5cbi8vICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoJ1lvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IGdldFVzZXJNZWRpYScpO1xuLy8gICAgICAgICAgICAgfVxuXG5cbi8vICAgICAgICAgICAgIGZ1bmN0aW9uIHByb3ZpZGVWaWRlb1FRKClcbi8vICAgICAgICAgICAgIHtcbi8vICAgICAgICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKClcbi8vICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihkZXZpY2VzKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIHZhciBleENhbWVyYXMgPSBbXTtcbi8vICAgICAgICAgICAgICAgICAgICAgZGV2aWNlcy5mb3JFYWNoKGZ1bmN0aW9uKGRldmljZSkge1xuLy8gICAgICAgICAgICAgICAgICAgICBpZiAoZGV2aWNlLmtpbmQgPT09ICd2aWRlb2lucHV0Jykge1xuLy8gICAgICAgICAgICAgICAgICAgICBleENhbWVyYXMucHVzaChkZXZpY2UuZGV2aWNlSWQpXG4vLyAgICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgICB9KTtcblxuLy8gICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGV4Q2FtZXJhcyk7XG4vLyAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihpZHMpe1xuLy8gICAgICAgICAgICAgICAgICAgICBpZihpZHMubGVuZ3RoID09PSAwKVxuLy8gICAgICAgICAgICAgICAgICAgICB7XG4vLyAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnQ291bGQgbm90IGZpbmQgYSB3ZWJjYW0nKTtcbi8vICAgICAgICAgICAgICAgICAgICAgfVxuXG4vLyAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlbzoge1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgJ29wdGlvbmFsJzogW3tcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnc291cmNlSWQnOiBpZHMubGVuZ3RoID09PSAxID8gaWRzWzBdIDogaWRzWzFdLy90aGlzIHdheSBRUSBicm93c2VyIG9wZW5zIHRoZSByZWFyIGNhbWVyYVxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICAgICAgIH0pO1xuLy8gICAgICAgICAgICAgICAgIH0pO1xuLy8gICAgICAgICAgICAgfVxuXG5cblxuXG5cblxuXG4vLyAgICQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIuc3Vic2NyaWJlLXJlZ2lzdGVyX19idG5cIiwgKGUpID0+IHtcblxuXG5cbi8vICAgICAgICAgICAgICAgaWYgKGpiU2Nhbm5lcikge1xuLy8gICAgICAgICAgICAgICAgICAgamJTY2FubmVyLnJlc3VtZVNjYW5uaW5nKCk7XG4vLyAgICAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAgICBqYlNjYW5uZXIgPSBuZXcgSnNRUlNjYW5uZXIob25RUkNvZGVTY2FubmVkKTtcbi8vICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGpiU2Nhbm5lcik7XG4vLyAgICAgICAgICAgICAgICAgICBqYlNjYW5uZXIuc2V0U25hcEltYWdlTWF4U2l6ZSgzMDApO1xuLy8gICAgICAgICAgICAgICAgICAgdmFyIHNjYW5uZXJQYXJlbnRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJqcy12aWRlby1ib3hcIik7XG4vLyAgICAgICAgICAgICAgICAgICBpZihzY2FubmVyUGFyZW50RWxlbWVudClcbi8vICAgICAgICAgICAgICAgICAgIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAvL2FwcGVuZCB0aGUgamJTY2FubmVyIHRvIGFuIGV4aXN0aW5nIERPTSBlbGVtZW50XG4vLyAgICAgICAgICAgICAgICAgICAgICAgamJTY2FubmVyLmFwcGVuZFRvKHNjYW5uZXJQYXJlbnRFbGVtZW50KTtcbi8vICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgfVxuXG5cblxuXG4vLyAgIH0pO1xuXG4vLyAgICQoZG9jdW1lbnQpLm9uKFwiY2xpY2tcIiwgXCIucXItc2Nhbm5lci1tb2RhbCAucXItc2Nhbm5lci1tb2RhbF9fY2xvc2VcIiwgKGUpID0+IHtcbi8vICAgICAgIGpiU2Nhbm5lci5zdG9wU2Nhbm5pbmcoKTtcbi8vICAgfSk7XG5cblxudmFyIHNjYW5uZXJQYXJlbnRFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJqcy12aWRlby1ib3hcIik7XG52YXIgamJTY2FubmVyO1xuXG4gICQoJy5zdWJzY3JpYmUtcmVnaXN0ZXJfX2lucHV0IC5pbnB1dC10ZXh0JykuZWFjaChmdW5jdGlvbihpbmRleCwgdmFsdWUpIHtcblxuICAgIGNvbnN0ICRpbnB1dCA9ICQodGhpcyk7XG5cbiAgICAvLyBmdW5jdGlvbiBvblFSQ29kZVNjYW5uZWQoc2Nhbm5lZFRleHQpIHtcblxuICAgIC8vICAgICAgICRpbnB1dC52YWwoc2Nhbm5lZFRleHQpO1xuICAgIC8vICAgICAgICQoXCIucXItc2Nhbm5lci1tb2RhbFwiKS5yZW1vdmVDbGFzcyhcImpzLXNob3dcIik7XG4gICAgLy8gICAgICAgamJTY2FubmVyLnN0b3BTY2FubmluZygpO1xuXG4gICAgLy8gfVxuXG4gICAgZnVuY3Rpb24gb25RUkNvZGVTY2FubmVkKGVsKSB7XG5cbiAgICAgIHJldHVybiBmdW5jdGlvbihzY2FubmVkVGV4dCkge1xuXG4gICAgICAgIGVsLnZhbChzY2FubmVkVGV4dCk7XG4gICAgICAgICQoXCIucXItc2Nhbm5lci1tb2RhbFwiKS5yZW1vdmVDbGFzcyhcImpzLXNob3dcIik7XG4gICAgICAgIGpiU2Nhbm5lci5zdG9wU2Nhbm5pbmcoKTtcbiAgICAgICAgamJTY2FubmVyLnJlbW92ZUZyb20oc2Nhbm5lclBhcmVudEVsZW1lbnQpO1xuICAgICAgfVxuXG4gICAgfVxuXG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHByb3ZpZGVWaWRlbygpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdmFyIG4gPSBuYXZpZ2F0b3I7XG5cbiAgICAgICAgICAgICAgICBpZiAobi5tZWRpYURldmljZXMgJiYgbi5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKVxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBuLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoe1xuICAgICAgICAgICAgICAgICAgICB2aWRlbzoge1xuICAgICAgICAgICAgICAgICAgICAgIGZhY2luZ01vZGU6IFwiZW52aXJvbm1lbnRcIlxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBhdWRpbzogZmFsc2VcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnWW91ciBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgZ2V0VXNlck1lZGlhJyk7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgZnVuY3Rpb24gcHJvdmlkZVZpZGVvUVEoKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmVudW1lcmF0ZURldmljZXMoKVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGRldmljZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV4Q2FtZXJhcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBkZXZpY2VzLmZvckVhY2goZnVuY3Rpb24oZGV2aWNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkZXZpY2Uua2luZCA9PT0gJ3ZpZGVvaW5wdXQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGV4Q2FtZXJhcy5wdXNoKGRldmljZS5kZXZpY2VJZClcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZXhDYW1lcmFzKTtcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGlkcyl7XG4gICAgICAgICAgICAgICAgICAgIGlmKGlkcy5sZW5ndGggPT09IDApXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdDb3VsZCBub3QgZmluZCBhIHdlYmNhbScpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZGVvOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnb3B0aW9uYWwnOiBbe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzb3VyY2VJZCc6IGlkcy5sZW5ndGggPT09IDEgPyBpZHNbMF0gOiBpZHNbMV0vL3RoaXMgd2F5IFFRIGJyb3dzZXIgb3BlbnMgdGhlIHJlYXIgY2FtZXJhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfV1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cblxuXG5cblxuXG5cbiAgICAkaW5wdXQuc2libGluZ3MoJy5zdWJzY3JpYmUtcmVnaXN0ZXJfX2J0bicpLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcblxuXG5cblxuICAgICAgamJTY2FubmVyID0gbmV3IEpzUVJTY2FubmVyKG9uUVJDb2RlU2Nhbm5lZCgkaW5wdXQpKTtcbiAgICAgIC8vY29uc29sZS5sb2coamJTY2FubmVyKTtcbiAgICAgIGpiU2Nhbm5lci5zZXRTbmFwSW1hZ2VNYXhTaXplKDMwMCk7XG4gICAgICAvL3ZhciBzY2FubmVyUGFyZW50RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwianMtdmlkZW8tYm94XCIpO1xuICAgICAgaWYoc2Nhbm5lclBhcmVudEVsZW1lbnQpXG4gICAgICB7XG4gICAgICAgIHNjYW5uZXJQYXJlbnRFbGVtZW50LmlubmVySFRNTCA9ICcnO1xuICAgICAgICAgIC8vYXBwZW5kIHRoZSBqYlNjYW5uZXIgdG8gYW4gZXhpc3RpbmcgRE9NIGVsZW1lbnRcbiAgICAgICAgICBqYlNjYW5uZXIuYXBwZW5kVG8oc2Nhbm5lclBhcmVudEVsZW1lbnQpO1xuICAgICAgfVxuXG5cblxuXG5cbiAgICB9KTtcbiAgfSlcblxuICAkKGRvY3VtZW50KS5vbihcImNsaWNrXCIsIFwiLnFyLXNjYW5uZXItbW9kYWwgLnFyLXNjYW5uZXItbW9kYWxfX2Nsb3NlXCIsIChlKSA9PiB7XG4gICAgICBqYlNjYW5uZXIuc3RvcFNjYW5uaW5nKCk7XG4gICAgICBqYlNjYW5uZXIucmVtb3ZlRnJvbShzY2FubmVyUGFyZW50RWxlbWVudCk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgcmV3YXJkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN1YnNjcmlwdGlvbi1wYWdlX19yZXdhcmQtbW9iaWxlJyk7XG5cbiAgaWYgKCFyZXdhcmQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBzbGlkZXIgPSBuZXcgU3dpcGVyKCcuc3Vic2NyaXB0aW9uLXBhZ2VfX3Jld2FyZC1tb2JpbGUnLCB7XG4gICAgc2xpZGVzUGVyVmlldzogMSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICBlbDogJy5zdWJzY3JpcHRpb24tcGFnZV9fcGFnaW5hdGlvbicsXG4gICAgICBkeW5hbWljQnVsbGV0czogdHJ1ZSxcbiAgICB9XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3Qgc2NoZWR1bGVCdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWRldmljZV9fc2NoZWR1bGUnKTtcblxuICBpZiAoIXNjaGVkdWxlQnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NjaGVkdWxlX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjb25zdCByYWRpb3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2NoZWR1bGVfX21vZGFsLXRvZ2dsZSBpbnB1dCcpO1xuICAvLyBjb25zdCB0b2dnbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NoZWR1bGVfX21vZGFsLXRvZ2dsZScpO1xuXG4gIC8vIHJhZGlvcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0sIGlkKSB7XG4gIC8vICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcbiAgLy8gICAgIGlmIChpZCA9PT0gMCkge1xuICAvLyAgICAgICB0b2dnbGUuY2xhc3NMaXN0LnJlbW92ZSgnc2Vjb25kLXRhYicpO1xuICAvLyAgICAgICB0b2dnbGUuY2xhc3NMaXN0LmFkZCgnZmlyc3QtdGFiJyk7XG4gIC8vICAgICB9XG5cbiAgLy8gICAgIGlmIChpZCA9PT0gMSkge1xuICAvLyAgICAgICB0b2dnbGUuY2xhc3NMaXN0LnJlbW92ZSgnZmlyc3QtdGFiJyk7XG4gIC8vICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QuYWRkKCdzZWNvbmQtdGFiJyk7XG4gIC8vICAgICB9XG4gIC8vICAgfSlcbiAgLy8gfSlcblxuICBzY2hlZHVsZUJ0bnMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAvLyBjb25zdCBzY2hlZHVsZUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtZGV2aWNlX19zY2hlZHVsZScpO1xuXG4gIC8vIGlmICghc2NoZWR1bGVCdG5zWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NoZWR1bGVfX21vZGFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHJhZGlvcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zY2hlZHVsZV9fbW9kYWwtdG9nZ2xlIGlucHV0Jyk7XG4gIGNvbnN0IHRvZ2dsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY2hlZHVsZV9fbW9kYWwtdG9nZ2xlJyk7XG5cbiAgcmFkaW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaWQpIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKGlkID09PSAwKSB7XG4gICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QucmVtb3ZlKCdzZWNvbmQtdGFiJyk7XG4gICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QuYWRkKCdmaXJzdC10YWInKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGlkID09PSAxKSB7XG4gICAgICAgIHRvZ2dsZS5jbGFzc0xpc3QucmVtb3ZlKCdmaXJzdC10YWInKTtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5hZGQoJ3NlY29uZC10YWInKTtcbiAgICAgIH1cbiAgICB9KVxuICB9KVxuXG4gIC8vIHNjaGVkdWxlQnRucy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgLy8gICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICAvLyB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICBjb25zdCBtYWluUGFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYWluLXBhZ2UnKTtcblxuICBpZiAoIW1haW5QYWdlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc3VwcG9ydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zdXBwb3J0Jyk7XG4gIGNvbnN0IHN1cHBvcnRDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3VwcG9ydF9fY29udGFpbmVyJyk7XG4gIGNvbnN0IGl0ZW1zID0gc3VwcG9ydC5xdWVyeVNlbGVjdG9yQWxsKCcuc3VwcG9ydF9faXRlbScpO1xuXG4gIGZ1bmN0aW9uIG1ha2VTbGlkZXIoKSB7XG4gICAgY29uc3QgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3N3aXBlci1jb250YWluZXInKTtcbiAgICBjb250YWluZXIuY2xhc3NMaXN0LmFkZCgnc3VwcG9ydF9fc2xpZGVyJyk7XG4gICAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgnc3dpcGVyLXdyYXBwZXInKTtcblxuICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24oaXRlbSwgaWR4KSB7XG4gICAgICBjb25zdCBzbGlkZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgc2xpZGUuY2xhc3NMaXN0LmFkZCgnc3dpcGVyLXNsaWRlJylcbiAgICAgIGNvbnN0IG5vZGUgPSBpdGVtLmNsb25lTm9kZSh0cnVlKTtcbiAgICAgIHNsaWRlLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgd3JhcHBlci5hcHBlbmRDaGlsZChzbGlkZSk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBwYWdpbmF0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgcGFnaW5hdGlvbi5jbGFzc0xpc3QuYWRkKCdzdXBwb3J0X19zbGlkZXItcGFnaW5hdGlvbicsJ3N3aXBlci1wYWdpbmF0aW9uJyk7XG5cbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQod3JhcHBlcik7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHBhZ2luYXRpb24pO1xuICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGNvbnRhaW5lcik7XG5cbiAgICBzdXBwb3J0Q29udGFpbmVyLmFwcGVuZENoaWxkKGZyYWdtZW50KTtcblxuICAgIGNvbnN0IHNsaWRlciA9IG5ldyBTd2lwZXIoJy5zdXBwb3J0X19zbGlkZXInLCB7XG4gICAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgICAgcGFnaW5hdGlvbjoge1xuICAgICAgICBlbDogJy5zdXBwb3J0X19zbGlkZXItcGFnaW5hdGlvbidcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIG1ha2VTbGlkZXIoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICQoJy5zdXBwb3J0X19kb2NzLWJ0bicpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICQodGhpcykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCB0cmFuc2FjdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudHJhbnNhY3Rpb25zLW1vYmlsZS1ibG9jaycpO1xuXG4gIGlmICghdHJhbnNhY3Rpb25zKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3Qgc2xpZGVyID0gbmV3IFN3aXBlcignLnRyYW5zYWN0aW9ucy1tb2JpbGUtYmxvY2tfX3NsaWRlcicsIHtcbiAgICBzbGlkZXNQZXJWaWV3OiAxLFxuICAgIHBhZ2luYXRpb246IHtcbiAgICAgIGVsOiAnLnRyYW5zYWN0aW9ucy1tb2JpbGUtYmxvY2tfX3BhZ2luYXRpb24nLFxuICAgICAgZHluYW1pY0J1bGxldHM6IHRydWUsXG4gICAgfVxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICQoJy5oZWFkZXJfX3VzZXItYnRuJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgIGlmICgkKHRoaXMpLmlzKGUudGFyZ2V0KSkge1xuICAgICAgJCh0aGlzKS50b2dnbGVDbGFzcygnYWN0aXZlJyk7XG4gICAgfVxuICB9KTtcblxuICAkKGRvY3VtZW50KS5vbignbW91c2V1cCcsIGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgYmxvY2sgPSAkKCcuaGVhZGVyX191c2VyLWJ0bicpO1xuXG4gICAgaWYgKCFibG9jay5pcyhlLnRhcmdldCkgJiYgYmxvY2suaGFzKGUudGFyZ2V0KS5sZW5ndGggPT09IDApIHtcbiAgICAgIGJsb2NrLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICB9XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgdmVyaWZpY2F0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvbicpO1xuXG4gIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyaWZpY2F0aW9uX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBjb25zdCBmaWxlSW5wdXRCbG9jayA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy52ZXJpZmljYXRpb25fX21vZGFsLWlucHV0LWZpbGUnKTtcbiAgLy8gY29uc3QgZmlsZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG4gIC8vIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICAvLyBjb25zdCBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIC8vIGNvbnN0IHNhdmVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcblxuICAvLyBjb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAvLyAgICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG5cbiAgLy8gICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuICAvLyAgICAgc2F2ZUJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuXG4gIC8vICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAvLyAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAvLyAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgLy8gICAgIH1cbiAgLy8gICB9XG4gIC8vIH1cblxuICAvLyBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gIC8vICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgLy8gICB9XG4gIC8vIH1cblxuICAvLyBjb25zdCBvbklucHV0Q2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gIC8vICAgaWYgKGZpbGVJbnB1dC52YWx1ZSAhPT0gJycpIHtcbiAgLy8gICAgIHNhdmVCdG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAvLyAgIH1cbiAgLy8gfVxuXG4gIHZlcmlmaWNhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KVxuXG4gIC8vIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgLy8gb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgLy8gZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uSW5wdXRDaGFuZ2UpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgLy8gY29uc3QgdmVyaWZpY2F0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LWluZm9fX3ZlcmlmaWNhdGlvbicpO1xuXG4gIC8vIGlmICghdmVyaWZpY2F0aW9uQnRuWzBdKSB7XG4gIC8vICAgcmV0dXJuO1xuICAvLyB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyaWZpY2F0aW9uX19tb2RhbCcpO1xuXG4gIGlmICghbW9kYWwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBmaWxlSW5wdXRCbG9jayA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoJy52ZXJpZmljYXRpb25fX21vZGFsLWlucHV0LWZpbGUnKTtcbiAgLy9jb25zdCBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgLy9jb25zdCBmaWxlQ2xlYXIgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuXG4gIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICBjb25zdCBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIGNvbnN0IHNhdmVCdG4gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcblxuICBjb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICBmaWxlSW5wdXRCbG9jay5mb3JFYWNoKGZ1bmN0aW9uKGlucHV0QmxvY2spIHtcbiAgICAgIGNvbnN0IGZpbGVJbnB1dCA9IGlucHV0QmxvY2sucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG5cbiAgICAgIGlmIChpbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgICAgICAgaW5wdXRCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcblxuICAgICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgICAgICAgc2F2ZUJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuXG4gICAgICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH1cblxuICBjb25zdCBjaGVja0lucHV0cyA9IGZ1bmN0aW9uKCkge1xuICAgIGxldCBmaWxsZWQgPSB0cnVlO1xuXG4gICAgZmlsZUlucHV0QmxvY2suZm9yRWFjaChmdW5jdGlvbihpbnB1dEJsb2NrKSB7XG4gICAgICBjb25zdCBmaWxlSW5wdXQgPSBpbnB1dEJsb2NrLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuXG4gICAgICBpZiAoZmlsZUlucHV0LnZhbHVlID09PSAnJykge1xuICAgICAgICBmaWxsZWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmIChmaWxsZWQgJiYgc2F2ZUJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHNhdmVCdG4ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xuICAgIH1cblxuICAgIGlmICghZmlsbGVkICYmICFzYXZlQnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc2F2ZUJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgICAgIG9uQ2xvc2VDbGljaygpO1xuICAgIH1cbiAgfVxuXG4gIC8vIGNvbnN0IG9uSW5wdXRDaGFuZ2UgPSBmdW5jdGlvbigpIHtcbiAgLy8gICBpZiAoZmlsZUlucHV0LnZhbHVlICE9PSAnJykge1xuICAvLyAgICAgc2F2ZUJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gIC8vICAgfVxuICAvLyB9XG5cbiAgY29uc3Qgb25GaWxlQ2xlYXIgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXNhdmVCdG4uaGFzQXR0cmlidXRlKCdkaXNhYmxlZCcpKSB7XG4gICAgICBzYXZlQnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9XG5cbiAgLy8gdmVyaWZpY2F0aW9uQnRuLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIC8vIH0pXG5cbiAgd2luZG93Lm9uVmVyaWZpY2F0aW9uRmlsZURyb3AgPSBmdW5jdGlvbigpIHtcbiAgICBjaGVja0lucHV0cygpO1xuICB9O1xuXG4gIGZpbGVJbnB1dEJsb2NrLmZvckVhY2goZnVuY3Rpb24oaW5wdXRCbG9jaykge1xuICAgIGNvbnN0IGZpbGVJbnB1dCA9IGlucHV0QmxvY2sucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG4gICAgY29uc3QgZmlsZUNsZWFyID0gaW5wdXRCbG9jay5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19jbGVhcicpO1xuXG5cbiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgd2luZG93Lm9uVmVyaWZpY2F0aW9uRmlsZURyb3ApO1xuICAgIGZpbGVDbGVhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uRmlsZUNsZWFyKTtcbiAgfSlcblxuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjYW5jZWxsYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fc2VyaWFsLWJ0bicpO1xuXG4gIGlmICghY2FuY2VsbGF0aW9uQnRuWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd3JpdGUtc2VyaWFsJyk7XG5cbiAgaWYgKCFtb2RhbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNhbmNlbGxhdGlvbkJ0bi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KTtcblxuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAvLyBjb25zdCB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG5cbiAgLy8gaWYgKCF2ZXJpZmljYXRpb25CdG5bMF0pIHtcbiAgLy8gICByZXR1cm47XG4gIC8vIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3cml0ZS1zZXJpYWwnKTtcblxuICBpZiAoIW1vZGFsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgaW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcud3JpdGUtc2VyaWFsX19pbnB1dCAuaW5wdXQtdGV4dCcpO1xuICBjb25zdCBidG4gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3NhdmUnKTtcblxuICBjb25zdCBvbklucHV0ID0gZnVuY3Rpb24oZSkge1xuICAgIGNvbnN0IHZhbHVlID0gZS50YXJnZXQudmFsdWU7XG5cbiAgICBpZiAoXG4gICAgICB2YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpICE9PSAnJ1xuICAgICAgJiYgdmFsdWUubGVuZ3RoID4gMFxuICAgICAgJiYgYnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgICkge1xuICAgICAgYnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgIH1cblxuICAgIGlmIChcbiAgICAgIHZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnXG4gICAgICB8fCB2YWx1ZS5sZW5ndGggPT09IDBcbiAgICApIHtcbiAgICAgIGlmICghYnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgICBidG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyB2ZXJpZmljYXRpb25CdG4uZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gIC8vICAgbmV3IE1vZGFsKGl0ZW0sIG1vZGFsKTtcbiAgLy8gfSlcblxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uSW5wdXQpO1xufSkoKTtcbiJdfQ==
