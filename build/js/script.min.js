"use strict";$(".date-input").datepicker(),function(){var e=document.querySelectorAll(".input-file__label");function t(e){var t=e.querySelector("input");function n(e){e.preventDefault(),e.stopPropagation()}function i(t){e.classList.add("highlight")}function o(t){e.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,n,!1)})),["dragenter","dragover"].forEach((function(t){e.addEventListener(t,i,!1)})),["dragleave","drop"].forEach((function(t){e.addEventListener(t,o,!1)})),e.addEventListener("drop",(function(e){var n=e.dataTransfer.files;t.files&&t.files[0]&&(t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file"));t.files=n,c()}),!1);var c=function(){l(t)},l=function(t){if(t.files&&t.files[0]){var n=new FileReader;n.onload=function(n){e.parentNode.classList.add("loaded"),e.nextElementSibling.querySelector(".file-load__name").textContent=t.files[0].name},n.readAsDataURL(t.files[0])}};t.addEventListener("change",c)}window.makeFileLoad=t,e[0]&&e.forEach((function(e){t(e)}))}(),function(){var e=document.querySelectorAll(".delivery-or-pickup__modal-time");if(e[0]){var t=new Inputmask("99:99");e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelectorAll(".input-text");e[0]&&e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))}))}(),function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));var t=document.querySelector("body");function n(e,t){this.trigger=e,this.modal=t,this.overlay=this.modal.querySelector(".modal__overlay"),this.closeBtn=this.modal.querySelector(".modal__close"),this.onOverlayClick=this.onOverlayClick.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onTriggerClick=this.onTriggerClick.bind(this),this.onResize=this.onResize.bind(this),this.addEventListeners()}n.prototype.open=function(){this.modal.classList.add("js-show"),t.classList.add("js__body-no-scroll")},n.prototype.close=function(){this.modal.classList.remove("js-show"),t.classList.remove("js__body-no-scroll")},n.prototype.onOverlayClick=function(e){e.target===this.overlay&&this.close()},n.prototype.onCloseClick=function(){this.close()},n.prototype.onTriggerClick=function(){this.open()},n.prototype.onResize=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))},n.prototype.addEventListeners=function(){var e,t;this.overlay.addEventListener("click",this.onOverlayClick),this.closeBtn.addEventListener("click",this.onCloseClick),this.trigger.addEventListener("click",this.onTriggerClick),window.addEventListener("resize",(e=this.onResize,function(n){t&&clearTimeout(t),t=setTimeout(e,100,n)}))},window.Modal=n}(),function(){var e=document.querySelectorAll(".search"),t=document.querySelectorAll(".search + .search-close");e[0]&&(e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))})),t.forEach((function(e){e.addEventListener("click",(function(){var t=e.previousElementSibling;t.value="",t.classList.contains("js-inputed")&&t.classList.remove("js-inputed")}))})))}(),$(".select").select2(),$(".select").on("select2:select",(function(e){$(this).addClass("picked")})),$(".contract-info__delivered-toggle").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),document.querySelector(".contracts-all")&&$(".date-input").datepicker(),function(){var e=document.querySelectorAll(".deliver-or-pickup__confirm-btn");if(e[0]){$("#delivery-date").datepicker();var t=document.getElementById("delivery-or-pickup__modal"),n=t.querySelector(".modal__close"),i=t.querySelector(".delivery-or-pickup__modal-input-file"),o=t.querySelector(".input-file__input"),c=t.querySelector(".delivery-or-pickup__modal-time"),l=t.querySelector(".delivery-or-pickup__modal-time"),s=t.querySelector(".checkbox__input");e.forEach((function(e){new Modal(e,t)}));n.addEventListener("click",(function(){i.classList.contains("loaded")&&(i.classList.remove("loaded"),c.value="",l.value="",s.checked=!1,$("#delivery-date").datepicker("setDate",""),o.value="",/safari/i.test(navigator.userAgent)||(o.type="",o.type="file"))}))}}(),$(".filters__btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){var e=document.querySelectorAll(".payment-waiting__confirm-btn");if(e[0]){$("#payment-date").datepicker();var t=document.getElementById("payment-waiting__modal"),n=t.querySelector(".modal__close"),i=t.querySelector(".transactions__check-all input"),o=t.querySelector(".payment-waiting__modal-sender input"),c=t.querySelector(".payment-waiting__modal-recipient input"),l=t.querySelector(".payment-waiting__modal-sum input"),s=t.querySelector(".payment-waiting__modal-purpose input"),a=function(){return t.querySelectorAll(".transactions__check input")};e.forEach((function(e){new Modal(e,t)})),n.addEventListener("click",(function(){i.checked=!1,a().forEach((function(e){e.checked=!1})),$("#payment-date").datepicker("setDate",""),o.value="",c.value="",l.value="",s.value=""})),i.addEventListener("change",(function(){a().forEach((function(e){i.checked?e.checked=!0:e.checked=!1}))}))}}(),$(".support__docs-btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyIsImRhdGUtaW5wdXQuanMiLCJpbnB1dC1maWxlLmpzIiwiaW5wdXQtbWFzay5qcyIsImlucHV0LXRleHQuanMiLCJtb2RhbC5qcyIsInNlYXJjaC5qcyIsInNlbGVjdC5qcyIsImNvbnRyYWN0LXBhZ2UuanMiLCJjb250cmFjdHMtYWxsLmpzIiwiZGVsaXZlcnktbW9kYWwuanMiLCJmaWx0ZXJzLmpzIiwicGF5bWVudC1jb25maXJtLW1vZGFsLmpzIiwic3VwcG9ydC5qcyJdLCJuYW1lcyI6WyIkIiwiZGF0ZXBpY2tlciIsImZpbGVEcm9wQXJlYSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsIm1ha2VGaWxlTG9hZCIsImZpbGVJbnB1dCIsInF1ZXJ5U2VsZWN0b3IiLCJwcmV2ZW50RGVmYXVsdHMiLCJlIiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJoaWdobGlnaHQiLCJjbGFzc0xpc3QiLCJhZGQiLCJ1bmhpZ2hsaWdodCIsInJlbW92ZSIsImZvckVhY2giLCJldmVudE5hbWUiLCJhZGRFdmVudExpc3RlbmVyIiwiZmlsZXMiLCJkYXRhVHJhbnNmZXIiLCJ2YWx1ZSIsInRlc3QiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJ0eXBlIiwib25GaWxlQ2hhbmdlIiwicmVhZFVybCIsImlucHV0IiwicmVhZGVyIiwiRmlsZVJlYWRlciIsIm9ubG9hZCIsInBhcmVudE5vZGUiLCJuZXh0RWxlbWVudFNpYmxpbmciLCJ0ZXh0Q29udGVudCIsIm5hbWUiLCJyZWFkQXNEYXRhVVJMIiwid2luZG93IiwiaXRlbSIsImRlbGl2ZXJ5VGltZUlucHV0cyIsImltIiwiSW5wdXRtYXNrIiwibWFzayIsImlucHV0cyIsInNwbGl0Iiwiam9pbiIsImNvbnRhaW5zIiwidmgiLCJpbm5lckhlaWdodCIsImRvY3VtZW50RWxlbWVudCIsInN0eWxlIiwic2V0UHJvcGVydHkiLCJjb25jYXQiLCIkYm9keSIsIk1vZGFsIiwidHJpZ2dlciIsIm1vZGFsIiwidGhpcyIsIm92ZXJsYXkiLCJjbG9zZUJ0biIsIm9uT3ZlcmxheUNsaWNrIiwiYmluZCIsIm9uQ2xvc2VDbGljayIsIm9uVHJpZ2dlckNsaWNrIiwib25SZXNpemUiLCJhZGRFdmVudExpc3RlbmVycyIsInByb3RvdHlwZSIsIm9wZW4iLCJjbG9zZSIsInRhcmdldCIsImZ1bmMiLCJ0aW1lciIsImV2ZW50IiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsIml0ZW1zIiwic2VhcmNoIiwicHJldmlvdXNFbGVtZW50U2libGluZyIsInNlbGVjdDIiLCJvbiIsImFkZENsYXNzIiwiY2xpY2siLCJwYXJlbnQiLCJuZXh0Iiwic2xpZGVUb2dnbGUiLCJ0b2dnbGVDbGFzcyIsImRlbGl2ZXJ5QnRucyIsImdldEVsZW1lbnRCeUlkIiwiZmlsZUlucHV0QmxvY2siLCJkYXRlSW5wdXQiLCJ0aW1lSW5wdXQiLCJjb25maXJtQ2hlY2tib3giLCJidG4iLCJjaGVja2VkIiwicGF5bWVudENvbmZpcm1CdG5zIiwibWFpbkNoZWNrYm94Iiwic2VuZGVySW5wdXQiLCJyZWNpcGllbnRJbnB1dCIsInN1bUlucHV0IiwicHVycG9zZUlucHV0IiwiZ2V0QWxsQ2hlY2tib3giXSwibWFwcGluZ3MiOiJBQUFBLGFDQ0FBLEVBQUEsZUFBQUMsYUNEQSxXQUNBLElBQUFDLEVBQUFDLFNBQUFDLGlCQUFBLHNCQUVBLFNBQUFDLEVBQUFILEdBQ0EsSUFBQUksRUFBQUosRUFBQUssY0FBQSxTQU9BLFNBQUFDLEVBQUFDLEdBQ0FBLEVBQUFDLGlCQUNBRCxFQUFBRSxrQkFhQSxTQUFBQyxFQUFBSCxHQUNBUCxFQUFBVyxVQUFBQyxJQUFBLGFBR0EsU0FBQUMsRUFBQU4sR0FDQVAsRUFBQVcsVUFBQUcsT0FBQSxhQXhCQSxDQUFBLFlBQUEsV0FBQSxZQUFBLFFBQUFDLFNBQUEsU0FBQUMsR0FDQWhCLEVBQUFpQixpQkFBQUQsRUFBQVYsR0FBQSxNQVVBLENBQUEsWUFBQSxZQUFBUyxTQUFBLFNBQUFDLEdB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QUFBLDBCQUNBbkIsRUFBQVosRUFBQWxELGNBQUEsaUJBQ0F5RixFQUFBdkMsRUFBQWxELGNBQUEsa0NBQ0EwRixFQUFBeEMsRUFBQWxELGNBQUEsd0NBQ0EyRixFQUFBekMsRUFBQWxELGNBQUEsMkNBQ0E0RixFQUFBMUMsRUFBQWxELGNBQUEscUNBQ0E2RixFQUFBM0MsRUFBQWxELGNBQUEseUNBRUE4RixFQUFBLFdBQ0EsT0FBQTVDLEVBQUFyRCxpQkFBQSwrQkF5QkEyRixFQUFBOUUsU0FBQSxTQUFBNEUsR0FDQSxJQUFBdEMsTUFBQXNDLEVBQUFwQyxNQUdBWSxFQUFBbEQsaUJBQUEsU0FoQkEsV0FDQTZFLEVBQUFGLFNBQUEsRUFDQU8sSUFBQXBGLFNBQUEsU0FBQXNCLEdBQ0FBLEVBQUF1RCxTQUFBLEtBRUE5RixFQUFBLGlCQUFBQyxXQUFBLFVBQUEsSUFDQWdHLEVBQUEzRSxNQUFBLEdBQ0E0RSxFQUFBNUUsTUFBQSxHQUNBNkUsRUFBQTdFLE1BQUEsR0FDQThFLEVBQUE5RSxNQUFBLE1BUUEwRSxFQUFBN0UsaUJBQUEsVUEzQkEsV0FDQWtGLElBQUFwRixTQUFBLFNBQUFzQixHQUNBeUQsRUFBQUYsUUFDQXZELEVBQUF1RCxTQUFBLEVBRUF2RCxFQUFBdUQsU0FBQSxTQTFCQSxHQ0NBOUYsRUFBQSxzQkFBQWtGLE9BQUEsV0FDQWxGLEVBQUEwRCxNQUFBeUIsU0FBQUMsT0FBQUMsY0FDQXJGLEVBQUEwRCxNQUFBNEIsWUFBQSIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5kYXRlLWlucHV0JykuZGF0ZXBpY2tlcigpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGZpbGVEcm9wQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1maWxlX19sYWJlbCcpO1xuXG4gIGZ1bmN0aW9uIG1ha2VGaWxlTG9hZChmaWxlRHJvcEFyZWEpIHtcbiAgICB2YXIgZmlsZUlucHV0ID0gZmlsZURyb3BBcmVhLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7IC8vINCh0LHRgNCw0YHRi9Cy0LDQtdC8INGB0YLQsNC90LTQsNGA0YLQvdGL0LUg0YHQvtCx0YvRgtC40Y8g0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsFxuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInLCAnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcHJldmVudERlZmF1bHRzLCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdHMoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG5cbiAgICA7IC8vINCU0L7QsdCw0LLQu9GP0LXQvCDRgdGC0LjQu9C4INC/0YDQuCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNC4INGE0LDQudC70LAg0L3QsNC0INC90YPQttC90L7QuSDQvtCx0LvQsNGB0YLRjNGOXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlciddLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoaWdobGlnaHQsIGZhbHNlKTtcbiAgICB9KTtcbiAgICBbJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHVuaGlnaGxpZ2h0LCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBoaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodCcpO1xuICAgIH1cblxuICAgIDtcblxuICAgIGZ1bmN0aW9uIHVuaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQnKTtcbiAgICB9XG5cbiAgICA7IC8vXG5cbiAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGhhbmRsZURyb3AsIGZhbHNlKTtcblxuICAgIGZ1bmN0aW9uIGhhbmRsZURyb3AoZSkge1xuICAgICAgdmFyIGR0ID0gZS5kYXRhVHJhbnNmZXI7XG4gICAgICB2YXIgZmlsZXMgPSBkdC5maWxlcztcblxuICAgICAgaWYgKGZpbGVJbnB1dC5maWxlcyAmJiBmaWxlSW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZmlsZUlucHV0LmZpbGVzID0gZmlsZXM7XG4gICAgICBvbkZpbGVDaGFuZ2UoKTtcbiAgICB9XG5cbiAgICA7XG5cbiAgICB2YXIgb25GaWxlQ2hhbmdlID0gZnVuY3Rpb24gb25GaWxlQ2hhbmdlKCkge1xuICAgICAgcmVhZFVybChmaWxlSW5wdXQpO1xuICAgIH07XG5cbiAgICB2YXIgcmVhZFVybCA9IGZ1bmN0aW9uIHJlYWRVcmwoaW5wdXQpIHtcbiAgICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlc1swXSkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdsb2FkZWQnKTtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEubmV4dEVsZW1lbnRTaWJsaW5nLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX25hbWUnKS50ZXh0Q29udGVudCA9IGlucHV0LmZpbGVzWzBdLm5hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW5wdXQuZmlsZXNbMF0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWxlQ2hhbmdlKTtcbiAgfVxuXG4gIHdpbmRvdy5tYWtlRmlsZUxvYWQgPSBtYWtlRmlsZUxvYWQ7XG5cbiAgaWYgKCFmaWxlRHJvcEFyZWFbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBmaWxlRHJvcEFyZWEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG1ha2VGaWxlTG9hZChpdGVtKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgZGVsaXZlcnlUaW1lSW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtdGltZScpO1xuXG4gIGlmICghZGVsaXZlcnlUaW1lSW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGltID0gbmV3IElucHV0bWFzayhcIjk5Ojk5XCIpO1xuICBkZWxpdmVyeVRpbWVJbnB1dHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGltLm1hc2soaXRlbSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC10ZXh0Jyk7XG5cbiAgaWYgKCFpbnB1dHNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpbnB1dHMuZm9yRWFjaChmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGlucHV0LnZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnKSB7XG4gICAgICAgIGlucHV0LnZhbHVlID0gJyc7XG4gICAgICB9XG5cbiAgICAgIGlmIChpbnB1dC52YWx1ZSAhPT0gJycgJiYgIWlucHV0LmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGlucHV0LnZhbHVlID09PSAnJyAmJiBpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLXZoJywgXCJcIi5jb25jYXQodmgsIFwicHhcIikpO1xuICB2YXIgJGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XG5cbiAgZnVuY3Rpb24gZGVib3VuY2UoZnVuYykge1xuICAgIHZhciB0aW1lcjtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBpZiAodGltZXIpIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICB0aW1lciA9IHNldFRpbWVvdXQoZnVuYywgMTAwLCBldmVudCk7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIE1vZGFsKHRyaWdnZXIsIG1vZGFsKSB7XG4gICAgdGhpcy50cmlnZ2VyID0gdHJpZ2dlcjtcbiAgICB0aGlzLm1vZGFsID0gbW9kYWw7XG4gICAgdGhpcy5vdmVybGF5ID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgICB0aGlzLmNsb3NlQnRuID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gICAgdGhpcy5vbk92ZXJsYXlDbGljayA9IHRoaXMub25PdmVybGF5Q2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uQ2xvc2VDbGljayA9IHRoaXMub25DbG9zZUNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vblRyaWdnZXJDbGljayA9IHRoaXMub25UcmlnZ2VyQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uUmVzaXplID0gdGhpcy5vblJlc2l6ZS5iaW5kKHRoaXMpO1xuICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LmFkZCgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5hZGQoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUub25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbiAoZSkge1xuICAgIGlmIChlLnRhcmdldCA9PT0gdGhpcy5vdmVybGF5KSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5vbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5vblRyaWdnZXJDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLm9wZW4oKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUub25SZXNpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBcIlwiLmNvbmNhdCh2aCwgXCJweFwiKSk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25PdmVybGF5Q2xpY2spO1xuICAgIHRoaXMuY2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2xvc2VDbGljayk7XG4gICAgdGhpcy50cmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vblRyaWdnZXJDbGljayk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGRlYm91bmNlKHRoaXMub25SZXNpemUpKTtcbiAgfTtcblxuICB3aW5kb3cuTW9kYWwgPSBNb2RhbDtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2gnKTtcbiAgdmFyIGNsb3NlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCArIC5zZWFyY2gtY2xvc2UnKTtcblxuICBpZiAoIWl0ZW1zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9IC8vIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgLy8gICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgKCkgPT57XG4gIC8vICAgICBpdGVtLnBhcmVudE5vZGUucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdqcy1mb2N1cycpO1xuICAvLyAgIH0pO1xuICAvLyB9KTtcblxuXG4gIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaXRlbS52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJykge1xuICAgICAgICBpdGVtLnZhbHVlID0gJyc7XG4gICAgICB9XG5cbiAgICAgIGlmIChpdGVtLnZhbHVlICE9PSAnJyAmJiAhaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGl0ZW0udmFsdWUgPT09ICcnICYmIGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJykpIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuICBjbG9zZS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBzZWFyY2ggPSBpdGVtLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG4gICAgICBzZWFyY2gudmFsdWUgPSAnJztcblxuICAgICAgaWYgKHNlYXJjaC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5zZWxlY3QnKS5zZWxlY3QyKCk7XG4gICQoJy5zZWxlY3QnKS5vbignc2VsZWN0MjpzZWxlY3QnLCBmdW5jdGlvbiAoZSkge1xuICAgICQodGhpcykuYWRkQ2xhc3MoJ3BpY2tlZCcpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5jb250cmFjdC1pbmZvX19kZWxpdmVyZWQtdG9nZ2xlJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGNvbnRyYWN0c0FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdHMtYWxsJyk7XG5cbiAgaWYgKCFjb250cmFjdHNBbGwpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcuZGF0ZS1pbnB1dCcpLmRhdGVwaWNrZXIoKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBkZWxpdmVyeUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFkZWxpdmVyeUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKTtcbiAgdmFyIG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwnKTtcbiAgdmFyIGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICB2YXIgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIHZhciBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgdmFyIGRhdGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgdmFyIHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgdmFyIGNvbmZpcm1DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGVja2JveF9faW5wdXQnKTtcbiAgZGVsaXZlcnlCdG5zLmZvckVhY2goZnVuY3Rpb24gKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgdmFyIG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uIG9uQ2xvc2VDbGljaygpIHtcbiAgICBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAgICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gICAgICBkYXRlSW5wdXQudmFsdWUgPSAnJztcbiAgICAgIHRpbWVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgICAgIGZpbGVJbnB1dC52YWx1ZSA9ICcnO1xuXG4gICAgICBpZiAoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAkKCcuZmlsdGVyc19fYnRuJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHBheW1lbnRDb25maXJtQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYXltZW50LXdhaXRpbmdfX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFwYXltZW50Q29uZmlybUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcjcGF5bWVudC1kYXRlJykuZGF0ZXBpY2tlcigpO1xuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5bWVudC13YWl0aW5nX19tb2RhbCcpO1xuICB2YXIgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIHZhciBtYWluQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudHJhbnNhY3Rpb25zX19jaGVjay1hbGwgaW5wdXQnKTtcbiAgdmFyIHNlbmRlcklucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc2VuZGVyIGlucHV0Jyk7XG4gIHZhciByZWNpcGllbnRJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXJlY2lwaWVudCBpbnB1dCcpO1xuICB2YXIgc3VtSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zdW0gaW5wdXQnKTtcbiAgdmFyIHB1cnBvc2VJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXB1cnBvc2UgaW5wdXQnKTtcblxuICB2YXIgZ2V0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbiBnZXRBbGxDaGVja2JveCgpIHtcbiAgICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fY2hlY2sgaW5wdXQnKTtcbiAgfTtcblxuICB2YXIgb25BbGxDaGFuZ2UgPSBmdW5jdGlvbiBvbkFsbENoYW5nZSgpIHtcbiAgICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGlmIChtYWluQ2hlY2tib3guY2hlY2tlZCkge1xuICAgICAgICBpdGVtLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgdmFyIG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uIG9uQ2xvc2VDbGljaygpIHtcbiAgICBtYWluQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gICAgfSk7XG4gICAgJCgnI3BheW1lbnQtZGF0ZScpLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG4gICAgc2VuZGVySW5wdXQudmFsdWUgPSAnJztcbiAgICByZWNpcGllbnRJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHN1bUlucHV0LnZhbHVlID0gJyc7XG4gICAgcHVycG9zZUlucHV0LnZhbHVlID0gJyc7XG4gIH07XG5cbiAgcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24gKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgbWFpbkNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQWxsQ2hhbmdlKTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5zdXBwb3J0X19kb2NzLWJ0bicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAkKCcuZGF0ZS1pbnB1dCcpLmRhdGVwaWNrZXIoKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGZpbGVEcm9wQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1maWxlX19sYWJlbCcpO1xuXG4gIGZ1bmN0aW9uIG1ha2VGaWxlTG9hZChmaWxlRHJvcEFyZWEpIHtcbiAgICBjb25zdCBmaWxlSW5wdXQgPSBmaWxlRHJvcEFyZWEucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcbiAgICAvLyDQodCx0YDQsNGB0YvQstCw0LXQvCDRgdGC0LDQvdC00LDRgNGC0L3Ri9C1INGB0L7QsdGL0YLQuNGPINC/0YDQuCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNC4INGE0LDQudC70LBcblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJywgJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBwcmV2ZW50RGVmYXVsdHMsIGZhbHNlKVxuICAgIH0pO1xuXG4gICAgZnVuY3Rpb24gcHJldmVudERlZmF1bHRzIChlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH07XG5cbiAgICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0YHRgtC40LvQuCDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwINC90LDQtCDQvdGD0LbQvdC+0Lkg0L7QsdC70LDRgdGC0YzRjlxuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInXS5mb3JFYWNoKGV2ZW50TmFtZSA9PiB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhpZ2hsaWdodCwgZmFsc2UpXG4gICAgfSk7XG5cbiAgICBbJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB1bmhpZ2hsaWdodCwgZmFsc2UpXG4gICAgfSlcblxuICAgIGZ1bmN0aW9uIGhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LmFkZCgnaGlnaGxpZ2h0Jyk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIHVuaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQnKTtcbiAgICB9O1xuXG4gICAgLy9cblxuICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgaGFuZGxlRHJvcCwgZmFsc2UpXG5cbiAgICBmdW5jdGlvbiBoYW5kbGVEcm9wKGUpIHtcbiAgICAgIGxldCBkdCA9IGUuZGF0YVRyYW5zZmVyXG4gICAgICBsZXQgZmlsZXMgPSBkdC5maWxlc1xuXG4gICAgICBpZiAoZmlsZUlucHV0LmZpbGVzICYmIGZpbGVJbnB1dC5maWxlc1swXSkge1xuICAgICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZmlsZUlucHV0LmZpbGVzID0gZmlsZXM7XG4gICAgICBvbkZpbGVDaGFuZ2UoKTtcbiAgICB9O1xuXG4gICAgY29uc3Qgb25GaWxlQ2hhbmdlID0gKCkgPT4ge1xuICAgICAgcmVhZFVybChmaWxlSW5wdXQpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlYWRVcmwgPSAoaW5wdXQpID0+IHtcbiAgICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlc1swXSkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdsb2FkZWQnKTtcbiAgICAgICAgICBmaWxlRHJvcEFyZWFcbiAgICAgICAgICAgIC5uZXh0RWxlbWVudFNpYmxpbmdcbiAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKCcuZmlsZS1sb2FkX19uYW1lJylcbiAgICAgICAgICAgIC50ZXh0Q29udGVudCA9IGlucHV0LmZpbGVzWzBdLm5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpbnB1dC5maWxlc1swXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmlsZUNoYW5nZSk7XG4gIH1cblxuICB3aW5kb3cubWFrZUZpbGVMb2FkID0gbWFrZUZpbGVMb2FkO1xuXG5cbiAgaWYgKCFmaWxlRHJvcEFyZWFbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBmaWxlRHJvcEFyZWEuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgbWFrZUZpbGVMb2FkKGl0ZW0pO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGRlbGl2ZXJ5VGltZUlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcblxuICBpZiAoIWRlbGl2ZXJ5VGltZUlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbSA9IG5ldyBJbnB1dG1hc2soXCI5OTo5OVwiKTtcblxuICBkZWxpdmVyeVRpbWVJbnB1dHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgaW0ubWFzayhpdGVtKTtcbiAgfSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC10ZXh0Jyk7XG5cbiAgaWYgKCFpbnB1dHNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpbnB1dHMuZm9yRWFjaChmdW5jdGlvbihpbnB1dCkge1xuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChcbiAgICAgICAgaW5wdXQudmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJydcbiAgICAgICkge1xuICAgICAgICBpbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIGlucHV0LnZhbHVlICE9PSAnJ1xuICAgICAgICAmJiAhaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpbnB1dC5jbGFzc0xpc3QuYWRkKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgaW5wdXQudmFsdWUgPT09ICcnXG4gICAgICAgICYmIGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG4iLCIoKCkgPT4ge1xuICBsZXQgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBgJHt2aH1weGApO1xuXG4gIGNvbnN0ICRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpO1xuXG4gIGZ1bmN0aW9uIGRlYm91bmNlKGZ1bmMpe1xuICAgIHZhciB0aW1lcjtcbiAgICByZXR1cm4gZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgaWYodGltZXIpIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgICB0aW1lciA9IHNldFRpbWVvdXQoZnVuYywxMDAsZXZlbnQpO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBNb2RhbCAodHJpZ2dlciwgbW9kYWwpIHtcbiAgICB0aGlzLnRyaWdnZXIgPSB0cmlnZ2VyO1xuICAgIHRoaXMubW9kYWwgPSBtb2RhbDtcbiAgICB0aGlzLm92ZXJsYXkgPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAgIHRoaXMuY2xvc2VCdG4gPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcblxuICAgIHRoaXMub25PdmVybGF5Q2xpY2sgPSB0aGlzLm9uT3ZlcmxheUNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNsb3NlQ2xpY2sgPSB0aGlzLm9uQ2xvc2VDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25UcmlnZ2VyQ2xpY2sgPSB0aGlzLm9uVHJpZ2dlckNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vblJlc2l6ZSA9IHRoaXMub25SZXNpemUuYmluZCh0aGlzKTtcblxuICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QuYWRkKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LmFkZCgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLXNob3cnKTtcbiAgICAkYm9keS5jbGFzc0xpc3QucmVtb3ZlKCdqc19fYm9keS1uby1zY3JvbGwnKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQgPT09IHRoaXMub3ZlcmxheSkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub25UcmlnZ2VyQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm9wZW4oKTtcbiAgfVxuXG4gIE1vZGFsLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgbGV0IHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIGAke3ZofXB4YCk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbk92ZXJsYXlDbGljayk7XG4gICAgdGhpcy5jbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbG9zZUNsaWNrKTtcbiAgICB0aGlzLnRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uVHJpZ2dlckNsaWNrKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGVib3VuY2UodGhpcy5vblJlc2l6ZSkpO1xuICB9XG5cbiAgd2luZG93Lk1vZGFsID0gTW9kYWw7XG59KSgpO1xuIiwiKCgpID0+IHtcbiAgY29uc3QgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoJyk7XG4gIGNvbnN0IGNsb3NlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCArIC5zZWFyY2gtY2xvc2UnKTtcblxuICBpZiAoIWl0ZW1zWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAvLyAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PntcbiAgLy8gICAgIGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2pzLWZvY3VzJyk7XG4gIC8vICAgfSk7XG4gIC8vIH0pO1xuXG4gIGl0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoKSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIGl0ZW0udmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJydcbiAgICAgICkge1xuICAgICAgICBpdGVtLnZhbHVlID0gJyc7XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgaXRlbS52YWx1ZSAhPT0gJydcbiAgICAgICAgJiYgIWl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpdGVtLnZhbHVlID09PSAnJ1xuICAgICAgICAmJiBpdGVtLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSlcbiAgfSk7XG5cbiAgY2xvc2UuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBjb25zdCBzZWFyY2ggPSBpdGVtLnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG4gICAgICBzZWFyY2gudmFsdWUgPSAnJztcbiAgICAgIGlmIChcbiAgICAgICAgc2VhcmNoLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgc2VhcmNoLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KVxuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICQoJy5zZWxlY3QnKS5zZWxlY3QyKCk7XG4gICQoJy5zZWxlY3QnKS5vbignc2VsZWN0MjpzZWxlY3QnLCBmdW5jdGlvbiAoZSkge1xuICAgICQodGhpcykuYWRkQ2xhc3MoJ3BpY2tlZCcpO1xufSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICQoJy5jb250cmFjdC1pbmZvX19kZWxpdmVyZWQtdG9nZ2xlJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdHNBbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3RzLWFsbCcpO1xuXG4gIGlmICghY29udHJhY3RzQWxsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJCgnLmRhdGUtaW5wdXQnKS5kYXRlcGlja2VyKCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBkZWxpdmVyeUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFkZWxpdmVyeUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKTtcblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWxpdmVyeS1vci1waWNrdXBfX21vZGFsJyk7XG4gIGNvbnN0IGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICBjb25zdCBmaWxlSW5wdXRCbG9jayA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLWlucHV0LWZpbGUnKTtcbiAgY29uc3QgZmlsZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmlucHV0LWZpbGVfX2lucHV0Jyk7XG4gIGNvbnN0IGRhdGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgY29uc3QgdGltZUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtdGltZScpO1xuICBjb25zdCBjb25maXJtQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuY2hlY2tib3hfX2lucHV0Jyk7XG5cbiAgZGVsaXZlcnlCdG5zLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7XG4gICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICB9KTtcblxuICBjb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAgICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gICAgICBkYXRlSW5wdXQudmFsdWUgPSAnJztcbiAgICAgIHRpbWVJbnB1dC52YWx1ZSA9ICcnO1xuICAgICAgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcblxuICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICQoJy5maWx0ZXJzX19idG4nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHBheW1lbnRDb25maXJtQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYXltZW50LXdhaXRpbmdfX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFwYXltZW50Q29uZmlybUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcjcGF5bWVudC1kYXRlJykuZGF0ZXBpY2tlcigpO1xuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheW1lbnQtd2FpdGluZ19fbW9kYWwnKTtcbiAgY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIGNvbnN0IG1haW5DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy50cmFuc2FjdGlvbnNfX2NoZWNrLWFsbCBpbnB1dCcpO1xuICBjb25zdCBzZW5kZXJJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXNlbmRlciBpbnB1dCcpO1xuICBjb25zdCByZWNpcGllbnRJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXJlY2lwaWVudCBpbnB1dCcpO1xuICBjb25zdCBzdW1JbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXN1bSBpbnB1dCcpO1xuICBjb25zdCBwdXJwb3NlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1wdXJwb3NlIGlucHV0Jyk7XG5cbiAgY29uc3QgZ2V0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fY2hlY2sgaW5wdXQnKTtcbiAgfTtcblxuICBjb25zdCBvbkFsbENoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICBpZiAobWFpbkNoZWNrYm94LmNoZWNrZWQpIHtcbiAgICAgICAgaXRlbS5jaGVja2VkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGl0ZW0uY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgfVxuICAgIH0pXG4gIH07XG5cbiAgY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgbWFpbkNoZWNrYm94LmNoZWNrZWQgPSBmYWxzZTtcbiAgICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gICAgfSk7XG4gICAgJCgnI3BheW1lbnQtZGF0ZScpLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG4gICAgc2VuZGVySW5wdXQudmFsdWUgPSAnJztcbiAgICByZWNpcGllbnRJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHN1bUlucHV0LnZhbHVlID0gJyc7XG4gICAgcHVycG9zZUlucHV0LnZhbHVlID0gJyc7XG4gIH07XG5cbiAgcGF5bWVudENvbmZpcm1CdG5zLmZvckVhY2goZnVuY3Rpb24oYnRuKSB7XG4gICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICB9KTtcblxuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIG1haW5DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkFsbENoYW5nZSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICAkKCcuc3VwcG9ydF9fZG9jcy1idG4nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KVxufSkoKTtcbiJdfQ==
