"use strict";!function(){var e=document.querySelectorAll(".checkbox-2__input");e[0]&&e.forEach((function(e){e.addEventListener("change",(function(e){var t=e.target;!0===t.checked?t.parentNode.classList.add("checked"):t.parentNode.classList.remove("checked")}))}))}(),$(".date-input").datepicker(),function(){var e=document.querySelectorAll(".input-file__label");function t(e){var t=e.querySelector("input"),n=e.parentNode.querySelector(".file-load__clear");function i(e){e.preventDefault(),e.stopPropagation()}function o(t){e.classList.add("highlight")}function c(t){e.classList.remove("highlight")}["dragenter","dragover","dragleave","drop"].forEach((function(t){e.addEventListener(t,i,!1)})),["dragenter","dragover"].forEach((function(t){e.addEventListener(t,o,!1)})),["dragleave","drop"].forEach((function(t){e.addEventListener(t,c,!1)})),e.addEventListener("drop",(function(e){var n=e.dataTransfer.files;t.files&&t.files[0]&&(t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file"));t.files=n,a()}),!1);var a=function(){l(t)},l=function(t){if(t.files&&t.files[0]){var n=new FileReader;n.onload=function(n){e.parentNode.classList.add("loaded"),e.nextElementSibling.querySelector(".file-load__name").textContent=t.files[0].name},n.readAsDataURL(t.files[0])}};t.addEventListener("change",a),n.addEventListener("click",(function(){e.parentNode.classList.remove("loaded"),t.value="",/safari/i.test(navigator.userAgent)||(t.type="",t.type="file")}))}window.makeFileLoad=t,e[0]&&e.forEach((function(e){t(e)}))}(),function(){var e=document.querySelectorAll(".input-text");e[0]&&e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))}))}(),function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"));var t=document.querySelector("body");function n(e,t){this.trigger=e,this.modal=t,this.overlay=this.modal.querySelector(".modal__overlay"),this.closeBtn=this.modal.querySelector(".modal__close"),this.onOverlayClick=this.onOverlayClick.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onTriggerClick=this.onTriggerClick.bind(this),this.onResize=this.onResize.bind(this),this.addEventListeners()}n.prototype.open=function(){this.modal.classList.add("js-show"),t.classList.add("js__body-no-scroll")},n.prototype.close=function(){this.modal.classList.remove("js-show"),t.classList.remove("js__body-no-scroll")},n.prototype.onOverlayClick=function(e){e.target===this.overlay&&this.close()},n.prototype.onCloseClick=function(){this.close()},n.prototype.onTriggerClick=function(){this.open()},n.prototype.onResize=function(){var e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh","".concat(e,"px"))},n.prototype.addEventListeners=function(){var e,t;this.overlay.addEventListener("click",this.onOverlayClick),this.closeBtn.addEventListener("click",this.onCloseClick),this.trigger.addEventListener("click",this.onTriggerClick),window.addEventListener("resize",(e=this.onResize,function(n){t&&clearTimeout(t),t=setTimeout(e,100,n)}))},window.Modal=n}(),function(){var e=document.querySelectorAll(".input-phone");if(e[0]){var t=new Inputmask("+7(999) 999-99-99");e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelectorAll(".search"),t=document.querySelectorAll(".search + .search-close");e[0]&&(e.forEach((function(e){e.addEventListener("blur",(function(){""===e.value.split(" ").join("")&&(e.value=""),""===e.value||e.classList.contains("js-inputed")||e.classList.add("js-inputed"),""===e.value&&e.classList.contains("js-inputed")&&e.classList.remove("js-inputed")}))})),t.forEach((function(e){e.addEventListener("click",(function(){var t=e.previousElementSibling;t.value="",t.classList.contains("js-inputed")&&t.classList.remove("js-inputed")}))})))}(),function(){function e(e){var t=e.text.split("splitter");return t.length>1?$("<span>"+t[0]+"</span><span>"+t[1]+"</span>"):e.text}$(".select").select2({templateResult:e,templateSelection:e}),$(".select").on("select2:select",(function(e){$(this).addClass("picked")}))}(),function(){var e=document.querySelectorAll(".delivery-or-pickup__modal-time");if(e[0]){var t=new Inputmask("99:99");e.forEach((function(e){t.mask(e)}))}}(),function(){var e=document.querySelector(".contract-info__cancellation");if(e){var t=document.getElementById("cancellation__modal");new Modal(e,t)}}(),$(".delivery-or-pickup.done").click((function(){$(this).find(".contract-info__delivered-adress").slideToggle(),$(this).find(".contract-info__delivered-toggle").toggleClass("opened")})),function(){if(document.querySelector(".contract-services")){var e=document.querySelectorAll(".contract-services__link"),t=function(e){var t=e.target;console.log(t.classList.contains("chekcbox-btn__label")),(t.classList.contains("checkbox-btn__label")||t.classList.contains("checkbox-btn__checkbox")||t.classList.contains("deliver-or-pickup__confirm-btn")||t.classList.contains("contract-services__delivery-confirm"))&&e.preventDefault()};e.forEach((function(e){e.addEventListener("click",t)}))}}(),document.querySelector(".contracts-all")&&$(".date-input").datepicker(),function(){var e=document.querySelectorAll(".deliver-or-pickup__confirm-btn");if(e[0]){$("#delivery-date").datepicker().on("change",(function(e){u()}));var t=document.getElementById("delivery-or-pickup__modal"),n=t.querySelector(".modal__close"),i=t.querySelector(".modal__overlay"),o=t.querySelector(".modal__submit"),c=t.querySelector(".delivery-or-pickup__modal-input-file"),a=t.querySelector(".input-file__input"),l=t.querySelector(".delivery-or-pickup__modal-date"),r=t.querySelector(".delivery-or-pickup__modal-time"),s=t.querySelector(".checkbox__input");e.forEach((function(e){new Modal(e,t)}));var d=function(){c.classList.contains("loaded")&&(c.classList.remove("loaded"),a.value="",o.setAttribute("disabled",""),/safari/i.test(navigator.userAgent)||(a.type="",a.type="file")),l.value="",r.value="",s.checked=!1,$("#delivery-date").datepicker("setDate","")},u=function(e){v()&&o.hasAttribute("disabled")?o.removeAttribute("disabled"):v()||o.hasAttribute("disabled")||o.setAttribute("disabled","")},v=function(){return $("#delivery-date").datepicker("getDate")&&""!==r.value&&!0===s.checked&&""!==a.value};n.addEventListener("click",d),i.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&d()})),l.addEventListener("input",u),r.addEventListener("input",u),a.addEventListener("change",u),s.addEventListener("change",u)}}(),$(".filters__btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){var e=document.querySelectorAll(".payment-waiting__confirm-btn");if(e[0]){$("#payment-date").datepicker();var t=document.getElementById("payment-waiting__modal"),n=t.querySelector(".modal__close"),i=t.querySelector(".modal__overlay"),o=t.querySelector(".transactions__check-all input"),c=t.querySelector(".payment-waiting__modal-sender input"),a=t.querySelector(".payment-waiting__modal-recipient input"),l=t.querySelector(".payment-waiting__modal-sum input"),r=t.querySelector(".payment-waiting__modal-purpose input"),s=function(){return t.querySelectorAll(".transactions__check input")},d=function(){o.checked=!1,s().forEach((function(e){e.checked=!1})),$("#payment-date").datepicker("setDate",""),c.value="",a.value="",l.value="",r.value=""};e.forEach((function(e){new Modal(e,t)})),n.addEventListener("click",d),i.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&d()})),o.addEventListener("change",(function(){s().forEach((function(e){o.checked?e.checked=!0:e.checked=!1}))}))}}(),function(){var e=document.querySelectorAll(".contract-device__schedule");if(e[0]){var t=document.getElementById("schedule__modal"),n=document.querySelectorAll(".schedule__modal-toggle input"),i=document.querySelector(".schedule__modal-toggle");n.forEach((function(e,t){e.addEventListener("change",(function(){0===t&&(i.classList.remove("second-tab"),i.classList.add("first-tab")),1===t&&(i.classList.remove("first-tab"),i.classList.add("second-tab"))}))})),e.forEach((function(e){new Modal(e,t)}))}}(),$(".support__docs-btn").click((function(){$(this).parent().next().slideToggle(),$(this).toggleClass("opened")})),function(){var e=document.querySelector(".contract-info__verification");if(e){var t=document.getElementById("verification__modal"),n=t.querySelector(".verification__modal-input-file"),i=t.querySelector(".input-file__input"),o=t.querySelector(".modal__close"),c=t.querySelector(".modal__overlay"),a=document.querySelector(".modal__save"),l=function(){n.classList.contains("loaded")&&(n.classList.remove("loaded"),i.value="",a.setAttribute("disabled",""),/safari/i.test(navigator.userAgent)||(i.type="",i.type="file"))};new Modal(e,t),o.addEventListener("click",l),c.addEventListener("click",(function(e){e.target.classList.contains("modal__overlay")&&l()})),i.addEventListener("change",(function(){""!==i.value&&a.removeAttribute("disabled")}))}}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdC5qcyIsImNoZWNrYm94LTIuanMiLCJkYXRlLWlucHV0LmpzIiwiaW5wdXQtZmlsZS5qcyIsImlucHV0LXRleHQuanMiLCJtb2RhbC5qcyIsInBob25lLW1hc2suanMiLCJzZWFyY2guanMiLCJzZWxlY3QuanMiLCJ0aW1lLW1hc2suanMiLCJjYW5jZWxsYXRpb24tbW9kYWwuanMiLCJjb250cmFjdC1wYWdlLmpzIiwiY29udHJhY3Qtc2VydmljZXMuanMiLCJjb250cmFjdHMtYWxsLmpzIiwiZGVsaXZlcnktbW9kYWwuanMiLCJmaWx0ZXJzLmpzIiwicGF5bWVudC1jb25maXJtLW1vZGFsLmpzIiwic2NoZWR1bGUtbW9kYWwuanMiLCJzdXBwb3J0LmpzIiwidmVyaWZpY2F0aW9uLW1vZGFsLmpzIl0sIm5hbWVzIjpbImNoZWNrYm94MiIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJpdGVtIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ0YXJnZXQiLCJjaGVja2VkIiwicGFyZW50Tm9kZSIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsIiQiLCJkYXRlcGlja2VyIiwiZmlsZURyb3BBcmVhIiwibWFrZUZpbGVMb2FkIiwiZmlsZUlucHV0IiwicXVlcnlTZWxlY3RvciIsImZpbGVDbGVhciIsInByZXZlbnREZWZhdWx0cyIsInByZXZlbnREZWZhdWx0Iiwic3RvcFByb3BhZ2F0aW9uIiwiaGlnaGxpZ2h0IiwidW5oaWdobGlnaHQiLCJldmVudE5hbWUiLCJmaWxlcyIsImRhdGFUcmFuc2ZlciIsInZhbHVlIiwidGVzdCIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsInR5cGUiLCJvbkZpbGVDaGFuZ2UiLCJyZWFkVXJsIiwiaW5wdXQiLCJyZWFkZXIiLCJGaWxlUmVhZGVyIiwib25sb2FkIiwibmV4dEVsZW1lbnRTaWJsaW5nIiwidGV4dENvbnRlbnQiLCJuYW1lIiwicmVhZEFzRGF0YVVSTCIsIndpbmRvdyIsImlucHV0cyIsInNwbGl0Iiwiam9pbiIsImNvbnRhaW5zIiwidmgiLCJpbm5lckhlaWdodCIsImRvY3VtZW50RWxlbWVudCIsInN0eWxlIiwic2V0UHJvcGVydHkiLCJjb25jYXQiLCIkYm9keSIsIk1vZGFsIiwidHJpZ2dlciIsIm1vZGFsIiwidGhpcyIsIm92ZXJsYXkiLCJjbG9zZUJ0biIsIm9uT3ZlcmxheUNsaWNrIiwiYmluZCIsIm9uQ2xvc2VDbGljayIsIm9uVHJpZ2dlckNsaWNrIiwib25SZXNpemUiLCJhZGRFdmVudExpc3RlbmVycyIsInByb3RvdHlwZSIsIm9wZW4iLCJjbG9zZSIsImZ1bmMiLCJ0aW1lciIsImV2ZW50IiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsImltIiwiSW5wdXRtYXNrIiwibWFzayIsIml0ZW1zIiwic2VhcmNoIiwicHJldmlvdXNFbGVtZW50U2libGluZyIsImZvcm1hdE9wdGlvbiIsInRleHQiLCJsZW5ndGgiLCJzZWxlY3QyIiwidGVtcGxhdGVSZXN1bHQiLCJ0ZW1wbGF0ZVNlbGVjdGlvbiIsIm9uIiwiYWRkQ2xhc3MiLCJkZWxpdmVyeVRpbWVJbnB1dHMiLCJjYW5jZWxsYXRpb25CdG4iLCJnZXRFbGVtZW50QnlJZCIsImNsaWNrIiwiZmluZCIsInNsaWRlVG9nZ2xlIiwidG9nZ2xlQ2xhc3MiLCJsaW5rcyIsIm9uTGlua0NsaWNrIiwiY29uc29sZSIsImxvZyIsImxpbmsiLCJkZWxpdmVyeUJ0bnMiLCJkYXRlVGV4dCIsIm9uRmllbGRDaGFuZ2UiLCJzdWJtaXQiLCJmaWxlSW5wdXRCbG9jayIsImRhdGVJbnB1dCIsInRpbWVJbnB1dCIsImNvbmZpcm1DaGVja2JveCIsImJ0biIsInNldEF0dHJpYnV0ZSIsImlzRm9ybUZpbGxlZCIsImhhc0F0dHJpYnV0ZSIsInJlbW92ZUF0dHJpYnV0ZSIsInBhcmVudCIsIm5leHQiLCJwYXltZW50Q29uZmlybUJ0bnMiLCJtYWluQ2hlY2tib3giLCJzZW5kZXJJbnB1dCIsInJlY2lwaWVudElucHV0Iiwic3VtSW5wdXQiLCJwdXJwb3NlSW5wdXQiLCJnZXRBbGxDaGVja2JveCIsInNjaGVkdWxlQnRucyIsInJhZGlvcyIsInRvZ2dsZSIsImlkIiwidmVyaWZpY2F0aW9uQnRuIiwic2F2ZUJ0biJdLCJtYXBwaW5ncyI6IkFBQUEsY0NBQSxXQUNBLElBQUFBLEVBQUFDLFNBQUFDLGlCQUFBLHNCQUVBRixFQUFBLElBSUFBLEVBQUFHLFNBQUEsU0FBQUMsR0FDQUEsRUFBQUMsaUJBQUEsVUFBQSxTQUFBQyxHQUNBLElBQUFDLEVBQUFELEVBQUFDLFFBQ0EsSUFBQUEsRUFBQUMsUUFDQUQsRUFBQUUsV0FBQUMsVUFBQUMsSUFBQSxXQUVBSixFQUFBRSxXQUFBQyxVQUFBRSxPQUFBLGlCQWJBLEdDQ0FDLEVBQUEsZUFBQUMsYUNEQSxXQUNBLElBQUFDLEVBQUFkLFNBQUFDLGlCQUFBLHNCQUVBLFNBQUFjLEVBQUFELEdBQ0EsSUFBQUUsRUFBQUYsRUFBQUcsY0FBQSxTQUNBQyxFQUFBSixFQUFBTixXQUFBUyxjQUFBLHFCQU9BLFNBQUFFLEVBQUFkLEdBQ0FBLEVBQUFlLGlCQUNBZixFQUFBZ0Isa0JBYUEsU0FBQUMsRUFBQWpCLEdBQ0FTLEVBQUFMLFVBQUFDLElBQUEsYUFHQSxTQUFBYSxFQUFBbEIsR0FDQVMsRUFBQUwsVUFBQUUsT0FBQSxhQXhCQSxDQUFBLFlBQUEsV0FBQSxZQUFBLFFBQUFULFNBQUEsU0FBQXNCLEdBQ0FWLEVBQUFWLGlCQUFBb0IsRUFBQUwsR0FBQSxNQVVBLENBQUEsWUFBQSxZQUFBakIsU0FBQSxTQUFBc0IsR0FDQVYsRUFBQVYsaUJBQUFvQixFQUFBRixHQUFBLE1BR0EsQ0FBQSxZQUFBLFFBQUFwQixTQUFBLFNBQUFzQixHQUNBVixFQUFBVixpQkFBQW9CLEVBQUFELEdBQUEsTUFhQVQsRUFBQVYsaUJBQUEsUUFFQSxTQUFBQyxHQUNBLElBQ0FvQixFQURBcEIsRUFBQXFCLGFBQ0FELE1BRUFULEVBQUFTLE9BQUFULEVBQUFTLE1BQUEsS0FDQVQsRUFBQVcsTUFBQSxHQUVBLFVBQUFDLEtB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QVksRUFBQWhFLGlCQUFBLFFBQUEwRCxHQUNBSixFQUFBdEQsaUJBQUEsU0FkQSxTQUFBQyxHQUNBQSxFQUFBQyxPQUFBRyxVQUFBcUMsU0FBQSxtQkFDQWdCLE9BYUE5QyxFQUFBWixpQkFBQSxVQVRBLFdBQ0EsS0FBQVksRUFBQVcsT0FDQW9HLEVBQUFmLGdCQUFBLGdCQXBDQSIsImZpbGUiOiJzY3JpcHQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjaGVja2JveDIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2hlY2tib3gtMl9faW5wdXQnKTtcblxuICBpZiAoIWNoZWNrYm94MlswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNoZWNrYm94Mi5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuXG4gICAgICBpZiAodGFyZ2V0LmNoZWNrZWQgPT09IHRydWUpIHtcbiAgICAgICAgdGFyZ2V0LnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnY2hlY2tlZCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGFyZ2V0LnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnY2hlY2tlZCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5kYXRlLWlucHV0JykuZGF0ZXBpY2tlcigpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGZpbGVEcm9wQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1maWxlX19sYWJlbCcpO1xuXG4gIGZ1bmN0aW9uIG1ha2VGaWxlTG9hZChmaWxlRHJvcEFyZWEpIHtcbiAgICB2YXIgZmlsZUlucHV0ID0gZmlsZURyb3BBcmVhLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XG4gICAgdmFyIGZpbGVDbGVhciA9IGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7IC8vINCh0LHRgNCw0YHRi9Cy0LDQtdC8INGB0YLQsNC90LTQsNGA0YLQvdGL0LUg0YHQvtCx0YvRgtC40Y8g0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsFxuXG4gICAgWydkcmFnZW50ZXInLCAnZHJhZ292ZXInLCAnZHJhZ2xlYXZlJywgJ2Ryb3AnXS5mb3JFYWNoKGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcHJldmVudERlZmF1bHRzLCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdHMoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG5cbiAgICA7IC8vINCU0L7QsdCw0LLQu9GP0LXQvCDRgdGC0LjQu9C4INC/0YDQuCDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNC4INGE0LDQudC70LAg0L3QsNC0INC90YPQttC90L7QuSDQvtCx0LvQsNGB0YLRjNGOXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlciddLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoaWdobGlnaHQsIGZhbHNlKTtcbiAgICB9KTtcbiAgICBbJ2RyYWdsZWF2ZScsICdkcm9wJ10uZm9yRWFjaChmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHVuaGlnaGxpZ2h0LCBmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBoaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodCcpO1xuICAgIH1cblxuICAgIDtcblxuICAgIGZ1bmN0aW9uIHVuaGlnaGxpZ2h0KGUpIHtcbiAgICAgIGZpbGVEcm9wQXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdoaWdobGlnaHQnKTtcbiAgICB9XG5cbiAgICA7IC8vXG5cbiAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGhhbmRsZURyb3AsIGZhbHNlKTtcblxuICAgIGZ1bmN0aW9uIGhhbmRsZURyb3AoZSkge1xuICAgICAgdmFyIGR0ID0gZS5kYXRhVHJhbnNmZXI7XG4gICAgICB2YXIgZmlsZXMgPSBkdC5maWxlcztcblxuICAgICAgaWYgKGZpbGVJbnB1dC5maWxlcyAmJiBmaWxlSW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZmlsZUlucHV0LmZpbGVzID0gZmlsZXM7XG4gICAgICBvbkZpbGVDaGFuZ2UoKTtcbiAgICB9XG5cbiAgICA7XG5cbiAgICB2YXIgb25GaWxlQ2hhbmdlID0gZnVuY3Rpb24gb25GaWxlQ2hhbmdlKCkge1xuICAgICAgcmVhZFVybChmaWxlSW5wdXQpO1xuICAgIH07XG5cbiAgICB2YXIgcmVhZFVybCA9IGZ1bmN0aW9uIHJlYWRVcmwoaW5wdXQpIHtcbiAgICAgIGlmIChpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlc1swXSkge1xuICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcblxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKCdsb2FkZWQnKTtcbiAgICAgICAgICBmaWxlRHJvcEFyZWEubmV4dEVsZW1lbnRTaWJsaW5nLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX25hbWUnKS50ZXh0Q29udGVudCA9IGlucHV0LmZpbGVzWzBdLm5hbWU7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW5wdXQuZmlsZXNbMF0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBvbkNsZWFyKCkge1xuICAgICAgZmlsZURyb3BBcmVhLnBhcmVudE5vZGUuY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcblxuICAgICAgaWYgKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWxlQ2hhbmdlKTtcbiAgICBmaWxlQ2xlYXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsZWFyKTtcbiAgfVxuXG4gIHdpbmRvdy5tYWtlRmlsZUxvYWQgPSBtYWtlRmlsZUxvYWQ7XG5cbiAgaWYgKCFmaWxlRHJvcEFyZWFbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBmaWxlRHJvcEFyZWEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIG1ha2VGaWxlTG9hZChpdGVtKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXRleHQnKTtcblxuICBpZiAoIWlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uIChpbnB1dCkge1xuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaW5wdXQudmFsdWUuc3BsaXQoJyAnKS5qb2luKCcnKSA9PT0gJycpIHtcbiAgICAgICAgaW5wdXQudmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKGlucHV0LnZhbHVlICE9PSAnJyAmJiAhaW5wdXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJykpIHtcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaW5wdXQudmFsdWUgPT09ICcnICYmIGlucHV0LmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBcIlwiLmNvbmNhdCh2aCwgXCJweFwiKSk7XG4gIHZhciAkYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcblxuICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jKSB7XG4gICAgdmFyIHRpbWVyO1xuICAgIHJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmICh0aW1lcikgY2xlYXJUaW1lb3V0KHRpbWVyKTtcbiAgICAgIHRpbWVyID0gc2V0VGltZW91dChmdW5jLCAxMDAsIGV2ZW50KTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gTW9kYWwodHJpZ2dlciwgbW9kYWwpIHtcbiAgICB0aGlzLnRyaWdnZXIgPSB0cmlnZ2VyO1xuICAgIHRoaXMubW9kYWwgPSBtb2RhbDtcbiAgICB0aGlzLm92ZXJsYXkgPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICAgIHRoaXMuY2xvc2VCdG4gPSB0aGlzLm1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgICB0aGlzLm9uT3ZlcmxheUNsaWNrID0gdGhpcy5vbk92ZXJsYXlDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DbG9zZUNsaWNrID0gdGhpcy5vbkNsb3NlQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uVHJpZ2dlckNsaWNrID0gdGhpcy5vblRyaWdnZXJDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25SZXNpemUgPSB0aGlzLm9uUmVzaXplLmJpbmQodGhpcyk7XG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9wZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QuYWRkKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LmFkZCgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5yZW1vdmUoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5vbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLm92ZXJsYXkpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH07XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uVHJpZ2dlckNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub3BlbigpO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdmggPSB3aW5kb3cuaW5uZXJIZWlnaHQgKiAwLjAxO1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS12aCcsIFwiXCIuY29uY2F0KHZoLCBcInB4XCIpKTtcbiAgfTtcblxuICBNb2RhbC5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5vdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vbk92ZXJsYXlDbGljayk7XG4gICAgdGhpcy5jbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25DbG9zZUNsaWNrKTtcbiAgICB0aGlzLnRyaWdnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uVHJpZ2dlckNsaWNrKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZGVib3VuY2UodGhpcy5vblJlc2l6ZSkpO1xuICB9O1xuXG4gIHdpbmRvdy5Nb2RhbCA9IE1vZGFsO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5pbnB1dC1waG9uZScpO1xuXG4gIGlmICghaW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGltID0gbmV3IElucHV0bWFzayhcIis3KDk5OSkgOTk5LTk5LTk5XCIpO1xuICBpbnB1dHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGltLm1hc2soaXRlbSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlYXJjaCcpO1xuICB2YXIgY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoICsgLnNlYXJjaC1jbG9zZScpO1xuXG4gIGlmICghaXRlbXNbMF0pIHtcbiAgICByZXR1cm47XG4gIH0gLy8gaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAvLyAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PntcbiAgLy8gICAgIGl0ZW0ucGFyZW50Tm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2pzLWZvY3VzJyk7XG4gIC8vICAgfSk7XG4gIC8vIH0pO1xuXG5cbiAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChpdGVtLnZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnKSB7XG4gICAgICAgIGl0ZW0udmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKGl0ZW0udmFsdWUgIT09ICcnICYmICFpdGVtLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXRlbS52YWx1ZSA9PT0gJycgJiYgaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKSkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG4gIGNsb3NlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHNlYXJjaCA9IGl0ZW0ucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgIHNlYXJjaC52YWx1ZSA9ICcnO1xuXG4gICAgICBpZiAoc2VhcmNoLmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpKSB7XG4gICAgICAgIHNlYXJjaC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1pbnB1dGVkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gZm9ybWF0T3B0aW9uKGl0ZW0pIHtcbiAgICB2YXIgdmFsdWUgPSBpdGVtLnRleHQuc3BsaXQoJ3NwbGl0dGVyJyk7XG5cbiAgICBpZiAodmFsdWUubGVuZ3RoID4gMSkge1xuICAgICAgdmFyIHJlc3VsdCA9ICQoJzxzcGFuPicgKyB2YWx1ZVswXSArICc8L3NwYW4+PHNwYW4+JyArIHZhbHVlWzFdICsgJzwvc3Bhbj4nKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBpdGVtLnRleHQ7XG4gICAgfVxuICB9XG5cbiAgJCgnLnNlbGVjdCcpLnNlbGVjdDIoe1xuICAgIHRlbXBsYXRlUmVzdWx0OiBmb3JtYXRPcHRpb24sXG4gICAgdGVtcGxhdGVTZWxlY3Rpb246IGZvcm1hdE9wdGlvblxuICB9KTtcbiAgJCgnLnNlbGVjdCcpLm9uKCdzZWxlY3QyOnNlbGVjdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgJCh0aGlzKS5hZGRDbGFzcygncGlja2VkJyk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRlbGl2ZXJ5VGltZUlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcblxuICBpZiAoIWRlbGl2ZXJ5VGltZUlucHV0c1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBpbSA9IG5ldyBJbnB1dG1hc2soXCI5OTo5OVwiKTtcbiAgZGVsaXZlcnlUaW1lSW5wdXRzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBpbS5tYXNrKGl0ZW0pO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjYW5jZWxsYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3QtaW5mb19fY2FuY2VsbGF0aW9uJyk7XG5cbiAgaWYgKCFjYW5jZWxsYXRpb25CdG4pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsbGF0aW9uX19tb2RhbCcpO1xuICBuZXcgTW9kYWwoY2FuY2VsbGF0aW9uQnRuLCBtb2RhbCk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkgey8vIGNvbnN0IGRhdGFCbG9jayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1jcmVhdGlvbicpO1xuICAvLyBpZiAoIWRhdGFCbG9jaykge1xuICAvLyAgIHJldHVybjtcbiAgLy8gfVxuICAvLyBjb25zdCByYWRpb3MgPSBkYXRhQmxvY2sucXVlcnlTZWxlY3RvckFsbCgnLnJhZGlvX19pbnB1dCcpO1xuICAvLyBjb25zdCBuZXh0QnRuID0gZGF0YUJsb2NrLnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1wYXltZW50X19uZXh0Jyk7XG4gIC8vIGxldCBzZWxlY3RlZCA9IDA7XG4gIC8vIGZ1bmN0aW9uIGlzUmFkaW9DaGVja2VkICgpIHtcbiAgLy8gICBsZXQgaXNDaGVja2VkID0gZmFsc2U7XG4gIC8vICAgcmFkaW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgICAgaWYgKGl0ZW0uY2hlY2tlZCkge1xuICAvLyAgICAgICBpc0NoZWNrZWQgPSB0cnVlO1xuICAvLyAgICAgfVxuICAvLyAgIH0pO1xuICAvLyAgIHJldHVybiBpc0NoZWNrZWQ7XG4gIC8vIH1cbiAgLy8gZnVuY3Rpb24gY2hlY2tEYXRhICgpIHtcbiAgLy8gICBpZiAoXG4gIC8vICAgICBzZWxlY3RlZCA+PSAzXG4gIC8vICAgICAmJiBpc1JhZGlvQ2hlY2tlZCgpXG4gIC8vICAgKSB7XG4gIC8vICAgICBpZiAobmV4dEJ0bi5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgLy8gICAgICAgbmV4dEJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJylcbiAgLy8gICAgIH1cbiAgLy8gICB9IGVsc2Uge1xuICAvLyAgICAgaWYgKCFuZXh0QnRuLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAvLyAgICAgICBuZXh0QnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyB9XG4gIC8vICQoJy5jb250cmFjdC1zdWJqZWN0X19hZ2VudCcpLm9uKCdzZWxlY3QyOnNlbGVjdCcsIGZ1bmN0aW9uKGUpIHtcbiAgLy8gICBzZWxlY3RlZCArPSAxO1xuICAvLyAgIGNoZWNrRGF0YSgpO1xuICAvLyB9KVxuICAvLyAkKCcuY29udHJhY3Qtc3ViamVjdF9fc2VydmljZScpLm9uKCdzZWxlY3QyOnNlbGVjdCcsIGZ1bmN0aW9uKCkge1xuICAvLyAgIHNlbGVjdGVkICs9MTtcbiAgLy8gICBjaGVja0RhdGEoKTtcbiAgLy8gfSlcbiAgLy8gcmFkaW9zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAvLyAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gIC8vICAgICBjaGVja0RhdGEoKTtcbiAgLy8gICB9KVxuICAvLyB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5kZWxpdmVyeS1vci1waWNrdXAuZG9uZScpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLmZpbmQoJy5jb250cmFjdC1pbmZvX19kZWxpdmVyZWQtYWRyZXNzJykuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLmZpbmQoJy5jb250cmFjdC1pbmZvX19kZWxpdmVyZWQtdG9nZ2xlJykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciBjb250cmFjdFNlcnZpY2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LXNlcnZpY2VzJyk7XG5cbiAgaWYgKCFjb250cmFjdFNlcnZpY2VzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbnRyYWN0LXNlcnZpY2VzX19saW5rJyk7XG5cbiAgdmFyIG9uTGlua0NsaWNrID0gZnVuY3Rpb24gb25MaW5rQ2xpY2soZSkge1xuICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICBjb25zb2xlLmxvZyh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVrY2JveC1idG5fX2xhYmVsJykpO1xuXG4gICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2NoZWNrYm94LWJ0bl9fbGFiZWwnKSB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2NoZWNrYm94JykgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJykgfHwgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY29udHJhY3Qtc2VydmljZXNfX2RlbGl2ZXJ5LWNvbmZpcm0nKSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgfTtcblxuICBsaW5rcy5mb3JFYWNoKGZ1bmN0aW9uIChsaW5rKSB7XG4gICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTGlua0NsaWNrKTtcbiAgfSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICB2YXIgY29udHJhY3RzQWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0cy1hbGwnKTtcblxuICBpZiAoIWNvbnRyYWN0c0FsbCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gICQoJy5kYXRlLWlucHV0JykuZGF0ZXBpY2tlcigpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGRlbGl2ZXJ5QnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5kZWxpdmVyLW9yLXBpY2t1cF9fY29uZmlybS1idG4nKTtcblxuICBpZiAoIWRlbGl2ZXJ5QnRuc1swXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcigpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbiAoZGF0ZVRleHQpIHtcbiAgICBvbkZpZWxkQ2hhbmdlKCk7XG4gIH0pO1xuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbCcpO1xuICB2YXIgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIHZhciBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIHZhciBzdWJtaXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX3N1Ym1pdCcpO1xuICB2YXIgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIHZhciBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgdmFyIGRhdGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLWRhdGUnKTtcbiAgdmFyIHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgdmFyIGNvbmZpcm1DaGVja2JveCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5jaGVja2JveF9faW5wdXQnKTtcbiAgZGVsaXZlcnlCdG5zLmZvckVhY2goZnVuY3Rpb24gKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgdmFyIG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uIG9uQ2xvc2VDbGljaygpIHtcbiAgICBpZiAoZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LmNvbnRhaW5zKCdsb2FkZWQnKSkge1xuICAgICAgZmlsZUlucHV0QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnbG9hZGVkJyk7XG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuXG4gICAgICBpZiAoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRhdGVJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHRpbWVJbnB1dC52YWx1ZSA9ICcnO1xuICAgIGNvbmZpcm1DaGVja2JveC5jaGVja2VkID0gZmFsc2U7XG4gICAgJCgnI2RlbGl2ZXJ5LWRhdGUnKS5kYXRlcGlja2VyKCdzZXREYXRlJywgJycpO1xuICB9O1xuXG4gIHZhciBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uIG9uT3ZlcmxheUNsaWNrKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIG9uRmllbGRDaGFuZ2UgPSBmdW5jdGlvbiBvbkZpZWxkQ2hhbmdlKGUpIHtcbiAgICBpZiAoaXNGb3JtRmlsbGVkKCkgJiYgc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc3VibWl0LnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9IGVsc2UgaWYgKCFpc0Zvcm1GaWxsZWQoKSAmJiAhc3VibWl0Lmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKSkge1xuICAgICAgc3VibWl0LnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgfVxuICB9O1xuXG4gIHZhciBpc0Zvcm1GaWxsZWQgPSBmdW5jdGlvbiBpc0Zvcm1GaWxsZWQoKSB7XG4gICAgcmV0dXJuICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignZ2V0RGF0ZScpICYmIHRpbWVJbnB1dC52YWx1ZSAhPT0gJycgJiYgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPT09IHRydWUgJiYgZmlsZUlucHV0LnZhbHVlICE9PSAnJztcbiAgfTtcblxuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIGRhdGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICB0aW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBvbkZpZWxkQ2hhbmdlKTtcbiAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uRmllbGRDaGFuZ2UpO1xuICBjb25maXJtQ2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWVsZENoYW5nZSk7XG59KSgpO1xuXG4oZnVuY3Rpb24gKCkge1xuICAkKCcuZmlsdGVyc19fYnRuJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICQodGhpcykucGFyZW50KCkubmV4dCgpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS50b2dnbGVDbGFzcygnb3BlbmVkJyk7XG4gIH0pO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHBheW1lbnRDb25maXJtQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYXltZW50LXdhaXRpbmdfX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFwYXltZW50Q29uZmlybUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcjcGF5bWVudC1kYXRlJykuZGF0ZXBpY2tlcigpO1xuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGF5bWVudC13YWl0aW5nX19tb2RhbCcpO1xuICB2YXIgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIHZhciBvdmVybGF5ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19vdmVybGF5Jyk7XG4gIHZhciBtYWluQ2hlY2tib3ggPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudHJhbnNhY3Rpb25zX19jaGVjay1hbGwgaW5wdXQnKTtcbiAgdmFyIHNlbmRlcklucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc2VuZGVyIGlucHV0Jyk7XG4gIHZhciByZWNpcGllbnRJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXJlY2lwaWVudCBpbnB1dCcpO1xuICB2YXIgc3VtSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcucGF5bWVudC13YWl0aW5nX19tb2RhbC1zdW0gaW5wdXQnKTtcbiAgdmFyIHB1cnBvc2VJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXB1cnBvc2UgaW5wdXQnKTtcblxuICB2YXIgZ2V0QWxsQ2hlY2tib3ggPSBmdW5jdGlvbiBnZXRBbGxDaGVja2JveCgpIHtcbiAgICByZXR1cm4gbW9kYWwucXVlcnlTZWxlY3RvckFsbCgnLnRyYW5zYWN0aW9uc19fY2hlY2sgaW5wdXQnKTtcbiAgfTtcblxuICB2YXIgb25BbGxDaGFuZ2UgPSBmdW5jdGlvbiBvbkFsbENoYW5nZSgpIHtcbiAgICBnZXRBbGxDaGVja2JveCgpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIGlmIChtYWluQ2hlY2tib3guY2hlY2tlZCkge1xuICAgICAgICBpdGVtLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgdmFyIG9uQ2xvc2VDbGljayA9IGZ1bmN0aW9uIG9uQ2xvc2VDbGljaygpIHtcbiAgICBtYWluQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gICAgfSk7XG4gICAgJCgnI3BheW1lbnQtZGF0ZScpLmRhdGVwaWNrZXIoJ3NldERhdGUnLCAnJyk7XG4gICAgc2VuZGVySW5wdXQudmFsdWUgPSAnJztcbiAgICByZWNpcGllbnRJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHN1bUlucHV0LnZhbHVlID0gJyc7XG4gICAgcHVycG9zZUlucHV0LnZhbHVlID0gJyc7XG4gIH07XG5cbiAgdmFyIG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24gb25PdmVybGF5Q2xpY2soZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgICAgIG9uQ2xvc2VDbGljaygpO1xuICAgIH1cbiAgfTtcblxuICBwYXltZW50Q29uZmlybUJ0bnMuZm9yRWFjaChmdW5jdGlvbiAoYnRuKSB7XG4gICAgbmV3IE1vZGFsKGJ0biwgbW9kYWwpO1xuICB9KTtcbiAgY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNsb3NlQ2xpY2spO1xuICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25PdmVybGF5Q2xpY2spO1xuICBtYWluQ2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25BbGxDaGFuZ2UpO1xufSkoKTtcblxuKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHNjaGVkdWxlQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1kZXZpY2VfX3NjaGVkdWxlJyk7XG5cbiAgaWYgKCFzY2hlZHVsZUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NoZWR1bGVfX21vZGFsJyk7XG4gIHZhciByYWRpb3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2NoZWR1bGVfX21vZGFsLXRvZ2dsZSBpbnB1dCcpO1xuICB2YXIgdG9nZ2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlX19tb2RhbC10b2dnbGUnKTtcbiAgcmFkaW9zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGlkKSB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaWQgPT09IDApIHtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5yZW1vdmUoJ3NlY29uZC10YWInKTtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5hZGQoJ2ZpcnN0LXRhYicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaWQgPT09IDEpIHtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5yZW1vdmUoJ2ZpcnN0LXRhYicpO1xuICAgICAgICB0b2dnbGUuY2xhc3NMaXN0LmFkZCgnc2Vjb25kLXRhYicpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbiAgc2NoZWR1bGVCdG5zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICBuZXcgTW9kYWwoaXRlbSwgbW9kYWwpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gICQoJy5zdXBwb3J0X19kb2NzLWJ0bicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG5cbihmdW5jdGlvbiAoKSB7XG4gIHZhciB2ZXJpZmljYXRpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3QtaW5mb19fdmVyaWZpY2F0aW9uJyk7XG5cbiAgaWYgKCF2ZXJpZmljYXRpb25CdG4pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmVyaWZpY2F0aW9uX19tb2RhbCcpO1xuICB2YXIgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudmVyaWZpY2F0aW9uX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIHZhciBmaWxlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtZmlsZV9faW5wdXQnKTtcbiAgdmFyIGNsb3NlID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19jbG9zZScpO1xuICB2YXIgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICB2YXIgc2F2ZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fc2F2ZScpO1xuXG4gIHZhciBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbiBvbkNsb3NlQ2xpY2soKSB7XG4gICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG4gICAgICBzYXZlQnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG5cbiAgICAgIGlmICghL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHZhciBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uIG9uT3ZlcmxheUNsaWNrKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgICB9XG4gIH07XG5cbiAgdmFyIG9uSW5wdXRDaGFuZ2UgPSBmdW5jdGlvbiBvbklucHV0Q2hhbmdlKCkge1xuICAgIGlmIChmaWxlSW5wdXQudmFsdWUgIT09ICcnKSB7XG4gICAgICBzYXZlQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG4gIH07XG5cbiAgbmV3IE1vZGFsKHZlcmlmaWNhdGlvbkJ0biwgbW9kYWwpO1xuICBjbG9zZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xvc2VDbGljayk7XG4gIG92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk92ZXJsYXlDbGljayk7XG4gIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbklucHV0Q2hhbmdlKTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjaGVja2JveDIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY2hlY2tib3gtMl9faW5wdXQnKTtcblxuICBpZiAoIWNoZWNrYm94MlswXSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNoZWNrYm94Mi5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgaWYgKHRhcmdldC5jaGVja2VkID09PSB0cnVlKSB7XG4gICAgICAgIHRhcmdldC5wYXJlbnROb2RlLmNsYXNzTGlzdC5hZGQoJ2NoZWNrZWQnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhcmdldC5wYXJlbnROb2RlLmNsYXNzTGlzdC5yZW1vdmUoJ2NoZWNrZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICQoJy5kYXRlLWlucHV0JykuZGF0ZXBpY2tlcigpO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgZmlsZURyb3BBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LWZpbGVfX2xhYmVsJyk7XG5cbiAgZnVuY3Rpb24gbWFrZUZpbGVMb2FkKGZpbGVEcm9wQXJlYSkge1xuICAgIGNvbnN0IGZpbGVJbnB1dCA9IGZpbGVEcm9wQXJlYS5xdWVyeVNlbGVjdG9yKCdpbnB1dCcpO1xuICAgIGNvbnN0IGZpbGVDbGVhciA9IGZpbGVEcm9wQXJlYS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5maWxlLWxvYWRfX2NsZWFyJyk7XG4gICAgLy8g0KHQsdGA0LDRgdGL0LLQsNC10Lwg0YHRgtCw0L3QtNCw0YDRgtC90YvQtSDRgdC+0LHRi9GC0LjRjyDQv9GA0Lgg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQuCDRhNCw0LnQu9CwXG5cbiAgICBbJ2RyYWdlbnRlcicsICdkcmFnb3ZlcicsICdkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgcHJldmVudERlZmF1bHRzLCBmYWxzZSlcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0cyAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9O1xuXG4gICAgLy8g0JTQvtCx0LDQstC70Y/QtdC8INGB0YLQuNC70Lgg0L/RgNC4INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40Lgg0YTQsNC50LvQsCDQvdCw0LQg0L3Rg9C20L3QvtC5INC+0LHQu9Cw0YHRgtGM0Y5cblxuICAgIFsnZHJhZ2VudGVyJywgJ2RyYWdvdmVyJ10uZm9yRWFjaChldmVudE5hbWUgPT4ge1xuICAgICAgZmlsZURyb3BBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoaWdobGlnaHQsIGZhbHNlKVxuICAgIH0pO1xuXG4gICAgWydkcmFnbGVhdmUnLCAnZHJvcCddLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgIGZpbGVEcm9wQXJlYS5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdW5oaWdobGlnaHQsIGZhbHNlKVxuICAgIH0pXG5cbiAgICBmdW5jdGlvbiBoaWdobGlnaHQoZSkge1xuICAgICAgZmlsZURyb3BBcmVhLmNsYXNzTGlzdC5hZGQoJ2hpZ2hsaWdodCcpO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiB1bmhpZ2hsaWdodChlKSB7XG4gICAgICBmaWxlRHJvcEFyZWEuY2xhc3NMaXN0LnJlbW92ZSgnaGlnaGxpZ2h0Jyk7XG4gICAgfTtcblxuICAgIC8vXG5cbiAgICBmaWxlRHJvcEFyZWEuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGhhbmRsZURyb3AsIGZhbHNlKVxuXG4gICAgZnVuY3Rpb24gaGFuZGxlRHJvcChlKSB7XG4gICAgICBsZXQgZHQgPSBlLmRhdGFUcmFuc2ZlclxuICAgICAgbGV0IGZpbGVzID0gZHQuZmlsZXNcblxuICAgICAgaWYgKGZpbGVJbnB1dC5maWxlcyAmJiBmaWxlSW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZpbGVJbnB1dC5maWxlcyA9IGZpbGVzO1xuICAgICAgb25GaWxlQ2hhbmdlKCk7XG4gICAgfTtcblxuICAgIGNvbnN0IG9uRmlsZUNoYW5nZSA9ICgpID0+IHtcbiAgICAgIHJlYWRVcmwoZmlsZUlucHV0KTtcbiAgICB9XG5cbiAgICBjb25zdCByZWFkVXJsID0gKGlucHV0KSA9PiB7XG4gICAgICBpZiAoaW5wdXQuZmlsZXMgJiYgaW5wdXQuZmlsZXNbMF0pIHtcbiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG5cbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgZmlsZURyb3BBcmVhLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnbG9hZGVkJyk7XG4gICAgICAgICAgZmlsZURyb3BBcmVhXG4gICAgICAgICAgICAubmV4dEVsZW1lbnRTaWJsaW5nXG4gICAgICAgICAgICAucXVlcnlTZWxlY3RvcignLmZpbGUtbG9hZF9fbmFtZScpXG4gICAgICAgICAgICAudGV4dENvbnRlbnQgPSBpbnB1dC5maWxlc1swXS5uYW1lO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW5wdXQuZmlsZXNbMF0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uQ2xlYXIoKSB7XG4gICAgICBmaWxlRHJvcEFyZWEucGFyZW50Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCdsb2FkZWQnKTtcblxuICAgICAgZmlsZUlucHV0LnZhbHVlID0gJyc7XG5cbiAgICAgIGlmKCEvc2FmYXJpL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSl7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJyc7XG4gICAgICAgIGZpbGVJbnB1dC50eXBlID0gJ2ZpbGUnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpbGVDaGFuZ2UpO1xuICAgIGZpbGVDbGVhci5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2xlYXIpO1xuICB9XG5cbiAgd2luZG93Lm1ha2VGaWxlTG9hZCA9IG1ha2VGaWxlTG9hZDtcblxuXG4gIGlmICghZmlsZURyb3BBcmVhWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgZmlsZURyb3BBcmVhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG1ha2VGaWxlTG9hZChpdGVtKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBpbnB1dHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuaW5wdXQtdGV4dCcpO1xuXG4gIGlmICghaW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaW5wdXRzLmZvckVhY2goZnVuY3Rpb24oaW5wdXQpIHtcbiAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoXG4gICAgICAgIGlucHV0LnZhbHVlLnNwbGl0KCcgJykuam9pbignJykgPT09ICcnXG4gICAgICApIHtcbiAgICAgICAgaW5wdXQudmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpbnB1dC52YWx1ZSAhPT0gJydcbiAgICAgICAgJiYgIWlucHV0LmNsYXNzTGlzdC5jb250YWlucygnanMtaW5wdXRlZCcpXG4gICAgICApIHtcbiAgICAgICAgaW5wdXQuY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIGlucHV0LnZhbHVlID09PSAnJ1xuICAgICAgICAmJiBpbnB1dC5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKVxuICAgICAgKSB7XG4gICAgICAgIGlucHV0LmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KSgpO1xuIiwiKCgpID0+IHtcbiAgbGV0IHZoID0gd2luZG93LmlubmVySGVpZ2h0ICogMC4wMTtcbiAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCctLXZoJywgYCR7dmh9cHhgKTtcblxuICBjb25zdCAkYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcblxuICBmdW5jdGlvbiBkZWJvdW5jZShmdW5jKXtcbiAgICB2YXIgdGltZXI7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgIGlmKHRpbWVyKSBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KGZ1bmMsMTAwLGV2ZW50KTtcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gTW9kYWwgKHRyaWdnZXIsIG1vZGFsKSB7XG4gICAgdGhpcy50cmlnZ2VyID0gdHJpZ2dlcjtcbiAgICB0aGlzLm1vZGFsID0gbW9kYWw7XG4gICAgdGhpcy5vdmVybGF5ID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgICB0aGlzLmNsb3NlQnRuID0gdGhpcy5tb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG5cbiAgICB0aGlzLm9uT3ZlcmxheUNsaWNrID0gdGhpcy5vbk92ZXJsYXlDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DbG9zZUNsaWNrID0gdGhpcy5vbkNsb3NlQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLm9uVHJpZ2dlckNsaWNrID0gdGhpcy5vblRyaWdnZXJDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25SZXNpemUgPSB0aGlzLm9uUmVzaXplLmJpbmQodGhpcyk7XG5cbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXJzKCk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kYWwuY2xhc3NMaXN0LmFkZCgnanMtc2hvdycpO1xuICAgICRib2R5LmNsYXNzTGlzdC5hZGQoJ2pzX19ib2R5LW5vLXNjcm9sbCcpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdqcy1zaG93Jyk7XG4gICAgJGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnanNfX2JvZHktbm8tc2Nyb2xsJyk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLm92ZXJsYXkpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5jbG9zZSgpO1xuICB9XG5cbiAgTW9kYWwucHJvdG90eXBlLm9uVHJpZ2dlckNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5vcGVuKCk7XG4gIH1cblxuICBNb2RhbC5wcm90b3R5cGUub25SZXNpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgIGxldCB2aCA9IHdpbmRvdy5pbm5lckhlaWdodCAqIDAuMDE7XG4gICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tdmgnLCBgJHt2aH1weGApO1xuICB9O1xuXG4gIE1vZGFsLnByb3RvdHlwZS5hZGRFdmVudExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMub3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25PdmVybGF5Q2xpY2spO1xuICAgIHRoaXMuY2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQ2xvc2VDbGljayk7XG4gICAgdGhpcy50cmlnZ2VyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5vblRyaWdnZXJDbGljayk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGRlYm91bmNlKHRoaXMub25SZXNpemUpKTtcbiAgfVxuXG4gIHdpbmRvdy5Nb2RhbCA9IE1vZGFsO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgaW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmlucHV0LXBob25lJyk7XG5cbiAgaWYgKCFpbnB1dHNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBpbSA9IG5ldyBJbnB1dG1hc2soXCIrNyg5OTkpIDk5OS05OS05OVwiKTtcblxuICBpbnB1dHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgaW0ubWFzayhpdGVtKTtcbiAgfSlcbn0pKCk7XG4iLCIoKCkgPT4ge1xuICBjb25zdCBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zZWFyY2gnKTtcbiAgY29uc3QgY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VhcmNoICsgLnNlYXJjaC1jbG9zZScpO1xuXG4gIGlmICghaXRlbXNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBpdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gIC8vICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsICgpID0+e1xuICAvLyAgICAgaXRlbS5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0LmFkZCgnanMtZm9jdXMnKTtcbiAgLy8gICB9KTtcbiAgLy8gfSk7XG5cbiAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgaXRlbS52YWx1ZS5zcGxpdCgnICcpLmpvaW4oJycpID09PSAnJ1xuICAgICAgKSB7XG4gICAgICAgIGl0ZW0udmFsdWUgPSAnJztcbiAgICAgIH1cblxuICAgICAgaWYgKFxuICAgICAgICBpdGVtLnZhbHVlICE9PSAnJ1xuICAgICAgICAmJiAhaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2pzLWlucHV0ZWQnKVxuICAgICAgKSB7XG4gICAgICAgIGl0ZW0uY2xhc3NMaXN0LmFkZCgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoXG4gICAgICAgIGl0ZW0udmFsdWUgPT09ICcnXG4gICAgICAgICYmIGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBpdGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2pzLWlucHV0ZWQnKTtcbiAgICAgIH1cbiAgICB9KVxuICB9KTtcblxuICBjbG9zZS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgaXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNlYXJjaCA9IGl0ZW0ucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgIHNlYXJjaC52YWx1ZSA9ICcnO1xuICAgICAgaWYgKFxuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LmNvbnRhaW5zKCdqcy1pbnB1dGVkJylcbiAgICAgICkge1xuICAgICAgICBzZWFyY2guY2xhc3NMaXN0LnJlbW92ZSgnanMtaW5wdXRlZCcpO1xuICAgICAgfVxuICAgIH0pXG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICBmdW5jdGlvbiBmb3JtYXRPcHRpb24gKGl0ZW0pIHtcbiAgICBjb25zdCB2YWx1ZSA9IGl0ZW0udGV4dC5zcGxpdCgnc3BsaXR0ZXInKTtcblxuICAgIGlmICh2YWx1ZS5sZW5ndGggPiAxKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSAkKCc8c3Bhbj4nXG4gICAgICAgICsgdmFsdWVbMF1cbiAgICAgICAgKyAnPC9zcGFuPjxzcGFuPidcbiAgICAgICAgKyB2YWx1ZVsxXVxuICAgICAgICArICc8L3NwYW4+Jyk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gaXRlbS50ZXh0O1xuICAgIH1cbiAgfVxuXG4gICQoJy5zZWxlY3QnKS5zZWxlY3QyKHtcbiAgICB0ZW1wbGF0ZVJlc3VsdDogZm9ybWF0T3B0aW9uLFxuICAgIHRlbXBsYXRlU2VsZWN0aW9uOiBmb3JtYXRPcHRpb25cbiAgfSk7XG5cbiAgJCgnLnNlbGVjdCcpLm9uKCdzZWxlY3QyOnNlbGVjdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgJCh0aGlzKS5hZGRDbGFzcygncGlja2VkJyk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgZGVsaXZlcnlUaW1lSW5wdXRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmRlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwtdGltZScpO1xuXG4gIGlmICghZGVsaXZlcnlUaW1lSW5wdXRzWzBdKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGltID0gbmV3IElucHV0bWFzayhcIjk5Ojk5XCIpO1xuXG4gIGRlbGl2ZXJ5VGltZUlucHV0cy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBpbS5tYXNrKGl0ZW0pO1xuICB9KTtcblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgY29uc3QgY2FuY2VsbGF0aW9uQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LWluZm9fX2NhbmNlbGxhdGlvbicpO1xuXG4gIGlmICghY2FuY2VsbGF0aW9uQnRuKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsbGF0aW9uX19tb2RhbCcpO1xuXG4gIG5ldyBNb2RhbChjYW5jZWxsYXRpb25CdG4sIG1vZGFsKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgJCgnLmRlbGl2ZXJ5LW9yLXBpY2t1cC5kb25lJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5maW5kKCcuY29udHJhY3QtaW5mb19fZGVsaXZlcmVkLWFkcmVzcycpLnNsaWRlVG9nZ2xlKCk7XG4gICAgJCh0aGlzKS5maW5kKCcuY29udHJhY3QtaW5mb19fZGVsaXZlcmVkLXRvZ2dsZScpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdFNlcnZpY2VzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbnRyYWN0LXNlcnZpY2VzJyk7XG5cbiAgaWYgKCFjb250cmFjdFNlcnZpY2VzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29udHJhY3Qtc2VydmljZXNfX2xpbmsnKTtcblxuICBjb25zdCBvbkxpbmtDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgICBjb25zdCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICBjb25zb2xlLmxvZyh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVrY2JveC1idG5fX2xhYmVsJykpO1xuXG4gICAgaWYgKFxuICAgICAgdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY2hlY2tib3gtYnRuX19sYWJlbCcpXG4gICAgICB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjaGVja2JveC1idG5fX2NoZWNrYm94JylcbiAgICAgIHx8IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2RlbGl2ZXItb3ItcGlja3VwX19jb25maXJtLWJ0bicpXG4gICAgICB8fCB0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb250cmFjdC1zZXJ2aWNlc19fZGVsaXZlcnktY29uZmlybScpXG4gICAgKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICB9XG5cbiAgbGlua3MuZm9yRWFjaChmdW5jdGlvbihsaW5rKSB7XG4gICAgbGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uTGlua0NsaWNrKTtcbiAgfSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBjb250cmFjdHNBbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29udHJhY3RzLWFsbCcpO1xuXG4gIGlmICghY29udHJhY3RzQWxsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgJCgnLmRhdGUtaW5wdXQnKS5kYXRlcGlja2VyKCk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuICBjb25zdCBkZWxpdmVyeUJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZGVsaXZlci1vci1waWNrdXBfX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFkZWxpdmVyeUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoKS5vbignY2hhbmdlJywgZnVuY3Rpb24oZGF0ZVRleHQpIHtcbiAgICBvbkZpZWxkQ2hhbmdlKCk7XG4gIH0pO1xuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlbGl2ZXJ5LW9yLXBpY2t1cF9fbW9kYWwnKTtcbiAgY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgY29uc3Qgc3VibWl0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLm1vZGFsX19zdWJtaXQnKTtcbiAgY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICBjb25zdCBkYXRlSW5wdXQgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcuZGVsaXZlcnktb3ItcGlja3VwX19tb2RhbC1kYXRlJyk7XG4gIGNvbnN0IHRpbWVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5kZWxpdmVyeS1vci1waWNrdXBfX21vZGFsLXRpbWUnKTtcbiAgY29uc3QgY29uZmlybUNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLmNoZWNrYm94X19pbnB1dCcpO1xuXG4gIGRlbGl2ZXJ5QnRucy5mb3JFYWNoKGZ1bmN0aW9uKGJ0bikge1xuICAgIG5ldyBNb2RhbChidG4sIG1vZGFsKTtcbiAgfSk7XG5cbiAgY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuXG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuXG4gICAgICBpZighL3NhZmFyaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpe1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICcnO1xuICAgICAgICBmaWxlSW5wdXQudHlwZSA9ICdmaWxlJztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkYXRlSW5wdXQudmFsdWUgPSAnJztcbiAgICB0aW1lSW5wdXQudmFsdWUgPSAnJztcbiAgICBjb25maXJtQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgICQoJyNkZWxpdmVyeS1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgfVxuXG4gIGNvbnN0IG9uT3ZlcmxheUNsaWNrID0gZnVuY3Rpb24oZSkge1xuICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21vZGFsX19vdmVybGF5JykpIHtcbiAgICAgIG9uQ2xvc2VDbGljaygpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG9uRmllbGRDaGFuZ2UgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGlzRm9ybUZpbGxlZCgpICYmIHN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHN1Ym1pdC5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XG4gICAgfSBlbHNlIGlmICghaXNGb3JtRmlsbGVkKCkgJiYgIXN1Ym1pdC5oYXNBdHRyaWJ1dGUoJ2Rpc2FibGVkJykpIHtcbiAgICAgIHN1Ym1pdC5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJycpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGlzRm9ybUZpbGxlZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAkKCcjZGVsaXZlcnktZGF0ZScpLmRhdGVwaWNrZXIoJ2dldERhdGUnKVxuICAgICAgJiYgdGltZUlucHV0LnZhbHVlICE9PSAnJ1xuICAgICAgJiYgY29uZmlybUNoZWNrYm94LmNoZWNrZWQgPT09IHRydWVcbiAgICAgICYmIGZpbGVJbnB1dC52YWx1ZSAhPT0gJydcbiAgfVxuXG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgZGF0ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgb25GaWVsZENoYW5nZSk7XG4gIHRpbWVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIG9uRmllbGRDaGFuZ2UpO1xuICBmaWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgb25GaWVsZENoYW5nZSk7XG4gIGNvbmZpcm1DaGVja2JveC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkZpZWxkQ2hhbmdlKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gICQoJy5maWx0ZXJzX19idG4nKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAkKHRoaXMpLnBhcmVudCgpLm5leHQoKS5zbGlkZVRvZ2dsZSgpO1xuICAgICQodGhpcykudG9nZ2xlQ2xhc3MoJ29wZW5lZCcpO1xuICB9KTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHBheW1lbnRDb25maXJtQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5wYXltZW50LXdhaXRpbmdfX2NvbmZpcm0tYnRuJyk7XG5cbiAgaWYgKCFwYXltZW50Q29uZmlybUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAkKCcjcGF5bWVudC1kYXRlJykuZGF0ZXBpY2tlcigpO1xuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BheW1lbnQtd2FpdGluZ19fbW9kYWwnKTtcbiAgY29uc3QgY2xvc2UgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2Nsb3NlJyk7XG4gIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX292ZXJsYXknKTtcbiAgY29uc3QgbWFpbkNoZWNrYm94ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnRyYW5zYWN0aW9uc19fY2hlY2stYWxsIGlucHV0Jyk7XG4gIGNvbnN0IHNlbmRlcklucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc2VuZGVyIGlucHV0Jyk7XG4gIGNvbnN0IHJlY2lwaWVudElucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtcmVjaXBpZW50IGlucHV0Jyk7XG4gIGNvbnN0IHN1bUlucHV0ID0gbW9kYWwucXVlcnlTZWxlY3RvcignLnBheW1lbnQtd2FpdGluZ19fbW9kYWwtc3VtIGlucHV0Jyk7XG4gIGNvbnN0IHB1cnBvc2VJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5wYXltZW50LXdhaXRpbmdfX21vZGFsLXB1cnBvc2UgaW5wdXQnKTtcblxuICBjb25zdCBnZXRBbGxDaGVja2JveCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBtb2RhbC5xdWVyeVNlbGVjdG9yQWxsKCcudHJhbnNhY3Rpb25zX19jaGVjayBpbnB1dCcpO1xuICB9O1xuXG4gIGNvbnN0IG9uQWxsQ2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgZ2V0QWxsQ2hlY2tib3goKS5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGlmIChtYWluQ2hlY2tib3guY2hlY2tlZCkge1xuICAgICAgICBpdGVtLmNoZWNrZWQgPSB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXRlbS5jaGVja2VkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfSlcbiAgfTtcblxuICBjb25zdCBvbkNsb3NlQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICBtYWluQ2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICAgIGdldEFsbENoZWNrYm94KCkuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgICBpdGVtLmNoZWNrZWQgPSBmYWxzZTtcbiAgICB9KTtcbiAgICAkKCcjcGF5bWVudC1kYXRlJykuZGF0ZXBpY2tlcignc2V0RGF0ZScsICcnKTtcbiAgICBzZW5kZXJJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHJlY2lwaWVudElucHV0LnZhbHVlID0gJyc7XG4gICAgc3VtSW5wdXQudmFsdWUgPSAnJztcbiAgICBwdXJwb3NlSW5wdXQudmFsdWUgPSAnJztcbiAgfTtcblxuICBjb25zdCBvbk92ZXJsYXlDbGljayA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbF9fb3ZlcmxheScpKSB7XG4gICAgICBvbkNsb3NlQ2xpY2soKTtcbiAgICB9XG4gIH1cblxuICBwYXltZW50Q29uZmlybUJ0bnMuZm9yRWFjaChmdW5jdGlvbihidG4pIHtcbiAgICBuZXcgTW9kYWwoYnRuLCBtb2RhbCk7XG4gIH0pO1xuXG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgbWFpbkNoZWNrYm94LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uQWxsQ2hhbmdlKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHNjaGVkdWxlQnRucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb250cmFjdC1kZXZpY2VfX3NjaGVkdWxlJyk7XG5cbiAgaWYgKCFzY2hlZHVsZUJ0bnNbMF0pIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY2hlZHVsZV9fbW9kYWwnKTtcbiAgY29uc3QgcmFkaW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNjaGVkdWxlX19tb2RhbC10b2dnbGUgaW5wdXQnKTtcbiAgY29uc3QgdG9nZ2xlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNjaGVkdWxlX19tb2RhbC10b2dnbGUnKTtcblxuICByYWRpb3MuZm9yRWFjaChmdW5jdGlvbihpdGVtLCBpZCkge1xuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoaWQgPT09IDApIHtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5yZW1vdmUoJ3NlY29uZC10YWInKTtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5hZGQoJ2ZpcnN0LXRhYicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaWQgPT09IDEpIHtcbiAgICAgICAgdG9nZ2xlLmNsYXNzTGlzdC5yZW1vdmUoJ2ZpcnN0LXRhYicpO1xuICAgICAgICB0b2dnbGUuY2xhc3NMaXN0LmFkZCgnc2Vjb25kLXRhYicpO1xuICAgICAgfVxuICAgIH0pXG4gIH0pXG5cbiAgc2NoZWR1bGVCdG5zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIG5ldyBNb2RhbChpdGVtLCBtb2RhbCk7XG4gIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcbiAgJCgnLnN1cHBvcnRfX2RvY3MtYnRuJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgJCh0aGlzKS5wYXJlbnQoKS5uZXh0KCkuc2xpZGVUb2dnbGUoKTtcbiAgICAkKHRoaXMpLnRvZ2dsZUNsYXNzKCdvcGVuZWQnKTtcbiAgfSlcbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHZlcmlmaWNhdGlvbkJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb250cmFjdC1pbmZvX192ZXJpZmljYXRpb24nKTtcblxuICBpZiAoIXZlcmlmaWNhdGlvbkJ0bikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZlcmlmaWNhdGlvbl9fbW9kYWwnKTtcbiAgY29uc3QgZmlsZUlucHV0QmxvY2sgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCcudmVyaWZpY2F0aW9uX19tb2RhbC1pbnB1dC1maWxlJyk7XG4gIGNvbnN0IGZpbGVJbnB1dCA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5pbnB1dC1maWxlX19pbnB1dCcpO1xuICBjb25zdCBjbG9zZSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fY2xvc2UnKTtcbiAgY29uc3Qgb3ZlcmxheSA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbF9fb3ZlcmxheScpO1xuICBjb25zdCBzYXZlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsX19zYXZlJyk7XG5cbiAgY29uc3Qgb25DbG9zZUNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5jb250YWlucygnbG9hZGVkJykpIHtcbiAgICAgIGZpbGVJbnB1dEJsb2NrLmNsYXNzTGlzdC5yZW1vdmUoJ2xvYWRlZCcpO1xuXG4gICAgICBmaWxlSW5wdXQudmFsdWUgPSAnJztcbiAgICAgIHNhdmVCdG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcblxuICAgICAgaWYoIS9zYWZhcmkvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXtcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnJztcbiAgICAgICAgZmlsZUlucHV0LnR5cGUgPSAnZmlsZSc7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgb25PdmVybGF5Q2xpY2sgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnbW9kYWxfX292ZXJsYXknKSkge1xuICAgICAgb25DbG9zZUNsaWNrKCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3Qgb25JbnB1dENoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmIChmaWxlSW5wdXQudmFsdWUgIT09ICcnKSB7XG4gICAgICBzYXZlQnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICB9XG4gIH1cblxuICBuZXcgTW9kYWwodmVyaWZpY2F0aW9uQnRuLCBtb2RhbCk7XG4gIGNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DbG9zZUNsaWNrKTtcbiAgb3ZlcmxheS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uT3ZlcmxheUNsaWNrKTtcbiAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIG9uSW5wdXRDaGFuZ2UpO1xufSkoKTtcbiJdfQ==
